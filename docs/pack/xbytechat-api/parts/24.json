{
  "name": "xbytechat-api",
  "part": 24,
  "of": 25,
  "generatedAt": "2025-12-10 08:27:07 +00:00",
  "files": [
    {
      "path": "xbytechat-api/Migrations/20251201043515_AddContactIdinFlowExecutionContextTble.Designer.cs",
      "sha256": "38ec12c51164042c2f74ee5e9c861aa3e8339a67977143f70858e3c323edd93d",
      "language": "csharp",
      "size": 188960,
      "content": "// <auto-generated />\nusing System;\nusing Microsoft.EntityFrameworkCore;\nusing Microsoft.EntityFrameworkCore.Infrastructure;\nusing Microsoft.EntityFrameworkCore.Migrations;\nusing Microsoft.EntityFrameworkCore.Storage.ValueConversion;\nusing Npgsql.EntityFrameworkCore.PostgreSQL.Metadata;\nusing xbytechat.api;\n\n#nullable disable\n\nnamespace xbytechat.api.Migrations\n{\n    [DbContext(typeof(AppDbContext))]\n    [Migration(\"20251201043515_AddContactIdinFlowExecutionContextTble\")]\n    partial class AddContactIdinFlowExecutionContextTble\n    {\n        /// <inheritdoc />\n        protected override void BuildTargetModel(ModelBuilder modelBuilder)\n        {\n#pragma warning disable 612, 618\n            modelBuilder\n                .HasAnnotation(\"ProductVersion\", \"8.0.18\")\n                .HasAnnotation(\"Relational:MaxIdentifierLength\", 63);\n\n            NpgsqlModelBuilderExtensions.UseIdentityByDefaultColumns(modelBuilder);\n\n            modelBuilder.Entity(\"ContactTag\", b =>\n                {\n                    b.Property<Guid>(\"Id\")\n                        .ValueGeneratedOnAdd()\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<DateTime>(\"AssignedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<string>(\"AssignedBy\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<Guid>(\"BusinessId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<Guid>(\"ContactId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<Guid>(\"TagId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.HasKey(\"Id\");\n\n                    b.HasIndex(\"ContactId\");\n\n                    b.HasIndex(\"TagId\");\n\n                    b.ToTable(\"ContactTags\");\n                });\n\n            modelBuilder.Entity(\"MessageLog\", b =>\n                {\n                    b.Property<Guid>(\"Id\")\n                        .ValueGeneratedOnAdd()\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<Guid>(\"BusinessId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<string>(\"ButtonBundleJson\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<Guid?>(\"CTAFlowConfigId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<Guid?>(\"CTAFlowStepId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<Guid?>(\"CampaignId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<Guid?>(\"ContactId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<string>(\"ConversationCategory\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"ConversationId\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<DateTimeOffset?>(\"ConversationStartedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<DateTime>(\"CreatedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<string>(\"ErrorMessage\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<int?>(\"FlowVersion\")\n                        .HasColumnType(\"integer\");\n\n                    b.Property<bool?>(\"IsChargeable\")\n                        .HasColumnType(\"boolean\");\n\n                    b.Property<bool>(\"IsIncoming\")\n                        .HasColumnType(\"boolean\");\n\n                    b.Property<string>(\"MediaUrl\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"MessageContent\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"MessageId\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<DateTime?>(\"MessageTime\")\n                        .ValueGeneratedOnAddOrUpdate()\n                        .HasColumnType(\"timestamp with time zone\")\n                        .HasComputedColumnSql(\"COALESCE(\\\"SentAt\\\", \\\"CreatedAt\\\")\", true);\n\n                    b.Property<decimal?>(\"PriceAmount\")\n                        .HasColumnType(\"numeric\");\n\n                    b.Property<string>(\"PriceCurrency\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"Provider\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"ProviderMessageId\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"RawResponse\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"RecipientNumber\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<Guid?>(\"RefMessageId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<string>(\"RenderedBody\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<Guid?>(\"RunId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<DateTime?>(\"SentAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<string>(\"Source\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"Status\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.HasKey(\"Id\");\n\n                    b.HasIndex(\"CampaignId\")\n                        .HasDatabaseName(\"IX_MessageLogs_Campaign\");\n\n                    b.HasIndex(\"ContactId\");\n\n                    b.HasIndex(\"MessageId\");\n\n                    b.HasIndex(\"ProviderMessageId\")\n                        .HasDatabaseName(\"IX_MessageLogs_ProviderMessageId\")\n                        .HasFilter(\"\\\"ProviderMessageId\\\" IS NOT NULL\");\n\n                    b.HasIndex(\"RunId\");\n\n                    b.HasIndex(\"BusinessId\", \"ConversationId\")\n                        .HasDatabaseName(\"IX_MessageLogs_BizConversation\")\n                        .HasFilter(\"\\\"ConversationId\\\" IS NOT NULL\");\n\n                    b.HasIndex(\"BusinessId\", \"CreatedAt\")\n                        .HasDatabaseName(\"IX_MessageLogs_BizCreatedAt\");\n\n                    b.HasIndex(\"BusinessId\", \"MessageId\")\n                        .HasDatabaseName(\"IX_MessageLogs_Business_MessageId\");\n\n                    b.HasIndex(\"BusinessId\", \"ProviderMessageId\")\n                        .HasDatabaseName(\"IX_MessageLogs_BizProviderMessage\")\n                        .HasFilter(\"\\\"ProviderMessageId\\\" IS NOT NULL\");\n\n                    b.HasIndex(\"BusinessId\", \"RecipientNumber\")\n                        .HasDatabaseName(\"IX_MessageLogs_Business_Recipient\");\n\n                    b.HasIndex(\"BusinessId\", \"IsIncoming\", \"ContactId\", \"MessageTime\")\n                        .HasDatabaseName(\"ix_msglogs_biz_in_contact_msgtime\");\n\n                    b.ToTable(\"MessageLogs\");\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.AuthModule.Models.User\", b =>\n                {\n                    b.Property<Guid>(\"Id\")\n                        .ValueGeneratedOnAdd()\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<Guid?>(\"BusinessId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<DateTime>(\"CreatedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<DateTime?>(\"DeletedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<string>(\"Email\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<bool>(\"IsDeleted\")\n                        .HasColumnType(\"boolean\");\n\n                    b.Property<string>(\"Name\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"PasswordHash\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"RefreshToken\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<DateTime?>(\"RefreshTokenExpiry\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<Guid?>(\"RoleId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<string>(\"Status\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.HasKey(\"Id\");\n\n                    b.HasIndex(\"BusinessId\");\n\n                    b.HasIndex(\"RoleId\");\n\n                    b.ToTable(\"Users\");\n\n                    b.HasData(\n                        new\n                        {\n                            Id = new Guid(\"62858aa2-3a54-4fd5-8696-c343d9af7634\"),\n                            CreatedAt = new DateTime(2025, 1, 1, 0, 0, 0, 0, DateTimeKind.Utc),\n                            Email = \"admin@xbytechat.com\",\n                            IsDeleted = false,\n                            Name = \"Super Admin\",\n                            PasswordHash = \"JAvlGPq9JyTdtvBO6x2llnRI1+gxwIyPqCKAn3THIKk=\",\n                            RoleId = new Guid(\"00000000-0000-0000-0000-000000000001\"),\n                            Status = \"active\"\n                        });\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.AuthModule.Models.WhatsAppTemplate\", b =>\n                {\n                    b.Property<Guid>(\"Id\")\n                        .ValueGeneratedOnAdd()\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<string>(\"Body\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"BodyPreview\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<int>(\"BodyVarCount\")\n                        .HasColumnType(\"integer\");\n\n                    b.Property<Guid>(\"BusinessId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<string>(\"Category\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<DateTime>(\"CreatedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<bool>(\"HasPhoneButton\")\n                        .HasColumnType(\"boolean\");\n\n                    b.Property<string>(\"HeaderKind\")\n                        .IsRequired()\n                        .HasMaxLength(16)\n                        .HasColumnType(\"character varying(16)\");\n\n                    b.Property<string>(\"HeaderText\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<int>(\"HeaderTextVarCount\")\n                        .HasColumnType(\"integer\");\n\n                    b.Property<bool>(\"IsActive\")\n                        .HasColumnType(\"boolean\");\n\n                    b.Property<string>(\"LanguageCode\")\n                        .IsRequired()\n                        .HasMaxLength(16)\n                        .HasColumnType(\"character varying(16)\");\n\n                    b.Property<DateTime>(\"LastSyncedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<string>(\"Name\")\n                        .IsRequired()\n                        .HasMaxLength(160)\n                        .HasColumnType(\"character varying(160)\");\n\n                    b.Property<string>(\"NamedParamKeys\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"ParameterFormat\")\n                        .IsRequired()\n                        .HasMaxLength(24)\n                        .HasColumnType(\"character varying(24)\");\n\n                    b.Property<string>(\"PlaceholderMap\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"Provider\")\n                        .IsRequired()\n                        .HasMaxLength(40)\n                        .HasColumnType(\"character varying(40)\");\n\n                    b.Property<int>(\"QuickReplyCount\")\n                        .HasColumnType(\"integer\");\n\n                    b.Property<string>(\"RawJson\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<bool>(\"RequiresMediaHeader\")\n                        .HasColumnType(\"boolean\");\n\n                    b.Property<byte[]>(\"RowVersion\")\n                        .HasColumnType(\"bytea\");\n\n                    b.Property<string>(\"Status\")\n                        .IsRequired()\n                        .HasMaxLength(24)\n                        .HasColumnType(\"character varying(24)\");\n\n                    b.Property<string>(\"SubCategory\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"TemplateId\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<int>(\"TotalTextParamCount\")\n                        .HasColumnType(\"integer\");\n\n                    b.Property<DateTime>(\"UpdatedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<string>(\"UrlButtons\")\n                        .HasColumnType(\"text\");\n\n                    b.HasKey(\"Id\");\n\n                    b.HasIndex(\"LastSyncedAt\")\n                        .HasDatabaseName(\"IX_WAT_LastSyncedAt\");\n\n                    b.HasIndex(\"UpdatedAt\")\n                        .HasDatabaseName(\"IX_WAT_UpdatedAt\");\n\n                    b.HasIndex(\"BusinessId\", \"IsActive\")\n                        .HasDatabaseName(\"IX_WAT_Business_IsActive\");\n\n                    b.HasIndex(\"BusinessId\", \"LastSyncedAt\")\n                        .IsDescending(false, true)\n                        .HasDatabaseName(\"IX_WAT_Business_LastSyncedAt\");\n\n                    b.HasIndex(\"BusinessId\", \"Provider\", \"TemplateId\")\n                        .IsUnique()\n                        .HasDatabaseName(\"IX_WAT_Business_Provider_TemplateId\")\n                        .HasFilter(\"\\\"TemplateId\\\" IS NOT NULL\");\n\n                    b.HasIndex(\"BusinessId\", \"Provider\", \"Name\", \"LanguageCode\")\n                        .IsUnique()\n                        .HasDatabaseName(\"IX_WAT_Business_Provider_Name_Lang\");\n\n                    b.HasIndex(\"BusinessId\", \"Provider\", \"Status\", \"LanguageCode\")\n                        .HasDatabaseName(\"IX_WAT_Business_Provider_Status_Lang_Active\")\n                        .HasFilter(\"\\\"IsActive\\\" = TRUE\");\n\n                    b.HasIndex(\"BusinessId\", \"Provider\", \"IsActive\", \"UpdatedAt\", \"LastSyncedAt\")\n                        .IsDescending(false, false, false, true, true)\n                        .HasDatabaseName(\"IX_WAT_Business_Provider_IsActive_Sort\");\n\n                    b.ToTable(\"WhatsAppTemplates\", (string)null);\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.CRM.Models.Contact\", b =>\n                {\n                    b.Property<Guid>(\"Id\")\n                        .ValueGeneratedOnAdd()\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<Guid?>(\"AssignedAgentId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<Guid>(\"BusinessId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<DateTime>(\"CreatedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<string>(\"Email\")\n                        .HasMaxLength(100)\n                        .HasColumnType(\"character varying(100)\");\n\n                    b.Property<string>(\"Group\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<bool>(\"IsActive\")\n                        .HasColumnType(\"boolean\");\n\n                    b.Property<bool>(\"IsArchived\")\n                        .HasColumnType(\"boolean\");\n\n                    b.Property<bool>(\"IsAutomationPaused\")\n                        .HasColumnType(\"boolean\");\n\n                    b.Property<bool>(\"IsFavorite\")\n                        .HasColumnType(\"boolean\");\n\n                    b.Property<DateTime?>(\"LastCTAInteraction\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<string>(\"LastCTAType\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<Guid?>(\"LastClickedProductId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<DateTime?>(\"LastContactedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<string>(\"LeadSource\")\n                        .HasMaxLength(50)\n                        .HasColumnType(\"character varying(50)\");\n\n                    b.Property<string>(\"Name\")\n                        .IsRequired()\n                        .HasMaxLength(100)\n                        .HasColumnType(\"character varying(100)\");\n\n                    b.Property<DateTime?>(\"NextFollowUpAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<string>(\"Notes\")\n                        .HasMaxLength(500)\n                        .HasColumnType(\"character varying(500)\");\n\n                    b.Property<string>(\"PhoneNumber\")\n                        .IsRequired()\n                        .HasMaxLength(20)\n                        .HasColumnType(\"character varying(20)\");\n\n                    b.Property<string>(\"ProfileName\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<DateTime?>(\"ProfileNameUpdatedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<string>(\"Tags\")\n                        .HasMaxLength(200)\n                        .HasColumnType(\"character varying(200)\");\n\n                    b.HasKey(\"Id\");\n\n                    b.HasIndex(\"BusinessId\", \"PhoneNumber\")\n                        .IsUnique();\n\n                    b.ToTable(\"Contacts\");\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.CRM.Models.Note\", b =>\n                {\n                    b.Property<Guid>(\"Id\")\n                        .ValueGeneratedOnAdd()\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<Guid?>(\"BusinessId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<Guid?>(\"ContactId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<string>(\"Content\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<DateTime>(\"CreatedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<string>(\"CreatedBy\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<DateTime?>(\"EditedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<bool>(\"IsInternal\")\n                        .HasColumnType(\"boolean\");\n\n                    b.Property<bool>(\"IsPinned\")\n                        .HasColumnType(\"boolean\");\n\n                    b.Property<string>(\"Source\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"Title\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.HasKey(\"Id\");\n\n                    b.ToTable(\"Notes\");\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.CRM.Models.Reminder\", b =>\n                {\n                    b.Property<Guid>(\"Id\")\n                        .ValueGeneratedOnAdd()\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<Guid>(\"BusinessId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<DateTime?>(\"CompletedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<Guid>(\"ContactId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<DateTime>(\"CreatedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<string>(\"Description\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<DateTime>(\"DueAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<bool>(\"FollowUpSent\")\n                        .HasColumnType(\"boolean\");\n\n                    b.Property<bool>(\"IsActive\")\n                        .HasColumnType(\"boolean\");\n\n                    b.Property<bool>(\"IsRecurring\")\n                        .HasColumnType(\"boolean\");\n\n                    b.Property<string>(\"LastCTAType\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<DateTime?>(\"LastClickedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<string>(\"LinkedCampaign\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<int?>(\"Priority\")\n                        .HasColumnType(\"integer\");\n\n                    b.Property<string>(\"RecurrencePattern\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"ReminderType\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<bool>(\"SendWhatsappNotification\")\n                        .HasColumnType(\"boolean\");\n\n                    b.Property<string>(\"Status\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"Title\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<DateTime?>(\"UpdatedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.HasKey(\"Id\");\n\n                    b.ToTable(\"Reminders\");\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.CRM.Models.Tag\", b =>\n                {\n                    b.Property<Guid>(\"Id\")\n                        .ValueGeneratedOnAdd()\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<Guid>(\"BusinessId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<string>(\"Category\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"ColorHex\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<DateTime>(\"CreatedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<bool>(\"IsActive\")\n                        .HasColumnType(\"boolean\");\n\n                    b.Property<bool>(\"IsSystemTag\")\n                        .HasColumnType(\"boolean\");\n\n                    b.Property<DateTime?>(\"LastUsedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<string>(\"Name\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"Notes\")\n                        .HasColumnType(\"text\");\n\n                    b.HasKey(\"Id\");\n\n                    b.ToTable(\"Tags\");\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.AccessControl.Models.Permission\", b =>\n                {\n                    b.Property<Guid>(\"Id\")\n                        .ValueGeneratedOnAdd()\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<string>(\"Code\")\n                        .IsRequired()\n                        .HasMaxLength(120)\n                        .HasColumnType(\"character varying(120)\");\n\n                    b.Property<DateTime>(\"CreatedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<string>(\"Description\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"Group\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<bool>(\"IsActive\")\n                        .HasColumnType(\"boolean\");\n\n                    b.Property<string>(\"Name\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.HasKey(\"Id\");\n\n                    b.HasIndex(\"Code\")\n                        .IsUnique();\n\n                    b.ToTable(\"Permissions\");\n\n                    b.HasData(\n                        new\n                        {\n                            Id = new Guid(\"30000000-0000-0000-0000-000000000000\"),\n                            Code = \"DASHBOARD.VIEW\",\n                            CreatedAt = new DateTime(2025, 9, 13, 0, 0, 0, 0, DateTimeKind.Utc),\n                            Group = \"Dashboard\",\n                            IsActive = true,\n                            Name = \"dashboard.view\"\n                        },\n                        new\n                        {\n                            Id = new Guid(\"30000000-0000-0000-0000-000000000001\"),\n                            Code = \"CAMPAIGN.VIEW\",\n                            CreatedAt = new DateTime(2025, 9, 13, 0, 0, 0, 0, DateTimeKind.Utc),\n                            Group = \"Campaign\",\n                            IsActive = true,\n                            Name = \"campaign.view\"\n                        },\n                        new\n                        {\n                            Id = new Guid(\"30000000-0000-0000-0000-000000000002\"),\n                            Code = \"CAMPAIGN.CREATE\",\n                            CreatedAt = new DateTime(2025, 9, 13, 0, 0, 0, 0, DateTimeKind.Utc),\n                            Group = \"Campaign\",\n                            IsActive = true,\n                            Name = \"campaign.create\"\n                        },\n                        new\n                        {\n                            Id = new Guid(\"30000000-0000-0000-0000-000000000003\"),\n                            Code = \"CAMPAIGN.DELETE\",\n                            CreatedAt = new DateTime(2025, 9, 13, 0, 0, 0, 0, DateTimeKind.Utc),\n                            Group = \"Campaign\",\n                            IsActive = true,\n                            Name = \"campaign.delete\"\n                        },\n                        new\n                        {\n                            Id = new Guid(\"30000000-0000-0000-0000-000000000004\"),\n                            Code = \"PRODUCT.VIEW\",\n                            CreatedAt = new DateTime(2025, 9, 13, 0, 0, 0, 0, DateTimeKind.Utc),\n                            Group = \"Catalog\",\n                            IsActive = true,\n                            Name = \"product.view\"\n                        },\n                        new\n                        {\n                            Id = new Guid(\"30000000-0000-0000-0000-000000000005\"),\n                            Code = \"PRODUCT.CREATE\",\n                            CreatedAt = new DateTime(2025, 9, 13, 0, 0, 0, 0, DateTimeKind.Utc),\n                            Group = \"Catalog\",\n                            IsActive = true,\n                            Name = \"product.create\"\n                        },\n                        new\n                        {\n                            Id = new Guid(\"30000000-0000-0000-0000-000000000006\"),\n                            Code = \"PRODUCT.DELETE\",\n                            CreatedAt = new DateTime(2025, 9, 13, 0, 0, 0, 0, DateTimeKind.Utc),\n                            Group = \"Catalog\",\n                            IsActive = true,\n                            Name = \"product.delete\"\n                        },\n                        new\n                        {\n                            Id = new Guid(\"30000000-0000-0000-0000-000000000007\"),\n                            Code = \"CONTACTS.VIEW\",\n                            CreatedAt = new DateTime(2025, 9, 13, 0, 0, 0, 0, DateTimeKind.Utc),\n                            Group = \"CRM\",\n                            IsActive = true,\n                            Name = \"contacts.view\"\n                        },\n                        new\n                        {\n                            Id = new Guid(\"30000000-0000-0000-0000-000000000008\"),\n                            Code = \"TAGS.EDIT\",\n                            CreatedAt = new DateTime(2025, 9, 13, 0, 0, 0, 0, DateTimeKind.Utc),\n                            IsActive = true,\n                            Name = \"tags.edit\"\n                        },\n                        new\n                        {\n                            Id = new Guid(\"30000000-0000-0000-0000-000000000009\"),\n                            Code = \"ADMIN.BUSINESS.APPROVE\",\n                            CreatedAt = new DateTime(2025, 9, 13, 0, 0, 0, 0, DateTimeKind.Utc),\n                            Group = \"Admin\",\n                            IsActive = true,\n                            Name = \"admin.business.approve\"\n                        },\n                        new\n                        {\n                            Id = new Guid(\"30000000-0000-0000-0000-000000000010\"),\n                            Code = \"ADMIN.LOGS.VIEW\",\n                            CreatedAt = new DateTime(2025, 9, 13, 0, 0, 0, 0, DateTimeKind.Utc),\n                            IsActive = true,\n                            Name = \"admin.logs.view\"\n                        },\n                        new\n                        {\n                            Id = new Guid(\"30000000-0000-0000-0000-000000000011\"),\n                            Code = \"ADMIN.PLANS.VIEW\",\n                            CreatedAt = new DateTime(2025, 9, 13, 0, 0, 0, 0, DateTimeKind.Utc),\n                            Group = \"Admin\",\n                            IsActive = true,\n                            Name = \"admin.plans.view\"\n                        },\n                        new\n                        {\n                            Id = new Guid(\"30000000-0000-0000-0000-000000000012\"),\n                            Code = \"ADMIN.PLANS.CREATE\",\n                            CreatedAt = new DateTime(2025, 9, 13, 0, 0, 0, 0, DateTimeKind.Utc),\n                            Group = \"Admin\",\n                            IsActive = true,\n                            Name = \"admin.plans.create\"\n                        },\n                        new\n                        {\n                            Id = new Guid(\"30000000-0000-0000-0000-000000000013\"),\n                            Code = \"ADMIN.PLANS.UPDATE\",\n                            CreatedAt = new DateTime(2025, 9, 13, 0, 0, 0, 0, DateTimeKind.Utc),\n                            Group = \"Admin\",\n                            IsActive = true,\n                            Name = \"admin.plans.update\"\n                        },\n                        new\n                        {\n                            Id = new Guid(\"30000000-0000-0000-0000-000000000014\"),\n                            Code = \"ADMIN.PLANS.DELETE\",\n                            CreatedAt = new DateTime(2025, 9, 13, 0, 0, 0, 0, DateTimeKind.Utc),\n                            Group = \"Admin\",\n                            IsActive = true,\n                            Name = \"admin.plans.delete\"\n                        },\n                        new\n                        {\n                            Id = new Guid(\"74c8034f-d9cb-4a17-8578-a9f765bd845c\"),\n                            Code = \"MESSAGING.REPORT.VIEW\",\n                            CreatedAt = new DateTime(2025, 9, 13, 0, 0, 0, 0, DateTimeKind.Utc),\n                            Group = \"Messaging\",\n                            IsActive = true,\n                            Name = \"messaging.report.view\"\n                        },\n                        new\n                        {\n                            Id = new Guid(\"c819f1bd-422d-4609-916c-cc185fe44ab0\"),\n                            Code = \"MESSAGING.STATUS.VIEW\",\n                            CreatedAt = new DateTime(2025, 9, 13, 0, 0, 0, 0, DateTimeKind.Utc),\n                            Group = \"Messaging\",\n                            IsActive = true,\n                            Name = \"messaging.status.view\"\n                        },\n                        new\n                        {\n                            Id = new Guid(\"eecd0fac-223c-4dba-9fa1-2a6e973d61d1\"),\n                            Code = \"MESSAGING.INBOX.VIEW\",\n                            CreatedAt = new DateTime(2025, 9, 13, 0, 0, 0, 0, DateTimeKind.Utc),\n                            Group = \"Messaging\",\n                            IsActive = true,\n                            Name = \"messaging.inbox.view\"\n                        },\n                        new\n                        {\n                            Id = new Guid(\"974af1f9-3caa-4857-a1a7-48462c389332\"),\n                            Code = \"MESSAGING.SEND.TEXT\",\n                            CreatedAt = new DateTime(2025, 9, 13, 0, 0, 0, 0, DateTimeKind.Utc),\n                            Group = \"Messaging\",\n                            IsActive = true,\n                            Name = \"messaging.send.text\"\n                        },\n                        new\n                        {\n                            Id = new Guid(\"0485154c-dde5-4732-a7aa-a379c77a5b27\"),\n                            Code = \"MESSAGING.SEND.TEMPLATE\",\n                            CreatedAt = new DateTime(2025, 9, 13, 0, 0, 0, 0, DateTimeKind.Utc),\n                            Group = \"Messaging\",\n                            IsActive = true,\n                            Name = \"messaging.send.template\"\n                        },\n                        new\n                        {\n                            Id = new Guid(\"29461562-ef9c-48c0-a606-482ff57b8f95\"),\n                            Code = \"MESSAGING.SEND\",\n                            CreatedAt = new DateTime(2025, 9, 13, 0, 0, 0, 0, DateTimeKind.Utc),\n                            Group = \"Messaging\",\n                            IsActive = true,\n                            Name = \"messaging.send\"\n                        },\n                        new\n                        {\n                            Id = new Guid(\"bbc5202a-eac9-40bb-aa78-176c677dbf5b\"),\n                            Code = \"MESSAGING.WHATSAPPSETTINGS.VIEW\",\n                            CreatedAt = new DateTime(2025, 9, 13, 0, 0, 0, 0, DateTimeKind.Utc),\n                            Group = \"Messaging\",\n                            IsActive = true,\n                            Name = \"messaging.whatsappsettings.view\"\n                        },\n                        new\n                        {\n                            Id = new Guid(\"205b87c7-b008-4e51-9fea-798c2dc4f9c2\"),\n                            Code = \"ADMIN.WHATSAPPSETTINGS.VIEW\",\n                            CreatedAt = new DateTime(2025, 9, 13, 0, 0, 0, 0, DateTimeKind.Utc),\n                            Group = \"Admin\",\n                            IsActive = true,\n                            Name = \"admin.whatsappsettings.view\"\n                        },\n                        new\n                        {\n                            Id = new Guid(\"6e4d3a86-7cf9-4ac2-b8a7-ed10c9f0173d\"),\n                            Code = \"SETTINGS.WHATSAPP.VIEW\",\n                            CreatedAt = new DateTime(2025, 9, 13, 0, 0, 0, 0, DateTimeKind.Utc),\n                            Group = \"Settings\",\n                            IsActive = true,\n                            Name = \"Settings - WhatsApp View\"\n                        },\n                        new\n                        {\n                            Id = new Guid(\"ad36cdb7-5221-448b-a6a6-c35c9f88d021\"),\n                            Code = \"INBOX.VIEW\",\n                            CreatedAt = new DateTime(2025, 9, 13, 0, 0, 0, 0, DateTimeKind.Utc),\n                            Group = \"Inbox\",\n                            IsActive = true,\n                            Name = \"inbox.view\"\n                        },\n                        new\n                        {\n                            Id = new Guid(\"74828fc0-e358-4cfc-b924-13719a0d9f50\"),\n                            Code = \"INBOX.MENU\",\n                            CreatedAt = new DateTime(2025, 9, 13, 0, 0, 0, 0, DateTimeKind.Utc),\n                            Group = \"Inbox\",\n                            IsActive = true,\n                            Name = \"inbox.menu\"\n                        },\n                        new\n                        {\n                            Id = new Guid(\"98572fe7-d142-475a-b990-f248641809e2\"),\n                            Code = \"SETTINGS.PROFILE.VIEW\",\n                            CreatedAt = new DateTime(2025, 9, 13, 0, 0, 0, 0, DateTimeKind.Utc),\n                            Group = \"Settings\",\n                            IsActive = true,\n                            Name = \"settings.profile.view\"\n                        },\n                        new\n                        {\n                            Id = new Guid(\"821480c6-1464-415e-bba8-066fcb4e7e63\"),\n                            Code = \"AUTOMATION.MENU\",\n                            CreatedAt = new DateTime(2025, 9, 13, 0, 0, 0, 0, DateTimeKind.Utc),\n                            Group = \"Automation\",\n                            IsActive = true,\n                            Name = \"automation.menu\"\n                        },\n                        new\n                        {\n                            Id = new Guid(\"918a61d0-5ab6-46af-a3d3-41e37b7710f9\"),\n                            Code = \"AUTOMATION.CREATE.TEMPLATE.FLOW\",\n                            CreatedAt = new DateTime(2025, 9, 13, 0, 0, 0, 0, DateTimeKind.Utc),\n                            Group = \"Automation\",\n                            IsActive = true,\n                            Name = \"automation.Create.Template.Flow\"\n                        },\n                        new\n                        {\n                            Id = new Guid(\"9ae90cfe-3fea-4307-b024-3083c2728148\"),\n                            Code = \"AUTOMATION.VIEW.TEMPLATE.FLOW\",\n                            CreatedAt = new DateTime(2025, 9, 13, 0, 0, 0, 0, DateTimeKind.Utc),\n                            Group = \"Automation\",\n                            IsActive = true,\n                            Name = \"automation.View.Template.Flow\"\n                        },\n                        new\n                        {\n                            Id = new Guid(\"93c5d5a7-f8dd-460a-8c7b-e3788440ba3a\"),\n                            Code = \"AUTOMATION.CREATE.TEMPLATEPLUSFREETEXT.FLOW\",\n                            CreatedAt = new DateTime(2025, 9, 13, 0, 0, 0, 0, DateTimeKind.Utc),\n                            Group = \"Automation\",\n                            IsActive = true,\n                            Name = \"automation.Create.TemplatePlusFreetext.Flow\"\n                        },\n                        new\n                        {\n                            Id = new Guid(\"7d7cbceb-4ce7-4835-85cd-59562487298d\"),\n                            Code = \"AUTOMATION.VIEW.TEMPLATEPLUSFREETEXT.FLOW\",\n                            CreatedAt = new DateTime(2025, 9, 13, 0, 0, 0, 0, DateTimeKind.Utc),\n                            Group = \"Automation\",\n                            IsActive = true,\n                            Name = \"automation.View.TemplatePlusFreetext.Flow\"\n                        },\n                        new\n                        {\n                            Id = new Guid(\"636b17f2-1c54-4e26-a8cd-dbf561dcb522\"),\n                            Code = \"AUTOMATION.VIEW.TEMPLATE.FLOW_ANALYTICS\",\n                            CreatedAt = new DateTime(2025, 9, 13, 0, 0, 0, 0, DateTimeKind.Utc),\n                            Group = \"Automation\",\n                            IsActive = true,\n                            Name = \"automation.View.Template.Flow_analytics\"\n                        },\n                        new\n                        {\n                            Id = new Guid(\"adfa8490-9705-4a36-a86e-d5bff7ddc220\"),\n                            Code = \"AUTOMATION.VIEW.TEMPLATEPLUSFREETEXT.FLOW_ANALYTICS\",\n                            CreatedAt = new DateTime(2025, 9, 13, 0, 0, 0, 0, DateTimeKind.Utc),\n                            Group = \"Automation\",\n                            IsActive = true,\n                            Name = \"automation.View.TemplatePlusFreeText.Flow_analytics\"\n                        },\n                        new\n                        {\n                            Id = new Guid(\"0dedac5b-81c8-44c3-8cfe-76c58e29c6db\"),\n                            Code = \"AUTOMATION_TRIGGER_TEST\",\n                            CreatedAt = new DateTime(2025, 9, 13, 0, 0, 0, 0, DateTimeKind.Utc),\n                            Group = \"Automation\",\n                            IsActive = true,\n                            Name = \"automation_trigger_test\"\n                        },\n                        new\n                        {\n                            Id = new Guid(\"14ef7f9d-0975-4ab4-b6f1-7d1af8b594ca\"),\n                            Code = \"TEMPLATE.BUILDER.VIEW\",\n                            CreatedAt = new DateTime(2025, 9, 13, 0, 0, 0, 0, DateTimeKind.Utc),\n                            Group = \"TemplateBuilder\",\n                            IsActive = true,\n                            Name = \"View Template Builder\"\n                        },\n                        new\n                        {\n                            Id = new Guid(\"03eabd97-b196-4603-bbdd-1b2cdd595ead\"),\n                            Code = \"TEMPLATE.BUILDER.CREATE.DRAFT\",\n                            CreatedAt = new DateTime(2025, 9, 13, 0, 0, 0, 0, DateTimeKind.Utc),\n                            Group = \"TemplateBuilder\",\n                            IsActive = true,\n                            Name = \"Draft Creation\"\n                        },\n                        new\n                        {\n                            Id = new Guid(\"d272be50-ff26-45cf-bd7a-e9db74813699\"),\n                            Code = \"TEMPLATE.BUILDER.APPROVED.TEMPLATES.VIEW\",\n                            CreatedAt = new DateTime(2025, 9, 13, 0, 0, 0, 0, DateTimeKind.Utc),\n                            Group = \"TemplateBuilder\",\n                            IsActive = true,\n                            Name = \"View Approved Template\"\n                        },\n                        new\n                        {\n                            Id = new Guid(\"3602f49d-dc10-4faa-9a44-4185a669ea0a\"),\n                            Code = \"TEMPLATE.BUILDER.LIBRARY.BROWSE\",\n                            CreatedAt = new DateTime(2025, 9, 13, 0, 0, 0, 0, DateTimeKind.Utc),\n                            Group = \"TemplateBuilder\",\n                            IsActive = true,\n                            Name = \"View Template Library\"\n                        });\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.AccessControl.Models.Plan\", b =>\n                {\n                    b.Property<Guid>(\"Id\")\n                        .ValueGeneratedOnAdd()\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<string>(\"Code\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<DateTime>(\"CreatedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<string>(\"Description\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<bool>(\"IsActive\")\n                        .HasColumnType(\"boolean\");\n\n                    b.Property<bool>(\"IsInternal\")\n                        .HasColumnType(\"boolean\");\n\n                    b.Property<string>(\"Name\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.HasKey(\"Id\");\n\n                    b.ToTable(\"Plans\");\n\n                    b.HasData(\n                        new\n                        {\n                            Id = new Guid(\"5f9f5de1-a0b2-48ba-b03d-77b27345613f\"),\n                            Code = \"SYSTEM_DEFAULT\",\n                            CreatedAt = new DateTime(2025, 1, 1, 0, 0, 0, 0, DateTimeKind.Utc),\n                            Description = \"Default free plan\",\n                            IsActive = true,\n                            IsInternal = true,\n                            Name = \"System Default\"\n                        });\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.AccessControl.Models.PlanPermission\", b =>\n                {\n                    b.Property<Guid>(\"Id\")\n                        .ValueGeneratedOnAdd()\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<DateTime>(\"AssignedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<string>(\"AssignedBy\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<bool>(\"IsActive\")\n                        .HasColumnType(\"boolean\");\n\n                    b.Property<Guid>(\"PermissionId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<Guid>(\"PlanId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.HasKey(\"Id\");\n\n                    b.HasIndex(\"PermissionId\");\n\n                    b.HasIndex(\"PlanId\");\n\n                    b.HasIndex(\"PlanId\", \"PermissionId\")\n                        .IsUnique()\n                        .HasDatabaseName(\"UX_PlanPermissions_Plan_Permission\");\n\n                    b.ToTable(\"PlanPermissions\");\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.AccessControl.Models.Role\", b =>\n                {\n                    b.Property<Guid>(\"Id\")\n                        .ValueGeneratedOnAdd()\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<DateTime>(\"CreatedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<string>(\"Description\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<bool>(\"IsActive\")\n                        .HasColumnType(\"boolean\");\n\n                    b.Property<bool>(\"IsSystemDefined\")\n                        .HasColumnType(\"boolean\");\n\n                    b.Property<string>(\"Name\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.HasKey(\"Id\");\n\n                    b.ToTable(\"Roles\");\n\n                    b.HasData(\n                        new\n                        {\n                            Id = new Guid(\"00000000-0000-0000-0000-000000000001\"),\n                            CreatedAt = new DateTime(2025, 1, 1, 0, 0, 0, 0, DateTimeKind.Utc),\n                            Description = \"Super Admin\",\n                            IsActive = true,\n                            IsSystemDefined = false,\n                            Name = \"admin\"\n                        },\n                        new\n                        {\n                            Id = new Guid(\"00000000-0000-0000-0000-000000000002\"),\n                            CreatedAt = new DateTime(2025, 1, 1, 0, 0, 0, 0, DateTimeKind.Utc),\n                            Description = \"Business Partner\",\n                            IsActive = true,\n                            IsSystemDefined = false,\n                            Name = \"partner\"\n                        },\n                        new\n                        {\n                            Id = new Guid(\"00000000-0000-0000-0000-000000000003\"),\n                            CreatedAt = new DateTime(2025, 1, 1, 0, 0, 0, 0, DateTimeKind.Utc),\n                            Description = \"Reseller Partner\",\n                            IsActive = true,\n                            IsSystemDefined = false,\n                            Name = \"reseller\"\n                        },\n                        new\n                        {\n                            Id = new Guid(\"00000000-0000-0000-0000-000000000004\"),\n                            CreatedAt = new DateTime(2025, 1, 1, 0, 0, 0, 0, DateTimeKind.Utc),\n                            Description = \"Business Owner\",\n                            IsActive = true,\n                            IsSystemDefined = false,\n                            Name = \"business\"\n                        },\n                        new\n                        {\n                            Id = new Guid(\"00000000-0000-0000-0000-000000000005\"),\n                            CreatedAt = new DateTime(2025, 1, 1, 0, 0, 0, 0, DateTimeKind.Utc),\n                            Description = \"Staff\",\n                            IsActive = true,\n                            IsSystemDefined = false,\n                            Name = \"staff\"\n                        });\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.AccessControl.Models.RolePermission\", b =>\n                {\n                    b.Property<Guid>(\"Id\")\n                        .ValueGeneratedOnAdd()\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<DateTime>(\"AssignedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<string>(\"AssignedBy\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<bool>(\"IsActive\")\n                        .HasColumnType(\"boolean\");\n\n                    b.Property<bool>(\"IsRevoked\")\n                        .HasColumnType(\"boolean\");\n\n                    b.Property<Guid>(\"PermissionId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<Guid>(\"RoleId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.HasKey(\"Id\");\n\n                    b.HasIndex(\"PermissionId\");\n\n                    b.HasIndex(\"RoleId\", \"PermissionId\")\n                        .IsUnique()\n                        .HasDatabaseName(\"UX_RolePermissions_Role_Permission\");\n\n                    b.ToTable(\"RolePermissions\");\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.AccessControl.Models.UserPermission\", b =>\n                {\n                    b.Property<Guid>(\"Id\")\n                        .ValueGeneratedOnAdd()\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<DateTime>(\"AssignedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<string>(\"AssignedBy\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<bool>(\"IsGranted\")\n                        .HasColumnType(\"boolean\");\n\n                    b.Property<bool>(\"IsRevoked\")\n                        .HasColumnType(\"boolean\");\n\n                    b.Property<Guid>(\"PermissionId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<Guid>(\"UserId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.HasKey(\"Id\");\n\n                    b.HasIndex(\"PermissionId\");\n\n                    b.HasIndex(\"UserId\");\n\n                    b.ToTable(\"UserPermissions\");\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.AccountInsights.Models.AccountInsightsAction\", b =>\n                {\n                    b.Property<long>(\"Id\")\n                        .ValueGeneratedOnAdd()\n                        .HasColumnType(\"bigint\");\n\n                    NpgsqlPropertyBuilderExtensions.UseIdentityByDefaultColumn(b.Property<long>(\"Id\"));\n\n                    b.Property<string>(\"ActionType\")\n                        .IsRequired()\n                        .HasMaxLength(64)\n                        .HasColumnType(\"character varying(64)\");\n\n                    b.Property<string>(\"Actor\")\n                        .IsRequired()\n                        .HasMaxLength(256)\n                        .HasColumnType(\"character varying(256)\");\n\n                    b.Property<Guid>(\"BusinessId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<DateTime>(\"CreatedAtUtc\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<string>(\"Label\")\n                        .IsRequired()\n                        .HasMaxLength(256)\n                        .HasColumnType(\"character varying(256)\");\n\n                    b.Property<string>(\"MetaJson\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.HasKey(\"Id\");\n\n                    b.HasIndex(\"BusinessId\", \"CreatedAtUtc\");\n\n                    b.ToTable(\"AccountInsightsActions\", (string)null);\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.AuditTrail.Models.AuditLog\", b =>\n                {\n                    b.Property<Guid>(\"Id\")\n                        .ValueGeneratedOnAdd()\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<string>(\"ActionType\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<Guid>(\"BusinessId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<DateTime>(\"CreatedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<string>(\"Description\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"IPAddress\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"Location\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<Guid>(\"PerformedByUserId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<string>(\"PerformedByUserName\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"RoleAtTime\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"UserAgent\")\n                        .HasColumnType(\"text\");\n\n                    b.HasKey(\"Id\");\n\n                    b.ToTable(\"AuditLogs\");\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.AutoReplyBuilder.Flows.Models.AutoReplyFlow\", b =>\n                {\n                    b.Property<Guid>(\"Id\")\n                        .ValueGeneratedOnAdd()\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<Guid>(\"BusinessId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<DateTime>(\"CreatedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<string>(\"EdgesJson\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"IndustryTag\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<bool>(\"IsActive\")\n                        .HasColumnType(\"boolean\");\n\n                    b.Property<bool>(\"IsDefaultTemplate\")\n                        .HasColumnType(\"boolean\");\n\n                    b.Property<string>(\"Keyword\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"MatchMode\")\n                        .IsRequired()\n                        .HasMaxLength(32)\n                        .HasColumnType(\"character varying(32)\");\n\n                    b.Property<string>(\"Name\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"NodesJson\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<int>(\"Priority\")\n                        .HasColumnType(\"integer\");\n\n                    b.Property<string>(\"TriggerKeyword\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<DateTime?>(\"UpdatedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<string>(\"UseCase\")\n                        .HasColumnType(\"text\");\n\n                    b.HasKey(\"Id\");\n\n                    b.HasIndex(\"BusinessId\", \"Name\");\n\n                    b.ToTable(\"AutoReplyFlows\");\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.AutoReplyBuilder.Models.AutoReplyFlowEdge\", b =>\n                {\n                    b.Property<Guid>(\"Id\")\n                        .ValueGeneratedOnAdd()\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<DateTime>(\"CreatedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<Guid>(\"FlowId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<string>(\"SourceHandle\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"SourceNodeId\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"TargetHandle\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"TargetNodeId\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.HasKey(\"Id\");\n\n                    b.HasIndex(\"FlowId\");\n\n                    b.ToTable(\"AutoReplyFlowEdges\");\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.AutoReplyBuilder.Models.AutoReplyFlowNode\", b =>\n                {\n                    b.Property<Guid>(\"Id\")\n                        .ValueGeneratedOnAdd()\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<string>(\"ConfigJson\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<DateTime>(\"CreatedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<Guid>(\"FlowId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<string>(\"Label\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"NodeName\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"NodeType\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<int>(\"Order\")\n                        .HasColumnType(\"integer\");\n\n                    b.HasKey(\"Id\");\n\n                    b.HasIndex(\"FlowId\", \"NodeName\");\n\n                    b.ToTable(\"AutoReplyFlowNode\");\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.AutoReplyBuilder.Models.AutoReplyLog\", b =>\n                {\n                    b.Property<Guid>(\"Id\")\n                        .ValueGeneratedOnAdd()\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<Guid>(\"BusinessId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<Guid>(\"ContactId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<string>(\"FlowName\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<Guid?>(\"MessageLogId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<string>(\"ReplyContent\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"TriggerKeyword\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"TriggerType\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<DateTime>(\"TriggeredAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.HasKey(\"Id\");\n\n                    b.ToTable(\"AutoReplyLogs\");\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.Automation.Models.AutomationFlow\", b =>\n                {\n                    b.Property<Guid>(\"Id\")\n                        .ValueGeneratedOnAdd()\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<Guid>(\"BusinessId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<DateTime>(\"CreatedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<string>(\"EdgesJson\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<bool>(\"IsActive\")\n                        .HasColumnType(\"boolean\");\n\n                    b.Property<string>(\"Name\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"NodesJson\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"TriggerKeyword\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<DateTime>(\"UpdatedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.HasKey(\"Id\");\n\n                    b.ToTable(\"AutomationFlows\");\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.BusinessModule.Models.Business\", b =>\n                {\n                    b.Property<Guid>(\"Id\")\n                        .ValueGeneratedOnAdd()\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<string>(\"Address\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<DateTime?>(\"ApprovedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<string>(\"ApprovedBy\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"BusinessEmail\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"BusinessName\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"CompanyName\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"CompanyPhone\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<DateTime>(\"CreatedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<string>(\"CreatedBy\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<Guid?>(\"CreatedByPartnerId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<DateTime?>(\"DeletedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<string>(\"DeletedBy\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"Industry\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<bool>(\"IsApproved\")\n                        .HasColumnType(\"boolean\");\n\n                    b.Property<bool>(\"IsDeleted\")\n                        .HasColumnType(\"boolean\");\n\n                    b.Property<DateTime?>(\"LastLoginAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<string>(\"LogoUrl\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"Notes\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"Phone\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<Guid?>(\"PlanId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<string>(\"RepresentativeName\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"Source\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<int>(\"Status\")\n                        .HasColumnType(\"integer\");\n\n                    b.Property<string>(\"Tags\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"Website\")\n                        .HasColumnType(\"text\");\n\n                    b.HasKey(\"Id\");\n\n                    b.HasIndex(\"PlanId\");\n\n                    b.ToTable(\"Businesses\");\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.CTAFlowBuilder.Models.CTAFlowConfig\", b =>\n                {\n                    b.Property<Guid>(\"Id\")\n                        .ValueGeneratedOnAdd()\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<Guid>(\"BusinessId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<DateTime>(\"CreatedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<string>(\"CreatedBy\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"FlowName\")\n                        .IsRequired()\n                        .HasMaxLength(100)\n                        .HasColumnType(\"character varying(100)\");\n\n                    b.Property<bool>(\"IsActive\")\n                        .HasColumnType(\"boolean\");\n\n                    b.Property<bool>(\"IsPublished\")\n                        .HasColumnType(\"boolean\");\n\n                    b.Property<DateTime?>(\"UpdatedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.HasKey(\"Id\");\n\n                    b.HasIndex(\"BusinessId\", \"FlowName\", \"IsActive\")\n                        .IsUnique();\n\n                    b.ToTable(\"CTAFlowConfigs\");\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.CTAFlowBuilder.Models.CTAFlowStep\", b =>\n                {\n                    b.Property<Guid>(\"Id\")\n                        .ValueGeneratedOnAdd()\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<Guid>(\"CTAFlowConfigId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<float?>(\"PositionX\")\n                        .HasColumnType(\"real\");\n\n                    b.Property<float?>(\"PositionY\")\n                        .HasColumnType(\"real\");\n\n                    b.Property<int?>(\"ProfileNameSlot\")\n                        .HasColumnType(\"integer\");\n\n                    b.Property<string>(\"RequiredSource\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"RequiredTag\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<int>(\"StepOrder\")\n                        .HasColumnType(\"integer\");\n\n                    b.Property<string>(\"TemplateToSend\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"TemplateType\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"TriggerButtonText\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"TriggerButtonType\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<bool>(\"UseProfileName\")\n                        .HasColumnType(\"boolean\");\n\n                    b.HasKey(\"Id\");\n\n                    b.HasIndex(\"CTAFlowConfigId\");\n\n                    b.ToTable(\"CTAFlowSteps\");\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.CTAFlowBuilder.Models.FlowButtonLink\", b =>\n                {\n                    b.Property<Guid>(\"Id\")\n                        .ValueGeneratedOnAdd()\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<short>(\"ButtonIndex\")\n                        .HasColumnType(\"smallint\");\n\n                    b.Property<string>(\"ButtonSubType\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"ButtonText\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"ButtonType\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"ButtonValue\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<Guid>(\"CTAFlowStepId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<Guid?>(\"NextStepId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.HasKey(\"Id\");\n\n                    b.HasIndex(\"CTAFlowStepId\");\n\n                    b.ToTable(\"FlowButtonLinks\");\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.CTAFlowBuilder.Models.FlowExecutionLog\", b =>\n                {\n                    b.Property<Guid>(\"Id\")\n                        .ValueGeneratedOnAdd()\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<Guid?>(\"AutoReplyFlowId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<Guid>(\"BusinessId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<short?>(\"ButtonIndex\")\n                        .HasColumnType(\"smallint\");\n\n                    b.Property<Guid?>(\"CampaignId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<Guid?>(\"CampaignSendLogId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<string>(\"ContactPhone\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"ErrorMessage\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<DateTime>(\"ExecutedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<Guid?>(\"FlowId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<Guid?>(\"MessageLogId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<int>(\"Origin\")\n                        .HasColumnType(\"integer\");\n\n                    b.Property<string>(\"RawResponse\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<Guid?>(\"RequestId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<Guid?>(\"RunId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<Guid>(\"StepId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<string>(\"StepName\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<bool>(\"Success\")\n                        .HasColumnType(\"boolean\");\n\n                    b.Property<string>(\"TemplateName\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"TemplateType\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<Guid?>(\"TrackingLogId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<string>(\"TriggeredByButton\")\n                        .HasColumnType(\"text\");\n\n                    b.HasKey(\"Id\");\n\n                    b.HasIndex(\"FlowId\")\n                        .HasDatabaseName(\"IX_FlowExecutionLogs_FlowId\");\n\n                    b.HasIndex(\"BusinessId\", \"ExecutedAt\")\n                        .HasDatabaseName(\"ix_flowexec_biz_executedat\");\n\n                    b.HasIndex(\"BusinessId\", \"Origin\", \"AutoReplyFlowId\")\n                        .HasDatabaseName(\"ix_flowexec_biz_origin_autoreply\");\n\n                    b.HasIndex(\"BusinessId\", \"Origin\", \"CampaignId\")\n                        .HasDatabaseName(\"ix_flowexec_biz_origin_campaign\");\n\n                    b.ToTable(\"FlowExecutionLogs\", (string)null);\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.CTAManagement.Models.CTADefinition\", b =>\n                {\n                    b.Property<Guid>(\"Id\")\n                        .ValueGeneratedOnAdd()\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<Guid>(\"BusinessId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<string>(\"ButtonText\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"ButtonType\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<DateTime>(\"CreatedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<string>(\"Description\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<bool>(\"IsActive\")\n                        .HasColumnType(\"boolean\");\n\n                    b.Property<string>(\"TargetUrl\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"Title\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<DateTime?>(\"UpdatedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.HasKey(\"Id\");\n\n                    b.ToTable(\"CTADefinitions\");\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.CampaignModule.Models.Audience\", b =>\n                {\n                    b.Property<Guid>(\"Id\")\n                        .ValueGeneratedOnAdd()\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<Guid>(\"BusinessId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<Guid?>(\"CampaignId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<DateTime>(\"CreatedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<Guid?>(\"CreatedByUserId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<Guid?>(\"CsvBatchId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<string>(\"Description\")\n                        .HasMaxLength(512)\n                        .HasColumnType(\"character varying(512)\");\n\n                    b.Property<bool>(\"IsDeleted\")\n                        .HasColumnType(\"boolean\");\n\n                    b.Property<string>(\"Name\")\n                        .IsRequired()\n                        .HasMaxLength(160)\n                        .HasColumnType(\"character varying(160)\");\n\n                    b.Property<DateTime?>(\"UpdatedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.HasKey(\"Id\");\n\n                    b.HasIndex(\"CampaignId\");\n\n                    b.HasIndex(\"CsvBatchId\");\n\n                    b.HasIndex(\"BusinessId\", \"CampaignId\");\n\n                    b.HasIndex(\"BusinessId\", \"CsvBatchId\");\n\n                    b.HasIndex(\"BusinessId\", \"IsDeleted\")\n                        .HasDatabaseName(\"ix_audiences_biz_deleted\");\n\n                    b.ToTable(\"Audiences\", (string)null);\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.CampaignModule.Models.AudienceMember\", b =>\n                {\n                    b.Property<Guid>(\"Id\")\n                        .ValueGeneratedOnAdd()\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<string>(\"AttributesJson\")\n                        .HasColumnType(\"jsonb\");\n\n                    b.Property<Guid>(\"AudienceId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<Guid>(\"BusinessId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<Guid?>(\"ContactId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<DateTime>(\"CreatedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<Guid?>(\"CreatedByUserId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<string>(\"Email\")\n                        .HasMaxLength(256)\n                        .HasColumnType(\"character varying(256)\");\n\n                    b.Property<bool>(\"IsDeleted\")\n                        .HasColumnType(\"boolean\");\n\n                    b.Property<bool>(\"IsTransientContact\")\n                        .HasColumnType(\"boolean\");\n\n                    b.Property<string>(\"Name\")\n                        .HasMaxLength(160)\n                        .HasColumnType(\"character varying(160)\");\n\n                    b.Property<string>(\"PhoneE164\")\n                        .HasMaxLength(32)\n                        .HasColumnType(\"character varying(32)\");\n\n                    b.Property<string>(\"PhoneRaw\")\n                        .HasMaxLength(64)\n                        .HasColumnType(\"character varying(64)\");\n\n                    b.Property<DateTime?>(\"PromotedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<DateTime?>(\"UpdatedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.HasKey(\"Id\");\n\n                    b.HasIndex(\"ContactId\")\n                        .HasDatabaseName(\"ix_audmember_contact\");\n\n                    b.HasIndex(\"AudienceId\", \"PhoneE164\")\n                        .IsUnique()\n                        .HasDatabaseName(\"ux_audmember_audience_phone\");\n\n                    b.ToTable(\"AudienceMembers\", (string)null);\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.CampaignModule.Models.Campaign\", b =>\n                {\n                    b.Property<Guid>(\"Id\")\n                        .ValueGeneratedOnAdd()\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<Guid?>(\"AudienceId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<Guid>(\"BusinessId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<Guid?>(\"CTAFlowConfigId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<Guid?>(\"CampaignId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<string>(\"CampaignType\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<DateTime>(\"CreatedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<string>(\"CreatedBy\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<Guid?>(\"CtaId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<DateTime?>(\"DeletedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<string>(\"DeletedBy\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"DocumentUrl\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"FollowUpTemplateId\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"ImageCaption\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"ImageUrl\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<bool>(\"IsDeleted\")\n                        .HasColumnType(\"boolean\");\n\n                    b.Property<string>(\"MessageBody\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"MessageTemplate\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"Name\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"PhoneNumberId\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"Provider\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<DateTime?>(\"ScheduledAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<Guid?>(\"SourceCampaignId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<string>(\"Status\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"TemplateId\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"TemplateParameters\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"TemplateSchemaSnapshot\")\n                        .HasColumnType(\"jsonb\");\n\n                    b.Property<DateTime>(\"UpdatedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<string>(\"VideoUrl\")\n                        .HasColumnType(\"text\");\n\n                    b.HasKey(\"Id\");\n\n                    b.HasIndex(\"BusinessId\");\n\n                    b.HasIndex(\"CTAFlowConfigId\");\n\n                    b.HasIndex(\"CtaId\");\n\n                    b.HasIndex(\"SourceCampaignId\");\n\n                    b.ToTable(\"Campaigns\");\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.CampaignModule.Models.CampaignButton\", b =>\n                {\n                    b.Property<Guid>(\"Id\")\n                        .ValueGeneratedOnAdd()\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<Guid>(\"CampaignId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<bool>(\"IsFromTemplate\")\n                        .HasColumnType(\"boolean\");\n\n                    b.Property<int>(\"Position\")\n                        .HasColumnType(\"integer\");\n\n                    b.Property<string>(\"Title\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"Type\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"Value\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.HasKey(\"Id\");\n\n                    b.HasIndex(\"CampaignId\");\n\n                    b.ToTable(\"CampaignButtons\");\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.CampaignModule.Models.CampaignFlowOverride\", b =>\n                {\n                    b.Property<Guid>(\"Id\")\n                        .ValueGeneratedOnAdd()\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<string>(\"ButtonText\")\n                        .IsRequired()\n                        .HasMaxLength(50)\n                        .HasColumnType(\"character varying(50)\");\n\n                    b.Property<Guid>(\"CampaignId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<DateTime>(\"CreatedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<string>(\"CreatedBy\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"OverrideNextTemplate\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"TemplateName\")\n                        .IsRequired()\n                        .HasMaxLength(100)\n                        .HasColumnType(\"character varying(100)\");\n\n                    b.HasKey(\"Id\");\n\n                    b.HasIndex(\"CampaignId\");\n\n                    b.ToTable(\"CampaignFlowOverrides\");\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.CampaignModule.Models.CampaignRecipient\", b =>\n                {\n                    b.Property<Guid>(\"Id\")\n                        .ValueGeneratedOnAdd()\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<Guid?>(\"AudienceMemberId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<string>(\"BotId\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<Guid>(\"BusinessId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<Guid>(\"CampaignId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<string>(\"CategoryBrowsed\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"ClickedCTA\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<Guid?>(\"ContactId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<string>(\"IdempotencyKey\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<bool>(\"IsAutoTagged\")\n                        .HasColumnType(\"boolean\");\n\n                    b.Property<DateTime?>(\"MaterializedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<string>(\"MessagePreview\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"ProductBrowsed\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"ResolvedButtonUrlsJson\")\n                        .HasColumnType(\"jsonb\");\n\n                    b.Property<string>(\"ResolvedParametersJson\")\n                        .HasColumnType(\"jsonb\");\n\n                    b.Property<DateTime?>(\"SentAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<string>(\"Status\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<DateTime>(\"UpdatedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.HasKey(\"Id\");\n\n                    b.HasIndex(\"AudienceMemberId\");\n\n                    b.HasIndex(\"BusinessId\");\n\n                    b.HasIndex(\"ContactId\");\n\n                    b.HasIndex(\"IdempotencyKey\")\n                        .HasDatabaseName(\"ix_campaignrecipients_idempotency\");\n\n                    b.HasIndex(\"CampaignId\", \"ContactId\")\n                        .HasDatabaseName(\"ix_recipients_campaign_contact\");\n\n                    b.ToTable(\"CampaignRecipients\", (string)null);\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.CampaignModule.Models.CampaignVariableMap\", b =>\n                {\n                    b.Property<Guid>(\"Id\")\n                        .ValueGeneratedOnAdd()\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<Guid>(\"BusinessId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<Guid>(\"CampaignId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<string>(\"Component\")\n                        .IsRequired()\n                        .HasMaxLength(64)\n                        .HasColumnType(\"character varying(64)\");\n\n                    b.Property<DateTime>(\"CreatedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<Guid?>(\"CreatedByUserId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<string>(\"DefaultValue\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"Expression\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<int>(\"Index\")\n                        .HasColumnType(\"integer\");\n\n                    b.Property<bool>(\"IsRequired\")\n                        .HasColumnType(\"boolean\");\n\n                    b.Property<string>(\"SourceKey\")\n                        .HasMaxLength(128)\n                        .HasColumnType(\"character varying(128)\");\n\n                    b.Property<string>(\"SourceType\")\n                        .IsRequired()\n                        .HasMaxLength(32)\n                        .HasColumnType(\"character varying(32)\");\n\n                    b.Property<string>(\"StaticValue\")\n                        .HasColumnType(\"text\");\n\n                    b.HasKey(\"Id\");\n\n                    b.HasIndex(\"CampaignId\");\n\n                    b.ToTable(\"CampaignVariableMaps\");\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.CampaignModule.Models.CsvBatch\", b =>\n                {\n                    b.Property<Guid>(\"Id\")\n                        .ValueGeneratedOnAdd()\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<Guid?>(\"AudienceId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<Guid>(\"BusinessId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<string>(\"Checksum\")\n                        .HasMaxLength(128)\n                        .HasColumnType(\"character varying(128)\");\n\n                    b.Property<DateTime>(\"CreatedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<Guid?>(\"CreatedByUserId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<string>(\"ErrorMessage\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"FileName\")\n                        .HasMaxLength(256)\n                        .HasColumnType(\"character varying(256)\");\n\n                    b.Property<string>(\"HeadersJson\")\n                        .HasColumnType(\"jsonb\");\n\n                    b.Property<int>(\"RowCount\")\n                        .HasColumnType(\"integer\");\n\n                    b.Property<int>(\"SkippedCount\")\n                        .HasColumnType(\"integer\");\n\n                    b.Property<string>(\"Status\")\n                        .IsRequired()\n                        .HasMaxLength(32)\n                        .HasColumnType(\"character varying(32)\");\n\n                    b.HasKey(\"Id\");\n\n                    b.HasIndex(\"AudienceId\");\n\n                    b.HasIndex(\"Checksum\")\n                        .HasDatabaseName(\"ix_csvbatch_checksum\");\n\n                    b.HasIndex(\"BusinessId\", \"AudienceId\");\n\n                    b.HasIndex(\"BusinessId\", \"CreatedAt\")\n                        .HasDatabaseName(\"ix_csvbatch_biz_created\");\n\n                    b.ToTable(\"CsvBatches\", (string)null);\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.CampaignModule.Models.CsvRow\", b =>\n                {\n                    b.Property<Guid>(\"Id\")\n                        .ValueGeneratedOnAdd()\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<Guid>(\"BatchId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<Guid>(\"BusinessId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<DateTime>(\"CreatedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<string>(\"PhoneE164\")\n                        .HasMaxLength(32)\n                        .HasColumnType(\"character varying(32)\");\n\n                    b.Property<string>(\"PhoneRaw\")\n                        .HasMaxLength(64)\n                        .HasColumnType(\"character varying(64)\");\n\n                    b.Property<int>(\"RowIndex\")\n                        .HasColumnType(\"integer\");\n\n                    b.Property<string>(\"RowJson\")\n                        .IsRequired()\n                        .HasColumnType(\"jsonb\");\n\n                    b.Property<string>(\"ValidationError\")\n                        .HasColumnType(\"text\");\n\n                    b.HasKey(\"Id\");\n\n                    b.HasIndex(\"PhoneE164\")\n                        .HasDatabaseName(\"ix_csvrow_phone\");\n\n                    b.HasIndex(\"BatchId\", \"RowIndex\")\n                        .IsUnique()\n                        .HasDatabaseName(\"ux_csvrow_batch_rowidx\");\n\n                    b.HasIndex(\"BusinessId\", \"BatchId\");\n\n                    b.ToTable(\"CsvRows\", (string)null);\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.CampaignModule.Models.OutboundCampaignJob\", b =>\n                {\n                    b.Property<Guid>(\"Id\")\n                        .ValueGeneratedOnAdd()\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<int>(\"Attempt\")\n                        .HasColumnType(\"integer\");\n\n                    b.Property<Guid>(\"BusinessId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<Guid>(\"CampaignId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<DateTime>(\"CreatedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<string>(\"LastError\")\n                        .HasMaxLength(4000)\n                        .HasColumnType(\"character varying(4000)\");\n\n                    b.Property<int>(\"MaxAttempts\")\n                        .HasColumnType(\"integer\");\n\n                    b.Property<DateTimeOffset>(\"NextAttemptAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<string>(\"Status\")\n                        .IsRequired()\n                        .HasMaxLength(32)\n                        .HasColumnType(\"character varying(32)\");\n\n                    b.Property<DateTime>(\"UpdatedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.HasKey(\"Id\");\n\n                    b.HasIndex(\"CampaignId\");\n\n                    b.HasIndex(\"Status\", \"NextAttemptAt\");\n\n                    b.ToTable(\"OutboundCampaignJobs\", (string)null);\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.CampaignModule.Models.OutboundMessageJob\", b =>\n                {\n                    b.Property<Guid>(\"Id\")\n                        .ValueGeneratedOnAdd()\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<int>(\"Attempt\")\n                        .HasColumnType(\"integer\");\n\n                    b.Property<Guid>(\"BusinessId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<Guid>(\"CampaignId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<DateTime>(\"CreatedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<string>(\"HeaderMediaUrl\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"IdempotencyKey\")\n                        .HasMaxLength(1000)\n                        .HasColumnType(\"character varying(1000)\");\n\n                    b.Property<string>(\"LanguageCode\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"LastError\")\n                        .HasMaxLength(4000)\n                        .HasColumnType(\"character varying(4000)\");\n\n                    b.Property<string>(\"MediaType\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"MessageBody\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<DateTime?>(\"NextAttemptAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<string>(\"PhoneNumberId\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"Provider\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<Guid>(\"RecipientId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<string>(\"ResolvedButtonUrlsJson\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"ResolvedParamsJson\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"Status\")\n                        .IsRequired()\n                        .HasMaxLength(24)\n                        .HasColumnType(\"character varying(24)\");\n\n                    b.Property<string>(\"TemplateName\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.HasKey(\"Id\");\n\n                    b.HasIndex(\"CampaignId\");\n\n                    b.HasIndex(\"BusinessId\", \"IdempotencyKey\")\n                        .IsUnique()\n                        .HasDatabaseName(\"UX_Outbox_Biz_IdemKey\")\n                        .HasFilter(\"\\\"IdempotencyKey\\\" IS NOT NULL AND \\\"IdempotencyKey\\\" <> ''\");\n\n                    b.HasIndex(\"Status\", \"NextAttemptAt\", \"CreatedAt\")\n                        .HasDatabaseName(\"IX_Outbox_StatusDueCreated\");\n\n                    b.ToTable(\"OutboundMessageJobs\", (string)null);\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.CampaignTracking.Models.CampaignSendLog\", b =>\n                {\n                    b.Property<Guid>(\"Id\")\n                        .ValueGeneratedOnAdd()\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<bool>(\"AllowRetry\")\n                        .HasColumnType(\"boolean\");\n\n                    b.Property<string>(\"Browser\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<Guid>(\"BusinessId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<string>(\"ButtonBundleJson\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<Guid?>(\"CTAFlowConfigId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<Guid?>(\"CTAFlowStepId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<Guid>(\"CampaignId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<string>(\"City\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"ClickType\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<DateTime?>(\"ClickedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<Guid?>(\"ContactId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<string>(\"Country\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<DateTime>(\"CreatedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<string>(\"CreatedBy\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<DateTime?>(\"DeliveredAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<string>(\"DeviceInfo\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"DeviceType\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"ErrorMessage\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"IpAddress\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<bool>(\"IsClicked\")\n                        .HasColumnType(\"boolean\");\n\n                    b.Property<DateTime?>(\"LastRetryAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<string>(\"LastRetryStatus\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"MacAddress\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"MessageBody\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"MessageId\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<Guid?>(\"MessageLogId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<DateTime?>(\"ReadAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<Guid>(\"RecipientId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<int>(\"RetryCount\")\n                        .HasColumnType(\"integer\");\n\n                    b.Property<Guid?>(\"RunId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<string>(\"SendStatus\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<DateTime?>(\"SentAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<string>(\"SourceChannel\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"TemplateId\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<Guid?>(\"UserId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.HasKey(\"Id\");\n\n                    b.HasIndex(\"CampaignId\")\n                        .HasDatabaseName(\"IX_CampaignSendLogs_Campaign\");\n\n                    b.HasIndex(\"ContactId\");\n\n                    b.HasIndex(\"MessageId\");\n\n                    b.HasIndex(\"MessageLogId\");\n\n                    b.HasIndex(\"RecipientId\");\n\n                    b.HasIndex(\"RunId\");\n\n                    b.HasIndex(\"UserId\");\n\n                    b.HasIndex(\"BusinessId\", \"MessageId\")\n                        .HasDatabaseName(\"IX_CampaignSendLogs_Business_MessageId\");\n\n                    b.HasIndex(\"BusinessId\", \"SendStatus\", \"SentAt\")\n                        .HasDatabaseName(\"IX_CampaignSendLogs_StatusTime\");\n\n                    b.ToTable(\"CampaignSendLogs\", (string)null);\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.CampaignTracking.Worker.CampaignClickDailyAgg\", b =>\n                {\n                    b.Property<Guid>(\"Id\")\n                        .ValueGeneratedOnAdd()\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<int>(\"ButtonIndex\")\n                        .HasColumnType(\"integer\");\n\n                    b.Property<Guid>(\"CampaignId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<long>(\"Clicks\")\n                        .HasColumnType(\"bigint\");\n\n                    b.Property<DateTime>(\"Day\")\n                        .HasColumnType(\"date\");\n\n                    b.HasKey(\"Id\");\n\n                    b.HasIndex(\"CampaignId\", \"Day\", \"ButtonIndex\")\n                        .IsUnique();\n\n                    b.ToTable(\"CampaignClickDailyAgg\");\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.CampaignTracking.Worker.CampaignClickLog\", b =>\n                {\n                    b.Property<Guid>(\"Id\")\n                        .ValueGeneratedOnAdd()\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<int>(\"ButtonIndex\")\n                        .HasColumnType(\"integer\");\n\n                    b.Property<string>(\"ButtonTitle\")\n                        .IsRequired()\n                        .HasMaxLength(120)\n                        .HasColumnType(\"character varying(120)\");\n\n                    b.Property<Guid>(\"CampaignId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<Guid>(\"CampaignSendLogId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<string>(\"ClickType\")\n                        .IsRequired()\n                        .HasMaxLength(16)\n                        .HasColumnType(\"character varying(16)\");\n\n                    b.Property<DateTime>(\"ClickedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<Guid?>(\"ContactId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<string>(\"Destination\")\n                        .IsRequired()\n                        .HasMaxLength(2048)\n                        .HasColumnType(\"character varying(2048)\");\n\n                    b.Property<string>(\"Ip\")\n                        .IsRequired()\n                        .HasMaxLength(64)\n                        .HasColumnType(\"character varying(64)\");\n\n                    b.Property<Guid?>(\"RunId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<string>(\"UserAgent\")\n                        .IsRequired()\n                        .HasMaxLength(512)\n                        .HasColumnType(\"character varying(512)\");\n\n                    b.HasKey(\"Id\");\n\n                    b.HasIndex(\"CampaignId\", \"ButtonIndex\");\n\n                    b.HasIndex(\"CampaignId\", \"ContactId\");\n\n                    b.HasIndex(\"CampaignId\", \"ClickType\", \"ClickedAt\");\n\n                    b.ToTable(\"CampaignClickLogs\");\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.Catalog.Models.CatalogClickLog\", b =>\n                {\n                    b.Property<Guid>(\"Id\")\n                        .ValueGeneratedOnAdd()\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<string>(\"BotId\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<Guid>(\"BusinessId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<string>(\"ButtonText\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"CTAJourney\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<Guid?>(\"CampaignId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<Guid?>(\"CampaignSendLogId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<string>(\"CategoryBrowsed\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<DateTime?>(\"ClickedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<Guid?>(\"ContactId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<Guid?>(\"CtaId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<bool>(\"FollowUpSent\")\n                        .HasColumnType(\"boolean\");\n\n                    b.Property<string>(\"LastInteractionType\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<Guid?>(\"MessageLogId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<string>(\"PlanSnapshot\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"ProductBrowsed\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<Guid?>(\"ProductId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<string>(\"RefMessageId\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"Source\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"TemplateId\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"UserId\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"UserName\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"UserPhone\")\n                        .HasColumnType(\"text\");\n\n                    b.HasKey(\"Id\");\n\n                    b.ToTable(\"CatalogClickLogs\");\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.Catalog.Models.Product\", b =>\n                {\n                    b.Property<Guid>(\"Id\")\n                        .ValueGeneratedOnAdd()\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<Guid>(\"BusinessId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<DateTime>(\"CreatedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<string>(\"Currency\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"Description\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"ImageUrl\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<bool>(\"IsActive\")\n                        .HasColumnType(\"boolean\");\n\n                    b.Property<DateTime?>(\"LastClickedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<string>(\"MostClickedCTA\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"Name\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<decimal>(\"Price\")\n                        .HasColumnType(\"numeric\");\n\n                    b.Property<int>(\"TotalClicks\")\n                        .HasColumnType(\"integer\");\n\n                    b.HasKey(\"Id\");\n\n                    b.ToTable(\"Products\");\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.CustomeApi.Models.ApiKey\", b =>\n                {\n                    b.Property<Guid>(\"Id\")\n                        .ValueGeneratedOnAdd()\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<Guid>(\"BusinessId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<DateTime>(\"CreatedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<string>(\"CreatedBy\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<DateTime?>(\"ExpiresAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<bool>(\"IsRevoked\")\n                        .HasColumnType(\"boolean\");\n\n                    b.Property<DateTime?>(\"LastUsedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<string>(\"Name\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"Notes\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"Prefix\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"Scopes\")\n                        .IsRequired()\n                        .HasMaxLength(512)\n                        .HasColumnType(\"character varying(512)\");\n\n                    b.Property<string>(\"SecretHash\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.HasKey(\"Id\");\n\n                    b.HasIndex(\"Prefix\")\n                        .IsUnique();\n\n                    b.ToTable(\"ApiKeys\");\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.CustomeApi.Models.ContactJourneyState\", b =>\n                {\n                    b.Property<Guid>(\"Id\")\n                        .ValueGeneratedOnAdd()\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<Guid>(\"BusinessId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<int>(\"ClickCount\")\n                        .HasColumnType(\"integer\");\n\n                    b.Property<string>(\"ContactPhone\")\n                        .IsRequired()\n                        .HasMaxLength(32)\n                        .HasColumnType(\"character varying(32)\");\n\n                    b.Property<DateTime>(\"CreatedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<Guid>(\"FlowId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<string>(\"JourneyText\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"LastButtonText\")\n                        .HasMaxLength(256)\n                        .HasColumnType(\"character varying(256)\");\n\n                    b.Property<DateTime>(\"UpdatedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.HasKey(\"Id\");\n\n                    b.HasIndex(\"BusinessId\", \"FlowId\", \"ContactPhone\")\n                        .IsUnique();\n\n                    b.ToTable(\"ContactJourneyStates\");\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.CustomeApi.Models.CustomerWebhookConfig\", b =>\n                {\n                    b.Property<Guid>(\"Id\")\n                        .ValueGeneratedOnAdd()\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<string>(\"BearerToken\")\n                        .HasMaxLength(2048)\n                        .HasColumnType(\"character varying(2048)\");\n\n                    b.Property<Guid>(\"BusinessId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<DateTime>(\"CreatedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<bool>(\"IsActive\")\n                        .HasColumnType(\"boolean\");\n\n                    b.Property<DateTime?>(\"UpdatedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<string>(\"Url\")\n                        .IsRequired()\n                        .HasMaxLength(1024)\n                        .HasColumnType(\"character varying(1024)\");\n\n                    b.HasKey(\"Id\");\n\n                    b.ToTable(\"CustomerWebhookConfigs\");\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.ESU.Facebook.Models.EsuToken\", b =>\n                {\n                    b.Property<Guid>(\"Id\")\n                        .ValueGeneratedOnAdd()\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<string>(\"AccessToken\")\n                        .IsRequired()\n                        .HasMaxLength(4096)\n                        .HasColumnType(\"character varying(4096)\");\n\n                    b.Property<Guid>(\"BusinessId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<DateTime>(\"CreatedAtUtc\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<DateTime?>(\"ExpiresAtUtc\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<bool>(\"IsRevoked\")\n                        .HasColumnType(\"boolean\");\n\n                    b.Property<string>(\"Provider\")\n                        .IsRequired()\n                        .HasMaxLength(50)\n                        .HasColumnType(\"character varying(50)\");\n\n                    b.Property<string>(\"Scope\")\n                        .HasMaxLength(512)\n                        .HasColumnType(\"character varying(512)\");\n\n                    b.Property<DateTime?>(\"UpdatedAtUtc\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.HasKey(\"Id\");\n\n                    b.HasIndex(\"BusinessId\", \"Provider\")\n                        .IsUnique();\n\n                    b.ToTable(\"EsuTokens\", (string)null);\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.ESU.Facebook.Models.IntegrationFlags\", b =>\n                {\n                    b.Property<Guid>(\"BusinessId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<DateTime>(\"CreatedAtUtc\")\n                        .ValueGeneratedOnAdd()\n                        .HasColumnType(\"timestamp with time zone\")\n                        .HasDefaultValueSql(\"timezone('utc', now())\");\n\n                    b.Property<bool>(\"FacebookEsuCompleted\")\n                        .ValueGeneratedOnAdd()\n                        .HasColumnType(\"boolean\")\n                        .HasDefaultValue(false);\n\n                    b.Property<DateTime>(\"UpdatedAtUtc\")\n                        .ValueGeneratedOnAdd()\n                        .HasColumnType(\"timestamp with time zone\")\n                        .HasDefaultValueSql(\"timezone('utc', now())\");\n\n                    b.HasKey(\"BusinessId\");\n\n                    b.ToTable(\"IntegrationFlags\", (string)null);\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.Entitlements.Models.BusinessQuotaOverride\", b =>\n                {\n                    b.Property<Guid>(\"Id\")\n                        .ValueGeneratedOnAdd()\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<Guid>(\"BusinessId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<DateTime>(\"CreatedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<DateTime?>(\"ExpiresAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<bool?>(\"IsUnlimited\")\n                        .HasColumnType(\"boolean\");\n\n                    b.Property<long?>(\"Limit\")\n                        .HasColumnType(\"bigint\");\n\n                    b.Property<string>(\"QuotaKey\")\n                        .IsRequired()\n                        .HasMaxLength(128)\n                        .HasColumnType(\"character varying(128)\");\n\n                    b.Property<DateTime?>(\"UpdatedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.HasKey(\"Id\");\n\n                    b.HasIndex(\"BusinessId\", \"QuotaKey\")\n                        .IsUnique();\n\n                    b.ToTable(\"BusinessQuotaOverrides\");\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.Entitlements.Models.BusinessUsageCounter\", b =>\n                {\n                    b.Property<Guid>(\"Id\")\n                        .ValueGeneratedOnAdd()\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<Guid>(\"BusinessId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<long>(\"Consumed\")\n                        .HasColumnType(\"bigint\");\n\n                    b.Property<DateTime>(\"CreatedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<int>(\"Period\")\n                        .HasColumnType(\"integer\");\n\n                    b.Property<string>(\"QuotaKey\")\n                        .IsRequired()\n                        .HasMaxLength(128)\n                        .HasColumnType(\"character varying(128)\");\n\n                    b.Property<DateTime>(\"UpdatedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<DateTime>(\"WindowStartUtc\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.HasKey(\"Id\");\n\n                    b.HasIndex(\"BusinessId\", \"QuotaKey\", \"Period\", \"WindowStartUtc\")\n                        .IsUnique();\n\n                    b.ToTable(\"BusinessUsageCounters\");\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.Entitlements.Models.PlanQuota\", b =>\n                {\n                    b.Property<Guid>(\"Id\")\n                        .ValueGeneratedOnAdd()\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<DateTime>(\"CreatedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<string>(\"DenialMessage\")\n                        .HasMaxLength(256)\n                        .HasColumnType(\"character varying(256)\");\n\n                    b.Property<long>(\"Limit\")\n                        .HasColumnType(\"bigint\");\n\n                    b.Property<int>(\"Period\")\n                        .HasColumnType(\"integer\");\n\n                    b.Property<Guid>(\"PlanId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<string>(\"QuotaKey\")\n                        .IsRequired()\n                        .HasMaxLength(128)\n                        .HasColumnType(\"character varying(128)\");\n\n                    b.Property<DateTime?>(\"UpdatedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.HasKey(\"Id\");\n\n                    b.HasIndex(\"PlanId\", \"QuotaKey\")\n                        .IsUnique();\n\n                    b.ToTable(\"PlanQuotas\");\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.Inbox.Models.ChatSessionState\", b =>\n                {\n                    b.Property<Guid>(\"Id\")\n                        .ValueGeneratedOnAdd()\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<Guid>(\"BusinessId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<Guid>(\"ContactId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<DateTime>(\"LastUpdatedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<string>(\"Mode\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"UpdatedBy\")\n                        .HasColumnType(\"text\");\n\n                    b.HasKey(\"Id\");\n\n                    b.ToTable(\"ChatSessionStates\");\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.Inbox.Models.ContactRead\", b =>\n                {\n                    b.Property<Guid>(\"Id\")\n                        .ValueGeneratedOnAdd()\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<Guid>(\"BusinessId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<Guid>(\"ContactId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<DateTime>(\"LastReadAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<Guid>(\"UserId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.HasKey(\"Id\");\n\n                    b.HasIndex(\"ContactId\", \"UserId\")\n                        .IsUnique();\n\n                    b.HasIndex(\"BusinessId\", \"UserId\", \"ContactId\")\n                        .IsUnique()\n                        .HasDatabaseName(\"ux_contactreads_biz_user_contact\");\n\n                    b.ToTable(\"ContactReads\");\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.Inbox.Models.QuickReply\", b =>\n                {\n                    b.Property<Guid>(\"Id\")\n                        .ValueGeneratedOnAdd()\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<string>(\"Body\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<Guid>(\"BusinessId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<DateTime>(\"CreatedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<string>(\"CreatedBy\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<bool>(\"IsActive\")\n                        .HasColumnType(\"boolean\");\n\n                    b.Property<bool>(\"IsDeleted\")\n                        .HasColumnType(\"boolean\");\n\n                    b.Property<string>(\"Language\")\n                        .HasMaxLength(8)\n                        .HasColumnType(\"character varying(8)\");\n\n                    b.Property<Guid?>(\"OwnerUserId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<int>(\"Scope\")\n                        .HasColumnType(\"integer\");\n\n                    b.Property<string>(\"TagsCsv\")\n                        .HasMaxLength(240)\n                        .HasColumnType(\"character varying(240)\");\n\n                    b.Property<string>(\"Title\")\n                        .IsRequired()\n                        .HasMaxLength(120)\n                        .HasColumnType(\"character varying(120)\");\n\n                    b.Property<DateTime>(\"UpdatedAt\")\n                        .ValueGeneratedOnAdd()\n                        .HasColumnType(\"timestamp with time zone\")\n                        .HasDefaultValueSql(\"NOW()\");\n\n                    b.Property<string>(\"UpdatedBy\")\n                        .HasColumnType(\"text\");\n\n                    b.HasKey(\"Id\");\n\n                    b.HasIndex(\"UpdatedAt\");\n\n                    b.HasIndex(\"BusinessId\", \"OwnerUserId\", \"IsActive\");\n\n                    b.HasIndex(\"BusinessId\", \"Scope\", \"IsActive\");\n\n                    b.ToTable(\"QuickReplies\");\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.MessageManagement.DTOs.MessageStatusLog\", b =>\n                {\n                    b.Property<Guid>(\"Id\")\n                        .ValueGeneratedOnAdd()\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<Guid?>(\"BusinessId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<Guid?>(\"CampaignId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<string>(\"Channel\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<DateTime>(\"CreatedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<string>(\"CustomerProfileName\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<DateTime?>(\"DeliveredAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<int?>(\"ErrorCode\")\n                        .HasColumnType(\"integer\");\n\n                    b.Property<string>(\"ErrorMessage\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<bool>(\"IsSessionOpen\")\n                        .HasColumnType(\"boolean\");\n\n                    b.Property<string>(\"MessageId\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"MessageType\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<long?>(\"MetaTimestamp\")\n                        .HasColumnType(\"bigint\");\n\n                    b.Property<string>(\"RawPayload\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<DateTime?>(\"ReadAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<string>(\"RecipientNumber\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<DateTime?>(\"SentAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<string>(\"Status\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"TemplateCategory\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"TemplateName\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<Guid?>(\"UserId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.HasKey(\"Id\");\n\n                    b.HasIndex(\"BusinessId\");\n\n                    b.HasIndex(\"CampaignId\");\n\n                    b.HasIndex(\"UserId\");\n\n                    b.ToTable(\"MessageStatusLogs\");\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.Payment.Models.Coupon\", b =>\n                {\n                    b.Property<Guid>(\"Id\")\n                        .ValueGeneratedOnAdd()\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<string>(\"Code\")\n                        .IsRequired()\n                        .HasMaxLength(100)\n                        .HasColumnType(\"character varying(100)\");\n\n                    b.Property<string>(\"Description\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<int>(\"DiscountType\")\n                        .HasColumnType(\"integer\");\n\n                    b.Property<decimal>(\"DiscountValue\")\n                        .HasColumnType(\"numeric(18,2)\");\n\n                    b.Property<bool>(\"IsActive\")\n                        .HasColumnType(\"boolean\");\n\n                    b.Property<int?>(\"MaxRedemptions\")\n                        .HasColumnType(\"integer\");\n\n                    b.Property<int?>(\"MaxRedemptionsPerBusiness\")\n                        .HasColumnType(\"integer\");\n\n                    b.Property<string>(\"MetaJson\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<Guid?>(\"PlanId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<DateTime?>(\"ValidFromUtc\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<DateTime?>(\"ValidToUtc\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.HasKey(\"Id\");\n\n                    b.HasIndex(\"Code\")\n                        .IsUnique();\n\n                    b.HasIndex(\"PlanId\");\n\n                    b.ToTable(\"Coupons\", (string)null);\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.Payment.Models.Invoice\", b =>\n                {\n                    b.Property<Guid>(\"Id\")\n                        .ValueGeneratedOnAdd()\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<string>(\"AppliedCouponCode\")\n                        .HasMaxLength(100)\n                        .HasColumnType(\"character varying(100)\");\n\n                    b.Property<int?>(\"BillingCycle\")\n                        .HasColumnType(\"integer\");\n\n                    b.Property<Guid>(\"BusinessId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<string>(\"Currency\")\n                        .IsRequired()\n                        .HasMaxLength(10)\n                        .HasColumnType(\"character varying(10)\");\n\n                    b.Property<decimal>(\"DiscountAmount\")\n                        .HasColumnType(\"numeric(18,2)\");\n\n                    b.Property<DateTime?>(\"DueAtUtc\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<string>(\"InvoiceNumber\")\n                        .IsRequired()\n                        .HasMaxLength(100)\n                        .HasColumnType(\"character varying(100)\");\n\n                    b.Property<DateTime>(\"IssuedAtUtc\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<string>(\"Notes\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<DateTime?>(\"PaidAtUtc\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<Guid?>(\"PlanId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<int>(\"Status\")\n                        .HasColumnType(\"integer\");\n\n                    b.Property<Guid?>(\"SubscriptionId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<decimal>(\"SubtotalAmount\")\n                        .HasColumnType(\"numeric(18,2)\");\n\n                    b.Property<decimal>(\"TaxAmount\")\n                        .HasColumnType(\"numeric(18,2)\");\n\n                    b.Property<string>(\"TaxBreakdownJson\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<decimal>(\"TotalAmount\")\n                        .HasColumnType(\"numeric(18,2)\");\n\n                    b.HasKey(\"Id\");\n\n                    b.HasIndex(\"BusinessId\");\n\n                    b.HasIndex(\"InvoiceNumber\")\n                        .IsUnique();\n\n                    b.HasIndex(\"PlanId\");\n\n                    b.HasIndex(\"SubscriptionId\");\n\n                    b.ToTable(\"Invoices\", (string)null);\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.Payment.Models.InvoiceLineItem\", b =>\n                {\n                    b.Property<Guid>(\"Id\")\n                        .ValueGeneratedOnAdd()\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<string>(\"Description\")\n                        .IsRequired()\n                        .HasMaxLength(500)\n                        .HasColumnType(\"character varying(500)\");\n\n                    b.Property<Guid>(\"InvoiceId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<decimal>(\"LineTotal\")\n                        .HasColumnType(\"numeric(18,2)\");\n\n                    b.Property<string>(\"MetaJson\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<decimal>(\"Quantity\")\n                        .HasColumnType(\"numeric(18,2)\");\n\n                    b.Property<decimal>(\"UnitPrice\")\n                        .HasColumnType(\"numeric(18,2)\");\n\n                    b.HasKey(\"Id\");\n\n                    b.HasIndex(\"InvoiceId\");\n\n                    b.ToTable(\"InvoiceLineItems\", (string)null);\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.Payment.Models.PaymentTransaction\", b =>\n                {\n                    b.Property<Guid>(\"Id\")\n                        .ValueGeneratedOnAdd()\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<decimal>(\"Amount\")\n                        .HasColumnType(\"numeric(18,2)\");\n\n                    b.Property<Guid>(\"BusinessId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<DateTime?>(\"CompletedAtUtc\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<DateTime>(\"CreatedAtUtc\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<string>(\"Currency\")\n                        .IsRequired()\n                        .HasMaxLength(10)\n                        .HasColumnType(\"character varying(10)\");\n\n                    b.Property<string>(\"FailureReason\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"Gateway\")\n                        .IsRequired()\n                        .HasMaxLength(50)\n                        .HasColumnType(\"character varying(50)\");\n\n                    b.Property<string>(\"GatewayOrderId\")\n                        .HasMaxLength(200)\n                        .HasColumnType(\"character varying(200)\");\n\n                    b.Property<string>(\"GatewayPaymentId\")\n                        .HasMaxLength(200)\n                        .HasColumnType(\"character varying(200)\");\n\n                    b.Property<string>(\"GatewaySignature\")\n                        .HasMaxLength(500)\n                        .HasColumnType(\"character varying(500)\");\n\n                    b.Property<Guid?>(\"InvoiceId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<string>(\"MetaJson\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<int>(\"Status\")\n                        .HasColumnType(\"integer\");\n\n                    b.Property<Guid?>(\"SubscriptionId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.HasKey(\"Id\");\n\n                    b.HasIndex(\"BusinessId\");\n\n                    b.HasIndex(\"InvoiceId\");\n\n                    b.HasIndex(\"SubscriptionId\");\n\n                    b.ToTable(\"PaymentTransactions\", (string)null);\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.Payment.Models.Subscription\", b =>\n                {\n                    b.Property<Guid>(\"Id\")\n                        .ValueGeneratedOnAdd()\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<bool>(\"AutoRenew\")\n                        .HasColumnType(\"boolean\");\n\n                    b.Property<int>(\"BillingCycle\")\n                        .HasColumnType(\"integer\");\n\n                    b.Property<Guid>(\"BusinessId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<bool>(\"CancelAtPeriodEnd\")\n                        .HasColumnType(\"boolean\");\n\n                    b.Property<DateTime>(\"CurrentPeriodEndUtc\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<DateTime>(\"CurrentPeriodStartUtc\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<string>(\"GatewayCustomerId\")\n                        .HasMaxLength(200)\n                        .HasColumnType(\"character varying(200)\");\n\n                    b.Property<string>(\"GatewaySubscriptionId\")\n                        .HasMaxLength(200)\n                        .HasColumnType(\"character varying(200)\");\n\n                    b.Property<string>(\"Notes\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<Guid>(\"PlanId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<int>(\"Status\")\n                        .HasColumnType(\"integer\");\n\n                    b.Property<DateTime?>(\"TrialEndsAtUtc\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.HasKey(\"Id\");\n\n                    b.HasIndex(\"BusinessId\");\n\n                    b.HasIndex(\"PlanId\");\n\n                    b.ToTable(\"Subscriptions\", (string)null);\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.PlanManagement.Models.PlanFeatureMatrix\", b =>\n                {\n                    b.Property<Guid>(\"Id\")\n                        .ValueGeneratedOnAdd()\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<string>(\"FeatureName\")\n                        .IsRequired()\n                        .HasMaxLength(50)\n                        .HasColumnType(\"character varying(50)\");\n\n                    b.Property<bool>(\"IsEnabled\")\n                        .HasColumnType(\"boolean\");\n\n                    b.Property<string>(\"PlanName\")\n                        .IsRequired()\n                        .HasMaxLength(20)\n                        .HasColumnType(\"character varying(20)\");\n\n                    b.HasKey(\"Id\");\n\n                    b.ToTable(\"PlanFeatureMatrix\");\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.TemplateModule.Models.TemplateDraft\", b =>\n                {\n                    b.Property<Guid>(\"Id\")\n                        .ValueGeneratedOnAdd()\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<Guid>(\"BusinessId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<string>(\"Category\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<DateTime>(\"CreatedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<string>(\"CreatedByUserId\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"DefaultLanguage\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"Key\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<DateTime>(\"UpdatedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.HasKey(\"Id\");\n\n                    b.HasIndex(\"CreatedAt\")\n                        .HasDatabaseName(\"IX_TemplateDrafts_CreatedAt\");\n\n                    b.HasIndex(\"BusinessId\", \"Key\")\n                        .IsUnique()\n                        .HasDatabaseName(\"UX_TemplateDrafts_Biz_Key\");\n\n                    b.HasIndex(\"BusinessId\", \"UpdatedAt\")\n                        .HasDatabaseName(\"IX_TemplateDrafts_Biz_UpdatedAt\");\n\n                    b.ToTable(\"TemplateDrafts\");\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.TemplateModule.Models.TemplateDraftVariant\", b =>\n                {\n                    b.Property<Guid>(\"Id\")\n                        .ValueGeneratedOnAdd()\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<string>(\"BodyText\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"ButtonsJson\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"ExampleParamsJson\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"FooterText\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"HeaderMediaLocalUrl\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"HeaderText\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"HeaderType\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<bool>(\"IsReadyForSubmission\")\n                        .HasColumnType(\"boolean\");\n\n                    b.Property<string>(\"Language\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<Guid>(\"TemplateDraftId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<string>(\"ValidationErrorsJson\")\n                        .HasColumnType(\"text\");\n\n                    b.HasKey(\"Id\");\n\n                    b.HasIndex(\"Language\")\n                        .HasDatabaseName(\"IX_TDraftVariants_Language\");\n\n                    b.HasIndex(\"TemplateDraftId\", \"IsReadyForSubmission\")\n                        .HasDatabaseName(\"IX_TDraftVariants_Draft_Ready\");\n\n                    b.HasIndex(\"TemplateDraftId\", \"Language\")\n                        .IsUnique()\n                        .HasDatabaseName(\"UX_TDraftVariants_Draft_Language\");\n\n                    b.ToTable(\"TemplateDraftVariants\");\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.TemplateModule.Models.TemplateLibraryItem\", b =>\n                {\n                    b.Property<Guid>(\"Id\")\n                        .ValueGeneratedOnAdd()\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<string>(\"Category\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"Industry\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<bool>(\"IsFeatured\")\n                        .HasColumnType(\"boolean\");\n\n                    b.Property<string>(\"Key\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"TagsJson\")\n                        .HasColumnType(\"text\");\n\n                    b.HasKey(\"Id\");\n\n                    b.HasIndex(\"Category\")\n                        .HasDatabaseName(\"IX_TLibrary_Category\");\n\n                    b.HasIndex(\"Industry\", \"IsFeatured\")\n                        .HasDatabaseName(\"IX_TLibrary_Industry_Featured\");\n\n                    b.HasIndex(\"Industry\", \"Key\")\n                        .IsUnique()\n                        .HasDatabaseName(\"UX_TLibrary_Industry_Key\");\n\n                    b.ToTable(\"TemplateLibraryItems\");\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.TemplateModule.Models.TemplateLibraryVariant\", b =>\n                {\n                    b.Property<Guid>(\"Id\")\n                        .ValueGeneratedOnAdd()\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<string>(\"BodyText\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"ButtonsJson\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"ExampleParamsJson\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"FooterText\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"HeaderDemoUrl\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"HeaderText\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"HeaderType\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"Language\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<Guid>(\"LibraryItemId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.HasKey(\"Id\");\n\n                    b.HasIndex(\"Language\")\n                        .HasDatabaseName(\"IX_TLibraryVariants_Language\");\n\n                    b.HasIndex(\"LibraryItemId\", \"Language\")\n                        .IsUnique()\n                        .HasDatabaseName(\"UX_TLibraryVariants_Item_Lang\");\n\n                    b.ToTable(\"TemplateLibraryVariants\");\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.Tracking.Models.TrackingLog\", b =>\n                {\n                    b.Property<Guid>(\"Id\")\n                        .ValueGeneratedOnAdd()\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<string>(\"Browser\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<Guid>(\"BusinessId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<string>(\"ButtonText\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"CTAType\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<Guid?>(\"CampaignId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<Guid?>(\"CampaignSendLogId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<string>(\"City\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<DateTime>(\"ClickedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<string>(\"ClickedVia\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<Guid?>(\"ContactId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<string>(\"ContactPhone\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"Country\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"DeviceType\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<bool>(\"FollowUpSent\")\n                        .HasColumnType(\"boolean\");\n\n                    b.Property<string>(\"IPAddress\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"LastInteractionType\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"MessageId\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<Guid?>(\"MessageLogId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<string>(\"Referrer\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<Guid?>(\"SessionId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<Guid?>(\"SourceId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<string>(\"SourceType\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<Guid?>(\"StepId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<string>(\"TemplateId\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<Guid?>(\"ThreadId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.HasKey(\"Id\");\n\n                    b.HasIndex(\"CampaignId\")\n                        .HasDatabaseName(\"IX_TrackingLogs_Campaign\");\n\n                    b.HasIndex(\"CampaignSendLogId\")\n                        .HasDatabaseName(\"IX_TrackingLogs_SendLog\");\n\n                    b.HasIndex(\"ContactId\");\n\n                    b.HasIndex(\"MessageLogId\")\n                        .HasDatabaseName(\"IX_TrackingLogs_MessageLog\");\n\n                    b.ToTable(\"TrackingLogs\");\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.Webhooks.Models.FailedWebhookLog\", b =>\n                {\n                    b.Property<Guid>(\"Id\")\n                        .ValueGeneratedOnAdd()\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<DateTime>(\"CreatedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<string>(\"ErrorMessage\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"FailureType\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"RawJson\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"SourceModule\")\n                        .HasColumnType(\"text\");\n\n                    b.HasKey(\"Id\");\n\n                    b.ToTable(\"FailedWebhookLogs\");\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.Webhooks.Models.WebhookSettings\", b =>\n                {\n                    b.Property<Guid>(\"Id\")\n                        .ValueGeneratedOnAdd()\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<bool>(\"AutoCleanupEnabled\")\n                        .HasColumnType(\"boolean\");\n\n                    b.Property<DateTime?>(\"LastCleanupAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.HasKey(\"Id\");\n\n                    b.ToTable(\"WebhookSettings\");\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.WhatsAppSettings.Models.WhatsAppPhoneNumber\", b =>\n                {\n                    b.Property<Guid>(\"Id\")\n                        .ValueGeneratedOnAdd()\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<Guid>(\"BusinessId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<DateTime>(\"CreatedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<bool>(\"IsActive\")\n                        .HasColumnType(\"boolean\");\n\n                    b.Property<bool>(\"IsDefault\")\n                        .HasColumnType(\"boolean\");\n\n                    b.Property<string>(\"PhoneNumberId\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"Provider\")\n                        .IsRequired()\n                        .HasColumnType(\"character varying(50)\");\n\n                    b.Property<string>(\"SenderDisplayName\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<DateTime?>(\"UpdatedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<string>(\"WhatsAppBusinessNumber\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.HasKey(\"Id\");\n\n                    b.HasIndex(\"BusinessId\", \"Provider\", \"PhoneNumberId\")\n                        .IsUnique()\n                        .HasDatabaseName(\"UX_WhatsappPhoneNumbers_Bus_Prov_PhoneId\");\n\n                    b.ToTable(\"WhatsAppPhoneNumbers\", (string)null);\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.xbTimelines.Models.LeadTimeline\", b =>\n                {\n                    b.Property<int>(\"Id\")\n                        .ValueGeneratedOnAdd()\n                        .HasColumnType(\"integer\");\n\n                    NpgsqlPropertyBuilderExtensions.UseIdentityByDefaultColumn(b.Property<int>(\"Id\"));\n\n                    b.Property<Guid>(\"BusinessId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<Guid?>(\"CTASourceId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<string>(\"CTASourceType\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"CTAType\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"Category\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<Guid>(\"ContactId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<DateTime>(\"CreatedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<string>(\"CreatedBy\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"Data\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"Description\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"EventType\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<bool>(\"IsSystemGenerated\")\n                        .HasColumnType(\"boolean\");\n\n                    b.Property<Guid?>(\"ReferenceId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<string>(\"Source\")\n                        .HasColumnType(\"text\");\n\n                    b.HasKey(\"Id\");\n\n                    b.HasIndex(\"BusinessId\");\n\n                    b.HasIndex(\"ContactId\");\n\n                    b.ToTable(\"LeadTimelines\");\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Models.BusinessModel.BusinessPlanInfo\", b =>\n                {\n                    b.Property<Guid>(\"Id\")\n                        .ValueGeneratedOnAdd()\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<Guid>(\"BusinessId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<DateTime>(\"CreatedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<int>(\"Plan\")\n                        .HasColumnType(\"integer\");\n\n                    b.Property<DateTime>(\"QuotaResetDate\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<int>(\"RemainingMessages\")\n                        .HasColumnType(\"integer\");\n\n                    b.Property<int>(\"TotalMonthlyQuota\")\n                        .HasColumnType(\"integer\");\n\n                    b.Property<DateTime>(\"UpdatedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<decimal>(\"WalletBalance\")\n                        .HasColumnType(\"numeric\");\n\n                    b.HasKey(\"Id\");\n\n                    b.HasIndex(\"BusinessId\")\n                        .IsUnique();\n\n                    b.ToTable(\"BusinessPlanInfos\");\n                });\n\n            modelBuilder.Entity(\"xbytechat_api.Features.Billing.Models.ProviderBillingEvent\", b =>\n                {\n                    b.Property<Guid>(\"Id\")\n                        .ValueGeneratedOnAdd()\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<Guid>(\"BusinessId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<string>(\"ConversationCategory\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"ConversationId\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<DateTimeOffset>(\"CreatedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<string>(\"EventType\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<bool?>(\"IsChargeable\")\n                        .HasColumnType(\"boolean\");\n\n                    b.Property<Guid?>(\"MessageLogId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<DateTimeOffset>(\"OccurredAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<string>(\"PayloadJson\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<decimal?>(\"PriceAmount\")\n                        .HasColumnType(\"numeric\");\n\n                    b.Property<string>(\"PriceCurrency\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"Provider\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"ProviderMessageId\")\n                        .HasColumnType(\"text\");\n\n                    b.HasKey(\"Id\");\n\n                    b.HasIndex(\"BusinessId\", \"ConversationId\")\n                        .HasDatabaseName(\"IX_Billing_BizConversation\")\n                        .HasFilter(\"\\\"ConversationId\\\" IS NOT NULL\");\n\n                    b.HasIndex(\"BusinessId\", \"ProviderMessageId\")\n                        .HasDatabaseName(\"IX_Billing_BizProviderMessage\")\n                        .HasFilter(\"\\\"ProviderMessageId\\\" IS NOT NULL\");\n\n                    b.HasIndex(\"BusinessId\", \"EventType\", \"OccurredAt\")\n                        .HasDatabaseName(\"IX_Billing_BizEventTime\");\n\n                    b.HasIndex(\"BusinessId\", \"Provider\", \"ProviderMessageId\", \"EventType\")\n                        .IsUnique()\n                        .HasDatabaseName(\"UX_ProviderBillingEvents_UniqueEvent\")\n                        .HasFilter(\"\\\"ProviderMessageId\\\" IS NOT NULL\");\n\n                    b.ToTable(\"ProviderBillingEvents\");\n                });\n\n            modelBuilder.Entity(\"xbytechat_api.WhatsAppSettings.Models.WhatsAppSettingEntity\", b =>\n                {\n                    b.Property<Guid>(\"Id\")\n                        .ValueGeneratedOnAdd()\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<string>(\"ApiKey\")\n                        .IsRequired()\n                        .HasMaxLength(1000)\n                        .HasColumnType(\"character varying(1000)\");\n\n                    b.Property<string>(\"ApiUrl\")\n                        .IsRequired()\n                        .HasMaxLength(500)\n                        .HasColumnType(\"character varying(500)\");\n\n                    b.Property<Guid>(\"BusinessId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<DateTime>(\"CreatedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<bool>(\"IsActive\")\n                        .HasColumnType(\"boolean\");\n\n                    b.Property<string>(\"Provider\")\n                        .IsRequired()\n                        .HasMaxLength(50)\n                        .HasColumnType(\"character varying(50)\");\n\n                    b.Property<string>(\"SenderDisplayName\")\n                        .HasMaxLength(100)\n                        .HasColumnType(\"character varying(100)\");\n\n                    b.Property<DateTime?>(\"UpdatedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<string>(\"WabaId\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"WebhookCallbackUrl\")\n                        .HasMaxLength(1000)\n                        .HasColumnType(\"character varying(1000)\");\n\n                    b.Property<string>(\"WebhookSecret\")\n                        .HasMaxLength(200)\n                        .HasColumnType(\"character varying(200)\");\n\n                    b.Property<string>(\"WebhookVerifyToken\")\n                        .HasMaxLength(200)\n                        .HasColumnType(\"character varying(200)\");\n\n                    b.HasKey(\"Id\");\n\n                    b.HasAlternateKey(\"BusinessId\", \"Provider\")\n                        .HasName(\"AK_WhatsAppSettings_BusinessId_Provider\");\n\n                    b.HasIndex(\"Provider\", \"WabaId\")\n                        .HasDatabaseName(\"IX_WhatsAppSettings_Provider_WabaId\");\n\n                    b.HasIndex(\"Provider\", \"WebhookCallbackUrl\")\n                        .HasDatabaseName(\"IX_WhatsAppSettings_Provider_CallbackUrl\");\n\n                    b.HasIndex(\"BusinessId\", \"Provider\", \"IsActive\")\n                        .HasDatabaseName(\"IX_WhatsAppSettings_Business_Provider_IsActive\");\n\n                    b.ToTable(\"WhatsAppSettings\", (string)null);\n                });\n\n            modelBuilder.Entity(\"ContactTag\", b =>\n                {\n                    b.HasOne(\"xbytechat.api.CRM.Models.Contact\", \"Contact\")\n                        .WithMany(\"ContactTags\")\n                        .HasForeignKey(\"ContactId\")\n                        .OnDelete(DeleteBehavior.Cascade)\n                        .IsRequired();\n\n                    b.HasOne(\"xbytechat.api.CRM.Models.Tag\", \"Tag\")\n                        .WithMany(\"ContactTags\")\n                        .HasForeignKey(\"TagId\")\n                        .OnDelete(DeleteBehavior.Cascade)\n                        .IsRequired();\n\n                    b.Navigation(\"Contact\");\n\n                    b.Navigation(\"Tag\");\n                });\n\n            modelBuilder.Entity(\"MessageLog\", b =>\n                {\n                    b.HasOne(\"xbytechat.api.Features.BusinessModule.Models.Business\", \"Business\")\n                        .WithMany()\n                        .HasForeignKey(\"BusinessId\")\n                        .OnDelete(DeleteBehavior.Cascade)\n                        .IsRequired();\n\n                    b.HasOne(\"xbytechat.api.Features.CampaignModule.Models.Campaign\", \"SourceCampaign\")\n                        .WithMany(\"MessageLogs\")\n                        .HasForeignKey(\"CampaignId\")\n                        .OnDelete(DeleteBehavior.Cascade);\n\n                    b.HasOne(\"xbytechat.api.CRM.Models.Contact\", \"Contact\")\n                        .WithMany()\n                        .HasForeignKey(\"ContactId\");\n\n                    b.Navigation(\"Business\");\n\n                    b.Navigation(\"Contact\");\n\n                    b.Navigation(\"SourceCampaign\");\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.AuthModule.Models.User\", b =>\n                {\n                    b.HasOne(\"xbytechat.api.Features.BusinessModule.Models.Business\", \"Business\")\n                        .WithMany(\"Users\")\n                        .HasForeignKey(\"BusinessId\");\n\n                    b.HasOne(\"xbytechat.api.Features.AccessControl.Models.Role\", \"Role\")\n                        .WithMany(\"Users\")\n                        .HasForeignKey(\"RoleId\");\n\n                    b.Navigation(\"Business\");\n\n                    b.Navigation(\"Role\");\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.CRM.Models.Contact\", b =>\n                {\n                    b.HasOne(\"xbytechat.api.Features.BusinessModule.Models.Business\", \"Business\")\n                        .WithMany()\n                        .HasForeignKey(\"BusinessId\")\n                        .OnDelete(DeleteBehavior.Cascade)\n                        .IsRequired();\n\n                    b.Navigation(\"Business\");\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.AccessControl.Models.PlanPermission\", b =>\n                {\n                    b.HasOne(\"xbytechat.api.Features.AccessControl.Models.Permission\", \"Permission\")\n                        .WithMany(\"PlanPermissions\")\n                        .HasForeignKey(\"PermissionId\")\n                        .OnDelete(DeleteBehavior.Cascade)\n                        .IsRequired();\n\n                    b.HasOne(\"xbytechat.api.Features.AccessControl.Models.Plan\", \"Plan\")\n                        .WithMany(\"PlanPermissions\")\n                        .HasForeignKey(\"PlanId\")\n                        .OnDelete(DeleteBehavior.Cascade)\n                        .IsRequired();\n\n                    b.Navigation(\"Permission\");\n\n                    b.Navigation(\"Plan\");\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.AccessControl.Models.RolePermission\", b =>\n                {\n                    b.HasOne(\"xbytechat.api.Features.AccessControl.Models.Permission\", \"Permission\")\n                        .WithMany(\"RolePermissions\")\n                        .HasForeignKey(\"PermissionId\")\n                        .OnDelete(DeleteBehavior.Cascade)\n                        .IsRequired();\n\n                    b.HasOne(\"xbytechat.api.Features.AccessControl.Models.Role\", \"Role\")\n                        .WithMany(\"RolePermissions\")\n                        .HasForeignKey(\"RoleId\")\n                        .OnDelete(DeleteBehavior.Cascade)\n                        .IsRequired();\n\n                    b.Navigation(\"Permission\");\n\n                    b.Navigation(\"Role\");\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.AccessControl.Models.UserPermission\", b =>\n                {\n                    b.HasOne(\"xbytechat.api.Features.AccessControl.Models.Permission\", \"Permission\")\n                        .WithMany(\"UserPermissions\")\n                        .HasForeignKey(\"PermissionId\")\n                        .OnDelete(DeleteBehavior.Cascade)\n                        .IsRequired();\n\n                    b.HasOne(\"xbytechat.api.AuthModule.Models.User\", \"User\")\n                        .WithMany(\"UserPermissions\")\n                        .HasForeignKey(\"UserId\")\n                        .OnDelete(DeleteBehavior.Cascade)\n                        .IsRequired();\n\n                    b.Navigation(\"Permission\");\n\n                    b.Navigation(\"User\");\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.AutoReplyBuilder.Models.AutoReplyFlowEdge\", b =>\n                {\n                    b.HasOne(\"xbytechat.api.Features.AutoReplyBuilder.Flows.Models.AutoReplyFlow\", \"Flow\")\n                        .WithMany()\n                        .HasForeignKey(\"FlowId\")\n                        .OnDelete(DeleteBehavior.Cascade)\n                        .IsRequired();\n\n                    b.Navigation(\"Flow\");\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.AutoReplyBuilder.Models.AutoReplyFlowNode\", b =>\n                {\n                    b.HasOne(\"xbytechat.api.Features.AutoReplyBuilder.Flows.Models.AutoReplyFlow\", \"Flow\")\n                        .WithMany()\n                        .HasForeignKey(\"FlowId\")\n                        .OnDelete(DeleteBehavior.Cascade)\n                        .IsRequired();\n\n                    b.OwnsOne(\"xbytechat.api.Features.AutoReplyBuilder.Models.Position\", \"Position\", b1 =>\n                        {\n                            b1.Property<Guid>(\"AutoReplyFlowNodeId\")\n                                .HasColumnType(\"uuid\");\n\n                            b1.Property<double>(\"X\")\n                                .HasColumnType(\"double precision\");\n\n                            b1.Property<double>(\"Y\")\n                                .HasColumnType(\"double precision\");\n\n                            b1.HasKey(\"AutoReplyFlowNodeId\");\n\n                            b1.ToTable(\"AutoReplyFlowNode\");\n\n                            b1.WithOwner()\n                                .HasForeignKey(\"AutoReplyFlowNodeId\");\n                        });\n\n                    b.Navigation(\"Flow\");\n\n                    b.Navigation(\"Position\")\n                        .IsRequired();\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.BusinessModule.Models.Business\", b =>\n                {\n                    b.HasOne(\"xbytechat.api.Features.AccessControl.Models.Plan\", \"Plan\")\n                        .WithMany(\"Businesses\")\n                        .HasForeignKey(\"PlanId\");\n\n                    b.Navigation(\"Plan\");\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.CTAFlowBuilder.Models.CTAFlowStep\", b =>\n                {\n                    b.HasOne(\"xbytechat.api.Features.CTAFlowBuilder.Models.CTAFlowConfig\", \"Flow\")\n                        .WithMany(\"Steps\")\n                        .HasForeignKey(\"CTAFlowConfigId\")\n                        .OnDelete(DeleteBehavior.Cascade)\n                        .IsRequired();\n\n                    b.Navigation(\"Flow\");\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.CTAFlowBuilder.Models.FlowButtonLink\", b =>\n                {\n                    b.HasOne(\"xbytechat.api.Features.CTAFlowBuilder.Models.CTAFlowStep\", \"Step\")\n                        .WithMany(\"ButtonLinks\")\n                        .HasForeignKey(\"CTAFlowStepId\")\n                        .OnDelete(DeleteBehavior.Cascade)\n                        .IsRequired();\n\n                    b.Navigation(\"Step\");\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.CTAFlowBuilder.Models.FlowExecutionLog\", b =>\n                {\n                    b.HasOne(\"xbytechat.api.Features.CTAFlowBuilder.Models.CTAFlowConfig\", null)\n                        .WithMany()\n                        .HasForeignKey(\"FlowId\")\n                        .OnDelete(DeleteBehavior.Cascade);\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.CampaignModule.Models.Audience\", b =>\n                {\n                    b.HasOne(\"xbytechat.api.Features.CampaignModule.Models.Campaign\", \"Campaign\")\n                        .WithMany(\"Audiences\")\n                        .HasForeignKey(\"CampaignId\")\n                        .OnDelete(DeleteBehavior.Cascade);\n\n                    b.HasOne(\"xbytechat.api.Features.CampaignModule.Models.CsvBatch\", \"CsvBatch\")\n                        .WithMany()\n                        .HasForeignKey(\"CsvBatchId\")\n                        .OnDelete(DeleteBehavior.SetNull);\n\n                    b.Navigation(\"Campaign\");\n\n                    b.Navigation(\"CsvBatch\");\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.CampaignModule.Models.AudienceMember\", b =>\n                {\n                    b.HasOne(\"xbytechat.api.Features.CampaignModule.Models.Audience\", \"Audience\")\n                        .WithMany(\"Members\")\n                        .HasForeignKey(\"AudienceId\")\n                        .OnDelete(DeleteBehavior.Cascade)\n                        .IsRequired();\n\n                    b.Navigation(\"Audience\");\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.CampaignModule.Models.Campaign\", b =>\n                {\n                    b.HasOne(\"xbytechat.api.Features.BusinessModule.Models.Business\", \"Business\")\n                        .WithMany(\"Campaigns\")\n                        .HasForeignKey(\"BusinessId\")\n                        .OnDelete(DeleteBehavior.Cascade)\n                        .IsRequired();\n\n                    b.HasOne(\"xbytechat.api.Features.CTAFlowBuilder.Models.CTAFlowConfig\", \"CTAFlowConfig\")\n                        .WithMany()\n                        .HasForeignKey(\"CTAFlowConfigId\")\n                        .OnDelete(DeleteBehavior.Restrict);\n\n                    b.HasOne(\"xbytechat.api.Features.CTAManagement.Models.CTADefinition\", \"Cta\")\n                        .WithMany()\n                        .HasForeignKey(\"CtaId\");\n\n                    b.HasOne(\"xbytechat.api.Features.CampaignModule.Models.Campaign\", \"SourceCampaign\")\n                        .WithMany()\n                        .HasForeignKey(\"SourceCampaignId\");\n\n                    b.Navigation(\"Business\");\n\n                    b.Navigation(\"CTAFlowConfig\");\n\n                    b.Navigation(\"Cta\");\n\n                    b.Navigation(\"SourceCampaign\");\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.CampaignModule.Models.CampaignButton\", b =>\n                {\n                    b.HasOne(\"xbytechat.api.Features.CampaignModule.Models.Campaign\", \"Campaign\")\n                        .WithMany(\"MultiButtons\")\n                        .HasForeignKey(\"CampaignId\")\n                        .OnDelete(DeleteBehavior.Cascade)\n                        .IsRequired();\n\n                    b.Navigation(\"Campaign\");\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.CampaignModule.Models.CampaignFlowOverride\", b =>\n                {\n                    b.HasOne(\"xbytechat.api.Features.CampaignModule.Models.Campaign\", \"Campaign\")\n                        .WithMany()\n                        .HasForeignKey(\"CampaignId\")\n                        .OnDelete(DeleteBehavior.Cascade)\n                        .IsRequired();\n\n                    b.Navigation(\"Campaign\");\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.CampaignModule.Models.CampaignRecipient\", b =>\n                {\n                    b.HasOne(\"xbytechat.api.Features.CampaignModule.Models.AudienceMember\", \"AudienceMember\")\n                        .WithMany()\n                        .HasForeignKey(\"AudienceMemberId\")\n                        .OnDelete(DeleteBehavior.SetNull);\n\n                    b.HasOne(\"xbytechat.api.Features.BusinessModule.Models.Business\", \"Business\")\n                        .WithMany()\n                        .HasForeignKey(\"BusinessId\")\n                        .OnDelete(DeleteBehavior.Restrict)\n                        .IsRequired();\n\n                    b.HasOne(\"xbytechat.api.Features.CampaignModule.Models.Campaign\", \"Campaign\")\n                        .WithMany(\"Recipients\")\n                        .HasForeignKey(\"CampaignId\")\n                        .OnDelete(DeleteBehavior.Cascade)\n                        .IsRequired();\n\n                    b.HasOne(\"xbytechat.api.CRM.Models.Contact\", \"Contact\")\n                        .WithMany()\n                        .HasForeignKey(\"ContactId\")\n                        .OnDelete(DeleteBehavior.SetNull);\n\n                    b.Navigation(\"AudienceMember\");\n\n                    b.Navigation(\"Business\");\n\n                    b.Navigation(\"Campaign\");\n\n                    b.Navigation(\"Contact\");\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.CampaignModule.Models.CampaignVariableMap\", b =>\n                {\n                    b.HasOne(\"xbytechat.api.Features.CampaignModule.Models.Campaign\", \"Campaign\")\n                        .WithMany(\"VariableMaps\")\n                        .HasForeignKey(\"CampaignId\")\n                        .OnDelete(DeleteBehavior.Cascade)\n                        .IsRequired();\n\n                    b.Navigation(\"Campaign\");\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.CampaignModule.Models.CsvBatch\", b =>\n                {\n                    b.HasOne(\"xbytechat.api.Features.CampaignModule.Models.Audience\", null)\n                        .WithMany()\n                        .HasForeignKey(\"AudienceId\")\n                        .OnDelete(DeleteBehavior.SetNull);\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.CampaignModule.Models.CsvRow\", b =>\n                {\n                    b.HasOne(\"xbytechat.api.Features.CampaignModule.Models.CsvBatch\", \"Batch\")\n                        .WithMany()\n                        .HasForeignKey(\"BatchId\")\n                        .OnDelete(DeleteBehavior.Cascade)\n                        .IsRequired();\n\n                    b.Navigation(\"Batch\");\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.CampaignTracking.Models.CampaignSendLog\", b =>\n                {\n                    b.HasOne(\"xbytechat.api.Features.CampaignModule.Models.Campaign\", \"Campaign\")\n                        .WithMany(\"SendLogs\")\n                        .HasForeignKey(\"CampaignId\")\n                        .OnDelete(DeleteBehavior.Cascade)\n                        .IsRequired();\n\n                    b.HasOne(\"xbytechat.api.CRM.Models.Contact\", \"Contact\")\n                        .WithMany()\n                        .HasForeignKey(\"ContactId\")\n                        .OnDelete(DeleteBehavior.SetNull);\n\n                    b.HasOne(\"MessageLog\", \"MessageLog\")\n                        .WithMany()\n                        .HasForeignKey(\"MessageLogId\")\n                        .OnDelete(DeleteBehavior.Restrict);\n\n                    b.HasOne(\"xbytechat.api.Features.CampaignModule.Models.CampaignRecipient\", \"Recipient\")\n                        .WithMany(\"SendLogs\")\n                        .HasForeignKey(\"RecipientId\")\n                        .OnDelete(DeleteBehavior.Cascade)\n                        .IsRequired();\n\n                    b.HasOne(\"xbytechat.api.AuthModule.Models.User\", null)\n                        .WithMany(\"SendLogs\")\n                        .HasForeignKey(\"UserId\");\n\n                    b.Navigation(\"Campaign\");\n\n                    b.Navigation(\"Contact\");\n\n                    b.Navigation(\"MessageLog\");\n\n                    b.Navigation(\"Recipient\");\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.MessageManagement.DTOs.MessageStatusLog\", b =>\n                {\n                    b.HasOne(\"xbytechat.api.Features.BusinessModule.Models.Business\", \"Business\")\n                        .WithMany(\"MessageStatusLogs\")\n                        .HasForeignKey(\"BusinessId\");\n\n                    b.HasOne(\"xbytechat.api.Features.CampaignModule.Models.Campaign\", \"Campaign\")\n                        .WithMany(\"MessageStatusLogs\")\n                        .HasForeignKey(\"CampaignId\")\n                        .OnDelete(DeleteBehavior.Cascade);\n\n                    b.HasOne(\"xbytechat.api.AuthModule.Models.User\", \"User\")\n                        .WithMany(\"MessageStatusLogs\")\n                        .HasForeignKey(\"UserId\");\n\n                    b.Navigation(\"Business\");\n\n                    b.Navigation(\"Campaign\");\n\n                    b.Navigation(\"User\");\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.Payment.Models.Coupon\", b =>\n                {\n                    b.HasOne(\"xbytechat.api.Features.AccessControl.Models.Plan\", null)\n                        .WithMany()\n                        .HasForeignKey(\"PlanId\")\n                        .OnDelete(DeleteBehavior.SetNull);\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.Payment.Models.Invoice\", b =>\n                {\n                    b.HasOne(\"xbytechat.api.Features.BusinessModule.Models.Business\", \"Business\")\n                        .WithMany()\n                        .HasForeignKey(\"BusinessId\")\n                        .OnDelete(DeleteBehavior.Cascade)\n                        .IsRequired();\n\n                    b.HasOne(\"xbytechat.api.Features.AccessControl.Models.Plan\", \"Plan\")\n                        .WithMany()\n                        .HasForeignKey(\"PlanId\")\n                        .OnDelete(DeleteBehavior.SetNull);\n\n                    b.HasOne(\"xbytechat.api.Features.Payment.Models.Subscription\", \"Subscription\")\n                        .WithMany(\"Invoices\")\n                        .HasForeignKey(\"SubscriptionId\")\n                        .OnDelete(DeleteBehavior.SetNull);\n\n                    b.Navigation(\"Business\");\n\n                    b.Navigation(\"Plan\");\n\n                    b.Navigation(\"Subscription\");\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.Payment.Models.InvoiceLineItem\", b =>\n                {\n                    b.HasOne(\"xbytechat.api.Features.Payment.Models.Invoice\", \"Invoice\")\n                        .WithMany(\"LineItems\")\n                        .HasForeignKey(\"InvoiceId\")\n                        .OnDelete(DeleteBehavior.Cascade)\n                        .IsRequired();\n\n                    b.Navigation(\"Invoice\");\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.Payment.Models.PaymentTransaction\", b =>\n                {\n                    b.HasOne(\"xbytechat.api.Features.BusinessModule.Models.Business\", \"Business\")\n                        .WithMany()\n                        .HasForeignKey(\"BusinessId\")\n                        .OnDelete(DeleteBehavior.Cascade)\n                        .IsRequired();\n\n                    b.HasOne(\"xbytechat.api.Features.Payment.Models.Invoice\", \"Invoice\")\n                        .WithMany(\"Payments\")\n                        .HasForeignKey(\"InvoiceId\")\n                        .OnDelete(DeleteBehavior.SetNull);\n\n                    b.HasOne(\"xbytechat.api.Features.Payment.Models.Subscription\", \"Subscription\")\n                        .WithMany(\"Payments\")\n                        .HasForeignKey(\"SubscriptionId\")\n                        .OnDelete(DeleteBehavior.SetNull);\n\n                    b.Navigation(\"Business\");\n\n                    b.Navigation(\"Invoice\");\n\n                    b.Navigation(\"Subscription\");\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.Payment.Models.Subscription\", b =>\n                {\n                    b.HasOne(\"xbytechat.api.Features.BusinessModule.Models.Business\", \"Business\")\n                        .WithMany()\n                        .HasForeignKey(\"BusinessId\")\n                        .OnDelete(DeleteBehavior.Cascade)\n                        .IsRequired();\n\n                    b.HasOne(\"xbytechat.api.Features.AccessControl.Models.Plan\", \"Plan\")\n                        .WithMany()\n                        .HasForeignKey(\"PlanId\")\n                        .OnDelete(DeleteBehavior.Restrict)\n                        .IsRequired();\n\n                    b.Navigation(\"Business\");\n\n                    b.Navigation(\"Plan\");\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.Tracking.Models.TrackingLog\", b =>\n                {\n                    b.HasOne(\"xbytechat.api.Features.CampaignModule.Models.Campaign\", \"Campaign\")\n                        .WithMany()\n                        .HasForeignKey(\"CampaignId\")\n                        .OnDelete(DeleteBehavior.Restrict);\n\n                    b.HasOne(\"xbytechat.api.Features.CampaignTracking.Models.CampaignSendLog\", \"CampaignSendLog\")\n                        .WithMany()\n                        .HasForeignKey(\"CampaignSendLogId\")\n                        .OnDelete(DeleteBehavior.Restrict);\n\n                    b.HasOne(\"xbytechat.api.CRM.Models.Contact\", \"Contact\")\n                        .WithMany()\n                        .HasForeignKey(\"ContactId\");\n\n                    b.HasOne(\"MessageLog\", \"MessageLog\")\n                        .WithMany()\n                        .HasForeignKey(\"MessageLogId\")\n                        .OnDelete(DeleteBehavior.Restrict);\n\n                    b.Navigation(\"Campaign\");\n\n                    b.Navigation(\"CampaignSendLog\");\n\n                    b.Navigation(\"Contact\");\n\n                    b.Navigation(\"MessageLog\");\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.WhatsAppSettings.Models.WhatsAppPhoneNumber\", b =>\n                {\n                    b.HasOne(\"xbytechat_api.WhatsAppSettings.Models.WhatsAppSettingEntity\", null)\n                        .WithMany(\"WhatsAppBusinessNumbers\")\n                        .HasForeignKey(\"BusinessId\", \"Provider\")\n                        .HasPrincipalKey(\"BusinessId\", \"Provider\")\n                        .OnDelete(DeleteBehavior.Cascade)\n                        .IsRequired();\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.xbTimelines.Models.LeadTimeline\", b =>\n                {\n                    b.HasOne(\"xbytechat.api.Features.BusinessModule.Models.Business\", \"Business\")\n                        .WithMany()\n                        .HasForeignKey(\"BusinessId\")\n                        .OnDelete(DeleteBehavior.Cascade)\n                        .IsRequired();\n\n                    b.HasOne(\"xbytechat.api.CRM.Models.Contact\", \"Contact\")\n                        .WithMany()\n                        .HasForeignKey(\"ContactId\")\n                        .OnDelete(DeleteBehavior.Cascade)\n                        .IsRequired();\n\n                    b.Navigation(\"Business\");\n\n                    b.Navigation(\"Contact\");\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Models.BusinessModel.BusinessPlanInfo\", b =>\n                {\n                    b.HasOne(\"xbytechat.api.Features.BusinessModule.Models.Business\", \"Business\")\n                        .WithOne(\"BusinessPlanInfo\")\n                        .HasForeignKey(\"xbytechat.api.Models.BusinessModel.BusinessPlanInfo\", \"BusinessId\")\n                        .OnDelete(DeleteBehavior.Cascade)\n                        .IsRequired();\n\n                    b.Navigation(\"Business\");\n                });\n\n            modelBuilder.Entity(\"xbytechat_api.WhatsAppSettings.Models.WhatsAppSettingEntity\", b =>\n                {\n                    b.HasOne(\"xbytechat.api.Features.BusinessModule.Models.Business\", null)\n                        .WithMany(\"WhatsAppSettings\")\n                        .HasForeignKey(\"BusinessId\")\n                        .OnDelete(DeleteBehavior.Cascade)\n                        .IsRequired();\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.AuthModule.Models.User\", b =>\n                {\n                    b.Navigation(\"MessageStatusLogs\");\n\n                    b.Navigation(\"SendLogs\");\n\n                    b.Navigation(\"UserPermissions\");\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.CRM.Models.Contact\", b =>\n                {\n                    b.Navigation(\"ContactTags\");\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.CRM.Models.Tag\", b =>\n                {\n                    b.Navigation(\"ContactTags\");\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.AccessControl.Models.Permission\", b =>\n                {\n                    b.Navigation(\"PlanPermissions\");\n\n                    b.Navigation(\"RolePermissions\");\n\n                    b.Navigation(\"UserPermissions\");\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.AccessControl.Models.Plan\", b =>\n                {\n                    b.Navigation(\"Businesses\");\n\n                    b.Navigation(\"PlanPermissions\");\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.AccessControl.Models.Role\", b =>\n                {\n                    b.Navigation(\"RolePermissions\");\n\n                    b.Navigation(\"Users\");\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.BusinessModule.Models.Business\", b =>\n                {\n                    b.Navigation(\"BusinessPlanInfo\");\n\n                    b.Navigation(\"Campaigns\");\n\n                    b.Navigation(\"MessageStatusLogs\");\n\n                    b.Navigation(\"Users\");\n\n                    b.Navigation(\"WhatsAppSettings\");\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.CTAFlowBuilder.Models.CTAFlowConfig\", b =>\n                {\n                    b.Navigation(\"Steps\");\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.CTAFlowBuilder.Models.CTAFlowStep\", b =>\n                {\n                    b.Navigation(\"ButtonLinks\");\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.CampaignModule.Models.Audience\", b =>\n                {\n                    b.Navigation(\"Members\");\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.CampaignModule.Models.Campaign\", b =>\n                {\n                    b.Navigation(\"Audiences\");\n\n                    b.Navigation(\"MessageLogs\");\n\n                    b.Navigation(\"MessageStatusLogs\");\n\n                    b.Navigation(\"MultiButtons\");\n\n                    b.Navigation(\"Recipients\");\n\n                    b.Navigation(\"SendLogs\");\n\n                    b.Navigation(\"VariableMaps\");\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.CampaignModule.Models.CampaignRecipient\", b =>\n                {\n                    b.Navigation(\"SendLogs\");\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.Payment.Models.Invoice\", b =>\n                {\n                    b.Navigation(\"LineItems\");\n\n                    b.Navigation(\"Payments\");\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.Payment.Models.Subscription\", b =>\n                {\n                    b.Navigation(\"Invoices\");\n\n                    b.Navigation(\"Payments\");\n                });\n\n            modelBuilder.Entity(\"xbytechat_api.WhatsAppSettings.Models.WhatsAppSettingEntity\", b =>\n                {\n                    b.Navigation(\"WhatsAppBusinessNumbers\");\n                });\n#pragma warning restore 612, 618\n        }\n    }\n}\n"
    },
    {
      "path": "xbytechat-api/Migrations/AppDbContextModelSnapshot.cs",
      "sha256": "7a5f02cf6b6f7eb0de08060a6f24967890d1a32ad6c56aaeef98040ff3256dbe",
      "language": "csharp",
      "size": 188809,
      "content": "// <auto-generated />\nusing System;\nusing Microsoft.EntityFrameworkCore;\nusing Microsoft.EntityFrameworkCore.Infrastructure;\nusing Microsoft.EntityFrameworkCore.Storage.ValueConversion;\nusing Npgsql.EntityFrameworkCore.PostgreSQL.Metadata;\nusing xbytechat.api;\n\n#nullable disable\n\nnamespace xbytechat.api.Migrations\n{\n    [DbContext(typeof(AppDbContext))]\n    partial class AppDbContextModelSnapshot : ModelSnapshot\n    {\n        protected override void BuildModel(ModelBuilder modelBuilder)\n        {\n#pragma warning disable 612, 618\n            modelBuilder\n                .HasAnnotation(\"ProductVersion\", \"8.0.18\")\n                .HasAnnotation(\"Relational:MaxIdentifierLength\", 63);\n\n            NpgsqlModelBuilderExtensions.UseIdentityByDefaultColumns(modelBuilder);\n\n            modelBuilder.Entity(\"ContactTag\", b =>\n                {\n                    b.Property<Guid>(\"Id\")\n                        .ValueGeneratedOnAdd()\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<DateTime>(\"AssignedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<string>(\"AssignedBy\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<Guid>(\"BusinessId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<Guid>(\"ContactId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<Guid>(\"TagId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.HasKey(\"Id\");\n\n                    b.HasIndex(\"ContactId\");\n\n                    b.HasIndex(\"TagId\");\n\n                    b.ToTable(\"ContactTags\");\n                });\n\n            modelBuilder.Entity(\"MessageLog\", b =>\n                {\n                    b.Property<Guid>(\"Id\")\n                        .ValueGeneratedOnAdd()\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<Guid>(\"BusinessId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<string>(\"ButtonBundleJson\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<Guid?>(\"CTAFlowConfigId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<Guid?>(\"CTAFlowStepId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<Guid?>(\"CampaignId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<Guid?>(\"ContactId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<string>(\"ConversationCategory\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"ConversationId\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<DateTimeOffset?>(\"ConversationStartedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<DateTime>(\"CreatedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<string>(\"ErrorMessage\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<int?>(\"FlowVersion\")\n                        .HasColumnType(\"integer\");\n\n                    b.Property<bool?>(\"IsChargeable\")\n                        .HasColumnType(\"boolean\");\n\n                    b.Property<bool>(\"IsIncoming\")\n                        .HasColumnType(\"boolean\");\n\n                    b.Property<string>(\"MediaUrl\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"MessageContent\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"MessageId\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<DateTime?>(\"MessageTime\")\n                        .ValueGeneratedOnAddOrUpdate()\n                        .HasColumnType(\"timestamp with time zone\")\n                        .HasComputedColumnSql(\"COALESCE(\\\"SentAt\\\", \\\"CreatedAt\\\")\", true);\n\n                    b.Property<decimal?>(\"PriceAmount\")\n                        .HasColumnType(\"numeric\");\n\n                    b.Property<string>(\"PriceCurrency\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"Provider\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"ProviderMessageId\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"RawResponse\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"RecipientNumber\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<Guid?>(\"RefMessageId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<string>(\"RenderedBody\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<Guid?>(\"RunId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<DateTime?>(\"SentAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<string>(\"Source\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"Status\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.HasKey(\"Id\");\n\n                    b.HasIndex(\"CampaignId\")\n                        .HasDatabaseName(\"IX_MessageLogs_Campaign\");\n\n                    b.HasIndex(\"ContactId\");\n\n                    b.HasIndex(\"MessageId\");\n\n                    b.HasIndex(\"ProviderMessageId\")\n                        .HasDatabaseName(\"IX_MessageLogs_ProviderMessageId\")\n                        .HasFilter(\"\\\"ProviderMessageId\\\" IS NOT NULL\");\n\n                    b.HasIndex(\"RunId\");\n\n                    b.HasIndex(\"BusinessId\", \"ConversationId\")\n                        .HasDatabaseName(\"IX_MessageLogs_BizConversation\")\n                        .HasFilter(\"\\\"ConversationId\\\" IS NOT NULL\");\n\n                    b.HasIndex(\"BusinessId\", \"CreatedAt\")\n                        .HasDatabaseName(\"IX_MessageLogs_BizCreatedAt\");\n\n                    b.HasIndex(\"BusinessId\", \"MessageId\")\n                        .HasDatabaseName(\"IX_MessageLogs_Business_MessageId\");\n\n                    b.HasIndex(\"BusinessId\", \"ProviderMessageId\")\n                        .HasDatabaseName(\"IX_MessageLogs_BizProviderMessage\")\n                        .HasFilter(\"\\\"ProviderMessageId\\\" IS NOT NULL\");\n\n                    b.HasIndex(\"BusinessId\", \"RecipientNumber\")\n                        .HasDatabaseName(\"IX_MessageLogs_Business_Recipient\");\n\n                    b.HasIndex(\"BusinessId\", \"IsIncoming\", \"ContactId\", \"MessageTime\")\n                        .HasDatabaseName(\"ix_msglogs_biz_in_contact_msgtime\");\n\n                    b.ToTable(\"MessageLogs\");\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.AuthModule.Models.User\", b =>\n                {\n                    b.Property<Guid>(\"Id\")\n                        .ValueGeneratedOnAdd()\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<Guid?>(\"BusinessId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<DateTime>(\"CreatedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<DateTime?>(\"DeletedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<string>(\"Email\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<bool>(\"IsDeleted\")\n                        .HasColumnType(\"boolean\");\n\n                    b.Property<string>(\"Name\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"PasswordHash\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"RefreshToken\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<DateTime?>(\"RefreshTokenExpiry\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<Guid?>(\"RoleId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<string>(\"Status\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.HasKey(\"Id\");\n\n                    b.HasIndex(\"BusinessId\");\n\n                    b.HasIndex(\"RoleId\");\n\n                    b.ToTable(\"Users\");\n\n                    b.HasData(\n                        new\n                        {\n                            Id = new Guid(\"62858aa2-3a54-4fd5-8696-c343d9af7634\"),\n                            CreatedAt = new DateTime(2025, 1, 1, 0, 0, 0, 0, DateTimeKind.Utc),\n                            Email = \"admin@xbytechat.com\",\n                            IsDeleted = false,\n                            Name = \"Super Admin\",\n                            PasswordHash = \"JAvlGPq9JyTdtvBO6x2llnRI1+gxwIyPqCKAn3THIKk=\",\n                            RoleId = new Guid(\"00000000-0000-0000-0000-000000000001\"),\n                            Status = \"active\"\n                        });\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.AuthModule.Models.WhatsAppTemplate\", b =>\n                {\n                    b.Property<Guid>(\"Id\")\n                        .ValueGeneratedOnAdd()\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<string>(\"Body\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"BodyPreview\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<int>(\"BodyVarCount\")\n                        .HasColumnType(\"integer\");\n\n                    b.Property<Guid>(\"BusinessId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<string>(\"Category\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<DateTime>(\"CreatedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<bool>(\"HasPhoneButton\")\n                        .HasColumnType(\"boolean\");\n\n                    b.Property<string>(\"HeaderKind\")\n                        .IsRequired()\n                        .HasMaxLength(16)\n                        .HasColumnType(\"character varying(16)\");\n\n                    b.Property<string>(\"HeaderText\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<int>(\"HeaderTextVarCount\")\n                        .HasColumnType(\"integer\");\n\n                    b.Property<bool>(\"IsActive\")\n                        .HasColumnType(\"boolean\");\n\n                    b.Property<string>(\"LanguageCode\")\n                        .IsRequired()\n                        .HasMaxLength(16)\n                        .HasColumnType(\"character varying(16)\");\n\n                    b.Property<DateTime>(\"LastSyncedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<string>(\"Name\")\n                        .IsRequired()\n                        .HasMaxLength(160)\n                        .HasColumnType(\"character varying(160)\");\n\n                    b.Property<string>(\"NamedParamKeys\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"ParameterFormat\")\n                        .IsRequired()\n                        .HasMaxLength(24)\n                        .HasColumnType(\"character varying(24)\");\n\n                    b.Property<string>(\"PlaceholderMap\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"Provider\")\n                        .IsRequired()\n                        .HasMaxLength(40)\n                        .HasColumnType(\"character varying(40)\");\n\n                    b.Property<int>(\"QuickReplyCount\")\n                        .HasColumnType(\"integer\");\n\n                    b.Property<string>(\"RawJson\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<bool>(\"RequiresMediaHeader\")\n                        .HasColumnType(\"boolean\");\n\n                    b.Property<byte[]>(\"RowVersion\")\n                        .HasColumnType(\"bytea\");\n\n                    b.Property<string>(\"Status\")\n                        .IsRequired()\n                        .HasMaxLength(24)\n                        .HasColumnType(\"character varying(24)\");\n\n                    b.Property<string>(\"SubCategory\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"TemplateId\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<int>(\"TotalTextParamCount\")\n                        .HasColumnType(\"integer\");\n\n                    b.Property<DateTime>(\"UpdatedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<string>(\"UrlButtons\")\n                        .HasColumnType(\"text\");\n\n                    b.HasKey(\"Id\");\n\n                    b.HasIndex(\"LastSyncedAt\")\n                        .HasDatabaseName(\"IX_WAT_LastSyncedAt\");\n\n                    b.HasIndex(\"UpdatedAt\")\n                        .HasDatabaseName(\"IX_WAT_UpdatedAt\");\n\n                    b.HasIndex(\"BusinessId\", \"IsActive\")\n                        .HasDatabaseName(\"IX_WAT_Business_IsActive\");\n\n                    b.HasIndex(\"BusinessId\", \"LastSyncedAt\")\n                        .IsDescending(false, true)\n                        .HasDatabaseName(\"IX_WAT_Business_LastSyncedAt\");\n\n                    b.HasIndex(\"BusinessId\", \"Provider\", \"TemplateId\")\n                        .IsUnique()\n                        .HasDatabaseName(\"IX_WAT_Business_Provider_TemplateId\")\n                        .HasFilter(\"\\\"TemplateId\\\" IS NOT NULL\");\n\n                    b.HasIndex(\"BusinessId\", \"Provider\", \"Name\", \"LanguageCode\")\n                        .IsUnique()\n                        .HasDatabaseName(\"IX_WAT_Business_Provider_Name_Lang\");\n\n                    b.HasIndex(\"BusinessId\", \"Provider\", \"Status\", \"LanguageCode\")\n                        .HasDatabaseName(\"IX_WAT_Business_Provider_Status_Lang_Active\")\n                        .HasFilter(\"\\\"IsActive\\\" = TRUE\");\n\n                    b.HasIndex(\"BusinessId\", \"Provider\", \"IsActive\", \"UpdatedAt\", \"LastSyncedAt\")\n                        .IsDescending(false, false, false, true, true)\n                        .HasDatabaseName(\"IX_WAT_Business_Provider_IsActive_Sort\");\n\n                    b.ToTable(\"WhatsAppTemplates\", (string)null);\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.CRM.Models.Contact\", b =>\n                {\n                    b.Property<Guid>(\"Id\")\n                        .ValueGeneratedOnAdd()\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<Guid?>(\"AssignedAgentId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<Guid>(\"BusinessId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<DateTime>(\"CreatedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<string>(\"Email\")\n                        .HasMaxLength(100)\n                        .HasColumnType(\"character varying(100)\");\n\n                    b.Property<string>(\"Group\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<bool>(\"IsActive\")\n                        .HasColumnType(\"boolean\");\n\n                    b.Property<bool>(\"IsArchived\")\n                        .HasColumnType(\"boolean\");\n\n                    b.Property<bool>(\"IsAutomationPaused\")\n                        .HasColumnType(\"boolean\");\n\n                    b.Property<bool>(\"IsFavorite\")\n                        .HasColumnType(\"boolean\");\n\n                    b.Property<DateTime?>(\"LastCTAInteraction\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<string>(\"LastCTAType\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<Guid?>(\"LastClickedProductId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<DateTime?>(\"LastContactedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<string>(\"LeadSource\")\n                        .HasMaxLength(50)\n                        .HasColumnType(\"character varying(50)\");\n\n                    b.Property<string>(\"Name\")\n                        .IsRequired()\n                        .HasMaxLength(100)\n                        .HasColumnType(\"character varying(100)\");\n\n                    b.Property<DateTime?>(\"NextFollowUpAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<string>(\"Notes\")\n                        .HasMaxLength(500)\n                        .HasColumnType(\"character varying(500)\");\n\n                    b.Property<string>(\"PhoneNumber\")\n                        .IsRequired()\n                        .HasMaxLength(20)\n                        .HasColumnType(\"character varying(20)\");\n\n                    b.Property<string>(\"ProfileName\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<DateTime?>(\"ProfileNameUpdatedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<string>(\"Tags\")\n                        .HasMaxLength(200)\n                        .HasColumnType(\"character varying(200)\");\n\n                    b.HasKey(\"Id\");\n\n                    b.HasIndex(\"BusinessId\", \"PhoneNumber\")\n                        .IsUnique();\n\n                    b.ToTable(\"Contacts\");\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.CRM.Models.Note\", b =>\n                {\n                    b.Property<Guid>(\"Id\")\n                        .ValueGeneratedOnAdd()\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<Guid?>(\"BusinessId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<Guid?>(\"ContactId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<string>(\"Content\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<DateTime>(\"CreatedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<string>(\"CreatedBy\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<DateTime?>(\"EditedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<bool>(\"IsInternal\")\n                        .HasColumnType(\"boolean\");\n\n                    b.Property<bool>(\"IsPinned\")\n                        .HasColumnType(\"boolean\");\n\n                    b.Property<string>(\"Source\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"Title\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.HasKey(\"Id\");\n\n                    b.ToTable(\"Notes\");\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.CRM.Models.Reminder\", b =>\n                {\n                    b.Property<Guid>(\"Id\")\n                        .ValueGeneratedOnAdd()\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<Guid>(\"BusinessId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<DateTime?>(\"CompletedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<Guid>(\"ContactId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<DateTime>(\"CreatedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<string>(\"Description\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<DateTime>(\"DueAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<bool>(\"FollowUpSent\")\n                        .HasColumnType(\"boolean\");\n\n                    b.Property<bool>(\"IsActive\")\n                        .HasColumnType(\"boolean\");\n\n                    b.Property<bool>(\"IsRecurring\")\n                        .HasColumnType(\"boolean\");\n\n                    b.Property<string>(\"LastCTAType\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<DateTime?>(\"LastClickedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<string>(\"LinkedCampaign\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<int?>(\"Priority\")\n                        .HasColumnType(\"integer\");\n\n                    b.Property<string>(\"RecurrencePattern\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"ReminderType\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<bool>(\"SendWhatsappNotification\")\n                        .HasColumnType(\"boolean\");\n\n                    b.Property<string>(\"Status\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"Title\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<DateTime?>(\"UpdatedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.HasKey(\"Id\");\n\n                    b.ToTable(\"Reminders\");\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.CRM.Models.Tag\", b =>\n                {\n                    b.Property<Guid>(\"Id\")\n                        .ValueGeneratedOnAdd()\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<Guid>(\"BusinessId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<string>(\"Category\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"ColorHex\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<DateTime>(\"CreatedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<bool>(\"IsActive\")\n                        .HasColumnType(\"boolean\");\n\n                    b.Property<bool>(\"IsSystemTag\")\n                        .HasColumnType(\"boolean\");\n\n                    b.Property<DateTime?>(\"LastUsedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<string>(\"Name\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"Notes\")\n                        .HasColumnType(\"text\");\n\n                    b.HasKey(\"Id\");\n\n                    b.ToTable(\"Tags\");\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.AccessControl.Models.Permission\", b =>\n                {\n                    b.Property<Guid>(\"Id\")\n                        .ValueGeneratedOnAdd()\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<string>(\"Code\")\n                        .IsRequired()\n                        .HasMaxLength(120)\n                        .HasColumnType(\"character varying(120)\");\n\n                    b.Property<DateTime>(\"CreatedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<string>(\"Description\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"Group\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<bool>(\"IsActive\")\n                        .HasColumnType(\"boolean\");\n\n                    b.Property<string>(\"Name\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.HasKey(\"Id\");\n\n                    b.HasIndex(\"Code\")\n                        .IsUnique();\n\n                    b.ToTable(\"Permissions\");\n\n                    b.HasData(\n                        new\n                        {\n                            Id = new Guid(\"30000000-0000-0000-0000-000000000000\"),\n                            Code = \"DASHBOARD.VIEW\",\n                            CreatedAt = new DateTime(2025, 9, 13, 0, 0, 0, 0, DateTimeKind.Utc),\n                            Group = \"Dashboard\",\n                            IsActive = true,\n                            Name = \"dashboard.view\"\n                        },\n                        new\n                        {\n                            Id = new Guid(\"30000000-0000-0000-0000-000000000001\"),\n                            Code = \"CAMPAIGN.VIEW\",\n                            CreatedAt = new DateTime(2025, 9, 13, 0, 0, 0, 0, DateTimeKind.Utc),\n                            Group = \"Campaign\",\n                            IsActive = true,\n                            Name = \"campaign.view\"\n                        },\n                        new\n                        {\n                            Id = new Guid(\"30000000-0000-0000-0000-000000000002\"),\n                            Code = \"CAMPAIGN.CREATE\",\n                            CreatedAt = new DateTime(2025, 9, 13, 0, 0, 0, 0, DateTimeKind.Utc),\n                            Group = \"Campaign\",\n                            IsActive = true,\n                            Name = \"campaign.create\"\n                        },\n                        new\n                        {\n                            Id = new Guid(\"30000000-0000-0000-0000-000000000003\"),\n                            Code = \"CAMPAIGN.DELETE\",\n                            CreatedAt = new DateTime(2025, 9, 13, 0, 0, 0, 0, DateTimeKind.Utc),\n                            Group = \"Campaign\",\n                            IsActive = true,\n                            Name = \"campaign.delete\"\n                        },\n                        new\n                        {\n                            Id = new Guid(\"30000000-0000-0000-0000-000000000004\"),\n                            Code = \"PRODUCT.VIEW\",\n                            CreatedAt = new DateTime(2025, 9, 13, 0, 0, 0, 0, DateTimeKind.Utc),\n                            Group = \"Catalog\",\n                            IsActive = true,\n                            Name = \"product.view\"\n                        },\n                        new\n                        {\n                            Id = new Guid(\"30000000-0000-0000-0000-000000000005\"),\n                            Code = \"PRODUCT.CREATE\",\n                            CreatedAt = new DateTime(2025, 9, 13, 0, 0, 0, 0, DateTimeKind.Utc),\n                            Group = \"Catalog\",\n                            IsActive = true,\n                            Name = \"product.create\"\n                        },\n                        new\n                        {\n                            Id = new Guid(\"30000000-0000-0000-0000-000000000006\"),\n                            Code = \"PRODUCT.DELETE\",\n                            CreatedAt = new DateTime(2025, 9, 13, 0, 0, 0, 0, DateTimeKind.Utc),\n                            Group = \"Catalog\",\n                            IsActive = true,\n                            Name = \"product.delete\"\n                        },\n                        new\n                        {\n                            Id = new Guid(\"30000000-0000-0000-0000-000000000007\"),\n                            Code = \"CONTACTS.VIEW\",\n                            CreatedAt = new DateTime(2025, 9, 13, 0, 0, 0, 0, DateTimeKind.Utc),\n                            Group = \"CRM\",\n                            IsActive = true,\n                            Name = \"contacts.view\"\n                        },\n                        new\n                        {\n                            Id = new Guid(\"30000000-0000-0000-0000-000000000008\"),\n                            Code = \"TAGS.EDIT\",\n                            CreatedAt = new DateTime(2025, 9, 13, 0, 0, 0, 0, DateTimeKind.Utc),\n                            IsActive = true,\n                            Name = \"tags.edit\"\n                        },\n                        new\n                        {\n                            Id = new Guid(\"30000000-0000-0000-0000-000000000009\"),\n                            Code = \"ADMIN.BUSINESS.APPROVE\",\n                            CreatedAt = new DateTime(2025, 9, 13, 0, 0, 0, 0, DateTimeKind.Utc),\n                            Group = \"Admin\",\n                            IsActive = true,\n                            Name = \"admin.business.approve\"\n                        },\n                        new\n                        {\n                            Id = new Guid(\"30000000-0000-0000-0000-000000000010\"),\n                            Code = \"ADMIN.LOGS.VIEW\",\n                            CreatedAt = new DateTime(2025, 9, 13, 0, 0, 0, 0, DateTimeKind.Utc),\n                            IsActive = true,\n                            Name = \"admin.logs.view\"\n                        },\n                        new\n                        {\n                            Id = new Guid(\"30000000-0000-0000-0000-000000000011\"),\n                            Code = \"ADMIN.PLANS.VIEW\",\n                            CreatedAt = new DateTime(2025, 9, 13, 0, 0, 0, 0, DateTimeKind.Utc),\n                            Group = \"Admin\",\n                            IsActive = true,\n                            Name = \"admin.plans.view\"\n                        },\n                        new\n                        {\n                            Id = new Guid(\"30000000-0000-0000-0000-000000000012\"),\n                            Code = \"ADMIN.PLANS.CREATE\",\n                            CreatedAt = new DateTime(2025, 9, 13, 0, 0, 0, 0, DateTimeKind.Utc),\n                            Group = \"Admin\",\n                            IsActive = true,\n                            Name = \"admin.plans.create\"\n                        },\n                        new\n                        {\n                            Id = new Guid(\"30000000-0000-0000-0000-000000000013\"),\n                            Code = \"ADMIN.PLANS.UPDATE\",\n                            CreatedAt = new DateTime(2025, 9, 13, 0, 0, 0, 0, DateTimeKind.Utc),\n                            Group = \"Admin\",\n                            IsActive = true,\n                            Name = \"admin.plans.update\"\n                        },\n                        new\n                        {\n                            Id = new Guid(\"30000000-0000-0000-0000-000000000014\"),\n                            Code = \"ADMIN.PLANS.DELETE\",\n                            CreatedAt = new DateTime(2025, 9, 13, 0, 0, 0, 0, DateTimeKind.Utc),\n                            Group = \"Admin\",\n                            IsActive = true,\n                            Name = \"admin.plans.delete\"\n                        },\n                        new\n                        {\n                            Id = new Guid(\"74c8034f-d9cb-4a17-8578-a9f765bd845c\"),\n                            Code = \"MESSAGING.REPORT.VIEW\",\n                            CreatedAt = new DateTime(2025, 9, 13, 0, 0, 0, 0, DateTimeKind.Utc),\n                            Group = \"Messaging\",\n                            IsActive = true,\n                            Name = \"messaging.report.view\"\n                        },\n                        new\n                        {\n                            Id = new Guid(\"c819f1bd-422d-4609-916c-cc185fe44ab0\"),\n                            Code = \"MESSAGING.STATUS.VIEW\",\n                            CreatedAt = new DateTime(2025, 9, 13, 0, 0, 0, 0, DateTimeKind.Utc),\n                            Group = \"Messaging\",\n                            IsActive = true,\n                            Name = \"messaging.status.view\"\n                        },\n                        new\n                        {\n                            Id = new Guid(\"eecd0fac-223c-4dba-9fa1-2a6e973d61d1\"),\n                            Code = \"MESSAGING.INBOX.VIEW\",\n                            CreatedAt = new DateTime(2025, 9, 13, 0, 0, 0, 0, DateTimeKind.Utc),\n                            Group = \"Messaging\",\n                            IsActive = true,\n                            Name = \"messaging.inbox.view\"\n                        },\n                        new\n                        {\n                            Id = new Guid(\"974af1f9-3caa-4857-a1a7-48462c389332\"),\n                            Code = \"MESSAGING.SEND.TEXT\",\n                            CreatedAt = new DateTime(2025, 9, 13, 0, 0, 0, 0, DateTimeKind.Utc),\n                            Group = \"Messaging\",\n                            IsActive = true,\n                            Name = \"messaging.send.text\"\n                        },\n                        new\n                        {\n                            Id = new Guid(\"0485154c-dde5-4732-a7aa-a379c77a5b27\"),\n                            Code = \"MESSAGING.SEND.TEMPLATE\",\n                            CreatedAt = new DateTime(2025, 9, 13, 0, 0, 0, 0, DateTimeKind.Utc),\n                            Group = \"Messaging\",\n                            IsActive = true,\n                            Name = \"messaging.send.template\"\n                        },\n                        new\n                        {\n                            Id = new Guid(\"29461562-ef9c-48c0-a606-482ff57b8f95\"),\n                            Code = \"MESSAGING.SEND\",\n                            CreatedAt = new DateTime(2025, 9, 13, 0, 0, 0, 0, DateTimeKind.Utc),\n                            Group = \"Messaging\",\n                            IsActive = true,\n                            Name = \"messaging.send\"\n                        },\n                        new\n                        {\n                            Id = new Guid(\"bbc5202a-eac9-40bb-aa78-176c677dbf5b\"),\n                            Code = \"MESSAGING.WHATSAPPSETTINGS.VIEW\",\n                            CreatedAt = new DateTime(2025, 9, 13, 0, 0, 0, 0, DateTimeKind.Utc),\n                            Group = \"Messaging\",\n                            IsActive = true,\n                            Name = \"messaging.whatsappsettings.view\"\n                        },\n                        new\n                        {\n                            Id = new Guid(\"205b87c7-b008-4e51-9fea-798c2dc4f9c2\"),\n                            Code = \"ADMIN.WHATSAPPSETTINGS.VIEW\",\n                            CreatedAt = new DateTime(2025, 9, 13, 0, 0, 0, 0, DateTimeKind.Utc),\n                            Group = \"Admin\",\n                            IsActive = true,\n                            Name = \"admin.whatsappsettings.view\"\n                        },\n                        new\n                        {\n                            Id = new Guid(\"6e4d3a86-7cf9-4ac2-b8a7-ed10c9f0173d\"),\n                            Code = \"SETTINGS.WHATSAPP.VIEW\",\n                            CreatedAt = new DateTime(2025, 9, 13, 0, 0, 0, 0, DateTimeKind.Utc),\n                            Group = \"Settings\",\n                            IsActive = true,\n                            Name = \"Settings - WhatsApp View\"\n                        },\n                        new\n                        {\n                            Id = new Guid(\"ad36cdb7-5221-448b-a6a6-c35c9f88d021\"),\n                            Code = \"INBOX.VIEW\",\n                            CreatedAt = new DateTime(2025, 9, 13, 0, 0, 0, 0, DateTimeKind.Utc),\n                            Group = \"Inbox\",\n                            IsActive = true,\n                            Name = \"inbox.view\"\n                        },\n                        new\n                        {\n                            Id = new Guid(\"74828fc0-e358-4cfc-b924-13719a0d9f50\"),\n                            Code = \"INBOX.MENU\",\n                            CreatedAt = new DateTime(2025, 9, 13, 0, 0, 0, 0, DateTimeKind.Utc),\n                            Group = \"Inbox\",\n                            IsActive = true,\n                            Name = \"inbox.menu\"\n                        },\n                        new\n                        {\n                            Id = new Guid(\"98572fe7-d142-475a-b990-f248641809e2\"),\n                            Code = \"SETTINGS.PROFILE.VIEW\",\n                            CreatedAt = new DateTime(2025, 9, 13, 0, 0, 0, 0, DateTimeKind.Utc),\n                            Group = \"Settings\",\n                            IsActive = true,\n                            Name = \"settings.profile.view\"\n                        },\n                        new\n                        {\n                            Id = new Guid(\"821480c6-1464-415e-bba8-066fcb4e7e63\"),\n                            Code = \"AUTOMATION.MENU\",\n                            CreatedAt = new DateTime(2025, 9, 13, 0, 0, 0, 0, DateTimeKind.Utc),\n                            Group = \"Automation\",\n                            IsActive = true,\n                            Name = \"automation.menu\"\n                        },\n                        new\n                        {\n                            Id = new Guid(\"918a61d0-5ab6-46af-a3d3-41e37b7710f9\"),\n                            Code = \"AUTOMATION.CREATE.TEMPLATE.FLOW\",\n                            CreatedAt = new DateTime(2025, 9, 13, 0, 0, 0, 0, DateTimeKind.Utc),\n                            Group = \"Automation\",\n                            IsActive = true,\n                            Name = \"automation.Create.Template.Flow\"\n                        },\n                        new\n                        {\n                            Id = new Guid(\"9ae90cfe-3fea-4307-b024-3083c2728148\"),\n                            Code = \"AUTOMATION.VIEW.TEMPLATE.FLOW\",\n                            CreatedAt = new DateTime(2025, 9, 13, 0, 0, 0, 0, DateTimeKind.Utc),\n                            Group = \"Automation\",\n                            IsActive = true,\n                            Name = \"automation.View.Template.Flow\"\n                        },\n                        new\n                        {\n                            Id = new Guid(\"93c5d5a7-f8dd-460a-8c7b-e3788440ba3a\"),\n                            Code = \"AUTOMATION.CREATE.TEMPLATEPLUSFREETEXT.FLOW\",\n                            CreatedAt = new DateTime(2025, 9, 13, 0, 0, 0, 0, DateTimeKind.Utc),\n                            Group = \"Automation\",\n                            IsActive = true,\n                            Name = \"automation.Create.TemplatePlusFreetext.Flow\"\n                        },\n                        new\n                        {\n                            Id = new Guid(\"7d7cbceb-4ce7-4835-85cd-59562487298d\"),\n                            Code = \"AUTOMATION.VIEW.TEMPLATEPLUSFREETEXT.FLOW\",\n                            CreatedAt = new DateTime(2025, 9, 13, 0, 0, 0, 0, DateTimeKind.Utc),\n                            Group = \"Automation\",\n                            IsActive = true,\n                            Name = \"automation.View.TemplatePlusFreetext.Flow\"\n                        },\n                        new\n                        {\n                            Id = new Guid(\"636b17f2-1c54-4e26-a8cd-dbf561dcb522\"),\n                            Code = \"AUTOMATION.VIEW.TEMPLATE.FLOW_ANALYTICS\",\n                            CreatedAt = new DateTime(2025, 9, 13, 0, 0, 0, 0, DateTimeKind.Utc),\n                            Group = \"Automation\",\n                            IsActive = true,\n                            Name = \"automation.View.Template.Flow_analytics\"\n                        },\n                        new\n                        {\n                            Id = new Guid(\"adfa8490-9705-4a36-a86e-d5bff7ddc220\"),\n                            Code = \"AUTOMATION.VIEW.TEMPLATEPLUSFREETEXT.FLOW_ANALYTICS\",\n                            CreatedAt = new DateTime(2025, 9, 13, 0, 0, 0, 0, DateTimeKind.Utc),\n                            Group = \"Automation\",\n                            IsActive = true,\n                            Name = \"automation.View.TemplatePlusFreeText.Flow_analytics\"\n                        },\n                        new\n                        {\n                            Id = new Guid(\"0dedac5b-81c8-44c3-8cfe-76c58e29c6db\"),\n                            Code = \"AUTOMATION_TRIGGER_TEST\",\n                            CreatedAt = new DateTime(2025, 9, 13, 0, 0, 0, 0, DateTimeKind.Utc),\n                            Group = \"Automation\",\n                            IsActive = true,\n                            Name = \"automation_trigger_test\"\n                        },\n                        new\n                        {\n                            Id = new Guid(\"14ef7f9d-0975-4ab4-b6f1-7d1af8b594ca\"),\n                            Code = \"TEMPLATE.BUILDER.VIEW\",\n                            CreatedAt = new DateTime(2025, 9, 13, 0, 0, 0, 0, DateTimeKind.Utc),\n                            Group = \"TemplateBuilder\",\n                            IsActive = true,\n                            Name = \"View Template Builder\"\n                        },\n                        new\n                        {\n                            Id = new Guid(\"03eabd97-b196-4603-bbdd-1b2cdd595ead\"),\n                            Code = \"TEMPLATE.BUILDER.CREATE.DRAFT\",\n                            CreatedAt = new DateTime(2025, 9, 13, 0, 0, 0, 0, DateTimeKind.Utc),\n                            Group = \"TemplateBuilder\",\n                            IsActive = true,\n                            Name = \"Draft Creation\"\n                        },\n                        new\n                        {\n                            Id = new Guid(\"d272be50-ff26-45cf-bd7a-e9db74813699\"),\n                            Code = \"TEMPLATE.BUILDER.APPROVED.TEMPLATES.VIEW\",\n                            CreatedAt = new DateTime(2025, 9, 13, 0, 0, 0, 0, DateTimeKind.Utc),\n                            Group = \"TemplateBuilder\",\n                            IsActive = true,\n                            Name = \"View Approved Template\"\n                        },\n                        new\n                        {\n                            Id = new Guid(\"3602f49d-dc10-4faa-9a44-4185a669ea0a\"),\n                            Code = \"TEMPLATE.BUILDER.LIBRARY.BROWSE\",\n                            CreatedAt = new DateTime(2025, 9, 13, 0, 0, 0, 0, DateTimeKind.Utc),\n                            Group = \"TemplateBuilder\",\n                            IsActive = true,\n                            Name = \"View Template Library\"\n                        });\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.AccessControl.Models.Plan\", b =>\n                {\n                    b.Property<Guid>(\"Id\")\n                        .ValueGeneratedOnAdd()\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<string>(\"Code\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<DateTime>(\"CreatedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<string>(\"Description\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<bool>(\"IsActive\")\n                        .HasColumnType(\"boolean\");\n\n                    b.Property<bool>(\"IsInternal\")\n                        .HasColumnType(\"boolean\");\n\n                    b.Property<string>(\"Name\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.HasKey(\"Id\");\n\n                    b.ToTable(\"Plans\");\n\n                    b.HasData(\n                        new\n                        {\n                            Id = new Guid(\"5f9f5de1-a0b2-48ba-b03d-77b27345613f\"),\n                            Code = \"SYSTEM_DEFAULT\",\n                            CreatedAt = new DateTime(2025, 1, 1, 0, 0, 0, 0, DateTimeKind.Utc),\n                            Description = \"Default free plan\",\n                            IsActive = true,\n                            IsInternal = true,\n                            Name = \"System Default\"\n                        });\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.AccessControl.Models.PlanPermission\", b =>\n                {\n                    b.Property<Guid>(\"Id\")\n                        .ValueGeneratedOnAdd()\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<DateTime>(\"AssignedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<string>(\"AssignedBy\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<bool>(\"IsActive\")\n                        .HasColumnType(\"boolean\");\n\n                    b.Property<Guid>(\"PermissionId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<Guid>(\"PlanId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.HasKey(\"Id\");\n\n                    b.HasIndex(\"PermissionId\");\n\n                    b.HasIndex(\"PlanId\");\n\n                    b.HasIndex(\"PlanId\", \"PermissionId\")\n                        .IsUnique()\n                        .HasDatabaseName(\"UX_PlanPermissions_Plan_Permission\");\n\n                    b.ToTable(\"PlanPermissions\");\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.AccessControl.Models.Role\", b =>\n                {\n                    b.Property<Guid>(\"Id\")\n                        .ValueGeneratedOnAdd()\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<DateTime>(\"CreatedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<string>(\"Description\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<bool>(\"IsActive\")\n                        .HasColumnType(\"boolean\");\n\n                    b.Property<bool>(\"IsSystemDefined\")\n                        .HasColumnType(\"boolean\");\n\n                    b.Property<string>(\"Name\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.HasKey(\"Id\");\n\n                    b.ToTable(\"Roles\");\n\n                    b.HasData(\n                        new\n                        {\n                            Id = new Guid(\"00000000-0000-0000-0000-000000000001\"),\n                            CreatedAt = new DateTime(2025, 1, 1, 0, 0, 0, 0, DateTimeKind.Utc),\n                            Description = \"Super Admin\",\n                            IsActive = true,\n                            IsSystemDefined = false,\n                            Name = \"admin\"\n                        },\n                        new\n                        {\n                            Id = new Guid(\"00000000-0000-0000-0000-000000000002\"),\n                            CreatedAt = new DateTime(2025, 1, 1, 0, 0, 0, 0, DateTimeKind.Utc),\n                            Description = \"Business Partner\",\n                            IsActive = true,\n                            IsSystemDefined = false,\n                            Name = \"partner\"\n                        },\n                        new\n                        {\n                            Id = new Guid(\"00000000-0000-0000-0000-000000000003\"),\n                            CreatedAt = new DateTime(2025, 1, 1, 0, 0, 0, 0, DateTimeKind.Utc),\n                            Description = \"Reseller Partner\",\n                            IsActive = true,\n                            IsSystemDefined = false,\n                            Name = \"reseller\"\n                        },\n                        new\n                        {\n                            Id = new Guid(\"00000000-0000-0000-0000-000000000004\"),\n                            CreatedAt = new DateTime(2025, 1, 1, 0, 0, 0, 0, DateTimeKind.Utc),\n                            Description = \"Business Owner\",\n                            IsActive = true,\n                            IsSystemDefined = false,\n                            Name = \"business\"\n                        },\n                        new\n                        {\n                            Id = new Guid(\"00000000-0000-0000-0000-000000000005\"),\n                            CreatedAt = new DateTime(2025, 1, 1, 0, 0, 0, 0, DateTimeKind.Utc),\n                            Description = \"Staff\",\n                            IsActive = true,\n                            IsSystemDefined = false,\n                            Name = \"staff\"\n                        });\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.AccessControl.Models.RolePermission\", b =>\n                {\n                    b.Property<Guid>(\"Id\")\n                        .ValueGeneratedOnAdd()\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<DateTime>(\"AssignedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<string>(\"AssignedBy\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<bool>(\"IsActive\")\n                        .HasColumnType(\"boolean\");\n\n                    b.Property<bool>(\"IsRevoked\")\n                        .HasColumnType(\"boolean\");\n\n                    b.Property<Guid>(\"PermissionId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<Guid>(\"RoleId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.HasKey(\"Id\");\n\n                    b.HasIndex(\"PermissionId\");\n\n                    b.HasIndex(\"RoleId\", \"PermissionId\")\n                        .IsUnique()\n                        .HasDatabaseName(\"UX_RolePermissions_Role_Permission\");\n\n                    b.ToTable(\"RolePermissions\");\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.AccessControl.Models.UserPermission\", b =>\n                {\n                    b.Property<Guid>(\"Id\")\n                        .ValueGeneratedOnAdd()\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<DateTime>(\"AssignedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<string>(\"AssignedBy\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<bool>(\"IsGranted\")\n                        .HasColumnType(\"boolean\");\n\n                    b.Property<bool>(\"IsRevoked\")\n                        .HasColumnType(\"boolean\");\n\n                    b.Property<Guid>(\"PermissionId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<Guid>(\"UserId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.HasKey(\"Id\");\n\n                    b.HasIndex(\"PermissionId\");\n\n                    b.HasIndex(\"UserId\");\n\n                    b.ToTable(\"UserPermissions\");\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.AccountInsights.Models.AccountInsightsAction\", b =>\n                {\n                    b.Property<long>(\"Id\")\n                        .ValueGeneratedOnAdd()\n                        .HasColumnType(\"bigint\");\n\n                    NpgsqlPropertyBuilderExtensions.UseIdentityByDefaultColumn(b.Property<long>(\"Id\"));\n\n                    b.Property<string>(\"ActionType\")\n                        .IsRequired()\n                        .HasMaxLength(64)\n                        .HasColumnType(\"character varying(64)\");\n\n                    b.Property<string>(\"Actor\")\n                        .IsRequired()\n                        .HasMaxLength(256)\n                        .HasColumnType(\"character varying(256)\");\n\n                    b.Property<Guid>(\"BusinessId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<DateTime>(\"CreatedAtUtc\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<string>(\"Label\")\n                        .IsRequired()\n                        .HasMaxLength(256)\n                        .HasColumnType(\"character varying(256)\");\n\n                    b.Property<string>(\"MetaJson\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.HasKey(\"Id\");\n\n                    b.HasIndex(\"BusinessId\", \"CreatedAtUtc\");\n\n                    b.ToTable(\"AccountInsightsActions\", (string)null);\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.AuditTrail.Models.AuditLog\", b =>\n                {\n                    b.Property<Guid>(\"Id\")\n                        .ValueGeneratedOnAdd()\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<string>(\"ActionType\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<Guid>(\"BusinessId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<DateTime>(\"CreatedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<string>(\"Description\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"IPAddress\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"Location\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<Guid>(\"PerformedByUserId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<string>(\"PerformedByUserName\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"RoleAtTime\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"UserAgent\")\n                        .HasColumnType(\"text\");\n\n                    b.HasKey(\"Id\");\n\n                    b.ToTable(\"AuditLogs\");\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.AutoReplyBuilder.Flows.Models.AutoReplyFlow\", b =>\n                {\n                    b.Property<Guid>(\"Id\")\n                        .ValueGeneratedOnAdd()\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<Guid>(\"BusinessId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<DateTime>(\"CreatedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<string>(\"EdgesJson\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"IndustryTag\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<bool>(\"IsActive\")\n                        .HasColumnType(\"boolean\");\n\n                    b.Property<bool>(\"IsDefaultTemplate\")\n                        .HasColumnType(\"boolean\");\n\n                    b.Property<string>(\"Keyword\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"MatchMode\")\n                        .IsRequired()\n                        .HasMaxLength(32)\n                        .HasColumnType(\"character varying(32)\");\n\n                    b.Property<string>(\"Name\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"NodesJson\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<int>(\"Priority\")\n                        .HasColumnType(\"integer\");\n\n                    b.Property<string>(\"TriggerKeyword\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<DateTime?>(\"UpdatedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<string>(\"UseCase\")\n                        .HasColumnType(\"text\");\n\n                    b.HasKey(\"Id\");\n\n                    b.HasIndex(\"BusinessId\", \"Name\");\n\n                    b.ToTable(\"AutoReplyFlows\");\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.AutoReplyBuilder.Models.AutoReplyFlowEdge\", b =>\n                {\n                    b.Property<Guid>(\"Id\")\n                        .ValueGeneratedOnAdd()\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<DateTime>(\"CreatedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<Guid>(\"FlowId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<string>(\"SourceHandle\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"SourceNodeId\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"TargetHandle\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"TargetNodeId\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.HasKey(\"Id\");\n\n                    b.HasIndex(\"FlowId\");\n\n                    b.ToTable(\"AutoReplyFlowEdges\");\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.AutoReplyBuilder.Models.AutoReplyFlowNode\", b =>\n                {\n                    b.Property<Guid>(\"Id\")\n                        .ValueGeneratedOnAdd()\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<string>(\"ConfigJson\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<DateTime>(\"CreatedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<Guid>(\"FlowId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<string>(\"Label\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"NodeName\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"NodeType\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<int>(\"Order\")\n                        .HasColumnType(\"integer\");\n\n                    b.HasKey(\"Id\");\n\n                    b.HasIndex(\"FlowId\", \"NodeName\");\n\n                    b.ToTable(\"AutoReplyFlowNode\");\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.AutoReplyBuilder.Models.AutoReplyLog\", b =>\n                {\n                    b.Property<Guid>(\"Id\")\n                        .ValueGeneratedOnAdd()\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<Guid>(\"BusinessId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<Guid>(\"ContactId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<string>(\"FlowName\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<Guid?>(\"MessageLogId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<string>(\"ReplyContent\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"TriggerKeyword\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"TriggerType\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<DateTime>(\"TriggeredAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.HasKey(\"Id\");\n\n                    b.ToTable(\"AutoReplyLogs\");\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.Automation.Models.AutomationFlow\", b =>\n                {\n                    b.Property<Guid>(\"Id\")\n                        .ValueGeneratedOnAdd()\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<Guid>(\"BusinessId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<DateTime>(\"CreatedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<string>(\"EdgesJson\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<bool>(\"IsActive\")\n                        .HasColumnType(\"boolean\");\n\n                    b.Property<string>(\"Name\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"NodesJson\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"TriggerKeyword\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<DateTime>(\"UpdatedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.HasKey(\"Id\");\n\n                    b.ToTable(\"AutomationFlows\");\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.BusinessModule.Models.Business\", b =>\n                {\n                    b.Property<Guid>(\"Id\")\n                        .ValueGeneratedOnAdd()\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<string>(\"Address\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<DateTime?>(\"ApprovedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<string>(\"ApprovedBy\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"BusinessEmail\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"BusinessName\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"CompanyName\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"CompanyPhone\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<DateTime>(\"CreatedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<string>(\"CreatedBy\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<Guid?>(\"CreatedByPartnerId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<DateTime?>(\"DeletedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<string>(\"DeletedBy\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"Industry\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<bool>(\"IsApproved\")\n                        .HasColumnType(\"boolean\");\n\n                    b.Property<bool>(\"IsDeleted\")\n                        .HasColumnType(\"boolean\");\n\n                    b.Property<DateTime?>(\"LastLoginAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<string>(\"LogoUrl\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"Notes\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"Phone\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<Guid?>(\"PlanId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<string>(\"RepresentativeName\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"Source\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<int>(\"Status\")\n                        .HasColumnType(\"integer\");\n\n                    b.Property<string>(\"Tags\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"Website\")\n                        .HasColumnType(\"text\");\n\n                    b.HasKey(\"Id\");\n\n                    b.HasIndex(\"PlanId\");\n\n                    b.ToTable(\"Businesses\");\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.CTAFlowBuilder.Models.CTAFlowConfig\", b =>\n                {\n                    b.Property<Guid>(\"Id\")\n                        .ValueGeneratedOnAdd()\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<Guid>(\"BusinessId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<DateTime>(\"CreatedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<string>(\"CreatedBy\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"FlowName\")\n                        .IsRequired()\n                        .HasMaxLength(100)\n                        .HasColumnType(\"character varying(100)\");\n\n                    b.Property<bool>(\"IsActive\")\n                        .HasColumnType(\"boolean\");\n\n                    b.Property<bool>(\"IsPublished\")\n                        .HasColumnType(\"boolean\");\n\n                    b.Property<DateTime?>(\"UpdatedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.HasKey(\"Id\");\n\n                    b.HasIndex(\"BusinessId\", \"FlowName\", \"IsActive\")\n                        .IsUnique();\n\n                    b.ToTable(\"CTAFlowConfigs\");\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.CTAFlowBuilder.Models.CTAFlowStep\", b =>\n                {\n                    b.Property<Guid>(\"Id\")\n                        .ValueGeneratedOnAdd()\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<Guid>(\"CTAFlowConfigId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<float?>(\"PositionX\")\n                        .HasColumnType(\"real\");\n\n                    b.Property<float?>(\"PositionY\")\n                        .HasColumnType(\"real\");\n\n                    b.Property<int?>(\"ProfileNameSlot\")\n                        .HasColumnType(\"integer\");\n\n                    b.Property<string>(\"RequiredSource\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"RequiredTag\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<int>(\"StepOrder\")\n                        .HasColumnType(\"integer\");\n\n                    b.Property<string>(\"TemplateToSend\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"TemplateType\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"TriggerButtonText\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"TriggerButtonType\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<bool>(\"UseProfileName\")\n                        .HasColumnType(\"boolean\");\n\n                    b.HasKey(\"Id\");\n\n                    b.HasIndex(\"CTAFlowConfigId\");\n\n                    b.ToTable(\"CTAFlowSteps\");\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.CTAFlowBuilder.Models.FlowButtonLink\", b =>\n                {\n                    b.Property<Guid>(\"Id\")\n                        .ValueGeneratedOnAdd()\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<short>(\"ButtonIndex\")\n                        .HasColumnType(\"smallint\");\n\n                    b.Property<string>(\"ButtonSubType\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"ButtonText\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"ButtonType\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"ButtonValue\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<Guid>(\"CTAFlowStepId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<Guid?>(\"NextStepId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.HasKey(\"Id\");\n\n                    b.HasIndex(\"CTAFlowStepId\");\n\n                    b.ToTable(\"FlowButtonLinks\");\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.CTAFlowBuilder.Models.FlowExecutionLog\", b =>\n                {\n                    b.Property<Guid>(\"Id\")\n                        .ValueGeneratedOnAdd()\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<Guid?>(\"AutoReplyFlowId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<Guid>(\"BusinessId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<short?>(\"ButtonIndex\")\n                        .HasColumnType(\"smallint\");\n\n                    b.Property<Guid?>(\"CampaignId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<Guid?>(\"CampaignSendLogId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<string>(\"ContactPhone\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"ErrorMessage\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<DateTime>(\"ExecutedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<Guid?>(\"FlowId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<Guid?>(\"MessageLogId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<int>(\"Origin\")\n                        .HasColumnType(\"integer\");\n\n                    b.Property<string>(\"RawResponse\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<Guid?>(\"RequestId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<Guid?>(\"RunId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<Guid>(\"StepId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<string>(\"StepName\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<bool>(\"Success\")\n                        .HasColumnType(\"boolean\");\n\n                    b.Property<string>(\"TemplateName\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"TemplateType\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<Guid?>(\"TrackingLogId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<string>(\"TriggeredByButton\")\n                        .HasColumnType(\"text\");\n\n                    b.HasKey(\"Id\");\n\n                    b.HasIndex(\"FlowId\")\n                        .HasDatabaseName(\"IX_FlowExecutionLogs_FlowId\");\n\n                    b.HasIndex(\"BusinessId\", \"ExecutedAt\")\n                        .HasDatabaseName(\"ix_flowexec_biz_executedat\");\n\n                    b.HasIndex(\"BusinessId\", \"Origin\", \"AutoReplyFlowId\")\n                        .HasDatabaseName(\"ix_flowexec_biz_origin_autoreply\");\n\n                    b.HasIndex(\"BusinessId\", \"Origin\", \"CampaignId\")\n                        .HasDatabaseName(\"ix_flowexec_biz_origin_campaign\");\n\n                    b.ToTable(\"FlowExecutionLogs\", (string)null);\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.CTAManagement.Models.CTADefinition\", b =>\n                {\n                    b.Property<Guid>(\"Id\")\n                        .ValueGeneratedOnAdd()\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<Guid>(\"BusinessId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<string>(\"ButtonText\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"ButtonType\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<DateTime>(\"CreatedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<string>(\"Description\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<bool>(\"IsActive\")\n                        .HasColumnType(\"boolean\");\n\n                    b.Property<string>(\"TargetUrl\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"Title\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<DateTime?>(\"UpdatedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.HasKey(\"Id\");\n\n                    b.ToTable(\"CTADefinitions\");\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.CampaignModule.Models.Audience\", b =>\n                {\n                    b.Property<Guid>(\"Id\")\n                        .ValueGeneratedOnAdd()\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<Guid>(\"BusinessId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<Guid?>(\"CampaignId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<DateTime>(\"CreatedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<Guid?>(\"CreatedByUserId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<Guid?>(\"CsvBatchId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<string>(\"Description\")\n                        .HasMaxLength(512)\n                        .HasColumnType(\"character varying(512)\");\n\n                    b.Property<bool>(\"IsDeleted\")\n                        .HasColumnType(\"boolean\");\n\n                    b.Property<string>(\"Name\")\n                        .IsRequired()\n                        .HasMaxLength(160)\n                        .HasColumnType(\"character varying(160)\");\n\n                    b.Property<DateTime?>(\"UpdatedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.HasKey(\"Id\");\n\n                    b.HasIndex(\"CampaignId\");\n\n                    b.HasIndex(\"CsvBatchId\");\n\n                    b.HasIndex(\"BusinessId\", \"CampaignId\");\n\n                    b.HasIndex(\"BusinessId\", \"CsvBatchId\");\n\n                    b.HasIndex(\"BusinessId\", \"IsDeleted\")\n                        .HasDatabaseName(\"ix_audiences_biz_deleted\");\n\n                    b.ToTable(\"Audiences\", (string)null);\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.CampaignModule.Models.AudienceMember\", b =>\n                {\n                    b.Property<Guid>(\"Id\")\n                        .ValueGeneratedOnAdd()\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<string>(\"AttributesJson\")\n                        .HasColumnType(\"jsonb\");\n\n                    b.Property<Guid>(\"AudienceId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<Guid>(\"BusinessId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<Guid?>(\"ContactId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<DateTime>(\"CreatedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<Guid?>(\"CreatedByUserId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<string>(\"Email\")\n                        .HasMaxLength(256)\n                        .HasColumnType(\"character varying(256)\");\n\n                    b.Property<bool>(\"IsDeleted\")\n                        .HasColumnType(\"boolean\");\n\n                    b.Property<bool>(\"IsTransientContact\")\n                        .HasColumnType(\"boolean\");\n\n                    b.Property<string>(\"Name\")\n                        .HasMaxLength(160)\n                        .HasColumnType(\"character varying(160)\");\n\n                    b.Property<string>(\"PhoneE164\")\n                        .HasMaxLength(32)\n                        .HasColumnType(\"character varying(32)\");\n\n                    b.Property<string>(\"PhoneRaw\")\n                        .HasMaxLength(64)\n                        .HasColumnType(\"character varying(64)\");\n\n                    b.Property<DateTime?>(\"PromotedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<DateTime?>(\"UpdatedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.HasKey(\"Id\");\n\n                    b.HasIndex(\"ContactId\")\n                        .HasDatabaseName(\"ix_audmember_contact\");\n\n                    b.HasIndex(\"AudienceId\", \"PhoneE164\")\n                        .IsUnique()\n                        .HasDatabaseName(\"ux_audmember_audience_phone\");\n\n                    b.ToTable(\"AudienceMembers\", (string)null);\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.CampaignModule.Models.Campaign\", b =>\n                {\n                    b.Property<Guid>(\"Id\")\n                        .ValueGeneratedOnAdd()\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<Guid?>(\"AudienceId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<Guid>(\"BusinessId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<Guid?>(\"CTAFlowConfigId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<Guid?>(\"CampaignId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<string>(\"CampaignType\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<DateTime>(\"CreatedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<string>(\"CreatedBy\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<Guid?>(\"CtaId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<DateTime?>(\"DeletedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<string>(\"DeletedBy\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"DocumentUrl\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"FollowUpTemplateId\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"ImageCaption\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"ImageUrl\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<bool>(\"IsDeleted\")\n                        .HasColumnType(\"boolean\");\n\n                    b.Property<string>(\"MessageBody\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"MessageTemplate\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"Name\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"PhoneNumberId\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"Provider\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<DateTime?>(\"ScheduledAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<Guid?>(\"SourceCampaignId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<string>(\"Status\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"TemplateId\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"TemplateParameters\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"TemplateSchemaSnapshot\")\n                        .HasColumnType(\"jsonb\");\n\n                    b.Property<DateTime>(\"UpdatedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<string>(\"VideoUrl\")\n                        .HasColumnType(\"text\");\n\n                    b.HasKey(\"Id\");\n\n                    b.HasIndex(\"BusinessId\");\n\n                    b.HasIndex(\"CTAFlowConfigId\");\n\n                    b.HasIndex(\"CtaId\");\n\n                    b.HasIndex(\"SourceCampaignId\");\n\n                    b.ToTable(\"Campaigns\");\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.CampaignModule.Models.CampaignButton\", b =>\n                {\n                    b.Property<Guid>(\"Id\")\n                        .ValueGeneratedOnAdd()\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<Guid>(\"CampaignId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<bool>(\"IsFromTemplate\")\n                        .HasColumnType(\"boolean\");\n\n                    b.Property<int>(\"Position\")\n                        .HasColumnType(\"integer\");\n\n                    b.Property<string>(\"Title\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"Type\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"Value\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.HasKey(\"Id\");\n\n                    b.HasIndex(\"CampaignId\");\n\n                    b.ToTable(\"CampaignButtons\");\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.CampaignModule.Models.CampaignFlowOverride\", b =>\n                {\n                    b.Property<Guid>(\"Id\")\n                        .ValueGeneratedOnAdd()\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<string>(\"ButtonText\")\n                        .IsRequired()\n                        .HasMaxLength(50)\n                        .HasColumnType(\"character varying(50)\");\n\n                    b.Property<Guid>(\"CampaignId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<DateTime>(\"CreatedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<string>(\"CreatedBy\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"OverrideNextTemplate\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"TemplateName\")\n                        .IsRequired()\n                        .HasMaxLength(100)\n                        .HasColumnType(\"character varying(100)\");\n\n                    b.HasKey(\"Id\");\n\n                    b.HasIndex(\"CampaignId\");\n\n                    b.ToTable(\"CampaignFlowOverrides\");\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.CampaignModule.Models.CampaignRecipient\", b =>\n                {\n                    b.Property<Guid>(\"Id\")\n                        .ValueGeneratedOnAdd()\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<Guid?>(\"AudienceMemberId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<string>(\"BotId\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<Guid>(\"BusinessId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<Guid>(\"CampaignId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<string>(\"CategoryBrowsed\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"ClickedCTA\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<Guid?>(\"ContactId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<string>(\"IdempotencyKey\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<bool>(\"IsAutoTagged\")\n                        .HasColumnType(\"boolean\");\n\n                    b.Property<DateTime?>(\"MaterializedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<string>(\"MessagePreview\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"ProductBrowsed\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"ResolvedButtonUrlsJson\")\n                        .HasColumnType(\"jsonb\");\n\n                    b.Property<string>(\"ResolvedParametersJson\")\n                        .HasColumnType(\"jsonb\");\n\n                    b.Property<DateTime?>(\"SentAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<string>(\"Status\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<DateTime>(\"UpdatedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.HasKey(\"Id\");\n\n                    b.HasIndex(\"AudienceMemberId\");\n\n                    b.HasIndex(\"BusinessId\");\n\n                    b.HasIndex(\"ContactId\");\n\n                    b.HasIndex(\"IdempotencyKey\")\n                        .HasDatabaseName(\"ix_campaignrecipients_idempotency\");\n\n                    b.HasIndex(\"CampaignId\", \"ContactId\")\n                        .HasDatabaseName(\"ix_recipients_campaign_contact\");\n\n                    b.ToTable(\"CampaignRecipients\", (string)null);\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.CampaignModule.Models.CampaignVariableMap\", b =>\n                {\n                    b.Property<Guid>(\"Id\")\n                        .ValueGeneratedOnAdd()\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<Guid>(\"BusinessId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<Guid>(\"CampaignId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<string>(\"Component\")\n                        .IsRequired()\n                        .HasMaxLength(64)\n                        .HasColumnType(\"character varying(64)\");\n\n                    b.Property<DateTime>(\"CreatedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<Guid?>(\"CreatedByUserId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<string>(\"DefaultValue\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"Expression\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<int>(\"Index\")\n                        .HasColumnType(\"integer\");\n\n                    b.Property<bool>(\"IsRequired\")\n                        .HasColumnType(\"boolean\");\n\n                    b.Property<string>(\"SourceKey\")\n                        .HasMaxLength(128)\n                        .HasColumnType(\"character varying(128)\");\n\n                    b.Property<string>(\"SourceType\")\n                        .IsRequired()\n                        .HasMaxLength(32)\n                        .HasColumnType(\"character varying(32)\");\n\n                    b.Property<string>(\"StaticValue\")\n                        .HasColumnType(\"text\");\n\n                    b.HasKey(\"Id\");\n\n                    b.HasIndex(\"CampaignId\");\n\n                    b.ToTable(\"CampaignVariableMaps\");\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.CampaignModule.Models.CsvBatch\", b =>\n                {\n                    b.Property<Guid>(\"Id\")\n                        .ValueGeneratedOnAdd()\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<Guid?>(\"AudienceId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<Guid>(\"BusinessId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<string>(\"Checksum\")\n                        .HasMaxLength(128)\n                        .HasColumnType(\"character varying(128)\");\n\n                    b.Property<DateTime>(\"CreatedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<Guid?>(\"CreatedByUserId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<string>(\"ErrorMessage\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"FileName\")\n                        .HasMaxLength(256)\n                        .HasColumnType(\"character varying(256)\");\n\n                    b.Property<string>(\"HeadersJson\")\n                        .HasColumnType(\"jsonb\");\n\n                    b.Property<int>(\"RowCount\")\n                        .HasColumnType(\"integer\");\n\n                    b.Property<int>(\"SkippedCount\")\n                        .HasColumnType(\"integer\");\n\n                    b.Property<string>(\"Status\")\n                        .IsRequired()\n                        .HasMaxLength(32)\n                        .HasColumnType(\"character varying(32)\");\n\n                    b.HasKey(\"Id\");\n\n                    b.HasIndex(\"AudienceId\");\n\n                    b.HasIndex(\"Checksum\")\n                        .HasDatabaseName(\"ix_csvbatch_checksum\");\n\n                    b.HasIndex(\"BusinessId\", \"AudienceId\");\n\n                    b.HasIndex(\"BusinessId\", \"CreatedAt\")\n                        .HasDatabaseName(\"ix_csvbatch_biz_created\");\n\n                    b.ToTable(\"CsvBatches\", (string)null);\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.CampaignModule.Models.CsvRow\", b =>\n                {\n                    b.Property<Guid>(\"Id\")\n                        .ValueGeneratedOnAdd()\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<Guid>(\"BatchId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<Guid>(\"BusinessId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<DateTime>(\"CreatedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<string>(\"PhoneE164\")\n                        .HasMaxLength(32)\n                        .HasColumnType(\"character varying(32)\");\n\n                    b.Property<string>(\"PhoneRaw\")\n                        .HasMaxLength(64)\n                        .HasColumnType(\"character varying(64)\");\n\n                    b.Property<int>(\"RowIndex\")\n                        .HasColumnType(\"integer\");\n\n                    b.Property<string>(\"RowJson\")\n                        .IsRequired()\n                        .HasColumnType(\"jsonb\");\n\n                    b.Property<string>(\"ValidationError\")\n                        .HasColumnType(\"text\");\n\n                    b.HasKey(\"Id\");\n\n                    b.HasIndex(\"PhoneE164\")\n                        .HasDatabaseName(\"ix_csvrow_phone\");\n\n                    b.HasIndex(\"BatchId\", \"RowIndex\")\n                        .IsUnique()\n                        .HasDatabaseName(\"ux_csvrow_batch_rowidx\");\n\n                    b.HasIndex(\"BusinessId\", \"BatchId\");\n\n                    b.ToTable(\"CsvRows\", (string)null);\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.CampaignModule.Models.OutboundCampaignJob\", b =>\n                {\n                    b.Property<Guid>(\"Id\")\n                        .ValueGeneratedOnAdd()\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<int>(\"Attempt\")\n                        .HasColumnType(\"integer\");\n\n                    b.Property<Guid>(\"BusinessId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<Guid>(\"CampaignId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<DateTime>(\"CreatedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<string>(\"LastError\")\n                        .HasMaxLength(4000)\n                        .HasColumnType(\"character varying(4000)\");\n\n                    b.Property<int>(\"MaxAttempts\")\n                        .HasColumnType(\"integer\");\n\n                    b.Property<DateTimeOffset>(\"NextAttemptAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<string>(\"Status\")\n                        .IsRequired()\n                        .HasMaxLength(32)\n                        .HasColumnType(\"character varying(32)\");\n\n                    b.Property<DateTime>(\"UpdatedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.HasKey(\"Id\");\n\n                    b.HasIndex(\"CampaignId\");\n\n                    b.HasIndex(\"Status\", \"NextAttemptAt\");\n\n                    b.ToTable(\"OutboundCampaignJobs\", (string)null);\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.CampaignModule.Models.OutboundMessageJob\", b =>\n                {\n                    b.Property<Guid>(\"Id\")\n                        .ValueGeneratedOnAdd()\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<int>(\"Attempt\")\n                        .HasColumnType(\"integer\");\n\n                    b.Property<Guid>(\"BusinessId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<Guid>(\"CampaignId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<DateTime>(\"CreatedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<string>(\"HeaderMediaUrl\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"IdempotencyKey\")\n                        .HasMaxLength(1000)\n                        .HasColumnType(\"character varying(1000)\");\n\n                    b.Property<string>(\"LanguageCode\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"LastError\")\n                        .HasMaxLength(4000)\n                        .HasColumnType(\"character varying(4000)\");\n\n                    b.Property<string>(\"MediaType\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"MessageBody\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<DateTime?>(\"NextAttemptAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<string>(\"PhoneNumberId\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"Provider\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<Guid>(\"RecipientId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<string>(\"ResolvedButtonUrlsJson\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"ResolvedParamsJson\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"Status\")\n                        .IsRequired()\n                        .HasMaxLength(24)\n                        .HasColumnType(\"character varying(24)\");\n\n                    b.Property<string>(\"TemplateName\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.HasKey(\"Id\");\n\n                    b.HasIndex(\"CampaignId\");\n\n                    b.HasIndex(\"BusinessId\", \"IdempotencyKey\")\n                        .IsUnique()\n                        .HasDatabaseName(\"UX_Outbox_Biz_IdemKey\")\n                        .HasFilter(\"\\\"IdempotencyKey\\\" IS NOT NULL AND \\\"IdempotencyKey\\\" <> ''\");\n\n                    b.HasIndex(\"Status\", \"NextAttemptAt\", \"CreatedAt\")\n                        .HasDatabaseName(\"IX_Outbox_StatusDueCreated\");\n\n                    b.ToTable(\"OutboundMessageJobs\", (string)null);\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.CampaignTracking.Models.CampaignSendLog\", b =>\n                {\n                    b.Property<Guid>(\"Id\")\n                        .ValueGeneratedOnAdd()\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<bool>(\"AllowRetry\")\n                        .HasColumnType(\"boolean\");\n\n                    b.Property<string>(\"Browser\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<Guid>(\"BusinessId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<string>(\"ButtonBundleJson\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<Guid?>(\"CTAFlowConfigId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<Guid?>(\"CTAFlowStepId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<Guid>(\"CampaignId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<string>(\"City\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"ClickType\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<DateTime?>(\"ClickedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<Guid?>(\"ContactId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<string>(\"Country\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<DateTime>(\"CreatedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<string>(\"CreatedBy\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<DateTime?>(\"DeliveredAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<string>(\"DeviceInfo\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"DeviceType\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"ErrorMessage\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"IpAddress\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<bool>(\"IsClicked\")\n                        .HasColumnType(\"boolean\");\n\n                    b.Property<DateTime?>(\"LastRetryAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<string>(\"LastRetryStatus\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"MacAddress\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"MessageBody\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"MessageId\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<Guid?>(\"MessageLogId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<DateTime?>(\"ReadAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<Guid>(\"RecipientId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<int>(\"RetryCount\")\n                        .HasColumnType(\"integer\");\n\n                    b.Property<Guid?>(\"RunId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<string>(\"SendStatus\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<DateTime?>(\"SentAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<string>(\"SourceChannel\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"TemplateId\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<Guid?>(\"UserId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.HasKey(\"Id\");\n\n                    b.HasIndex(\"CampaignId\")\n                        .HasDatabaseName(\"IX_CampaignSendLogs_Campaign\");\n\n                    b.HasIndex(\"ContactId\");\n\n                    b.HasIndex(\"MessageId\");\n\n                    b.HasIndex(\"MessageLogId\");\n\n                    b.HasIndex(\"RecipientId\");\n\n                    b.HasIndex(\"RunId\");\n\n                    b.HasIndex(\"UserId\");\n\n                    b.HasIndex(\"BusinessId\", \"MessageId\")\n                        .HasDatabaseName(\"IX_CampaignSendLogs_Business_MessageId\");\n\n                    b.HasIndex(\"BusinessId\", \"SendStatus\", \"SentAt\")\n                        .HasDatabaseName(\"IX_CampaignSendLogs_StatusTime\");\n\n                    b.ToTable(\"CampaignSendLogs\", (string)null);\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.CampaignTracking.Worker.CampaignClickDailyAgg\", b =>\n                {\n                    b.Property<Guid>(\"Id\")\n                        .ValueGeneratedOnAdd()\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<int>(\"ButtonIndex\")\n                        .HasColumnType(\"integer\");\n\n                    b.Property<Guid>(\"CampaignId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<long>(\"Clicks\")\n                        .HasColumnType(\"bigint\");\n\n                    b.Property<DateTime>(\"Day\")\n                        .HasColumnType(\"date\");\n\n                    b.HasKey(\"Id\");\n\n                    b.HasIndex(\"CampaignId\", \"Day\", \"ButtonIndex\")\n                        .IsUnique();\n\n                    b.ToTable(\"CampaignClickDailyAgg\");\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.CampaignTracking.Worker.CampaignClickLog\", b =>\n                {\n                    b.Property<Guid>(\"Id\")\n                        .ValueGeneratedOnAdd()\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<int>(\"ButtonIndex\")\n                        .HasColumnType(\"integer\");\n\n                    b.Property<string>(\"ButtonTitle\")\n                        .IsRequired()\n                        .HasMaxLength(120)\n                        .HasColumnType(\"character varying(120)\");\n\n                    b.Property<Guid>(\"CampaignId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<Guid>(\"CampaignSendLogId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<string>(\"ClickType\")\n                        .IsRequired()\n                        .HasMaxLength(16)\n                        .HasColumnType(\"character varying(16)\");\n\n                    b.Property<DateTime>(\"ClickedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<Guid?>(\"ContactId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<string>(\"Destination\")\n                        .IsRequired()\n                        .HasMaxLength(2048)\n                        .HasColumnType(\"character varying(2048)\");\n\n                    b.Property<string>(\"Ip\")\n                        .IsRequired()\n                        .HasMaxLength(64)\n                        .HasColumnType(\"character varying(64)\");\n\n                    b.Property<Guid?>(\"RunId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<string>(\"UserAgent\")\n                        .IsRequired()\n                        .HasMaxLength(512)\n                        .HasColumnType(\"character varying(512)\");\n\n                    b.HasKey(\"Id\");\n\n                    b.HasIndex(\"CampaignId\", \"ButtonIndex\");\n\n                    b.HasIndex(\"CampaignId\", \"ContactId\");\n\n                    b.HasIndex(\"CampaignId\", \"ClickType\", \"ClickedAt\");\n\n                    b.ToTable(\"CampaignClickLogs\");\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.Catalog.Models.CatalogClickLog\", b =>\n                {\n                    b.Property<Guid>(\"Id\")\n                        .ValueGeneratedOnAdd()\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<string>(\"BotId\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<Guid>(\"BusinessId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<string>(\"ButtonText\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"CTAJourney\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<Guid?>(\"CampaignId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<Guid?>(\"CampaignSendLogId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<string>(\"CategoryBrowsed\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<DateTime?>(\"ClickedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<Guid?>(\"ContactId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<Guid?>(\"CtaId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<bool>(\"FollowUpSent\")\n                        .HasColumnType(\"boolean\");\n\n                    b.Property<string>(\"LastInteractionType\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<Guid?>(\"MessageLogId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<string>(\"PlanSnapshot\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"ProductBrowsed\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<Guid?>(\"ProductId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<string>(\"RefMessageId\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"Source\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"TemplateId\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"UserId\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"UserName\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"UserPhone\")\n                        .HasColumnType(\"text\");\n\n                    b.HasKey(\"Id\");\n\n                    b.ToTable(\"CatalogClickLogs\");\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.Catalog.Models.Product\", b =>\n                {\n                    b.Property<Guid>(\"Id\")\n                        .ValueGeneratedOnAdd()\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<Guid>(\"BusinessId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<DateTime>(\"CreatedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<string>(\"Currency\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"Description\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"ImageUrl\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<bool>(\"IsActive\")\n                        .HasColumnType(\"boolean\");\n\n                    b.Property<DateTime?>(\"LastClickedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<string>(\"MostClickedCTA\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"Name\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<decimal>(\"Price\")\n                        .HasColumnType(\"numeric\");\n\n                    b.Property<int>(\"TotalClicks\")\n                        .HasColumnType(\"integer\");\n\n                    b.HasKey(\"Id\");\n\n                    b.ToTable(\"Products\");\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.CustomeApi.Models.ApiKey\", b =>\n                {\n                    b.Property<Guid>(\"Id\")\n                        .ValueGeneratedOnAdd()\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<Guid>(\"BusinessId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<DateTime>(\"CreatedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<string>(\"CreatedBy\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<DateTime?>(\"ExpiresAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<bool>(\"IsRevoked\")\n                        .HasColumnType(\"boolean\");\n\n                    b.Property<DateTime?>(\"LastUsedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<string>(\"Name\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"Notes\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"Prefix\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"Scopes\")\n                        .IsRequired()\n                        .HasMaxLength(512)\n                        .HasColumnType(\"character varying(512)\");\n\n                    b.Property<string>(\"SecretHash\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.HasKey(\"Id\");\n\n                    b.HasIndex(\"Prefix\")\n                        .IsUnique();\n\n                    b.ToTable(\"ApiKeys\");\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.CustomeApi.Models.ContactJourneyState\", b =>\n                {\n                    b.Property<Guid>(\"Id\")\n                        .ValueGeneratedOnAdd()\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<Guid>(\"BusinessId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<int>(\"ClickCount\")\n                        .HasColumnType(\"integer\");\n\n                    b.Property<string>(\"ContactPhone\")\n                        .IsRequired()\n                        .HasMaxLength(32)\n                        .HasColumnType(\"character varying(32)\");\n\n                    b.Property<DateTime>(\"CreatedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<Guid>(\"FlowId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<string>(\"JourneyText\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"LastButtonText\")\n                        .HasMaxLength(256)\n                        .HasColumnType(\"character varying(256)\");\n\n                    b.Property<DateTime>(\"UpdatedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.HasKey(\"Id\");\n\n                    b.HasIndex(\"BusinessId\", \"FlowId\", \"ContactPhone\")\n                        .IsUnique();\n\n                    b.ToTable(\"ContactJourneyStates\");\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.CustomeApi.Models.CustomerWebhookConfig\", b =>\n                {\n                    b.Property<Guid>(\"Id\")\n                        .ValueGeneratedOnAdd()\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<string>(\"BearerToken\")\n                        .HasMaxLength(2048)\n                        .HasColumnType(\"character varying(2048)\");\n\n                    b.Property<Guid>(\"BusinessId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<DateTime>(\"CreatedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<bool>(\"IsActive\")\n                        .HasColumnType(\"boolean\");\n\n                    b.Property<DateTime?>(\"UpdatedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<string>(\"Url\")\n                        .IsRequired()\n                        .HasMaxLength(1024)\n                        .HasColumnType(\"character varying(1024)\");\n\n                    b.HasKey(\"Id\");\n\n                    b.ToTable(\"CustomerWebhookConfigs\");\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.ESU.Facebook.Models.EsuToken\", b =>\n                {\n                    b.Property<Guid>(\"Id\")\n                        .ValueGeneratedOnAdd()\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<string>(\"AccessToken\")\n                        .IsRequired()\n                        .HasMaxLength(4096)\n                        .HasColumnType(\"character varying(4096)\");\n\n                    b.Property<Guid>(\"BusinessId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<DateTime>(\"CreatedAtUtc\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<DateTime?>(\"ExpiresAtUtc\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<bool>(\"IsRevoked\")\n                        .HasColumnType(\"boolean\");\n\n                    b.Property<string>(\"Provider\")\n                        .IsRequired()\n                        .HasMaxLength(50)\n                        .HasColumnType(\"character varying(50)\");\n\n                    b.Property<string>(\"Scope\")\n                        .HasMaxLength(512)\n                        .HasColumnType(\"character varying(512)\");\n\n                    b.Property<DateTime?>(\"UpdatedAtUtc\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.HasKey(\"Id\");\n\n                    b.HasIndex(\"BusinessId\", \"Provider\")\n                        .IsUnique();\n\n                    b.ToTable(\"EsuTokens\", (string)null);\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.ESU.Facebook.Models.IntegrationFlags\", b =>\n                {\n                    b.Property<Guid>(\"BusinessId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<DateTime>(\"CreatedAtUtc\")\n                        .ValueGeneratedOnAdd()\n                        .HasColumnType(\"timestamp with time zone\")\n                        .HasDefaultValueSql(\"timezone('utc', now())\");\n\n                    b.Property<bool>(\"FacebookEsuCompleted\")\n                        .ValueGeneratedOnAdd()\n                        .HasColumnType(\"boolean\")\n                        .HasDefaultValue(false);\n\n                    b.Property<DateTime>(\"UpdatedAtUtc\")\n                        .ValueGeneratedOnAdd()\n                        .HasColumnType(\"timestamp with time zone\")\n                        .HasDefaultValueSql(\"timezone('utc', now())\");\n\n                    b.HasKey(\"BusinessId\");\n\n                    b.ToTable(\"IntegrationFlags\", (string)null);\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.Entitlements.Models.BusinessQuotaOverride\", b =>\n                {\n                    b.Property<Guid>(\"Id\")\n                        .ValueGeneratedOnAdd()\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<Guid>(\"BusinessId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<DateTime>(\"CreatedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<DateTime?>(\"ExpiresAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<bool?>(\"IsUnlimited\")\n                        .HasColumnType(\"boolean\");\n\n                    b.Property<long?>(\"Limit\")\n                        .HasColumnType(\"bigint\");\n\n                    b.Property<string>(\"QuotaKey\")\n                        .IsRequired()\n                        .HasMaxLength(128)\n                        .HasColumnType(\"character varying(128)\");\n\n                    b.Property<DateTime?>(\"UpdatedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.HasKey(\"Id\");\n\n                    b.HasIndex(\"BusinessId\", \"QuotaKey\")\n                        .IsUnique();\n\n                    b.ToTable(\"BusinessQuotaOverrides\");\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.Entitlements.Models.BusinessUsageCounter\", b =>\n                {\n                    b.Property<Guid>(\"Id\")\n                        .ValueGeneratedOnAdd()\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<Guid>(\"BusinessId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<long>(\"Consumed\")\n                        .HasColumnType(\"bigint\");\n\n                    b.Property<DateTime>(\"CreatedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<int>(\"Period\")\n                        .HasColumnType(\"integer\");\n\n                    b.Property<string>(\"QuotaKey\")\n                        .IsRequired()\n                        .HasMaxLength(128)\n                        .HasColumnType(\"character varying(128)\");\n\n                    b.Property<DateTime>(\"UpdatedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<DateTime>(\"WindowStartUtc\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.HasKey(\"Id\");\n\n                    b.HasIndex(\"BusinessId\", \"QuotaKey\", \"Period\", \"WindowStartUtc\")\n                        .IsUnique();\n\n                    b.ToTable(\"BusinessUsageCounters\");\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.Entitlements.Models.PlanQuota\", b =>\n                {\n                    b.Property<Guid>(\"Id\")\n                        .ValueGeneratedOnAdd()\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<DateTime>(\"CreatedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<string>(\"DenialMessage\")\n                        .HasMaxLength(256)\n                        .HasColumnType(\"character varying(256)\");\n\n                    b.Property<long>(\"Limit\")\n                        .HasColumnType(\"bigint\");\n\n                    b.Property<int>(\"Period\")\n                        .HasColumnType(\"integer\");\n\n                    b.Property<Guid>(\"PlanId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<string>(\"QuotaKey\")\n                        .IsRequired()\n                        .HasMaxLength(128)\n                        .HasColumnType(\"character varying(128)\");\n\n                    b.Property<DateTime?>(\"UpdatedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.HasKey(\"Id\");\n\n                    b.HasIndex(\"PlanId\", \"QuotaKey\")\n                        .IsUnique();\n\n                    b.ToTable(\"PlanQuotas\");\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.Inbox.Models.ChatSessionState\", b =>\n                {\n                    b.Property<Guid>(\"Id\")\n                        .ValueGeneratedOnAdd()\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<Guid>(\"BusinessId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<Guid>(\"ContactId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<DateTime>(\"LastUpdatedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<string>(\"Mode\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"UpdatedBy\")\n                        .HasColumnType(\"text\");\n\n                    b.HasKey(\"Id\");\n\n                    b.ToTable(\"ChatSessionStates\");\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.Inbox.Models.ContactRead\", b =>\n                {\n                    b.Property<Guid>(\"Id\")\n                        .ValueGeneratedOnAdd()\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<Guid>(\"BusinessId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<Guid>(\"ContactId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<DateTime>(\"LastReadAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<Guid>(\"UserId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.HasKey(\"Id\");\n\n                    b.HasIndex(\"ContactId\", \"UserId\")\n                        .IsUnique();\n\n                    b.HasIndex(\"BusinessId\", \"UserId\", \"ContactId\")\n                        .IsUnique()\n                        .HasDatabaseName(\"ux_contactreads_biz_user_contact\");\n\n                    b.ToTable(\"ContactReads\");\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.Inbox.Models.QuickReply\", b =>\n                {\n                    b.Property<Guid>(\"Id\")\n                        .ValueGeneratedOnAdd()\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<string>(\"Body\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<Guid>(\"BusinessId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<DateTime>(\"CreatedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<string>(\"CreatedBy\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<bool>(\"IsActive\")\n                        .HasColumnType(\"boolean\");\n\n                    b.Property<bool>(\"IsDeleted\")\n                        .HasColumnType(\"boolean\");\n\n                    b.Property<string>(\"Language\")\n                        .HasMaxLength(8)\n                        .HasColumnType(\"character varying(8)\");\n\n                    b.Property<Guid?>(\"OwnerUserId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<int>(\"Scope\")\n                        .HasColumnType(\"integer\");\n\n                    b.Property<string>(\"TagsCsv\")\n                        .HasMaxLength(240)\n                        .HasColumnType(\"character varying(240)\");\n\n                    b.Property<string>(\"Title\")\n                        .IsRequired()\n                        .HasMaxLength(120)\n                        .HasColumnType(\"character varying(120)\");\n\n                    b.Property<DateTime>(\"UpdatedAt\")\n                        .ValueGeneratedOnAdd()\n                        .HasColumnType(\"timestamp with time zone\")\n                        .HasDefaultValueSql(\"NOW()\");\n\n                    b.Property<string>(\"UpdatedBy\")\n                        .HasColumnType(\"text\");\n\n                    b.HasKey(\"Id\");\n\n                    b.HasIndex(\"UpdatedAt\");\n\n                    b.HasIndex(\"BusinessId\", \"OwnerUserId\", \"IsActive\");\n\n                    b.HasIndex(\"BusinessId\", \"Scope\", \"IsActive\");\n\n                    b.ToTable(\"QuickReplies\");\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.MessageManagement.DTOs.MessageStatusLog\", b =>\n                {\n                    b.Property<Guid>(\"Id\")\n                        .ValueGeneratedOnAdd()\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<Guid?>(\"BusinessId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<Guid?>(\"CampaignId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<string>(\"Channel\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<DateTime>(\"CreatedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<string>(\"CustomerProfileName\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<DateTime?>(\"DeliveredAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<int?>(\"ErrorCode\")\n                        .HasColumnType(\"integer\");\n\n                    b.Property<string>(\"ErrorMessage\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<bool>(\"IsSessionOpen\")\n                        .HasColumnType(\"boolean\");\n\n                    b.Property<string>(\"MessageId\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"MessageType\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<long?>(\"MetaTimestamp\")\n                        .HasColumnType(\"bigint\");\n\n                    b.Property<string>(\"RawPayload\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<DateTime?>(\"ReadAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<string>(\"RecipientNumber\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<DateTime?>(\"SentAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<string>(\"Status\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"TemplateCategory\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"TemplateName\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<Guid?>(\"UserId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.HasKey(\"Id\");\n\n                    b.HasIndex(\"BusinessId\");\n\n                    b.HasIndex(\"CampaignId\");\n\n                    b.HasIndex(\"UserId\");\n\n                    b.ToTable(\"MessageStatusLogs\");\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.Payment.Models.Coupon\", b =>\n                {\n                    b.Property<Guid>(\"Id\")\n                        .ValueGeneratedOnAdd()\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<string>(\"Code\")\n                        .IsRequired()\n                        .HasMaxLength(100)\n                        .HasColumnType(\"character varying(100)\");\n\n                    b.Property<string>(\"Description\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<int>(\"DiscountType\")\n                        .HasColumnType(\"integer\");\n\n                    b.Property<decimal>(\"DiscountValue\")\n                        .HasColumnType(\"numeric(18,2)\");\n\n                    b.Property<bool>(\"IsActive\")\n                        .HasColumnType(\"boolean\");\n\n                    b.Property<int?>(\"MaxRedemptions\")\n                        .HasColumnType(\"integer\");\n\n                    b.Property<int?>(\"MaxRedemptionsPerBusiness\")\n                        .HasColumnType(\"integer\");\n\n                    b.Property<string>(\"MetaJson\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<Guid?>(\"PlanId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<DateTime?>(\"ValidFromUtc\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<DateTime?>(\"ValidToUtc\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.HasKey(\"Id\");\n\n                    b.HasIndex(\"Code\")\n                        .IsUnique();\n\n                    b.HasIndex(\"PlanId\");\n\n                    b.ToTable(\"Coupons\", (string)null);\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.Payment.Models.Invoice\", b =>\n                {\n                    b.Property<Guid>(\"Id\")\n                        .ValueGeneratedOnAdd()\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<string>(\"AppliedCouponCode\")\n                        .HasMaxLength(100)\n                        .HasColumnType(\"character varying(100)\");\n\n                    b.Property<int?>(\"BillingCycle\")\n                        .HasColumnType(\"integer\");\n\n                    b.Property<Guid>(\"BusinessId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<string>(\"Currency\")\n                        .IsRequired()\n                        .HasMaxLength(10)\n                        .HasColumnType(\"character varying(10)\");\n\n                    b.Property<decimal>(\"DiscountAmount\")\n                        .HasColumnType(\"numeric(18,2)\");\n\n                    b.Property<DateTime?>(\"DueAtUtc\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<string>(\"InvoiceNumber\")\n                        .IsRequired()\n                        .HasMaxLength(100)\n                        .HasColumnType(\"character varying(100)\");\n\n                    b.Property<DateTime>(\"IssuedAtUtc\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<string>(\"Notes\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<DateTime?>(\"PaidAtUtc\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<Guid?>(\"PlanId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<int>(\"Status\")\n                        .HasColumnType(\"integer\");\n\n                    b.Property<Guid?>(\"SubscriptionId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<decimal>(\"SubtotalAmount\")\n                        .HasColumnType(\"numeric(18,2)\");\n\n                    b.Property<decimal>(\"TaxAmount\")\n                        .HasColumnType(\"numeric(18,2)\");\n\n                    b.Property<string>(\"TaxBreakdownJson\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<decimal>(\"TotalAmount\")\n                        .HasColumnType(\"numeric(18,2)\");\n\n                    b.HasKey(\"Id\");\n\n                    b.HasIndex(\"BusinessId\");\n\n                    b.HasIndex(\"InvoiceNumber\")\n                        .IsUnique();\n\n                    b.HasIndex(\"PlanId\");\n\n                    b.HasIndex(\"SubscriptionId\");\n\n                    b.ToTable(\"Invoices\", (string)null);\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.Payment.Models.InvoiceLineItem\", b =>\n                {\n                    b.Property<Guid>(\"Id\")\n                        .ValueGeneratedOnAdd()\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<string>(\"Description\")\n                        .IsRequired()\n                        .HasMaxLength(500)\n                        .HasColumnType(\"character varying(500)\");\n\n                    b.Property<Guid>(\"InvoiceId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<decimal>(\"LineTotal\")\n                        .HasColumnType(\"numeric(18,2)\");\n\n                    b.Property<string>(\"MetaJson\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<decimal>(\"Quantity\")\n                        .HasColumnType(\"numeric(18,2)\");\n\n                    b.Property<decimal>(\"UnitPrice\")\n                        .HasColumnType(\"numeric(18,2)\");\n\n                    b.HasKey(\"Id\");\n\n                    b.HasIndex(\"InvoiceId\");\n\n                    b.ToTable(\"InvoiceLineItems\", (string)null);\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.Payment.Models.PaymentTransaction\", b =>\n                {\n                    b.Property<Guid>(\"Id\")\n                        .ValueGeneratedOnAdd()\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<decimal>(\"Amount\")\n                        .HasColumnType(\"numeric(18,2)\");\n\n                    b.Property<Guid>(\"BusinessId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<DateTime?>(\"CompletedAtUtc\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<DateTime>(\"CreatedAtUtc\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<string>(\"Currency\")\n                        .IsRequired()\n                        .HasMaxLength(10)\n                        .HasColumnType(\"character varying(10)\");\n\n                    b.Property<string>(\"FailureReason\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"Gateway\")\n                        .IsRequired()\n                        .HasMaxLength(50)\n                        .HasColumnType(\"character varying(50)\");\n\n                    b.Property<string>(\"GatewayOrderId\")\n                        .HasMaxLength(200)\n                        .HasColumnType(\"character varying(200)\");\n\n                    b.Property<string>(\"GatewayPaymentId\")\n                        .HasMaxLength(200)\n                        .HasColumnType(\"character varying(200)\");\n\n                    b.Property<string>(\"GatewaySignature\")\n                        .HasMaxLength(500)\n                        .HasColumnType(\"character varying(500)\");\n\n                    b.Property<Guid?>(\"InvoiceId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<string>(\"MetaJson\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<int>(\"Status\")\n                        .HasColumnType(\"integer\");\n\n                    b.Property<Guid?>(\"SubscriptionId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.HasKey(\"Id\");\n\n                    b.HasIndex(\"BusinessId\");\n\n                    b.HasIndex(\"InvoiceId\");\n\n                    b.HasIndex(\"SubscriptionId\");\n\n                    b.ToTable(\"PaymentTransactions\", (string)null);\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.Payment.Models.Subscription\", b =>\n                {\n                    b.Property<Guid>(\"Id\")\n                        .ValueGeneratedOnAdd()\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<bool>(\"AutoRenew\")\n                        .HasColumnType(\"boolean\");\n\n                    b.Property<int>(\"BillingCycle\")\n                        .HasColumnType(\"integer\");\n\n                    b.Property<Guid>(\"BusinessId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<bool>(\"CancelAtPeriodEnd\")\n                        .HasColumnType(\"boolean\");\n\n                    b.Property<DateTime>(\"CurrentPeriodEndUtc\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<DateTime>(\"CurrentPeriodStartUtc\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<string>(\"GatewayCustomerId\")\n                        .HasMaxLength(200)\n                        .HasColumnType(\"character varying(200)\");\n\n                    b.Property<string>(\"GatewaySubscriptionId\")\n                        .HasMaxLength(200)\n                        .HasColumnType(\"character varying(200)\");\n\n                    b.Property<string>(\"Notes\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<Guid>(\"PlanId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<int>(\"Status\")\n                        .HasColumnType(\"integer\");\n\n                    b.Property<DateTime?>(\"TrialEndsAtUtc\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.HasKey(\"Id\");\n\n                    b.HasIndex(\"BusinessId\");\n\n                    b.HasIndex(\"PlanId\");\n\n                    b.ToTable(\"Subscriptions\", (string)null);\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.PlanManagement.Models.PlanFeatureMatrix\", b =>\n                {\n                    b.Property<Guid>(\"Id\")\n                        .ValueGeneratedOnAdd()\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<string>(\"FeatureName\")\n                        .IsRequired()\n                        .HasMaxLength(50)\n                        .HasColumnType(\"character varying(50)\");\n\n                    b.Property<bool>(\"IsEnabled\")\n                        .HasColumnType(\"boolean\");\n\n                    b.Property<string>(\"PlanName\")\n                        .IsRequired()\n                        .HasMaxLength(20)\n                        .HasColumnType(\"character varying(20)\");\n\n                    b.HasKey(\"Id\");\n\n                    b.ToTable(\"PlanFeatureMatrix\");\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.TemplateModule.Models.TemplateDraft\", b =>\n                {\n                    b.Property<Guid>(\"Id\")\n                        .ValueGeneratedOnAdd()\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<Guid>(\"BusinessId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<string>(\"Category\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<DateTime>(\"CreatedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<string>(\"CreatedByUserId\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"DefaultLanguage\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"Key\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<DateTime>(\"UpdatedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.HasKey(\"Id\");\n\n                    b.HasIndex(\"CreatedAt\")\n                        .HasDatabaseName(\"IX_TemplateDrafts_CreatedAt\");\n\n                    b.HasIndex(\"BusinessId\", \"Key\")\n                        .IsUnique()\n                        .HasDatabaseName(\"UX_TemplateDrafts_Biz_Key\");\n\n                    b.HasIndex(\"BusinessId\", \"UpdatedAt\")\n                        .HasDatabaseName(\"IX_TemplateDrafts_Biz_UpdatedAt\");\n\n                    b.ToTable(\"TemplateDrafts\");\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.TemplateModule.Models.TemplateDraftVariant\", b =>\n                {\n                    b.Property<Guid>(\"Id\")\n                        .ValueGeneratedOnAdd()\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<string>(\"BodyText\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"ButtonsJson\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"ExampleParamsJson\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"FooterText\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"HeaderMediaLocalUrl\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"HeaderText\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"HeaderType\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<bool>(\"IsReadyForSubmission\")\n                        .HasColumnType(\"boolean\");\n\n                    b.Property<string>(\"Language\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<Guid>(\"TemplateDraftId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<string>(\"ValidationErrorsJson\")\n                        .HasColumnType(\"text\");\n\n                    b.HasKey(\"Id\");\n\n                    b.HasIndex(\"Language\")\n                        .HasDatabaseName(\"IX_TDraftVariants_Language\");\n\n                    b.HasIndex(\"TemplateDraftId\", \"IsReadyForSubmission\")\n                        .HasDatabaseName(\"IX_TDraftVariants_Draft_Ready\");\n\n                    b.HasIndex(\"TemplateDraftId\", \"Language\")\n                        .IsUnique()\n                        .HasDatabaseName(\"UX_TDraftVariants_Draft_Language\");\n\n                    b.ToTable(\"TemplateDraftVariants\");\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.TemplateModule.Models.TemplateLibraryItem\", b =>\n                {\n                    b.Property<Guid>(\"Id\")\n                        .ValueGeneratedOnAdd()\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<string>(\"Category\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"Industry\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<bool>(\"IsFeatured\")\n                        .HasColumnType(\"boolean\");\n\n                    b.Property<string>(\"Key\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"TagsJson\")\n                        .HasColumnType(\"text\");\n\n                    b.HasKey(\"Id\");\n\n                    b.HasIndex(\"Category\")\n                        .HasDatabaseName(\"IX_TLibrary_Category\");\n\n                    b.HasIndex(\"Industry\", \"IsFeatured\")\n                        .HasDatabaseName(\"IX_TLibrary_Industry_Featured\");\n\n                    b.HasIndex(\"Industry\", \"Key\")\n                        .IsUnique()\n                        .HasDatabaseName(\"UX_TLibrary_Industry_Key\");\n\n                    b.ToTable(\"TemplateLibraryItems\");\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.TemplateModule.Models.TemplateLibraryVariant\", b =>\n                {\n                    b.Property<Guid>(\"Id\")\n                        .ValueGeneratedOnAdd()\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<string>(\"BodyText\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"ButtonsJson\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"ExampleParamsJson\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"FooterText\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"HeaderDemoUrl\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"HeaderText\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"HeaderType\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"Language\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<Guid>(\"LibraryItemId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.HasKey(\"Id\");\n\n                    b.HasIndex(\"Language\")\n                        .HasDatabaseName(\"IX_TLibraryVariants_Language\");\n\n                    b.HasIndex(\"LibraryItemId\", \"Language\")\n                        .IsUnique()\n                        .HasDatabaseName(\"UX_TLibraryVariants_Item_Lang\");\n\n                    b.ToTable(\"TemplateLibraryVariants\");\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.Tracking.Models.TrackingLog\", b =>\n                {\n                    b.Property<Guid>(\"Id\")\n                        .ValueGeneratedOnAdd()\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<string>(\"Browser\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<Guid>(\"BusinessId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<string>(\"ButtonText\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"CTAType\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<Guid?>(\"CampaignId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<Guid?>(\"CampaignSendLogId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<string>(\"City\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<DateTime>(\"ClickedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<string>(\"ClickedVia\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<Guid?>(\"ContactId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<string>(\"ContactPhone\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"Country\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"DeviceType\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<bool>(\"FollowUpSent\")\n                        .HasColumnType(\"boolean\");\n\n                    b.Property<string>(\"IPAddress\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"LastInteractionType\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"MessageId\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<Guid?>(\"MessageLogId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<string>(\"Referrer\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<Guid?>(\"SessionId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<Guid?>(\"SourceId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<string>(\"SourceType\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<Guid?>(\"StepId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<string>(\"TemplateId\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<Guid?>(\"ThreadId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.HasKey(\"Id\");\n\n                    b.HasIndex(\"CampaignId\")\n                        .HasDatabaseName(\"IX_TrackingLogs_Campaign\");\n\n                    b.HasIndex(\"CampaignSendLogId\")\n                        .HasDatabaseName(\"IX_TrackingLogs_SendLog\");\n\n                    b.HasIndex(\"ContactId\");\n\n                    b.HasIndex(\"MessageLogId\")\n                        .HasDatabaseName(\"IX_TrackingLogs_MessageLog\");\n\n                    b.ToTable(\"TrackingLogs\");\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.Webhooks.Models.FailedWebhookLog\", b =>\n                {\n                    b.Property<Guid>(\"Id\")\n                        .ValueGeneratedOnAdd()\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<DateTime>(\"CreatedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<string>(\"ErrorMessage\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"FailureType\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"RawJson\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"SourceModule\")\n                        .HasColumnType(\"text\");\n\n                    b.HasKey(\"Id\");\n\n                    b.ToTable(\"FailedWebhookLogs\");\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.Webhooks.Models.WebhookSettings\", b =>\n                {\n                    b.Property<Guid>(\"Id\")\n                        .ValueGeneratedOnAdd()\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<bool>(\"AutoCleanupEnabled\")\n                        .HasColumnType(\"boolean\");\n\n                    b.Property<DateTime?>(\"LastCleanupAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.HasKey(\"Id\");\n\n                    b.ToTable(\"WebhookSettings\");\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.WhatsAppSettings.Models.WhatsAppPhoneNumber\", b =>\n                {\n                    b.Property<Guid>(\"Id\")\n                        .ValueGeneratedOnAdd()\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<Guid>(\"BusinessId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<DateTime>(\"CreatedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<bool>(\"IsActive\")\n                        .HasColumnType(\"boolean\");\n\n                    b.Property<bool>(\"IsDefault\")\n                        .HasColumnType(\"boolean\");\n\n                    b.Property<string>(\"PhoneNumberId\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"Provider\")\n                        .IsRequired()\n                        .HasColumnType(\"character varying(50)\");\n\n                    b.Property<string>(\"SenderDisplayName\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<DateTime?>(\"UpdatedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<string>(\"WhatsAppBusinessNumber\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.HasKey(\"Id\");\n\n                    b.HasIndex(\"BusinessId\", \"Provider\", \"PhoneNumberId\")\n                        .IsUnique()\n                        .HasDatabaseName(\"UX_WhatsappPhoneNumbers_Bus_Prov_PhoneId\");\n\n                    b.ToTable(\"WhatsAppPhoneNumbers\", (string)null);\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.xbTimelines.Models.LeadTimeline\", b =>\n                {\n                    b.Property<int>(\"Id\")\n                        .ValueGeneratedOnAdd()\n                        .HasColumnType(\"integer\");\n\n                    NpgsqlPropertyBuilderExtensions.UseIdentityByDefaultColumn(b.Property<int>(\"Id\"));\n\n                    b.Property<Guid>(\"BusinessId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<Guid?>(\"CTASourceId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<string>(\"CTASourceType\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"CTAType\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"Category\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<Guid>(\"ContactId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<DateTime>(\"CreatedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<string>(\"CreatedBy\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"Data\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"Description\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"EventType\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<bool>(\"IsSystemGenerated\")\n                        .HasColumnType(\"boolean\");\n\n                    b.Property<Guid?>(\"ReferenceId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<string>(\"Source\")\n                        .HasColumnType(\"text\");\n\n                    b.HasKey(\"Id\");\n\n                    b.HasIndex(\"BusinessId\");\n\n                    b.HasIndex(\"ContactId\");\n\n                    b.ToTable(\"LeadTimelines\");\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Models.BusinessModel.BusinessPlanInfo\", b =>\n                {\n                    b.Property<Guid>(\"Id\")\n                        .ValueGeneratedOnAdd()\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<Guid>(\"BusinessId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<DateTime>(\"CreatedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<int>(\"Plan\")\n                        .HasColumnType(\"integer\");\n\n                    b.Property<DateTime>(\"QuotaResetDate\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<int>(\"RemainingMessages\")\n                        .HasColumnType(\"integer\");\n\n                    b.Property<int>(\"TotalMonthlyQuota\")\n                        .HasColumnType(\"integer\");\n\n                    b.Property<DateTime>(\"UpdatedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<decimal>(\"WalletBalance\")\n                        .HasColumnType(\"numeric\");\n\n                    b.HasKey(\"Id\");\n\n                    b.HasIndex(\"BusinessId\")\n                        .IsUnique();\n\n                    b.ToTable(\"BusinessPlanInfos\");\n                });\n\n            modelBuilder.Entity(\"xbytechat_api.Features.Billing.Models.ProviderBillingEvent\", b =>\n                {\n                    b.Property<Guid>(\"Id\")\n                        .ValueGeneratedOnAdd()\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<Guid>(\"BusinessId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<string>(\"ConversationCategory\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"ConversationId\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<DateTimeOffset>(\"CreatedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<string>(\"EventType\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<bool?>(\"IsChargeable\")\n                        .HasColumnType(\"boolean\");\n\n                    b.Property<Guid?>(\"MessageLogId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<DateTimeOffset>(\"OccurredAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<string>(\"PayloadJson\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<decimal?>(\"PriceAmount\")\n                        .HasColumnType(\"numeric\");\n\n                    b.Property<string>(\"PriceCurrency\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"Provider\")\n                        .IsRequired()\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"ProviderMessageId\")\n                        .HasColumnType(\"text\");\n\n                    b.HasKey(\"Id\");\n\n                    b.HasIndex(\"BusinessId\", \"ConversationId\")\n                        .HasDatabaseName(\"IX_Billing_BizConversation\")\n                        .HasFilter(\"\\\"ConversationId\\\" IS NOT NULL\");\n\n                    b.HasIndex(\"BusinessId\", \"ProviderMessageId\")\n                        .HasDatabaseName(\"IX_Billing_BizProviderMessage\")\n                        .HasFilter(\"\\\"ProviderMessageId\\\" IS NOT NULL\");\n\n                    b.HasIndex(\"BusinessId\", \"EventType\", \"OccurredAt\")\n                        .HasDatabaseName(\"IX_Billing_BizEventTime\");\n\n                    b.HasIndex(\"BusinessId\", \"Provider\", \"ProviderMessageId\", \"EventType\")\n                        .IsUnique()\n                        .HasDatabaseName(\"UX_ProviderBillingEvents_UniqueEvent\")\n                        .HasFilter(\"\\\"ProviderMessageId\\\" IS NOT NULL\");\n\n                    b.ToTable(\"ProviderBillingEvents\");\n                });\n\n            modelBuilder.Entity(\"xbytechat_api.WhatsAppSettings.Models.WhatsAppSettingEntity\", b =>\n                {\n                    b.Property<Guid>(\"Id\")\n                        .ValueGeneratedOnAdd()\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<string>(\"ApiKey\")\n                        .IsRequired()\n                        .HasMaxLength(1000)\n                        .HasColumnType(\"character varying(1000)\");\n\n                    b.Property<string>(\"ApiUrl\")\n                        .IsRequired()\n                        .HasMaxLength(500)\n                        .HasColumnType(\"character varying(500)\");\n\n                    b.Property<Guid>(\"BusinessId\")\n                        .HasColumnType(\"uuid\");\n\n                    b.Property<DateTime>(\"CreatedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<bool>(\"IsActive\")\n                        .HasColumnType(\"boolean\");\n\n                    b.Property<string>(\"Provider\")\n                        .IsRequired()\n                        .HasMaxLength(50)\n                        .HasColumnType(\"character varying(50)\");\n\n                    b.Property<string>(\"SenderDisplayName\")\n                        .HasMaxLength(100)\n                        .HasColumnType(\"character varying(100)\");\n\n                    b.Property<DateTime?>(\"UpdatedAt\")\n                        .HasColumnType(\"timestamp with time zone\");\n\n                    b.Property<string>(\"WabaId\")\n                        .HasColumnType(\"text\");\n\n                    b.Property<string>(\"WebhookCallbackUrl\")\n                        .HasMaxLength(1000)\n                        .HasColumnType(\"character varying(1000)\");\n\n                    b.Property<string>(\"WebhookSecret\")\n                        .HasMaxLength(200)\n                        .HasColumnType(\"character varying(200)\");\n\n                    b.Property<string>(\"WebhookVerifyToken\")\n                        .HasMaxLength(200)\n                        .HasColumnType(\"character varying(200)\");\n\n                    b.HasKey(\"Id\");\n\n                    b.HasAlternateKey(\"BusinessId\", \"Provider\")\n                        .HasName(\"AK_WhatsAppSettings_BusinessId_Provider\");\n\n                    b.HasIndex(\"Provider\", \"WabaId\")\n                        .HasDatabaseName(\"IX_WhatsAppSettings_Provider_WabaId\");\n\n                    b.HasIndex(\"Provider\", \"WebhookCallbackUrl\")\n                        .HasDatabaseName(\"IX_WhatsAppSettings_Provider_CallbackUrl\");\n\n                    b.HasIndex(\"BusinessId\", \"Provider\", \"IsActive\")\n                        .HasDatabaseName(\"IX_WhatsAppSettings_Business_Provider_IsActive\");\n\n                    b.ToTable(\"WhatsAppSettings\", (string)null);\n                });\n\n            modelBuilder.Entity(\"ContactTag\", b =>\n                {\n                    b.HasOne(\"xbytechat.api.CRM.Models.Contact\", \"Contact\")\n                        .WithMany(\"ContactTags\")\n                        .HasForeignKey(\"ContactId\")\n                        .OnDelete(DeleteBehavior.Cascade)\n                        .IsRequired();\n\n                    b.HasOne(\"xbytechat.api.CRM.Models.Tag\", \"Tag\")\n                        .WithMany(\"ContactTags\")\n                        .HasForeignKey(\"TagId\")\n                        .OnDelete(DeleteBehavior.Cascade)\n                        .IsRequired();\n\n                    b.Navigation(\"Contact\");\n\n                    b.Navigation(\"Tag\");\n                });\n\n            modelBuilder.Entity(\"MessageLog\", b =>\n                {\n                    b.HasOne(\"xbytechat.api.Features.BusinessModule.Models.Business\", \"Business\")\n                        .WithMany()\n                        .HasForeignKey(\"BusinessId\")\n                        .OnDelete(DeleteBehavior.Cascade)\n                        .IsRequired();\n\n                    b.HasOne(\"xbytechat.api.Features.CampaignModule.Models.Campaign\", \"SourceCampaign\")\n                        .WithMany(\"MessageLogs\")\n                        .HasForeignKey(\"CampaignId\")\n                        .OnDelete(DeleteBehavior.Cascade);\n\n                    b.HasOne(\"xbytechat.api.CRM.Models.Contact\", \"Contact\")\n                        .WithMany()\n                        .HasForeignKey(\"ContactId\");\n\n                    b.Navigation(\"Business\");\n\n                    b.Navigation(\"Contact\");\n\n                    b.Navigation(\"SourceCampaign\");\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.AuthModule.Models.User\", b =>\n                {\n                    b.HasOne(\"xbytechat.api.Features.BusinessModule.Models.Business\", \"Business\")\n                        .WithMany(\"Users\")\n                        .HasForeignKey(\"BusinessId\");\n\n                    b.HasOne(\"xbytechat.api.Features.AccessControl.Models.Role\", \"Role\")\n                        .WithMany(\"Users\")\n                        .HasForeignKey(\"RoleId\");\n\n                    b.Navigation(\"Business\");\n\n                    b.Navigation(\"Role\");\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.CRM.Models.Contact\", b =>\n                {\n                    b.HasOne(\"xbytechat.api.Features.BusinessModule.Models.Business\", \"Business\")\n                        .WithMany()\n                        .HasForeignKey(\"BusinessId\")\n                        .OnDelete(DeleteBehavior.Cascade)\n                        .IsRequired();\n\n                    b.Navigation(\"Business\");\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.AccessControl.Models.PlanPermission\", b =>\n                {\n                    b.HasOne(\"xbytechat.api.Features.AccessControl.Models.Permission\", \"Permission\")\n                        .WithMany(\"PlanPermissions\")\n                        .HasForeignKey(\"PermissionId\")\n                        .OnDelete(DeleteBehavior.Cascade)\n                        .IsRequired();\n\n                    b.HasOne(\"xbytechat.api.Features.AccessControl.Models.Plan\", \"Plan\")\n                        .WithMany(\"PlanPermissions\")\n                        .HasForeignKey(\"PlanId\")\n                        .OnDelete(DeleteBehavior.Cascade)\n                        .IsRequired();\n\n                    b.Navigation(\"Permission\");\n\n                    b.Navigation(\"Plan\");\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.AccessControl.Models.RolePermission\", b =>\n                {\n                    b.HasOne(\"xbytechat.api.Features.AccessControl.Models.Permission\", \"Permission\")\n                        .WithMany(\"RolePermissions\")\n                        .HasForeignKey(\"PermissionId\")\n                        .OnDelete(DeleteBehavior.Cascade)\n                        .IsRequired();\n\n                    b.HasOne(\"xbytechat.api.Features.AccessControl.Models.Role\", \"Role\")\n                        .WithMany(\"RolePermissions\")\n                        .HasForeignKey(\"RoleId\")\n                        .OnDelete(DeleteBehavior.Cascade)\n                        .IsRequired();\n\n                    b.Navigation(\"Permission\");\n\n                    b.Navigation(\"Role\");\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.AccessControl.Models.UserPermission\", b =>\n                {\n                    b.HasOne(\"xbytechat.api.Features.AccessControl.Models.Permission\", \"Permission\")\n                        .WithMany(\"UserPermissions\")\n                        .HasForeignKey(\"PermissionId\")\n                        .OnDelete(DeleteBehavior.Cascade)\n                        .IsRequired();\n\n                    b.HasOne(\"xbytechat.api.AuthModule.Models.User\", \"User\")\n                        .WithMany(\"UserPermissions\")\n                        .HasForeignKey(\"UserId\")\n                        .OnDelete(DeleteBehavior.Cascade)\n                        .IsRequired();\n\n                    b.Navigation(\"Permission\");\n\n                    b.Navigation(\"User\");\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.AutoReplyBuilder.Models.AutoReplyFlowEdge\", b =>\n                {\n                    b.HasOne(\"xbytechat.api.Features.AutoReplyBuilder.Flows.Models.AutoReplyFlow\", \"Flow\")\n                        .WithMany()\n                        .HasForeignKey(\"FlowId\")\n                        .OnDelete(DeleteBehavior.Cascade)\n                        .IsRequired();\n\n                    b.Navigation(\"Flow\");\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.AutoReplyBuilder.Models.AutoReplyFlowNode\", b =>\n                {\n                    b.HasOne(\"xbytechat.api.Features.AutoReplyBuilder.Flows.Models.AutoReplyFlow\", \"Flow\")\n                        .WithMany()\n                        .HasForeignKey(\"FlowId\")\n                        .OnDelete(DeleteBehavior.Cascade)\n                        .IsRequired();\n\n                    b.OwnsOne(\"xbytechat.api.Features.AutoReplyBuilder.Models.Position\", \"Position\", b1 =>\n                        {\n                            b1.Property<Guid>(\"AutoReplyFlowNodeId\")\n                                .HasColumnType(\"uuid\");\n\n                            b1.Property<double>(\"X\")\n                                .HasColumnType(\"double precision\");\n\n                            b1.Property<double>(\"Y\")\n                                .HasColumnType(\"double precision\");\n\n                            b1.HasKey(\"AutoReplyFlowNodeId\");\n\n                            b1.ToTable(\"AutoReplyFlowNode\");\n\n                            b1.WithOwner()\n                                .HasForeignKey(\"AutoReplyFlowNodeId\");\n                        });\n\n                    b.Navigation(\"Flow\");\n\n                    b.Navigation(\"Position\")\n                        .IsRequired();\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.BusinessModule.Models.Business\", b =>\n                {\n                    b.HasOne(\"xbytechat.api.Features.AccessControl.Models.Plan\", \"Plan\")\n                        .WithMany(\"Businesses\")\n                        .HasForeignKey(\"PlanId\");\n\n                    b.Navigation(\"Plan\");\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.CTAFlowBuilder.Models.CTAFlowStep\", b =>\n                {\n                    b.HasOne(\"xbytechat.api.Features.CTAFlowBuilder.Models.CTAFlowConfig\", \"Flow\")\n                        .WithMany(\"Steps\")\n                        .HasForeignKey(\"CTAFlowConfigId\")\n                        .OnDelete(DeleteBehavior.Cascade)\n                        .IsRequired();\n\n                    b.Navigation(\"Flow\");\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.CTAFlowBuilder.Models.FlowButtonLink\", b =>\n                {\n                    b.HasOne(\"xbytechat.api.Features.CTAFlowBuilder.Models.CTAFlowStep\", \"Step\")\n                        .WithMany(\"ButtonLinks\")\n                        .HasForeignKey(\"CTAFlowStepId\")\n                        .OnDelete(DeleteBehavior.Cascade)\n                        .IsRequired();\n\n                    b.Navigation(\"Step\");\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.CTAFlowBuilder.Models.FlowExecutionLog\", b =>\n                {\n                    b.HasOne(\"xbytechat.api.Features.CTAFlowBuilder.Models.CTAFlowConfig\", null)\n                        .WithMany()\n                        .HasForeignKey(\"FlowId\")\n                        .OnDelete(DeleteBehavior.Cascade);\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.CampaignModule.Models.Audience\", b =>\n                {\n                    b.HasOne(\"xbytechat.api.Features.CampaignModule.Models.Campaign\", \"Campaign\")\n                        .WithMany(\"Audiences\")\n                        .HasForeignKey(\"CampaignId\")\n                        .OnDelete(DeleteBehavior.Cascade);\n\n                    b.HasOne(\"xbytechat.api.Features.CampaignModule.Models.CsvBatch\", \"CsvBatch\")\n                        .WithMany()\n                        .HasForeignKey(\"CsvBatchId\")\n                        .OnDelete(DeleteBehavior.SetNull);\n\n                    b.Navigation(\"Campaign\");\n\n                    b.Navigation(\"CsvBatch\");\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.CampaignModule.Models.AudienceMember\", b =>\n                {\n                    b.HasOne(\"xbytechat.api.Features.CampaignModule.Models.Audience\", \"Audience\")\n                        .WithMany(\"Members\")\n                        .HasForeignKey(\"AudienceId\")\n                        .OnDelete(DeleteBehavior.Cascade)\n                        .IsRequired();\n\n                    b.Navigation(\"Audience\");\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.CampaignModule.Models.Campaign\", b =>\n                {\n                    b.HasOne(\"xbytechat.api.Features.BusinessModule.Models.Business\", \"Business\")\n                        .WithMany(\"Campaigns\")\n                        .HasForeignKey(\"BusinessId\")\n                        .OnDelete(DeleteBehavior.Cascade)\n                        .IsRequired();\n\n                    b.HasOne(\"xbytechat.api.Features.CTAFlowBuilder.Models.CTAFlowConfig\", \"CTAFlowConfig\")\n                        .WithMany()\n                        .HasForeignKey(\"CTAFlowConfigId\")\n                        .OnDelete(DeleteBehavior.Restrict);\n\n                    b.HasOne(\"xbytechat.api.Features.CTAManagement.Models.CTADefinition\", \"Cta\")\n                        .WithMany()\n                        .HasForeignKey(\"CtaId\");\n\n                    b.HasOne(\"xbytechat.api.Features.CampaignModule.Models.Campaign\", \"SourceCampaign\")\n                        .WithMany()\n                        .HasForeignKey(\"SourceCampaignId\");\n\n                    b.Navigation(\"Business\");\n\n                    b.Navigation(\"CTAFlowConfig\");\n\n                    b.Navigation(\"Cta\");\n\n                    b.Navigation(\"SourceCampaign\");\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.CampaignModule.Models.CampaignButton\", b =>\n                {\n                    b.HasOne(\"xbytechat.api.Features.CampaignModule.Models.Campaign\", \"Campaign\")\n                        .WithMany(\"MultiButtons\")\n                        .HasForeignKey(\"CampaignId\")\n                        .OnDelete(DeleteBehavior.Cascade)\n                        .IsRequired();\n\n                    b.Navigation(\"Campaign\");\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.CampaignModule.Models.CampaignFlowOverride\", b =>\n                {\n                    b.HasOne(\"xbytechat.api.Features.CampaignModule.Models.Campaign\", \"Campaign\")\n                        .WithMany()\n                        .HasForeignKey(\"CampaignId\")\n                        .OnDelete(DeleteBehavior.Cascade)\n                        .IsRequired();\n\n                    b.Navigation(\"Campaign\");\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.CampaignModule.Models.CampaignRecipient\", b =>\n                {\n                    b.HasOne(\"xbytechat.api.Features.CampaignModule.Models.AudienceMember\", \"AudienceMember\")\n                        .WithMany()\n                        .HasForeignKey(\"AudienceMemberId\")\n                        .OnDelete(DeleteBehavior.SetNull);\n\n                    b.HasOne(\"xbytechat.api.Features.BusinessModule.Models.Business\", \"Business\")\n                        .WithMany()\n                        .HasForeignKey(\"BusinessId\")\n                        .OnDelete(DeleteBehavior.Restrict)\n                        .IsRequired();\n\n                    b.HasOne(\"xbytechat.api.Features.CampaignModule.Models.Campaign\", \"Campaign\")\n                        .WithMany(\"Recipients\")\n                        .HasForeignKey(\"CampaignId\")\n                        .OnDelete(DeleteBehavior.Cascade)\n                        .IsRequired();\n\n                    b.HasOne(\"xbytechat.api.CRM.Models.Contact\", \"Contact\")\n                        .WithMany()\n                        .HasForeignKey(\"ContactId\")\n                        .OnDelete(DeleteBehavior.SetNull);\n\n                    b.Navigation(\"AudienceMember\");\n\n                    b.Navigation(\"Business\");\n\n                    b.Navigation(\"Campaign\");\n\n                    b.Navigation(\"Contact\");\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.CampaignModule.Models.CampaignVariableMap\", b =>\n                {\n                    b.HasOne(\"xbytechat.api.Features.CampaignModule.Models.Campaign\", \"Campaign\")\n                        .WithMany(\"VariableMaps\")\n                        .HasForeignKey(\"CampaignId\")\n                        .OnDelete(DeleteBehavior.Cascade)\n                        .IsRequired();\n\n                    b.Navigation(\"Campaign\");\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.CampaignModule.Models.CsvBatch\", b =>\n                {\n                    b.HasOne(\"xbytechat.api.Features.CampaignModule.Models.Audience\", null)\n                        .WithMany()\n                        .HasForeignKey(\"AudienceId\")\n                        .OnDelete(DeleteBehavior.SetNull);\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.CampaignModule.Models.CsvRow\", b =>\n                {\n                    b.HasOne(\"xbytechat.api.Features.CampaignModule.Models.CsvBatch\", \"Batch\")\n                        .WithMany()\n                        .HasForeignKey(\"BatchId\")\n                        .OnDelete(DeleteBehavior.Cascade)\n                        .IsRequired();\n\n                    b.Navigation(\"Batch\");\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.CampaignTracking.Models.CampaignSendLog\", b =>\n                {\n                    b.HasOne(\"xbytechat.api.Features.CampaignModule.Models.Campaign\", \"Campaign\")\n                        .WithMany(\"SendLogs\")\n                        .HasForeignKey(\"CampaignId\")\n                        .OnDelete(DeleteBehavior.Cascade)\n                        .IsRequired();\n\n                    b.HasOne(\"xbytechat.api.CRM.Models.Contact\", \"Contact\")\n                        .WithMany()\n                        .HasForeignKey(\"ContactId\")\n                        .OnDelete(DeleteBehavior.SetNull);\n\n                    b.HasOne(\"MessageLog\", \"MessageLog\")\n                        .WithMany()\n                        .HasForeignKey(\"MessageLogId\")\n                        .OnDelete(DeleteBehavior.Restrict);\n\n                    b.HasOne(\"xbytechat.api.Features.CampaignModule.Models.CampaignRecipient\", \"Recipient\")\n                        .WithMany(\"SendLogs\")\n                        .HasForeignKey(\"RecipientId\")\n                        .OnDelete(DeleteBehavior.Cascade)\n                        .IsRequired();\n\n                    b.HasOne(\"xbytechat.api.AuthModule.Models.User\", null)\n                        .WithMany(\"SendLogs\")\n                        .HasForeignKey(\"UserId\");\n\n                    b.Navigation(\"Campaign\");\n\n                    b.Navigation(\"Contact\");\n\n                    b.Navigation(\"MessageLog\");\n\n                    b.Navigation(\"Recipient\");\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.MessageManagement.DTOs.MessageStatusLog\", b =>\n                {\n                    b.HasOne(\"xbytechat.api.Features.BusinessModule.Models.Business\", \"Business\")\n                        .WithMany(\"MessageStatusLogs\")\n                        .HasForeignKey(\"BusinessId\");\n\n                    b.HasOne(\"xbytechat.api.Features.CampaignModule.Models.Campaign\", \"Campaign\")\n                        .WithMany(\"MessageStatusLogs\")\n                        .HasForeignKey(\"CampaignId\")\n                        .OnDelete(DeleteBehavior.Cascade);\n\n                    b.HasOne(\"xbytechat.api.AuthModule.Models.User\", \"User\")\n                        .WithMany(\"MessageStatusLogs\")\n                        .HasForeignKey(\"UserId\");\n\n                    b.Navigation(\"Business\");\n\n                    b.Navigation(\"Campaign\");\n\n                    b.Navigation(\"User\");\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.Payment.Models.Coupon\", b =>\n                {\n                    b.HasOne(\"xbytechat.api.Features.AccessControl.Models.Plan\", null)\n                        .WithMany()\n                        .HasForeignKey(\"PlanId\")\n                        .OnDelete(DeleteBehavior.SetNull);\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.Payment.Models.Invoice\", b =>\n                {\n                    b.HasOne(\"xbytechat.api.Features.BusinessModule.Models.Business\", \"Business\")\n                        .WithMany()\n                        .HasForeignKey(\"BusinessId\")\n                        .OnDelete(DeleteBehavior.Cascade)\n                        .IsRequired();\n\n                    b.HasOne(\"xbytechat.api.Features.AccessControl.Models.Plan\", \"Plan\")\n                        .WithMany()\n                        .HasForeignKey(\"PlanId\")\n                        .OnDelete(DeleteBehavior.SetNull);\n\n                    b.HasOne(\"xbytechat.api.Features.Payment.Models.Subscription\", \"Subscription\")\n                        .WithMany(\"Invoices\")\n                        .HasForeignKey(\"SubscriptionId\")\n                        .OnDelete(DeleteBehavior.SetNull);\n\n                    b.Navigation(\"Business\");\n\n                    b.Navigation(\"Plan\");\n\n                    b.Navigation(\"Subscription\");\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.Payment.Models.InvoiceLineItem\", b =>\n                {\n                    b.HasOne(\"xbytechat.api.Features.Payment.Models.Invoice\", \"Invoice\")\n                        .WithMany(\"LineItems\")\n                        .HasForeignKey(\"InvoiceId\")\n                        .OnDelete(DeleteBehavior.Cascade)\n                        .IsRequired();\n\n                    b.Navigation(\"Invoice\");\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.Payment.Models.PaymentTransaction\", b =>\n                {\n                    b.HasOne(\"xbytechat.api.Features.BusinessModule.Models.Business\", \"Business\")\n                        .WithMany()\n                        .HasForeignKey(\"BusinessId\")\n                        .OnDelete(DeleteBehavior.Cascade)\n                        .IsRequired();\n\n                    b.HasOne(\"xbytechat.api.Features.Payment.Models.Invoice\", \"Invoice\")\n                        .WithMany(\"Payments\")\n                        .HasForeignKey(\"InvoiceId\")\n                        .OnDelete(DeleteBehavior.SetNull);\n\n                    b.HasOne(\"xbytechat.api.Features.Payment.Models.Subscription\", \"Subscription\")\n                        .WithMany(\"Payments\")\n                        .HasForeignKey(\"SubscriptionId\")\n                        .OnDelete(DeleteBehavior.SetNull);\n\n                    b.Navigation(\"Business\");\n\n                    b.Navigation(\"Invoice\");\n\n                    b.Navigation(\"Subscription\");\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.Payment.Models.Subscription\", b =>\n                {\n                    b.HasOne(\"xbytechat.api.Features.BusinessModule.Models.Business\", \"Business\")\n                        .WithMany()\n                        .HasForeignKey(\"BusinessId\")\n                        .OnDelete(DeleteBehavior.Cascade)\n                        .IsRequired();\n\n                    b.HasOne(\"xbytechat.api.Features.AccessControl.Models.Plan\", \"Plan\")\n                        .WithMany()\n                        .HasForeignKey(\"PlanId\")\n                        .OnDelete(DeleteBehavior.Restrict)\n                        .IsRequired();\n\n                    b.Navigation(\"Business\");\n\n                    b.Navigation(\"Plan\");\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.Tracking.Models.TrackingLog\", b =>\n                {\n                    b.HasOne(\"xbytechat.api.Features.CampaignModule.Models.Campaign\", \"Campaign\")\n                        .WithMany()\n                        .HasForeignKey(\"CampaignId\")\n                        .OnDelete(DeleteBehavior.Restrict);\n\n                    b.HasOne(\"xbytechat.api.Features.CampaignTracking.Models.CampaignSendLog\", \"CampaignSendLog\")\n                        .WithMany()\n                        .HasForeignKey(\"CampaignSendLogId\")\n                        .OnDelete(DeleteBehavior.Restrict);\n\n                    b.HasOne(\"xbytechat.api.CRM.Models.Contact\", \"Contact\")\n                        .WithMany()\n                        .HasForeignKey(\"ContactId\");\n\n                    b.HasOne(\"MessageLog\", \"MessageLog\")\n                        .WithMany()\n                        .HasForeignKey(\"MessageLogId\")\n                        .OnDelete(DeleteBehavior.Restrict);\n\n                    b.Navigation(\"Campaign\");\n\n                    b.Navigation(\"CampaignSendLog\");\n\n                    b.Navigation(\"Contact\");\n\n                    b.Navigation(\"MessageLog\");\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.WhatsAppSettings.Models.WhatsAppPhoneNumber\", b =>\n                {\n                    b.HasOne(\"xbytechat_api.WhatsAppSettings.Models.WhatsAppSettingEntity\", null)\n                        .WithMany(\"WhatsAppBusinessNumbers\")\n                        .HasForeignKey(\"BusinessId\", \"Provider\")\n                        .HasPrincipalKey(\"BusinessId\", \"Provider\")\n                        .OnDelete(DeleteBehavior.Cascade)\n                        .IsRequired();\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.xbTimelines.Models.LeadTimeline\", b =>\n                {\n                    b.HasOne(\"xbytechat.api.Features.BusinessModule.Models.Business\", \"Business\")\n                        .WithMany()\n                        .HasForeignKey(\"BusinessId\")\n                        .OnDelete(DeleteBehavior.Cascade)\n                        .IsRequired();\n\n                    b.HasOne(\"xbytechat.api.CRM.Models.Contact\", \"Contact\")\n                        .WithMany()\n                        .HasForeignKey(\"ContactId\")\n                        .OnDelete(DeleteBehavior.Cascade)\n                        .IsRequired();\n\n                    b.Navigation(\"Business\");\n\n                    b.Navigation(\"Contact\");\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Models.BusinessModel.BusinessPlanInfo\", b =>\n                {\n                    b.HasOne(\"xbytechat.api.Features.BusinessModule.Models.Business\", \"Business\")\n                        .WithOne(\"BusinessPlanInfo\")\n                        .HasForeignKey(\"xbytechat.api.Models.BusinessModel.BusinessPlanInfo\", \"BusinessId\")\n                        .OnDelete(DeleteBehavior.Cascade)\n                        .IsRequired();\n\n                    b.Navigation(\"Business\");\n                });\n\n            modelBuilder.Entity(\"xbytechat_api.WhatsAppSettings.Models.WhatsAppSettingEntity\", b =>\n                {\n                    b.HasOne(\"xbytechat.api.Features.BusinessModule.Models.Business\", null)\n                        .WithMany(\"WhatsAppSettings\")\n                        .HasForeignKey(\"BusinessId\")\n                        .OnDelete(DeleteBehavior.Cascade)\n                        .IsRequired();\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.AuthModule.Models.User\", b =>\n                {\n                    b.Navigation(\"MessageStatusLogs\");\n\n                    b.Navigation(\"SendLogs\");\n\n                    b.Navigation(\"UserPermissions\");\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.CRM.Models.Contact\", b =>\n                {\n                    b.Navigation(\"ContactTags\");\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.CRM.Models.Tag\", b =>\n                {\n                    b.Navigation(\"ContactTags\");\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.AccessControl.Models.Permission\", b =>\n                {\n                    b.Navigation(\"PlanPermissions\");\n\n                    b.Navigation(\"RolePermissions\");\n\n                    b.Navigation(\"UserPermissions\");\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.AccessControl.Models.Plan\", b =>\n                {\n                    b.Navigation(\"Businesses\");\n\n                    b.Navigation(\"PlanPermissions\");\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.AccessControl.Models.Role\", b =>\n                {\n                    b.Navigation(\"RolePermissions\");\n\n                    b.Navigation(\"Users\");\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.BusinessModule.Models.Business\", b =>\n                {\n                    b.Navigation(\"BusinessPlanInfo\");\n\n                    b.Navigation(\"Campaigns\");\n\n                    b.Navigation(\"MessageStatusLogs\");\n\n                    b.Navigation(\"Users\");\n\n                    b.Navigation(\"WhatsAppSettings\");\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.CTAFlowBuilder.Models.CTAFlowConfig\", b =>\n                {\n                    b.Navigation(\"Steps\");\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.CTAFlowBuilder.Models.CTAFlowStep\", b =>\n                {\n                    b.Navigation(\"ButtonLinks\");\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.CampaignModule.Models.Audience\", b =>\n                {\n                    b.Navigation(\"Members\");\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.CampaignModule.Models.Campaign\", b =>\n                {\n                    b.Navigation(\"Audiences\");\n\n                    b.Navigation(\"MessageLogs\");\n\n                    b.Navigation(\"MessageStatusLogs\");\n\n                    b.Navigation(\"MultiButtons\");\n\n                    b.Navigation(\"Recipients\");\n\n                    b.Navigation(\"SendLogs\");\n\n                    b.Navigation(\"VariableMaps\");\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.CampaignModule.Models.CampaignRecipient\", b =>\n                {\n                    b.Navigation(\"SendLogs\");\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.Payment.Models.Invoice\", b =>\n                {\n                    b.Navigation(\"LineItems\");\n\n                    b.Navigation(\"Payments\");\n                });\n\n            modelBuilder.Entity(\"xbytechat.api.Features.Payment.Models.Subscription\", b =>\n                {\n                    b.Navigation(\"Invoices\");\n\n                    b.Navigation(\"Payments\");\n                });\n\n            modelBuilder.Entity(\"xbytechat_api.WhatsAppSettings.Models.WhatsAppSettingEntity\", b =>\n                {\n                    b.Navigation(\"WhatsAppBusinessNumbers\");\n                });\n#pragma warning restore 612, 618\n        }\n    }\n}\n"
    },
    {
      "path": "xbytechat-api/Migrations/FlowExecLogs_CascadeToFlow.cs",
      "sha256": "768f3f77c81b7bbdcf72f065e126cff0fb9f67eddb754b9e32da3a75620a93e1",
      "language": "csharp",
      "size": 1536,
      "content": "using Microsoft.EntityFrameworkCore.Migrations;\n\n#nullable disable\n\npublic partial class FlowExecLogs_CascadeToFlow : Migration\n{\n    protected override void Up(MigrationBuilder migrationBuilder)\n    {\n        migrationBuilder.Sql(@\"\nCREATE INDEX IF NOT EXISTS \"\"IX_FlowExecutionLogs_FlowId\"\"\nON \"\"FlowExecutionLogs\"\" (\"\"FlowId\"\");\n\");\n\n        migrationBuilder.Sql(@\"\nDO $$\nBEGIN\n  IF EXISTS (\n    SELECT 1 FROM information_schema.table_constraints\n    WHERE constraint_type='FOREIGN KEY'\n      AND table_name='FlowExecutionLogs'\n      AND constraint_name='FK_FlowExecutionLogs_CTAFlowConfigs_FlowId'\n  ) THEN\n    ALTER TABLE \"\"FlowExecutionLogs\"\"\n      DROP CONSTRAINT \"\"FK_FlowExecutionLogs_CTAFlowConfigs_FlowId\"\";\n  END IF;\nEND$$;\n\");\n\n        migrationBuilder.Sql(@\"\nALTER TABLE \"\"FlowExecutionLogs\"\"\nADD CONSTRAINT \"\"FK_FlowExecutionLogs_CTAFlowConfigs_FlowId\"\"\nFOREIGN KEY (\"\"FlowId\"\") REFERENCES \"\"CTAFlowConfigs\"\"(\"\"Id\"\")\nON DELETE CASCADE;\n\");\n    }\n\n    protected override void Down(MigrationBuilder migrationBuilder)\n    {\n        migrationBuilder.Sql(@\"\nDO $$\nBEGIN\n  IF EXISTS (\n    SELECT 1 FROM information_schema.table_constraints\n    WHERE constraint_type='FOREIGN KEY'\n      AND table_name='FlowExecutionLogs'\n      AND constraint_name='FK_FlowExecutionLogs_CTAFlowConfigs_FlowId'\n  ) THEN\n    ALTER TABLE \"\"FlowExecutionLogs\"\"\n      DROP CONSTRAINT \"\"FK_FlowExecutionLogs_CTAFlowConfigs_FlowId\"\";\n  END IF;\nEND$$;\n\");\n\n        migrationBuilder.Sql(@\"DROP INDEX IF EXISTS \"\"IX_FlowExecutionLogs_FlowId\"\";\");\n    }\n}\n"
    },
    {
      "path": "xbytechat-api/Migrations/IdempotencyKeyNullable_FilteredUq.cs",
      "sha256": "717f6b8337cdcdadc6b488a5fe202791ac30195a2b5d223edf7a526b75f4a6c0",
      "language": "csharp",
      "size": 2669,
      "content": "using Microsoft.EntityFrameworkCore.Migrations;\n\nnamespace xbytechat.api.Migrations\n{\n    public partial class IdempotencyKeyNullable_FilteredUq : Migration\n    {\n        //protected override void Up(MigrationBuilder migrationBuilder)\n        //{\n        //    // Drop legacy indexes if any (names may differ in your DB, keep the try/catch)\n        //    try { migrationBuilder.DropIndex(\"IX_OutboundMessageJobs_IdempotencyKey\", \"OutboundMessageJobs\"); } catch { }\n        //    try { migrationBuilder.DropIndex(\"UX_Outbox_Biz_IdemKey\", \"OutboundMessageJobs\"); } catch { }\n\n        //    // Make column nullable (drop any implicit default)\n        //    migrationBuilder.AlterColumn<string>(\n        //        name: \"IdempotencyKey\",\n        //        table: \"OutboundMessageJobs\",\n        //        type: \"text\",\n        //        nullable: true,\n        //        oldClrType: typeof(string),\n        //        oldType: \"text\");\n\n        //    // Normalize legacy empty strings to NULL so they don't trip the filtered unique\n        //    migrationBuilder.Sql(\"\"\"\n        //        UPDATE \"OutboundMessageJobs\"\n        //        SET \"IdempotencyKey\" = NULL\n        //        WHERE \"IdempotencyKey\" IS NOT NULL AND btrim(\"IdempotencyKey\") = '';\n        //    \"\"\");\n\n        //    // Recreate your filtered unique (per BusinessId) exactly as in your model\n        //    migrationBuilder.CreateIndex(\n        //        name: \"UX_Outbox_Biz_IdemKey\",\n        //        table: \"OutboundMessageJobs\",\n        //        columns: new[] { \"BusinessId\", \"IdempotencyKey\" },\n        //        unique: true,\n        //        filter: \"\\\"IdempotencyKey\\\" IS NOT NULL AND \\\"IdempotencyKey\\\" <> ''\");\n\n        //    // Safety: hot-path indexes (no-op if already exist)\n        //    migrationBuilder.CreateIndex(\n        //        name: \"IX_Outbox_StatusDueCreated\",\n        //        table: \"OutboundMessageJobs\",\n        //        columns: new[] { \"Status\", \"NextAttemptAt\", \"CreatedAt\" });\n        //}\n\n        //protected override void Down(MigrationBuilder migrationBuilder)\n        //{\n        //    migrationBuilder.DropIndex(\"UX_Outbox_Biz_IdemKey\", \"OutboundMessageJobs\");\n\n        //    migrationBuilder.AlterColumn<string>(\n        //        name: \"IdempotencyKey\",\n        //        table: \"OutboundMessageJobs\",\n        //        type: \"text\",\n        //        nullable: false,\n        //        defaultValue: \"\");\n\n        //    migrationBuilder.CreateIndex(\n        //        name: \"IX_OutboundMessageJobs_IdempotencyKey\",\n        //        table: \"OutboundMessageJobs\",\n        //        column: \"IdempotencyKey\",\n        //        unique: true);\n        //}\n    }\n}"
    },
    {
      "path": "xbytechat-api/Models/ApiKey.cs",
      "sha256": "b569e20fb3e20480ea2bdaa70a3443985ddefb22b2ec7de4c6ae6d43792098a6",
      "language": "csharp",
      "size": 830,
      "content": "using System;\n\nnamespace xbytechat.api.Features.CustomeApi.Models\n{\n    public sealed class ApiKey\n    {\n        public Guid Id { get; set; }\n        public Guid BusinessId { get; set; }\n\n        public string Name { get; set; } = string.Empty;   // e.g. \"Zapier Prod Key\"\n        public string Prefix { get; set; } = string.Empty; // e.g. \"live_ABCD\"\n        public string SecretHash { get; set; } = string.Empty;\n\n        public string Scopes { get; set; } = \"direct.send\"; // comma- or space-separated scopes\n        public DateTime CreatedAt { get; set; } = DateTime.UtcNow;\n        public DateTime? ExpiresAt { get; set; }\n        public DateTime? LastUsedAt { get; set; }\n        public bool IsRevoked { get; set; } = false;\n\n        public string? CreatedBy { get; set; }\n        public string? Notes { get; set; }\n    }\n}\n"
    },
    {
      "path": "xbytechat-api/Models/MessagesModel/MessageLog.cs",
      "sha256": "ced999fd341395b5641af8d3f4d71614807d94bfbe974d23fb677aca924139cc",
      "language": "csharp",
      "size": 2826,
      "content": "using System;\nusing System.Collections.Generic;\nusing xbytechat.api.Features.BusinessModule.Models;\nusing xbytechat.api.Features.CampaignModule.Models;\nusing xbytechat.api.Features.CRM.Models;\nusing xbytechat.api.Features.MessageManagement.DTOs;\n\npublic class MessageLog\n{\n    public Guid Id { get; set; }\n\n    public string? MessageId { get; set; } // WAMID from WhatsApp  alternate key\n                                           // public ICollection<MessageStatusLog> StatusUpdates { get; set; } = new List<MessageStatusLog>();\n    public Guid? RunId { get; set; }\n    //  FK to Business\n    public Guid BusinessId { get; set; }\n    public Business Business { get; set; }\n\n    //  Message Info\n    public string RecipientNumber { get; set; }\n    public string MessageContent { get; set; }\n    public string? MediaUrl { get; set; }\n\n    //  Status Info\n    public string Status { get; set; } = \"Queued\";\n    public string? ErrorMessage { get; set; }\n    public string? RawResponse { get; set; }\n\n    //  Timestamps\n    public DateTime CreatedAt { get; set; } = DateTime.UtcNow;\n    public DateTime? SentAt { get; set; }\n\n    //  Contact (optional)\n    public Guid? ContactId { get; set; }\n    public Contact? Contact { get; set; }\n\n    //  Campaign (optional)\n    public Guid? CampaignId { get; set; }\n\n    //  CTA Flow Tracking\n    public Guid? CTAFlowConfigId { get; set; }  // Which visual flow config this message belongs to\n    public Guid? CTAFlowStepId { get; set; }    // Which flow step (template) this message originated from\n\n    public int? FlowVersion { get; set; }                // which version of the flow this message belongs to\n    public string? ButtonBundleJson { get; set; }\n\n    public Campaign? SourceCampaign { get; set; } // renamed from \"Campaign\" to avoid name conflict\n\n    public bool IsIncoming { get; set; }\n\n    public string? RenderedBody { get; set; } // actual resolved message with parameters\n\n    public Guid? RefMessageId { get; set; }\n    public string? Source { get; set; } // e.g., \"campaign\", \"flow\", \"manual\"\n\n\n    public string? Provider { get; set; }                     // \"Meta_cloud\", \"Pinnacle\", etc.\n    public string? ProviderMessageId { get; set; }            // e.g., \"wamid.HBg...\"; indexed\n    public bool? IsChargeable { get; set; }                 // true/false/unknown\n    public string? ConversationId { get; set; }               // provider conv id (Meta)\n    public string? ConversationCategory { get; set; }         // \"marketing\" | \"utility\" | \"authentication\" | \"service\" | \"free_entry\" | \"unknown\"\n    public DateTimeOffset? ConversationStartedAt { get; set; }\n    public decimal? PriceAmount { get; set; }                 // nullable until known\n    public string? PriceCurrency { get; set; }     \n    // \"USD\", \"INR\", etc.\n}\n"
    },
    {
      "path": "xbytechat-api/Models/WhatsAppResult.cs",
      "sha256": "cd627fc7d90a4da1360bb14f8be3109068a83b746a1b782f257095f68ea5279d",
      "language": "csharp",
      "size": 220,
      "content": "namespace xbytechat.api.Models\n{\n    public class WhatsAppResult\n    {\n        public bool Success { get; set; }\n        public string? ErrorMessage { get; set; }\n        public string? RawResponse { get; set; }\n    }\n}\n"
    },
    {
      "path": "xbytechat-api/PayloadBuilders/ImageMessagePayloadBuilder.cs",
      "sha256": "71c13746d4e6cc70735324c5c2c755b80e4c7d032e71a97969c3efe007aa68ae",
      "language": "csharp",
      "size": 680,
      "content": "using xbytechat.api.DTOs.Messages;\n\nnamespace xbytechat.api.PayloadBuilders\n{\n    /// <summary>\n    /// Builds payload for sending image messages with media URL.\n    /// </summary>\n    public class ImageMessagePayloadBuilder : IWhatsAppPayloadBuilder\n    {\n        public object BuildPayload(BaseMessageDto dto)\n        {\n            var imageDto = dto as ImageMessageDto;\n\n            return new\n            {\n                messaging_product = \"whatsapp\",\n                to = imageDto.RecipientNumber,\n                type = \"image\",\n                image = new\n                {\n                    link = imageDto.MediaUrl\n                }\n            };\n        }\n    }\n}\n"
    },
    {
      "path": "xbytechat-api/PayloadBuilders/IWhatsAppPayloadBuilder.cs",
      "sha256": "2a2ff0592129a93fea8aa20df5fe1e8454dbfbe1640d5a1e15963af93dcd7922",
      "language": "csharp",
      "size": 190,
      "content": "namespace xbytechat.api.PayloadBuilders\n{\n    using xbytechat.api.DTOs.Messages;\n\n    public interface IWhatsAppPayloadBuilder\n    {\n        object BuildPayload(BaseMessageDto dto);\n    }\n}\n"
    },
    {
      "path": "xbytechat-api/PayloadBuilders/TemplateMessagePayloadBuilder.cs",
      "sha256": "70f39daad2789c61f03ade184abdf96a43221189b751178dfa1955c123b5f884",
      "language": "csharp",
      "size": 2013,
      "content": "using xbytechat.api.DTOs.Messages;\n\nnamespace xbytechat.api.PayloadBuilders\n{\n    public class TemplateMessagePayloadBuilder : IWhatsAppPayloadBuilder\n    {\n        public object BuildPayload(BaseMessageDto dto)\n        {\n            var templateDto = dto as TemplateMessageDto;\n            if (templateDto == null)\n                throw new InvalidCastException(\"DTO is not of type TemplateMessageDto.\");\n\n            var components = new List<object>();\n\n            //  Body parameters\n            if (templateDto.TemplateParameters != null && templateDto.TemplateParameters.Any())\n            {\n                components.Add(new\n                {\n                    type = \"body\",\n                    parameters = templateDto.TemplateParameters.Select(p => new\n                    {\n                        type = \"text\",\n                        text = p\n                    }).ToList()\n                });\n            }\n\n            //  Add button placeholders (Meta requires them for static buttons too)\n            components.Add(new\n            {\n                type = \"button\",\n                sub_type = \"url\",\n                index = \"0\",\n                parameters = new object[] { }  //  no parameters if static URL\n            });\n\n            components.Add(new\n            {\n                type = \"button\",\n                sub_type = \"phone_number\",\n                index = \"1\",\n                parameters = new object[] { }  //  no parameters if static phone\n            });\n\n            return new\n            {\n                messaging_product = \"whatsapp\",\n                to = templateDto.RecipientNumber,\n                type = \"template\",\n                template = new\n                {\n                    name = templateDto.TemplateName,\n                    language = new\n                    {\n                        code = templateDto.LanguageCode ?? \"en_US\"\n                    },\n                    components\n                }\n            };\n        }\n    }\n}\n"
    },
    {
      "path": "xbytechat-api/PayloadBuilders/TextMessagePayloadBuilder.cs",
      "sha256": "ce8e2e75c7865d9b08bebb267ceb84f7cdd0e77bd971c609576979b02726a590",
      "language": "csharp",
      "size": 750,
      "content": "// File: PayloadBuilders/TextMessagePayloadBuilder.cs\nusing xbytechat.api.DTOs.Messages;\n\nnamespace xbytechat.api.PayloadBuilders\n{\n    public class TextMessagePayloadBuilder : IWhatsAppPayloadBuilder\n    {\n        public object BuildPayload(BaseMessageDto dto)\n        {\n            var textDto = dto as TextMessageDto;\n\n            if (textDto == null)\n                throw new InvalidCastException(\"DTO is not of type TextMessageDto.\");\n\n            return new\n            {\n                messaging_product = \"whatsapp\",\n                to = textDto.RecipientNumber,\n                type = \"text\",\n                text = new\n                {\n                    body = textDto.MessageContent\n                }\n            };\n        }\n    }\n}\n"
    },
    {
      "path": "xbytechat-api/Program.cs",
      "sha256": "da1d01b0c7f150e34c1bc72f8775c8b42596070bbda029d43f2bc59f28d6380f",
      "language": "csharp",
      "size": 36030,
      "content": "using FluentValidation;\nusing Microsoft.AspNetCore.Authentication.JwtBearer;\nusing Microsoft.EntityFrameworkCore;\nusing Microsoft.IdentityModel.Tokens;\nusing Serilog;\nusing Serilog.Exceptions;\nusing System.Text;\nusing System.Text.Json;\nusing System.Text.Json.Serialization;\nusing xbytechat.api;\nusing xbytechat.api.AuthModule.Services;\nusing xbytechat.api.Features.AccessControl.Services;\nusing xbytechat.api.Features.AuditTrail.Services;\nusing xbytechat.api.Features.CampaignModule.Services;\nusing xbytechat.api.Features.CampaignTracking.Services;\nusing xbytechat.api.Features.Catalog.Services;\nusing xbytechat.api.Features.MessageManagement.Services;\nusing xbytechat.api.Features.MessagesEngine.PayloadBuilders;\nusing xbytechat.api.Features.MessagesEngine.Services;\nusing xbytechat.api.Features.PlanManagement.Services;\nusing xbytechat.api.Features.TemplateModule.Services;\nusing xbytechat.api.Features.Webhooks.Services;\nusing xbytechat.api.Features.Webhooks.Services.Processors;\nusing xbytechat.api.Features.Webhooks.Services.Resolvers;\nusing xbytechat.api.Helpers;\nusing xbytechat.api.Middlewares;\nusing xbytechat.api.PayloadBuilders;\nusing xbytechat.api.Repositories.Implementations;\nusing xbytechat.api.Repositories.Interfaces;\nusing xbytechat.api.Services;\nusing xbytechat.api.Services.Messages.Implementations;\nusing xbytechat.api.Services.Messages.Interfaces;\nusing xbytechat_api.WhatsAppSettings.Services;\nusing xbytechat_api.WhatsAppSettings.Validators;\nusing EnginePayloadBuilders = xbytechat.api.Features.MessagesEngine.PayloadBuilders;\nusing xbytechat.api.Features.CTAManagement.Services;\nusing xbytechat.api.Features.Tracking.Services;\nusing xbytechat.api.Features.Webhooks.BackgroundWorkers;\nusing xbytechat.api.Features.CTAFlowBuilder.Services;\nusing xbytechat.api.Features.FlowAnalytics.Services;\nusing xbytechat.api.Features.Inbox.Repositories;\nusing xbytechat.api.Features.Inbox.Services;\nusing xbytechat.api.Features.Inbox.Hubs;\nusing Microsoft.AspNetCore.SignalR;\nusing xbytechat.api.SignalR;\nusing xbytechat.api.Features.AutoReplyBuilder.Repositories;\nusing xbytechat.api.Features.AutoReplyBuilder.Services;\nusing xbytechat.api.Features.AutoReplyBuilder.Flows.Repositories;\nusing xbytechat.api.Features.BusinessModule.Services;\nusing xbytechat.api.Features.ReportingModule.Services;\nusing xbytechat.api.Features.Automation.Repositories;\nusing xbytechat.api.Features.Automation.Services;\nusing Npgsql;\nusing System.Net;\nusing xbytechat.api.WhatsAppSettings.Providers;\nusing xbytechat.api.Features.CampaignTracking.Config;\nusing xbytechat.api.Features.CampaignTracking.Worker;\nusing xbytechat.api.Infrastructure.Flows;\nusing xbytechat.api.Features.Webhooks.Pinnacle.Services.Adapters;\nusing xbytechat.api.Features.Webhooks.Directory;\nusing xbytechat.api.Features.Webhooks.Status;\nusing xbytechat.api.Features.WhatsAppSettings.Services;\nusing xbytechat.api.WhatsAppSettings.Services;\nusing xbytechat_api.Features.Billing.Services;\nusing xbytechat.api.Features.Audiences.Services;\nusing xbytechat.api.Features.CampaignModule.Helpers;\nusing Microsoft.AspNetCore.HttpOverrides;\nusing xbytechat.api.Features.CustomeApi.Services;\nusing Microsoft.AspNetCore.Authentication;\nusing xbytechat.api.Features.CustomeApi.Auth;\nusing Microsoft.OpenApi.Models;\nusing xbytechat.api.Infrastructure.Schema;\nusing xbytechat.api.Features.CampaignModule.Workers;\nusing xbytechat.api.Infrastructure.Observability;\nusing xbytechat.api.Features.CampaignTracking.Logging;\nusing xbytechat.api.Infrastructure.RateLimiting;\nusing xbytechat.api.Features.CampaignModule.SendEngine;\nusing xbytechat.api.Features.MessageLogging.Services;\nusing DocumentFormat.OpenXml.Office2016.Drawing.ChartDrawing;\nusing xbytechat.api.Features.CampaignModule.CountryCodes;\nusing xbytechat.api.Features.CampaignModule.Import;\nusing xbytechat.api.Features.TemplateModule.Abstractions;\nusing xbytechat.api.Features.TemplateModule.Config;\nusing xbytechat.api.Features.ESU.Shared;\nusing xbytechat.api.Features.ESU.Facebook.Services;\nusing xbytechat.api.Features.ESU.Facebook.Options;\nusing Microsoft.Extensions.Options;\nusing xbytechat.api.Features.ESU.Facebook.Abstractions;\nusing xbytechat.api.Features.ESU.Facebook.Clients;\nusing xbytechat.api.Features.ESU.Shared.Infrastructure;\nusing Microsoft.AspNetCore.RateLimiting;\nusing xbytechat.api.Features.Billing.Security;\nusing Microsoft.AspNetCore.Identity;\nusing xbytechat.api.AuthModule.Models;\nusing xbytechat.api.Features.AccountInsights.Services;\nusing xbytechat.api.Features.Payment.Services;\nusing xbytechat.api.Features.Payment.Options;\nusing xbytechat.api.Features.Entitlements.Services;\nusing xbytechat.api.Features.Auditing.FlowExecutions.Services;\nusing xbytechat.api.Features.CRM.Interfaces;\nusing xbytechat.api.Features.CRM.Services;\nusing xbytechat.api.Features.CRM.Timelines.Services;\nusing xbytechat.api.Features.ChatInbox.Services;\nusing xbytechat.api.Features.CRM.Summary.Interfaces;\nusing xbytechat.api.Features.CRM.Summary.Services;\n\n\n\nvar builder = WebApplication.CreateBuilder(args);\n\n#region Local overrides configuration\n// Load optional local secrets overrides (never committed) before env variables\nbuilder.Configuration\n    .AddJsonFile(\"appsettings.Local.json\", optional: true, reloadOnChange: true)\n    .AddEnvironmentVariables();\n#endregion\n\n#region  Serilog Configuration\nLog.Logger = new LoggerConfiguration()\n    .Enrich.WithExceptionDetails()\n    .Enrich.FromLogContext()\n    .MinimumLevel.Information()\n    .WriteTo.Console()\n    .WriteTo.File(\"logs/log-.txt\", rollingInterval: RollingInterval.Day)\n    .CreateLogger();\nbuilder.Host.UseSerilog();\n#endregion\n\n#region  Database Setup (PostgreSQL)\n//var connStr = builder.Configuration.GetConnectionString(\"DefaultConnection\");\n//builder.Services.AddDbContext<AppDbContext>(options =>\n//    options.UseNpgsql(connStr).EnableSensitiveDataLogging()\n//);\n\n//  Database Setup (PostgreSQL + UpdatedAtUtc interceptor)\nbuilder.Services.AddSingleton<UpdatedAtUtcInterceptor>();\n\nbuilder.Services.AddDbContext<AppDbContext>((sp, options) =>\n{\n    var env = sp.GetRequiredService<IHostEnvironment>();\n    var connection = builder.Configuration.GetConnectionString(\"DefaultConnection\");\n    if (string.IsNullOrWhiteSpace(connection) || connection.Contains(\"<set-via-env\", StringComparison.OrdinalIgnoreCase))\n    {\n        throw new InvalidOperationException(\"ConnectionStrings:DefaultConnection is not configured. Set it via environment variable (ConnectionStrings__DefaultConnection) or appsettings.Local.json.\");\n    }\n\n    options.UseNpgsql(connection);\n\n    // register UpdatedAt interceptor\n    options.AddInterceptors(sp.GetRequiredService<UpdatedAtUtcInterceptor>());\n\n    if (!env.IsDevelopment())\n    {\n        options.EnableSensitiveDataLogging(false);\n        options.EnableDetailedErrors(false);\n    }\n});\n\n\n//Console.WriteLine($\"[DEBUG] Using Connection String: {connStr}\");\n#endregion\n\n#region  Generic Repository Pattern\nbuilder.Services.AddScoped(typeof(IGenericRepository<>), typeof(GenericRepository<>));\n#endregion\n\n#region  Core Modules (Business/Auth)\nbuilder.Services.AddScoped<IBusinessService, BusinessService>();\nbuilder.Services.AddScoped<IAuthService, AuthService>();\nbuilder.Services.AddScoped<IJwtTokenService, JwtTokenService>();\n#endregion\n\n#region  Messaging Services & WhatsApp\n\nbuilder.Services.AddHttpClient<IMessageService, MessageService>();\nbuilder.Services.AddScoped<WhatsAppService>();\nbuilder.Services.AddScoped<IMessageStatusService, MessageStatusService>();\nbuilder.Services.AddScoped<ITemplateMessageSender, TemplateMessageSender>();\n#endregion\nbuilder.Services.AddHttpClient();\n#region  Payload Builders\nbuilder.Services.AddScoped<xbytechat.api.PayloadBuilders.IWhatsAppPayloadBuilder, xbytechat.api.PayloadBuilders.TextMessagePayloadBuilder>();\nbuilder.Services.AddScoped<xbytechat.api.PayloadBuilders.IWhatsAppPayloadBuilder, xbytechat.api.PayloadBuilders.ImageMessagePayloadBuilder>();\nbuilder.Services.AddScoped<xbytechat.api.PayloadBuilders.IWhatsAppPayloadBuilder, xbytechat.api.PayloadBuilders.TemplateMessagePayloadBuilder>();\n#endregion\n\n#region  Catalog & CRM Modules\nbuilder.Services.AddScoped<IContactSummaryService, ContactSummaryService>();\nbuilder.Services.AddScoped<IProductService, ProductService>();\nbuilder.Services.AddScoped<ICatalogTrackingService, CatalogTrackingService>();\nbuilder.Services.AddScoped<ICatalogDashboardService, CatalogDashboardService>();\nbuilder.Services.AddScoped<IContactService, ContactService>();\nbuilder.Services.AddScoped<ITagService, TagService>();\nbuilder.Services.AddScoped<IReminderService, ReminderService>();\nbuilder.Services.AddScoped<INoteService, NoteService>();\nbuilder.Services.AddScoped<ITimelineService, TimelineService>();\n#endregion\n\n#region  Billing \nbuilder.Services.AddScoped<IBillingIngestService, BillingIngestService>();\nbuilder.Services.AddScoped<IBillingReadService, BillingReadService>();\nbuilder.Services.AddSingleton<IMetaSignatureValidator, MetaSignatureValidator>();\n#endregion\n\n#region  Campaign Management\nbuilder.Services.AddScoped<ICampaignService, CampaignService>();\nbuilder.Services.AddScoped<ICampaignSendLogService, CampaignSendLogService>();\nbuilder.Services.AddScoped<ICampaignSendLogEnricher, CampaignSendLogEnricher>();\nbuilder.Services.AddScoped<ICampaignAnalyticsService, CampaignAnalyticsService>();\nbuilder.Services.AddScoped<ICampaignRetryService, CampaignRetryService>();\nbuilder.Services.AddScoped<ICampaignTrackingRetryService, CampaignTrackingRetryService>();\nbuilder.Services.AddHttpClient<IWhatsAppTemplateService, WhatsAppTemplateService>();\nbuilder.Services.AddScoped<ICampaignRecipientService, CampaignRecipientService>();\nbuilder.Services.AddScoped<IPlanService, PlanService>();\nbuilder.Services.AddScoped<ITemplatePreviewService, TemplatePreviewService>();\nbuilder.Services.AddScoped<IOutboundCampaignQueueService, OutboundCampaignQueueService>();\nbuilder.Services.AddScoped<ICampaignPreviewService, CampaignPreviewService>();\nbuilder.Services.AddScoped<IAudienceService, AudienceService>();\nbuilder.Services.AddScoped<ICampaignVariableMapService, CampaignVariableMapService>();\nbuilder.Services.AddScoped<IAudienceImportService, AudienceImportService>();\nbuilder.Services.AddScoped<ICampaignMaterializationService, CampaignMaterializationService>();\nbuilder.Services.AddScoped<ICampaignDispatchPlannerService, CampaignDispatchPlannerService>();\nbuilder.Services.AddScoped<ICsvExportService, CsvExportService>();\n\nbuilder.Services.AddScoped<ICampaignDryRunService, CampaignDryRunService>();\n// API\nbuilder.Services.AddScoped<ICustomApiService, CustomApiService>();\n// CSV ingest\nbuilder.Services.AddScoped<CampaignCsvSchemaBuilder>();\nbuilder.Services.AddScoped<ICsvBatchService, CsvBatchService>();\nbuilder.Services.AddScoped<IVariableResolver, VariableResolver>();\nbuilder.Services.AddScoped<ICampaignMaterializer, CampaignMaterializer>();\nbuilder.Services.AddScoped<ICampaignDispatcher, CampaignDispatcher>();\nbuilder.Services.AddScoped<IVariableMappingService, NoopVariableMappingService>();\n//builder.Services.AddScoped<IOutboundCampaignQueueService, NoopOutboundCampaignQueueService>();\nbuilder.Services.AddScoped<IMappingSuggestionService, MappingSuggestionService>();\n\nbuilder.Services.AddHostedService<OutboundSenderWorker>();\n//Refactoring\nbuilder.Services.Configure<xbytechat.api.Features.CampaignTracking.Logging.BatchingOptions>(\n    builder.Configuration.GetSection(\"Batching\"));\n\nbuilder.Services.AddSingleton<ICampaignLogSink, CampaignLogSink>();\nbuilder.Services.AddHostedService<CampaignLogFlushWorker>();\nMetricsRegistry.Configure(builder.Configuration);\nbuilder.Services.AddSingleton<IPhoneNumberRateLimiter, PhoneNumberRateLimiter>();\nbuilder.Services.AddSingleton<ITemplatePayloadBuilder, TemplatePayloadBuilder>();\n\n\n// Provider payload mappers\nbuilder.Services.AddSingleton<MetaCloudPayloadMapper>();\nbuilder.Services.AddSingleton<PinnaclePayloadMapper>();\n\nbuilder.Services.Configure<MessageLogSinkOptions>(\n    builder.Configuration.GetSection(\"MessageLogSink\"));\n\nbuilder.Services.AddSingleton<PostgresCopyMessageLogSink>();\nbuilder.Services.AddSingleton<IMessageLogSink>(sp => sp.GetRequiredService<PostgresCopyMessageLogSink>());\nbuilder.Services.AddHostedService(sp => sp.GetRequiredService<PostgresCopyMessageLogSink>());\n\nbuilder.Services.AddScoped<ICampaignSendValidator, CampaignSendValidator>();\n\nbuilder.Services.AddScoped<IJourneyExportService, JourneyExportService>();\n\n#endregion\n\n#region  Webhook Management\nbuilder.Services.AddHostedService<OutboxReaperWorker>();\n\nbuilder.Services.AddScoped<IWhatsAppWebhookService, WhatsAppWebhookService>();\nbuilder.Services.AddScoped<IWhatsAppWebhookDispatcher, WhatsAppWebhookDispatcher>();\nbuilder.Services.AddScoped<IStatusWebhookProcessor, StatusWebhookProcessor>();\nbuilder.Services.AddScoped<ITemplateWebhookProcessor, TemplateWebhookProcessor>();\nbuilder.Services.AddScoped<IMessageIdResolver, MessageIdResolver>();\nbuilder.Services.AddScoped<IClickWebhookProcessor, ClickWebhookProcessor>();\nbuilder.Services.AddScoped<ILeadTimelineService, LeadTimelineService>();\nbuilder.Services.AddScoped<IFailedWebhookLogService, FailedWebhookLogService>();\nbuilder.Services.AddSingleton<IWebhookQueueService, WebhookQueueService>();\nbuilder.Services.AddHostedService<WebhookQueueWorker>();\nbuilder.Services.AddHostedService<FailedWebhookLogCleanupService>();\nbuilder.Services.AddScoped<IMaintenanceService, MaintenanceService>();\nbuilder.Services.AddHostedService<WebhookAutoCleanupWorker>();\nbuilder.Services.AddScoped<IProviderDirectory, ProviderDirectory>();\nbuilder.Services.AddScoped<IMessageStatusUpdater, MessageStatusUpdater>();\nbuilder.Services.AddScoped<IPinnacleToMetaAdapter, PinnacleToMetaAdapter>();\n\n\n#endregion\n\n#region  Access Control & Permission\nbuilder.Services.AddScoped<IPasswordHasher<User>, PasswordHasher<User>>();\nbuilder.Services.AddScoped<IAccessControlService, AccessControlService>();\n\n#endregion\n\n#region  Tracking\nbuilder.Services.AddScoped<ITrackingService, TrackingService>();\nbuilder.Services.AddScoped<IMessageAnalyticsService, MessageAnalyticsService>();\nbuilder.Services.AddScoped<IUrlBuilderService, UrlBuilderService>();\nbuilder.Services.AddScoped<IContactJourneyService, ContactJourneyService>();\n\nbuilder.Services.Configure<TrackingOptions>(builder.Configuration.GetSection(\"Tracking\"));\nbuilder.Services.AddSingleton<IClickTokenService, ClickTokenService>();\nbuilder.Services.AddSingleton<IClickEventQueue, InProcessClickEventQueue>();\nbuilder.Services.AddHostedService<ClickLogWorker>();\n\nbuilder.Services.AddScoped<IMessageLogsReportService, MessageLogsReportService>();\n\n#endregion\n\n#region Template Creation\nbuilder.Services.AddScoped<ITemplateDraftService, TemplateDraftService>();\nbuilder.Services.AddScoped<ITemplateSubmissionService, TemplateSubmissionService>();\nbuilder.Services.AddScoped<ITemplateLibraryService, TemplateLibraryService>();\nbuilder.Services.AddScoped<IMetaTemplateClient, MetaTemplateClient>();\nbuilder.Services.AddScoped<IWhatsAppTemplatesSyncBridge, WhatsAppTemplatesSyncBridge>();\nbuilder.Services.AddScoped<IMetaCredentialsResolver, MetaCredentialsResolver>();\nbuilder.Services.AddScoped<IMetaTemplateClient, MetaTemplateClient>();\nbuilder.Services.AddScoped<ITemplateStatusService, TemplateStatusService>();\nbuilder.Services.Configure<UploadLimitsOptions>(\n    builder.Configuration.GetSection(\"TemplateBuilder:UploadLimits\"));\n\nbuilder.Services.AddScoped<IMetaUploadService, MetaUploadService>();\nbuilder.Services.AddScoped<ITemplateNameCheckService, TemplateNameCheckService>();\nbuilder.Services.AddScoped<ITemplateDraftLifecycleService, TemplateDraftLifecycleService>();\n\n#endregion\n#region  Flow Builder\nbuilder.Services.AddScoped<ICTAFlowService, CTAFlowService>();\n\n//builder.Services.Configure<FlowClickTokenOptions>(\n//    builder.Configuration.GetSection(\"FlowClickTokens\"));\n\nbuilder.Services.AddOptions<FlowClickTokenOptions>()\n    .BindConfiguration(\"FlowClickTokens\")\n    .Validate(o => !string.IsNullOrWhiteSpace(o.Secret) && o.Secret.Length >= 32,\n              \"Secret required (32 chars).\")\n    .Validate(o => Uri.TryCreate(o.BaseUrl, UriKind.Absolute, out var u) && u.Scheme == Uri.UriSchemeHttps,\n              \"BaseUrl must be an absolute https URL.\")\n    .Validate(o => o.TtlHours > 0, \"TtlHours must be positive.\")\n    .ValidateOnStart();\n\nbuilder.Services.AddSingleton<IFlowClickTokenService, FlowClickTokenService>();\nbuilder.Services.AddScoped<IFlowRuntimeService, FlowRuntimeService>();  //\nbuilder.Services.AddScoped<ICtaFlowRuntimeService, CtaFlowRuntimeService>();\n\n#endregion\n\n#region  Audit Trail Logging\nbuilder.Services.AddHttpContextAccessor();\nbuilder.Services.AddScoped<IAuditLogService, AuditLogService>();\n#endregion\nbuilder.Services.AddScoped<IContactProfileService, ContactProfileService>();\nbuilder.Services.AddScoped<IFlowExecutionQueryService, FlowExecutionQueryService>();\n#region  WhatsApp settings\nbuilder.Services.AddScoped<IWhatsAppSettingsService, WhatsAppSettingsService>();\nbuilder.Services.AddValidatorsFromAssemblyContaining<SaveWhatsAppSettingValidator>();\nbuilder.Services.AddHttpClient<IMessageEngineService, MessageEngineService>();\nbuilder.Services.AddScoped<IWhatsAppTemplateFetcherService, WhatsAppTemplateFetcherService>();\nbuilder.Services.AddScoped<EnginePayloadBuilders.TextMessagePayloadBuilder>();\nbuilder.Services.AddScoped<EnginePayloadBuilders.ImageMessagePayloadBuilder>();\nbuilder.Services.AddScoped<EnginePayloadBuilders.TemplateMessagePayloadBuilder>();\nbuilder.Services.AddScoped<EnginePayloadBuilders.CtaMessagePayloadBuilder>();\nbuilder.Services.AddScoped<IPlanManager, PlanManager>();\nbuilder.Services.AddScoped<ICTAManagementService, CTAManagementService>();\n//builder.Services.AddScoped<IWhatsAppProviderFactory, WhatsAppProviderFactory>();\nbuilder.Services.AddScoped<xbytechat.api.Features.MessagesEngine.Factory.IWhatsAppProviderFactory,\n                           xbytechat.api.Features.MessagesEngine.Factory.WhatsAppProviderFactory>();\nbuilder.Services.AddScoped<IWhatsAppSenderService, WhatsAppSenderService>();\n\nbuilder.Services.AddHttpClient(\"wa:pincale\", c =>\n{\n    c.Timeout = TimeSpan.FromSeconds(20);\n});\n\nbuilder.Services.AddHttpClient(\"wa:meta_cloud\", c =>\n{\n    c.Timeout = TimeSpan.FromSeconds(20);\n});\nbuilder.Services.AddScoped<MetaTemplateCatalogProvider>();\nbuilder.Services.AddScoped<PinnacleTemplateCatalogProvider>();\nbuilder.Services.AddScoped<ITemplateSyncService, TemplateSyncService>();\n\n// WhatsApp phone number management\nbuilder.Services.AddScoped<IWhatsAppPhoneNumberService, WhatsAppPhoneNumberService>();\n\n#endregion\n\n#region Worker\nbuilder.Services.AddHostedService<TemplateSyncWorker>();\n//builder.Services.AddHostedService<OutboundCampaignSendWorker>();\n\n#endregion\n#region  Inbox\nbuilder.Services.AddScoped<IUnreadCountService, UnreadCountService>();\n\nbuilder.Services.AddScoped<IFlowAnalyticsService, FlowAnalyticsService>();\nbuilder.Services.AddScoped<IInboxService, InboxService>();\nbuilder.Services.AddScoped<IInboundMessageProcessor, InboundMessageProcessor>();\nbuilder.Services.AddScoped<IInboxRepository, InboxRepository>();\nbuilder.Services.AddScoped<IQuickReplyService, QuickReplyService>();\n// ChatInbox\nbuilder.Services.AddScoped<IChatInboxQueryService, ChatInboxQueryService>();\nbuilder.Services.AddScoped<IChatInboxCommandService, ChatInboxCommandService>();\n#endregion\n\n#region  Access Control\nbuilder.Services.AddScoped<IPermissionService, PermissionService>();\nbuilder.Services.AddMemoryCache();\nbuilder.Services.AddScoped<IPermissionCacheService, PermissionCacheService>();\n#endregion\n\n#region  AutoReplyBuilder Module\n//builder.Services.AddScoped<IAutoReplyRepository, AutoReplyRepository>();\n//builder.Services.AddScoped<IAutoReplyService, AutoReplyService>();\nbuilder.Services.AddScoped<IAutoReplyFlowRepository, AutoReplyFlowRepository>();\nbuilder.Services.AddScoped<IAutoReplyFlowService, AutoReplyFlowService>();\nbuilder.Services.AddScoped<IAutoReplyRuntimeService, AutoReplyRuntimeService>();\nbuilder.Services.AddScoped<IChatSessionStateService, ChatSessionStateService>();\nbuilder.Services.AddScoped<IAgentAssignmentService, AgentAssignmentService>();\nbuilder.Services.AddScoped<IAutoReplyLogService, AutoReplyLogService>();\nbuilder.Services.AddScoped<IFlowExecutionLogger, FlowExecutionLogger>();\n#endregion\n\n#region  Automation Module\nbuilder.Services.AddScoped<IAutomationFlowRepository, AutomationFlowRepository>();\nbuilder.Services.AddScoped<IAutomationRunner, AutomationRunner>();\nbuilder.Services.AddScoped<IAutomationService, AutomationService>();\n#endregion\n\n\n#region  JWT Authentication (Bearer token only, no cookies)\n\nbuilder.Services\n    .AddAuthentication(JwtBearerDefaults.AuthenticationScheme)\n    .AddJwtBearer(options =>\n    {\n        var jwtSettings = builder.Configuration.GetSection(\"JwtSettings\");\n\n        options.TokenValidationParameters = new TokenValidationParameters\n        {\n            ValidateIssuer = true,\n            ValidateAudience = true,\n            ValidateLifetime = true,\n            ValidateIssuerSigningKey = true,\n            ValidIssuer = jwtSettings[\"Issuer\"],\n            ValidAudience = jwtSettings[\"Audience\"],\n            IssuerSigningKey = new SymmetricSecurityKey(\n                Encoding.UTF8.GetBytes(jwtSettings[\"SecretKey\"] ?? string.Empty)\n            ),\n            ClockSkew = TimeSpan.Zero\n        };\n\n        options.Events = new JwtBearerEvents\n        {\n            OnAuthenticationFailed = context =>\n            {\n                if (context.Exception is SecurityTokenExpiredException)\n                {\n                    //  Tell the pipeline we are handling this\n                    context.NoResult();\n\n                    context.Response.StatusCode = StatusCodes.Status401Unauthorized;\n                    context.Response.ContentType = \"application/json\";\n                    context.Response.Headers[\"x-token-expired\"] = \"true\";\n\n                    var payload =\n                        \"{\\\"success\\\":false,\\\"code\\\":\\\"TOKEN_EXPIRED\\\",\\\"message\\\":\\\"Token expired. Please login again.\\\"}\";\n\n                    return context.Response.WriteAsync(payload);\n                }\n\n                return Task.CompletedTask;\n            },\n            OnMessageReceived = context =>\n            {\n                var accessToken = context.Request.Query[\"access_token\"];\n                var path = context.HttpContext.Request.Path;\n\n                if (!string.IsNullOrEmpty(accessToken) &&\n                    path.StartsWithSegments(\"/api/hubs/inbox\"))\n                {\n                    context.Token = accessToken;\n                }\n\n                return Task.CompletedTask;\n            }\n        };\n    });\n\nbuilder.Services.AddAuthorization();\n\n\nbuilder.Services.AddAuthorization();\n#endregion\nbuilder.Services.Configure<StaticApiKeyOptions>(\n    builder.Configuration.GetSection(\"ApiKeys:Static\"));\n\n#region  CORS Setup (Bearer mode, no credentials)\n\nvar allowedOrigins = builder.Configuration.GetSection(\"Cors:AllowedOrigins\").Get<string[]>();\nif (allowedOrigins == null || allowedOrigins.Length == 0)\n{\n    var raw = builder.Configuration[\"Cors:AllowedOrigins\"];\n    if (!string.IsNullOrWhiteSpace(raw))\n        allowedOrigins = raw.Split(new[] { ',', ';', ' ' }, StringSplitOptions.RemoveEmptyEntries | StringSplitOptions.TrimEntries);\n}\nConsole.WriteLine(\"[CORS] Allowed origins => \" + string.Join(\", \", allowedOrigins ?? Array.Empty<string>()));\n\n\n\nbuilder.Services.AddCors(options =>\n{\n    options.AddPolicy(\"AllowFrontend\", policy =>\n    {\n        policy\n            .WithOrigins(allowedOrigins ?? Array.Empty<string>())\n            .AllowAnyHeader()\n            .AllowAnyMethod()\n            .AllowCredentials();\n    });\n});\n#endregion\n\n#region  MVC + Swagger + Middleware\nbuilder.Services.AddControllers()\n    .AddJsonOptions(opts =>\n    {\n        opts.JsonSerializerOptions.Converters.Add(new JsonStringEnumConverter(JsonNamingPolicy.CamelCase));\n    });\n\nbuilder.Services.AddEndpointsApiExplorer();\n\n//builder.Services.AddSwaggerGen(options =>\n//{\n//    options.SwaggerDoc(\"v1\", new Microsoft.OpenApi.Models.OpenApiInfo\n//    {\n//        Title = \"xByteChat API\",\n//        Version = \"v1\",\n//        Description = \"API documentation for xByteChat project\"\n//    });\n//});\nbuilder.Services.AddSwaggerGen(options =>\n{\n    options.SwaggerDoc(\"v1\", new Microsoft.OpenApi.Models.OpenApiInfo\n    {\n        Title = \"xByteChat API\",\n        Version = \"v1\",\n        Description = \"API documentation for xByteChat project\"\n    });\n\n    options.AddSecurityDefinition(\"Bearer\", new Microsoft.OpenApi.Models.OpenApiSecurityScheme\n    {\n        Description = \"JWT Authorization header. Example: Bearer {token}\",\n        Name = \"Authorization\",\n        In = Microsoft.OpenApi.Models.ParameterLocation.Header,\n        Type = Microsoft.OpenApi.Models.SecuritySchemeType.Http,\n        Scheme = \"bearer\",\n        BearerFormat = \"JWT\"\n    });\n\n    options.AddSecurityDefinition(\"ApiKey\", new OpenApiSecurityScheme\n    {\n        Description = \"Paste your static key (no quotes). Example: api_live_DEV_xxx\",\n        In = ParameterLocation.Header,\n        Name = \"X-Auth-Key\",\n        Type = SecuritySchemeType.ApiKey\n    });\n\n    options.AddSecurityRequirement(new Microsoft.OpenApi.Models.OpenApiSecurityRequirement\n    {\n        {\n            new Microsoft.OpenApi.Models.OpenApiSecurityScheme\n            {\n                Reference = new Microsoft.OpenApi.Models.OpenApiReference\n                { Type = Microsoft.OpenApi.Models.ReferenceType.SecurityScheme, Id = \"Bearer\" }\n            },\n            Array.Empty<string>()\n        },\n        {\n            new Microsoft.OpenApi.Models.OpenApiSecurityScheme\n            {\n                Reference = new Microsoft.OpenApi.Models.OpenApiReference\n                { Type = Microsoft.OpenApi.Models.ReferenceType.SecurityScheme, Id = \"ApiKey\" }\n            },\n            Array.Empty<string>()\n        }\n    });\n});\n\n#endregion\n\n#region  Embedded Signup\n\n// 1) Options binding (use consistent path/casing)\nbuilder.Services.Configure<EsuOptions>(builder.Configuration.GetSection(\"EmbeddedSignup\"));\n\n// 2) Infra\nbuilder.Services.AddHttpClient(); // harmless global client registration\n\n// 3) ESU core services\nbuilder.Services.AddScoped<IEsuStateStore, MemoryEsuStateStore>();\nbuilder.Services.AddScoped<IEsuFlagStore, EsuFlagStore>();\nbuilder.Services.AddScoped<IFacebookEsuService, FacebookEsuService>();\nbuilder.Services.AddScoped<IEsuTokenStore, EsuTokenStore>();\n// Environment-aware validation\nvar isDev = builder.Environment.IsDevelopment();\n\nbuilder.Services\n    .AddOptions<xbytechat.api.Features.ESU.Facebook.Options.FacebookOauthOptions>()\n    .Bind(builder.Configuration.GetSection(\"EmbeddedSignup:Facebook\"))\n    .PostConfigure(o =>\n    {\n        o.GraphBaseUrl = string.IsNullOrWhiteSpace(o.GraphBaseUrl)\n            ? \"https://graph.facebook.com\"\n            : o.GraphBaseUrl.TrimEnd('/');\n        o.GraphApiVersion = string.IsNullOrWhiteSpace(o.GraphApiVersion)\n            ? \"v20.0\"\n            : o.GraphApiVersion.Trim('/');\n    })\n    //  AppId must always exist\n    .Validate(o => !string.IsNullOrWhiteSpace(o.AppId),\n        \"EmbeddedSignup:Facebook:AppId is required.\")\n    //  AppSecret required only in non-Development\n    .Validate(o => isDev || !string.IsNullOrWhiteSpace(o.AppSecret),\n        \"EmbeddedSignup:Facebook:AppSecret is required in non-Development.\")\n    //  RedirectUri must be absolute (https required outside dev)\n    .Validate(o =>\n    {\n        if (string.IsNullOrWhiteSpace(o.RedirectUri)) return false;\n        if (!Uri.TryCreate(o.RedirectUri, UriKind.Absolute, out var uri)) return false;\n        return isDev || uri.Scheme == Uri.UriSchemeHttps;\n    }, \"EmbeddedSignup:Facebook:RedirectUri must be an absolute HTTPS URL.\")\n    .ValidateOnStart();\n\n// 4) Typed HttpClient for OAuth token exchange\nbuilder.Services.AddHttpClient<IFacebookOauthClient,FacebookOauthClient>(client =>\n{\n    client.Timeout = TimeSpan.FromSeconds(15);\n});\n\n// 5) ESU flag cache configuration\nbuilder.Services.AddOptions<EsuFlagCacheOptions>()\n    .Bind(builder.Configuration.GetSection(\"EmbeddedSignup:FlagCache\"))\n    .PostConfigure(o =>\n    {\n        if (o.TtlSeconds <= 0) o.TtlSeconds = 30;\n        if (o.MissTtlSeconds <= 0) o.MissTtlSeconds = 5;\n    });\n\n// 6) Token retrieval service\nbuilder.Services.AddScoped<IFacebookTokenService, FacebookTokenService>();\n\n\nbuilder.Services.AddHttpClient<IFacebookGraphClient, FacebookGraphClient>(client =>\n {\n     client.Timeout = TimeSpan.FromSeconds(15);\n });\n\nbuilder.Services.AddScoped<IEsuStatusService, EsuStatusService>();\n\n\n\nbuilder.Services.Configure<FacebookOptions>(builder.Configuration.GetSection(\"EmbeddedSignup:Facebook\"));\n\nbuilder.Services.Configure<UiOptions>(builder.Configuration.GetSection(\"Ui\"));\n#endregion\n\n#region Rate Limiter\nbuilder.Services.AddRateLimiter(o =>\n{\n    o.AddFixedWindowLimiter(\"GlobalLimiter\", opt =>\n    {\n        opt.PermitLimit = 100;\n        opt.Window = TimeSpan.FromMinutes(1);\n        opt.QueueLimit = 0;\n    });\n    o.AddFixedWindowLimiter(\"AuthLimiter\", opt =>\n    {\n        opt.PermitLimit = 10;   // login/signup attempts per minute\n        opt.Window = TimeSpan.FromMinutes(1);\n        opt.QueueLimit = 0;\n    });\n});\n\n#endregion\n\n#region Account Insignts\nbuilder.Services.AddScoped<IAccountInsightsService, AccountInsightsService>();\nbuilder.Services.AddScoped<IAccountInsightsAlertService, AccountInsightsAlertService>();\n\n#endregion\n\n#region payment module\nbuilder.Services.AddScoped<ISubscriptionService, SubscriptionService>();\nbuilder.Services.AddScoped<IInvoiceService, InvoiceService>();\nbuilder.Services.AddScoped<ICouponService, CouponService>();\nbuilder.Services.AddScoped<IAccessGuard, AccessGuard>();\nbuilder.Services.AddHttpClient<IPaymentGatewayService, RazorpayPaymentGatewayService>();\nbuilder.Services.AddScoped<ISubscriptionCheckoutService, SubscriptionCheckoutService>();\nbuilder.Services.AddScoped<PaymentOverviewService>();\nbuilder.Services.AddScoped<IAccessGuard, AccessGuard>();\nbuilder.Services.AddScoped<SubscriptionLifecycleService>();\nbuilder.Services.Configure<SubscriptionLifecycleOptions>(\n    builder.Configuration.GetSection(\"SubscriptionLifecycle\"));\n\n#endregion\n\n#region Quota Module (Entitlement)\nbuilder.Services.AddScoped<IQuotaService, QuotaService>();\n#endregion\nbuilder.Services.Configure<HostOptions>(o =>\n    o.BackgroundServiceExceptionBehavior = BackgroundServiceExceptionBehavior.Ignore);\n\nbuilder.Services.AddAutoMapper(AppDomain.CurrentDomain.GetAssemblies());\n\n#region SignalR\nbuilder.Services.AddSignalR();\nbuilder.Services.AddSingleton<IUserIdProvider, NameUserIdProvider>();\n#endregion\n\nbuilder.Services.AddHttpClient(\"customapi-webhooks\", c =>\n{\n    c.Timeout = TimeSpan.FromSeconds(10);\n});\nbuilder.Services.AddScoped<ICtaJourneyPublisher, CtaJourneyPublisher>();\nbuilder.Services.AddScoped<CtaJourneyPublisher>();\n\nAppDomain.CurrentDomain.UnhandledException += (_, e) =>\n    Log.Error(e.ExceptionObject as Exception, \"Unhandled exception (AppDomain)\");\n\n\nTaskScheduler.UnobservedTaskException += (_, e) =>\n{\n    Log.Error(e.Exception, \"Unobserved task exception\");\n    e.SetObserved();\n};\nvar app = builder.Build();\n\n\n\napp.MapGet(\"/api/debug/cors\", () => Results.Ok(new\n{\n    Allowed = app.Services.GetRequiredService<IConfiguration>()\n              .GetSection(\"Cors:AllowedOrigins\").Get<string[]>()\n}));\napp.MapGet(\"/api/debug/db\", async (AppDbContext db) =>\n{\n    try\n    {\n        await db.Database.OpenConnectionAsync();\n        await db.Database.CloseConnectionAsync();\n        return Results.Ok(\"ok\");\n    }\n    catch (Exception ex) { return Results.Problem(ex.Message); }\n});\napp.MapGet(\"/api/debug/_dbping\", async (IConfiguration cfg) =>\n{\n    try\n    {\n        var cs = cfg.GetConnectionString(\"DefaultConnection\");\n        await using var conn = new Npgsql.NpgsqlConnection(cs);\n        await conn.OpenAsync();\n        await using var cmd = new Npgsql.NpgsqlCommand(\"select version()\", conn);\n        var ver = (string?)await cmd.ExecuteScalarAsync();\n        return Results.Ok(new { ok = true, version = ver });\n    }\n    catch (Exception ex)\n    {\n        return Results.Problem(title: \"DB ping failed\", detail: ex.ToString(), statusCode: 500);\n    }\n});\napp.MapGet(\"/api/debug/conn\", (IConfiguration cfg) =>\n{\n    var cs = cfg.GetConnectionString(\"DefaultConnection\") ?? \"\";\n    var b = new NpgsqlConnectionStringBuilder(cs);\n    return Results.Ok(new\n    {\n        host = b.Host,\n        port = b.Port,\n        database = b.Database,\n        username = b.Username,\n        sslmode = b.SslMode.ToString(),\n        hasPassword = !string.IsNullOrEmpty(b.Password)\n    });\n});\n// Try DNS resolution of the DB host that /api/debug/conn reports\napp.MapGet(\"/api/debug/dns\", (IConfiguration cfg) =>\n{\n    var cs = cfg.GetConnectionString(\"DefaultConnection\") ?? \"\";\n    var b = new NpgsqlConnectionStringBuilder(cs);\n    try\n    {\n        var ips = Dns.GetHostAddresses(b.Host);\n        return Results.Ok(new { host = b.Host, addresses = ips.Select(i => i.ToString()).ToArray() });\n    }\n    catch (Exception ex)\n    {\n        return Results.Problem($\"DNS failed for host '{b.Host}': {ex.Message}\");\n    }\n});\n\n\n#region  Middleware Pipeline Setup \n\n#region CSP SEcurity\n\napp.Use(async (ctx, next) =>\n{\n    if (ctx.Request.Path.StartsWithSegments(\"/swagger\"))\n    {\n        // Swagger UI needs inline script & style\n        ctx.Response.Headers[\"Content-Security-Policy\"] =\n            \"default-src 'self'; \" +\n            \"script-src 'self' 'unsafe-inline'; \" +   // relaxed only for /swagger\n            \"style-src 'self' 'unsafe-inline'; \" +\n            \"img-src 'self' data: blob:; \" +\n            \"font-src 'self' data:; \" +\n            \"connect-src 'self'; \" +\n            \"frame-ancestors 'none'; \" +\n            \"base-uri 'self';\";\n    }\n    else\n    {\n        // Keep stricter policy for the rest of the app\n        ctx.Response.Headers[\"Content-Security-Policy\"] =\n            \"default-src 'self'; \" +\n            \"script-src 'self'; \" +                    // no inline scripts outside Swagger\n            \"style-src 'self' 'unsafe-inline'; \" +\n            \"img-src 'self' data: blob:; \" +\n            \"font-src 'self' data:; \" +\n            \"connect-src 'self'; \" +\n            \"frame-ancestors 'none'; \" +\n            \"base-uri 'self';\";\n    }\n\n    ctx.Response.Headers[\"X-Content-Type-Options\"] = \"nosniff\";\n    ctx.Response.Headers[\"X-Frame-Options\"] = \"DENY\";\n    ctx.Response.Headers[\"Referrer-Policy\"] = \"strict-origin-when-cross-origin\";\n    ctx.Response.Headers[\"Permissions-Policy\"] = \"camera=(), microphone=(), geolocation=()\";\n    await next();\n});\n\n\n\n#endregion\nAuditLoggingHelper.Configure(app.Services);\n\napp.UseMiddleware<GlobalExceptionMiddleware>();\n\nif (app.Environment.IsDevelopment())\n{\n    // Dev-specific configs\n}\n\napp.UseSwagger();\n\n//app.UseSwaggerUI();\napp.UseSwaggerUI(c =>\n{\n    c.SwaggerEndpoint(\"/swagger/v1/swagger.json\", \"xbytechat.api v1\");\n    c.RoutePrefix = \"swagger\";\n});\nif (!app.Environment.IsDevelopment())\n{\n\n    app.UseHttpsRedirection();\n    app.UseHsts();\n}\n\n// Security headers\n//app.Use(async (context, next) =>\n//{\n//    context.Response.Headers[\"X-Content-Type-Options\"] = \"nosniff\";\n//    context.Response.Headers[\"X-Frame-Options\"] = \"DENY\";\n//    context.Response.Headers[\"X-XSS-Protection\"] = \"1; mode=block\";\n//    context.Response.Headers[\"Referrer-Policy\"] = \"strict-origin-when-cross-origin\";\n//    context.Response.Headers[\"Permissions-Policy\"] = \"geolocation=(), microphone=(), camera=()\";\n//    await next();\n//});\n\napp.UseRouting();\napp.UseCors(\"AllowFrontend\");\n\napp.UseAuthentication();\napp.UseAuthorization();\napp.UseRateLimiter();\napp.MapControllers()\n     .RequireRateLimiting(\"GlobalLimiter\");\n\n\n//app.MapHub<InboxHub>(\"/hubs/inbox\");\napp.MapHub<InboxHub>(\"/api/hubs/inbox\");\napp.Run();\n#endregion\n\n\n\n\n\n\n"
    },
    {
      "path": "xbytechat-api/Properties/launchSettings.json",
      "sha256": "3374c65b7338b8a459db1242f356b2dd07d3dfd4cded988482a8f34fbe64e62e",
      "language": "json",
      "size": 1102,
      "content": "{\n  \"$schema\": \"http://json.schemastore.org/launchsettings.json\",\n  \"iisSettings\": {\n    \"windowsAuthentication\": false,\n    \"anonymousAuthentication\": true,\n    \"iisExpress\": {\n      \"applicationUrl\": \"http://localhost:18939\",\n      \"sslPort\": 44375\n    }\n  },\n  \"profiles\": {\n    \"http\": {\n      \"commandName\": \"Project\",\n      \"dotnetRunMessages\": true,\n      \"launchBrowser\": true,\n      \"launchUrl\": \"swagger\",\n      \"applicationUrl\": \"http://localhost:5295;http://localhost:7113\",\n      \"environmentVariables\": {\n        \"ASPNETCORE_ENVIRONMENT\": \"Development\"\n      }\n    },\n    \"https\": {\n      \"commandName\": \"Project\",\n      \"dotnetRunMessages\": true,\n      \"launchBrowser\": true,\n      \"launchUrl\": \"swagger\",\n      \"applicationUrl\": \"http://localhost:7113;http://localhost:5295\",\n      \"environmentVariables\": {\n        \"ASPNETCORE_ENVIRONMENT\": \"Development\"\n      }\n    },\n    \"IIS Express\": {\n      \"commandName\": \"IISExpress\",\n      \"launchBrowser\": true,\n      \"launchUrl\": \"swagger\",\n      \"environmentVariables\": {\n        \"ASPNETCORE_ENVIRONMENT\": \"Development\"\n      }\n    }\n  }\n}\n"
    },
    {
      "path": "xbytechat-api/RepositoriesGen/Implementations/GenericRepository.cs",
      "sha256": "68fdbced75094ad69adcf2073501cec37b1745f7b4d6206826d6aedc33fe0a46",
      "language": "csharp",
      "size": 2091,
      "content": "using System;\nusing System.Collections.Generic;\nusing System.Linq;\nusing System.Linq.Expressions;\nusing System.Threading.Tasks;\nusing Microsoft.EntityFrameworkCore;\nusing xbytechat.api.Repositories.Interfaces;\n\nnamespace xbytechat.api.Repositories.Implementations\n{\n    public class GenericRepository<T> : IGenericRepository<T> where T : class\n    {\n        private readonly AppDbContext _context;\n        private readonly DbSet<T> _dbSet;\n\n        public GenericRepository(AppDbContext context)\n        {\n            _context = context;\n            _dbSet = _context.Set<T>();\n        }\n\n        public async Task<IEnumerable<T>> GetAllAsync()\n        {\n            return await _dbSet.ToListAsync();\n        }\n\n        public async Task<T?> FindByIdAsync(Guid id)\n        {\n            return await _dbSet.FindAsync(id);\n        }\n\n        public async Task AddAsync(T entity)\n        {\n            await _dbSet.AddAsync(entity);\n        }\n\n        public void Update(T entity)\n        {\n            _dbSet.Update(entity);\n        }\n\n        public void Delete(T entity)\n        {\n            _dbSet.Remove(entity);\n        }\n\n        public async Task<T?> FirstOrDefaultAsync(Expression<Func<T, bool>> predicate)\n        {\n            return await _dbSet.FirstOrDefaultAsync(predicate);\n        }\n\n        public async Task<IEnumerable<T>> FindAllAsync(Expression<Func<T, bool>> predicate)\n        {\n            return await _dbSet.Where(predicate).ToListAsync();\n        }\n\n        public async Task<bool> ExistsAsync(Expression<Func<T, bool>> predicate)\n        {\n            return await _dbSet.AnyAsync(predicate);\n        }\n\n        public async Task SaveAsync()\n        {\n            await _context.SaveChangesAsync();\n        }\n\n        public async Task<List<T>> WhereAsync(Expression<Func<T, bool>> predicate)\n        {\n            return await _context.Set<T>().Where(predicate).ToListAsync();\n        }\n\n        //  NEW: Enables .Include(), .ThenInclude(), etc.\n        public IQueryable<T> AsQueryable()\n        {\n            return _dbSet.AsQueryable();\n        }\n    }\n}\n"
    },
    {
      "path": "xbytechat-api/RepositoriesGen/Interfaces/IGenericRepository.cs",
      "sha256": "dce9a4518c5e6db0da8996246969bbc864c23c5ec0eeb93ac053cc16a33bc920",
      "language": "csharp",
      "size": 941,
      "content": "using System;\nusing System.Collections.Generic;\nusing System.Linq;\nusing System.Linq.Expressions;\nusing System.Threading.Tasks;\n\nnamespace xbytechat.api.Repositories.Interfaces\n{\n    public interface IGenericRepository<T> where T : class\n    {\n        //  Basic Reads\n        Task<IEnumerable<T>> GetAllAsync();\n        Task<T?> FindByIdAsync(Guid id);\n        Task<T?> FirstOrDefaultAsync(Expression<Func<T, bool>> predicate);\n        Task<IEnumerable<T>> FindAllAsync(Expression<Func<T, bool>> predicate);\n\n        //  Checks\n        Task<bool> ExistsAsync(Expression<Func<T, bool>> predicate);\n\n        //  Commands\n        Task AddAsync(T entity);\n        void Update(T entity);\n        void Delete(T entity);\n        Task SaveAsync();\n\n        Task<List<T>> WhereAsync(Expression<Func<T, bool>> predicate);\n\n        //  New: Supports advanced LINQ operations like Include()\n        IQueryable<T> AsQueryable();\n    }\n}\n"
    },
    {
      "path": "xbytechat-api/Services/MessageModule/Implementations/MessageService.cs",
      "sha256": "df4904957a9ef900be4c3b85e61e948b37984a54ff581b7767929c80b6d69ebe",
      "language": "csharp",
      "size": 9801,
      "content": "using System.Text;\nusing System.Net.Http.Headers;\nusing Newtonsoft.Json;\nusing xbytechat.api.DTOs.Messages;\nusing xbytechat.api.Helpers;\nusing xbytechat.api.Models;\nusing xbytechat.api.PayloadBuilders;\nusing xbytechat.api.Repositories.Interfaces;\nusing xbytechat.api.Services.Messages.Interfaces;\nusing Microsoft.Extensions.Configuration;\nusing Microsoft.Extensions.Logging;\nusing Microsoft.EntityFrameworkCore;\n\nnamespace xbytechat.api.Services.Messages.Implementations\n{\n    public class MessageService : IMessageService\n    {\n        private readonly AppDbContext _dbContext;\n        private readonly HttpClient _httpClient;\n        private readonly IConfiguration _config;\n        private readonly IGenericRepository<MessageLog> _messageLogRepo;\n        private readonly Dictionary<string, IWhatsAppPayloadBuilder> _payloadBuilders;\n        private readonly ILogger<MessageService> _logger;\n\n        public MessageService(\n            AppDbContext dbContext,\n            HttpClient httpClient,\n            IConfiguration config,\n            IGenericRepository<MessageLog> messageLogRepo,\n            IEnumerable<IWhatsAppPayloadBuilder> builders,\n            ILogger<MessageService> logger)\n        {\n            _dbContext = dbContext;\n            _httpClient = httpClient;\n            _config = config;\n            _messageLogRepo = messageLogRepo;\n            _logger = logger;\n\n            _payloadBuilders = builders.ToDictionary(\n                b => b.GetType().Name.Replace(\"MessagePayloadBuilder\", \"\").ToLower(),\n                b => b\n            );\n        }\n\n        public async Task SendFollowUpAsync(string recipientNumber, string messageContent)\n        {\n            var dto = new TextMessageDto\n            {\n                RecipientNumber = recipientNumber,\n                MessageContent = messageContent,\n                BusinessId = Guid.Empty // Optional: Set dynamically if needed\n            };\n\n            await SendMessageAsync(dto); //  You already have this method\n        }\n\n\n        public async Task<SendResultExtended> SendMessageAsync(BaseMessageDto dto)\n        {\n            var messageType = dto.GetType().Name.Replace(\"MessageDto\", \"\").ToLower();\n\n            //  Get the right builder (e.g., for text, image)\n            if (!_payloadBuilders.TryGetValue(messageType, out var builder))\n            {\n                return new SendResultExtended\n                {\n                    Success = false,\n                    Message = \" Unsupported message type: \" + messageType\n                };\n            }\n\n            var apiUrl = _config[\"WhatsApp:ApiUrl\"];\n            var apiToken = _config[\"WhatsApp:apiToken\"];\n            _httpClient.DefaultRequestHeaders.Authorization = new AuthenticationHeaderValue(\"Bearer\", apiToken);\n\n            var payload = builder.BuildPayload(dto);\n            var json = JsonConvert.SerializeObject(payload);\n            var content = new StringContent(json, Encoding.UTF8, \"application/json\");\n\n            _logger.LogInformation(\" Sending Payload: {Payload}\", json);\n\n            try\n\n\n            {\n                //  Log the payload for debugging\n                _logger.LogInformation(\" Final WhatsApp Payload:\\n\" + JsonConvert.SerializeObject(payload, Formatting.Indented));\n\n                var response = await _httpClient.PostAsync(apiUrl, content);\n                var rawResponse = await response.Content.ReadAsStringAsync();\n\n                string? messageId = null;\n\n                //  Try extracting messageId (WAMID) from response\n                if (response.IsSuccessStatusCode)\n                {\n                    try\n                    {\n                        var jsonObj = JsonConvert.DeserializeObject<dynamic>(rawResponse);\n                        messageId = jsonObj?.messages?[0]?.id;\n                    }\n                    catch (Exception ex)\n                    {\n                        _logger.LogWarning(\" Message sent but failed to parse WAMID: \" + ex.Message);\n                    }\n                }\n\n                //  Log message for tracking\n                var log = new MessageLog\n                {\n                    BusinessId = dto.BusinessId,\n                    RecipientNumber = dto.RecipientNumber,\n                    MessageContent = dto is TextMessageDto textDto && !string.IsNullOrEmpty(textDto.MessageContent)\n                        ? textDto.MessageContent\n                        : \"[Empty or Non-Text]\",\n                    MediaUrl = (dto as ImageMessageDto)?.MediaUrl,\n                    Status = response.IsSuccessStatusCode ? \"Sent\" : \"Failed\",\n                    ErrorMessage = response.IsSuccessStatusCode ? null : response.ReasonPhrase,\n                    RawResponse = rawResponse,\n                    SentAt = DateTime.UtcNow,\n                    MessageId = messageId\n                };\n\n                await _messageLogRepo.AddAsync(log);\n                await _messageLogRepo.SaveAsync();\n\n                return new SendResultExtended\n                {\n                    Success = response.IsSuccessStatusCode,\n                    Message = response.IsSuccessStatusCode ? \" Message sent successfully\" : \" Failed to send message\",\n                    MessageId = messageId,\n                    RawResponse = rawResponse,\n                    MessageLogId = log.Id\n                };\n            }\n            catch (Exception ex)\n            {\n                _logger.LogError(ex, \" Exception during message send\");\n\n                return new SendResultExtended\n                {\n                    Success = false,\n                    Message = \" Exception while sending\",\n                    ErrorMessage = ex.Message\n                };\n            }\n        }\n        public async Task<SendResultExtended> SendInteractiveMessageAsync(string recipientPhone, string bodyText, List<string> buttons)\n        {\n            var apiUrl = _config[\"WhatsApp:ApiUrl\"];\n            var apiToken = _config[\"WhatsApp:apiToken\"];\n\n            _httpClient.DefaultRequestHeaders.Authorization = new AuthenticationHeaderValue(\"Bearer\", apiToken);\n\n            var payload = new\n            {\n                messaging_product = \"whatsapp\",\n                to = recipientPhone,\n                type = \"interactive\",\n                interactive = new\n                {\n                    type = \"button\",\n                    body = new { text = bodyText },\n                    action = new\n                    {\n                        buttons = buttons.Select((text, index) => new\n                        {\n                            type = \"reply\",\n                            reply = new\n                            {\n                                id = $\"cta_{index + 1}\",\n                                title = text\n                            }\n                        }).ToList()\n                    }\n                }\n            };\n\n            var json = JsonConvert.SerializeObject(payload);\n            var content = new StringContent(json, Encoding.UTF8, \"application/json\");\n\n            _logger.LogInformation(\" Sending CTA Message: \" + json);\n\n            try\n            {\n                var response = await _httpClient.PostAsync(apiUrl, content);\n                var rawResponse = await response.Content.ReadAsStringAsync();\n                // Message send here successfully \n                string? messageId = null;\n                if (response.IsSuccessStatusCode)\n                {\n                    try\n                    {\n                        dynamic jsonObj = JsonConvert.DeserializeObject<dynamic>(rawResponse);\n                        messageId = jsonObj?.messages?[0]?.id;\n                    }\n                    catch (Exception ex)\n                    {\n                        _logger.LogWarning(\" Sent, but failed to parse messageId: \" + ex.Message);\n                    }\n                }\n\n                // Log to MessageLogs table (optional: use a dummy entry)\n\n                var log = new MessageLog\n                {\n\n                    //BusinessId = Guid.Parse(\"put-a-valid-business-guid-here\"), //Guid.Empty, // set properly if you want to track\n                    BusinessId = Guid.TryParse(\"45262049-0127-4658-93e1-b3ffea645f4f\", out var parsedId)\n    ? parsedId\n    : throw new FormatException(\" Invalid GUID format used for BusinessId.\"),\n                    RecipientNumber = recipientPhone,\n                    MessageContent = bodyText,\n                    Status = response.IsSuccessStatusCode ? \"Sent\" : \"Failed\",\n                    ErrorMessage = response.IsSuccessStatusCode ? null : response.ReasonPhrase,\n                    RawResponse = rawResponse,\n                    SentAt = DateTime.UtcNow,\n                    MessageId = messageId\n                };\n\n                await _messageLogRepo.AddAsync(log);\n                await _messageLogRepo.SaveAsync();\n\n                return new SendResultExtended\n                {\n                    Success = response.IsSuccessStatusCode,\n                    Message = response.IsSuccessStatusCode ? \" CTA message sent\" : \" Failed to send CTA\",\n                    MessageId = messageId,\n                    RawResponse = rawResponse,\n                    MessageLogId = log.Id\n                };\n            }\n            catch (Exception ex)\n            {\n                _logger.LogError(ex, \" Exception while sending CTA\");\n\n                return new SendResultExtended\n                {\n                    Success = false,\n                    Message = \" Exception while sending CTA\",\n                    ErrorMessage = ex.InnerException?.Message ?? ex.Message //  this is critical\n                };\n            }\n\n        }\n\n    }\n}\n\n\n\n\n\n"
    },
    {
      "path": "xbytechat-api/Services/MessageModule/Interfaces/IMessageService.cs",
      "sha256": "7592cb1c94c37bab95a7c1a34fbc22e00b2fa0428bc1a23a4c2626a437314c30",
      "language": "csharp",
      "size": 846,
      "content": "using System.Threading.Tasks;\nusing xbytechat.api.DTOs.Messages;\nusing xbytechat.api.Helpers;\n\nnamespace xbytechat.api.Services.Messages.Interfaces\n{\n    public interface IMessageService\n    {\n        /// <summary>\n        /// Sends a message of any supported type (Text, Image, Template).\n        /// </summary>\n        /// <param name=\"dto\">Base DTO representing message details.</param>\n        /// <returns>Standardized result with status, error info, and raw response.</returns>\n        Task<SendResultExtended> SendMessageAsync(BaseMessageDto dto);\n        //Task<SendResultExtended> SendBulkMessagesAsync(BulkMessageDto dto);\n        Task SendFollowUpAsync(string recipientNumber, string messageContent);\n        Task<SendResultExtended> SendInteractiveMessageAsync(string recipientPhone, string bodyText, List<string> buttons);\n\n\n    }\n}\n"
    },
    {
      "path": "xbytechat-api/Services/WhatsAppService.cs",
      "sha256": "239db95488943944c9836125a53c4ede14522f2bc4914748e07350d86cc0051f",
      "language": "csharp",
      "size": 2917,
      "content": "using System.Net.Http.Headers;\nusing System.Text;\nusing System.Text.Json;\nusing Microsoft.Extensions.Configuration;\nusing xbytechat.api.Models;\n\nnamespace xbytechat.api.Services\n{\n    public class WhatsAppService\n    {\n        private readonly HttpClient _httpClient;\n        private readonly string _whatsAppToken;\n        private readonly string _whatsAppPhoneId;\n\n        public WhatsAppService(IConfiguration configuration)\n        {\n            _httpClient = new HttpClient();\n\n            _whatsAppToken = configuration[\"WhatsApp:apiToken\"];\n            _whatsAppPhoneId = configuration[\"WhatsApp:PhoneNumberId\"];\n\n            if (string.IsNullOrEmpty(_whatsAppToken))\n                Console.WriteLine(\" Token is NULL or EMPTY from config!\");\n\n            if (string.IsNullOrEmpty(_whatsAppPhoneId))\n                Console.WriteLine(\" Phone ID is NULL or EMPTY from config!\");\n        }\n\n        public async Task<WhatsAppResult> SendMessageAsync(string recipientPhone, string messageText)\n        {\n            try\n            {\n                Console.WriteLine(\" Preparing to send WhatsApp message...\");\n                var url = $\"https://graph.facebook.com/v22.0/{_whatsAppPhoneId}/messages\";\n\n                var payload = new\n                {\n                    messaging_product = \"whatsapp\",\n                    to = recipientPhone,\n                    type = \"text\",\n                    text = new { body = messageText }\n                };\n\n                var json = JsonSerializer.Serialize(payload);\n                var content = new StringContent(json, Encoding.UTF8, \"application/json\");\n\n                _httpClient.DefaultRequestHeaders.Authorization = new AuthenticationHeaderValue(\"Bearer\", _whatsAppToken);\n\n                var response = await _httpClient.PostAsync(url, content);\n                var responseBody = await response.Content.ReadAsStringAsync();\n\n                Console.WriteLine($\" Status: {response.StatusCode}\");\n                Console.WriteLine($\" Response: {responseBody}\");\n\n                if (response.IsSuccessStatusCode)\n                {\n                    return new WhatsAppResult { Success = true, RawResponse = responseBody };\n                }\n                else\n                {\n                    return new WhatsAppResult\n                    {\n                        Success = false,\n                        ErrorMessage = $\"Meta API Error: {response.StatusCode}\",\n                        RawResponse = responseBody\n                    };\n                }\n            }\n            catch (Exception ex)\n            {\n                Console.WriteLine(\" Exception while sending:\");\n                Console.WriteLine(ex.Message);\n\n                return new WhatsAppResult\n                {\n                    Success = false,\n                    ErrorMessage = ex.Message\n                };\n            }\n        }\n\n    }\n}\n"
    },
    {
      "path": "xbytechat-api/Shared/AutoMapperProfile.cs",
      "sha256": "0ba07b894bf8d3f5c191c050ba75cebe9b18dd77aa56b6a61dfb332f2ef09283",
      "language": "csharp",
      "size": 726,
      "content": "using AutoMapper;\nusing xbytechat.api.Features.CampaignModule.DTOs;\nusing xbytechat.api.Features.CampaignModule.Models;\nusing xbytechat.api.DTOs.Messages;\nusing xbytechat.api.Features.Tracking.DTOs;\nusing xbytechat.api.Features.Tracking.Models;\nusing xbytechat.api.Features.MessageManagement.DTOs;\nusing xbytechat.api.Features.CRM.Dtos;\nusing xbytechat.api.Features.CRM.Models;\n\nnamespace xbytechat.api.Shared\n{\n    public class AutoMapperProfile : Profile\n    {\n        public AutoMapperProfile()\n        {\n            CreateMap<Contact, ContactDto>();\n            CreateMap<Campaign, CampaignDto>();\n            CreateMap<MessageLog, MessageLogDto>();\n            CreateMap<TrackingLog, TrackingLogDto>();\n        }\n    }\n}\n"
    },
    {
      "path": "xbytechat-api/Shared/BusinessControllerBase.cs",
      "sha256": "ae04266e74cbbdfb58a81d85d24db83b9151ebef9e42b000430e8853ac2aa32f",
      "language": "csharp",
      "size": 343,
      "content": "using System;\nusing Microsoft.AspNetCore.Mvc;\n\nnamespace xbytechat.api.Shared\n{\n    // Do NOT add [ApiController] here; keep it on concrete controllers.\n    public abstract class BusinessControllerBase : ControllerBase\n    {\n        protected Guid BusinessId => User.GetBusinessId();\n        protected Guid UserId => User.GetUserId();\n    }\n}\n"
    },
    {
      "path": "xbytechat-api/Shared/ClaimsBusinessDetails.cs",
      "sha256": "c2e6949a61ef96fc2c06636f297b8d8d033f3f29fa5d7b57230743db945ed0a2",
      "language": "csharp",
      "size": 939,
      "content": "using System;\nusing System.Security.Claims;\n\nnamespace xbytechat.api.Shared\n{\n    public static class ClaimsBusinessDetails\n    {\n        public static Guid GetBusinessId(this ClaimsPrincipal user)\n        {\n            var businessIdClaim = user.FindFirst(\"businessId\")?.Value; // lowercase only!\n            if (string.IsNullOrEmpty(businessIdClaim) || !Guid.TryParse(businessIdClaim, out var businessId))\n                throw new UnauthorizedAccessException(\"Invalid or missing businessId in token.\");\n            return businessId;\n        }\n\n        public static Guid GetUserId(this ClaimsPrincipal user)\n        {\n            var userIdClaim = user.FindFirst(ClaimTypes.NameIdentifier)?.Value;\n            if (string.IsNullOrEmpty(userIdClaim) || !Guid.TryParse(userIdClaim, out var userId))\n                throw new UnauthorizedAccessException(\"Invalid or missing userId in token.\");\n            return userId;\n        }\n    }\n}\n"
    },
    {
      "path": "xbytechat-api/Shared/ClaimsPrincipalExtensions.cs",
      "sha256": "aceea513e3338cb16f3558e4dea2d6cafd833f7786da41a6c718b9b2c7294670",
      "language": "csharp",
      "size": 90,
      "content": "namespace xbytechat.api.Shared\n{\n    public class ClaimsPrincipalExtensions\n    {\n    }\n}\n"
    },
    {
      "path": "xbytechat-api/Shared/PaginatedRequest.cs",
      "sha256": "af6fceb743c7fcb6bbb984e08b2bb8e696a447e38e61b6fc85a7b9dd48a0fb04",
      "language": "csharp",
      "size": 363,
      "content": "namespace xbytechat.api.Shared\n{\n    public class PaginatedRequest\n    {\n        public int Page { get; set; } = 1;       // Page number (1-based)\n        public int PageSize { get; set; } = 10;  // Items per page\n\n        // Optional filter (can be extended later)\n        public string? Status { get; set; }\n        public string? Search { get; set; }\n    }\n}\n\n"
    },
    {
      "path": "xbytechat-api/Shared/PaginatedResponse.cs",
      "sha256": "d59aca9b4129006df5c4ec39b4e6793672e9493f4581e7963b6c215465d1b113",
      "language": "csharp",
      "size": 296,
      "content": "using System.Collections.Generic;\n\nnamespace xbytechat.api.Shared\n{\n    public class PaginatedResponse<T>\n    {\n        public List<T> Items { get; set; } = new();\n        public int TotalCount { get; set; }\n        public int Page { get; set; }\n        public int PageSize { get; set; }\n    }\n}\n"
    },
    {
      "path": "xbytechat-api/Shared/TrackingUtils/DeviceHelper.cs",
      "sha256": "70ad5b3deb3b07358a3ce61a514b3a9c3f4bb78007752bd0f4106ef8a3f27b32",
      "language": "csharp",
      "size": 748,
      "content": "// File: Features/CTATracking/Utils/DeviceHelper.cs\n\nnamespace xbytechat.api.Shared.TrackingUtils\n{\n    public static class DeviceHelper\n    {\n        public static string GetDeviceType(string userAgent)\n        {\n            if (string.IsNullOrEmpty(userAgent)) return \"Unknown\";\n\n            userAgent = userAgent.ToLower();\n\n            if (userAgent.Contains(\"mobile\") || userAgent.Contains(\"android\") || userAgent.Contains(\"iphone\"))\n                return \"Mobile\";\n\n            if (userAgent.Contains(\"ipad\") || userAgent.Contains(\"tablet\"))\n                return \"Tablet\";\n\n            if (userAgent.Contains(\"windows\") || userAgent.Contains(\"macintosh\"))\n                return \"Desktop\";\n\n            return \"Unknown\";\n        }\n    }\n}\n"
    },
    {
      "path": "xbytechat-api/Shared/TrackingUtils/GeoHelper.cs",
      "sha256": "359da4b5f8939751d00d9137b41774e466af302ccaf60e203c1b0f0827a9eafd",
      "language": "csharp",
      "size": 952,
      "content": "// File: Features/CTATracking/Utils/GeoHelper.cs\n\nusing System.Net.Http;\nusing System.Text.Json;\nusing System.Threading.Tasks;\n\nnamespace xbytechat.api.Shared.TrackingUtils\n{\n    public static class GeoHelper\n    {\n        public static async Task<string> GetCountryFromIP(string ipAddress)\n        {\n            try\n            {\n                if (string.IsNullOrWhiteSpace(ipAddress) || ipAddress == \"::1\")\n                    return \"Localhost\";\n\n                using var client = new HttpClient();\n                var response = await client.GetStringAsync($\"https://ipapi.co/{ipAddress}/json/\");\n\n                var doc = JsonDocument.Parse(response);\n                if (doc.RootElement.TryGetProperty(\"country_name\", out var countryProp))\n                    return countryProp.GetString() ?? \"Unknown\";\n            }\n            catch\n            {\n                // fallback\n            }\n\n            return \"Unknown\";\n        }\n    }\n}\n"
    },
    {
      "path": "xbytechat-api/Shared/TrackingUtils/TrackingUrlBuilder.cs",
      "sha256": "d944abb54aa2863bcad184f9d8bbd42d683f5d0b0b07474ea3f26903e7cc13d5",
      "language": "csharp",
      "size": 1370,
      "content": "using System;\nusing System.Web;\n\nnamespace xbytechat.api.Shared.TrackingUtils\n{\n    public static class TrackingUrlBuilder\n    {\n        public static string BuildTrackingUrl(\n            Guid businessId,\n            string sourceType,\n            Guid sourceId,\n            string buttonText,\n            string redirectUrl,\n            Guid? messageId = null,\n            Guid? contactId = null,\n            string contactPhone = null,\n            string sessionId = null,\n            string threadId = null)\n        {\n            var query = HttpUtility.ParseQueryString(string.Empty);\n            query[\"src\"] = sourceType;\n            query[\"id\"] = sourceId.ToString();\n            query[\"btn\"] = buttonText;\n            query[\"to\"] = redirectUrl;\n            query[\"type\"] = buttonText;\n            if (messageId != null) query[\"msg\"] = messageId.ToString();\n            if (contactId != null) query[\"contact\"] = contactId.ToString();\n            if (!string.IsNullOrEmpty(contactPhone)) query[\"phone\"] = contactPhone;\n            if (!string.IsNullOrEmpty(sessionId)) query[\"session\"] = sessionId;\n            if (!string.IsNullOrEmpty(threadId)) query[\"thread\"] = threadId;\n\n            var baseUrl = Environment.GetEnvironmentVariable(\"API_BASE_URL\") ?? \"https://yourdomain.com\";\n            return $\"{baseUrl}/api/tracking/redirect?{query}\";\n        }\n    }\n}\n"
    },
    {
      "path": "xbytechat-api/Shared/utility/TemplateParameterHelper.cs",
      "sha256": "51753bdf8ce7b9964913d5a501bee92803cf58d23cc315def80b8c69561dfbe1",
      "language": "csharp",
      "size": 1252,
      "content": "using Newtonsoft.Json;\nusing System.Text.RegularExpressions;\n\nnamespace xbytechat.api.Shared.utility\n{\n    public static class TemplateParameterHelper\n    {\n        //  Used when parsing stored JSON parameters\n        public static List<string> ParseTemplateParams(string? jsonString)\n        {\n            if (string.IsNullOrWhiteSpace(jsonString)) return new List<string>();\n            try\n            {\n                return JsonConvert.DeserializeObject<List<string>>(jsonString) ?? new List<string>();\n            }\n            catch\n            {\n                return new List<string>();\n            }\n        }\n\n        //  NEW: Fills {{1}}, {{2}} with parameter values\n        public static string FillPlaceholders(string template, List<string> parameters)\n        {\n            if (string.IsNullOrWhiteSpace(template) || parameters == null || parameters.Count == 0)\n                return template;\n\n            // Replace {{1}}, {{2}} ... with values\n            return Regex.Replace(template, @\"\\{\\{(\\d+)\\}\\}\", match =>\n            {\n                var index = int.Parse(match.Groups[1].Value) - 1;\n                return index >= 0 && index < parameters.Count ? parameters[index] : match.Value;\n            });\n        }\n    }\n}\n"
    },
    {
      "path": "xbytechat-api/Validators/MessageTypeValidator.cs",
      "sha256": "a9accea936700f5fa40d270dffc11079bdce7a4ede1f30f968b41436460b80b2",
      "language": "csharp",
      "size": 871,
      "content": "namespace xbytechat.api.Validators\n{\n    /// <summary>\n    /// Centralized validator for supported message types (text, image, template, etc.)\n    /// </summary>\n    public static class MessageTypeValidator\n    {\n        private static readonly HashSet<string> SupportedTypes = new()\n        {\n            \"text\", \"image\", \"template\"\n        };\n\n        /// <summary>\n        /// Checks whether a messageType is supported.\n        /// </summary>\n        public static bool IsValid(string? messageType)\n        {\n            return !string.IsNullOrWhiteSpace(messageType) &&\n                   SupportedTypes.Contains(messageType.ToLower());\n        }\n\n        /// <summary>\n        /// Returns all supported message types.\n        /// </summary>\n        public static IEnumerable<string> GetSupportedTypes()\n        {\n            return SupportedTypes;\n        }\n    }\n}\n"
    },
    {
      "path": "xbytechat-api/WhatsAppSettings/Abstractions/IMetaTemplateCatalogProvider.cs",
      "sha256": "86349422826b2dc4082100f836645a12e3ceea4ff94f60ce89ca253f1083e818",
      "language": "csharp",
      "size": 626,
      "content": "using System.Collections.Generic;\nusing System.Threading;\nusing System.Threading.Tasks;\nusing xbytechat.api.WhatsAppSettings.DTOs;\nusing xbytechat_api.WhatsAppSettings.Models;\n\nnamespace xbytechat.api.WhatsAppSettings.Abstractions\n{\n    public interface IMetaTemplateCatalogProvider\n    {\n        Task<IReadOnlyList<TemplateCatalogItem>> ListMetaAsync(\n            WhatsAppSettingEntity setting,\n            CancellationToken ct = default);\n\n        Task<TemplateCatalogItem?> GetByNameMetaAsync(\n            WhatsAppSettingEntity setting,\n            string templateName,\n            CancellationToken ct = default);\n    }\n}\n"
    },
    {
      "path": "xbytechat-api/WhatsAppSettings/Abstractions/IPinnacleTemplateCatalogProvider.cs",
      "sha256": "2b217b52f24e7214b9794295352839f4472418921d0d17a57bf4f5e8ce9aaeff",
      "language": "csharp",
      "size": 638,
      "content": "using System.Collections.Generic;\nusing System.Threading;\nusing System.Threading.Tasks;\nusing xbytechat.api.WhatsAppSettings.DTOs;\nusing xbytechat_api.WhatsAppSettings.Models;\n\nnamespace xbytechat.api.WhatsAppSettings.Abstractions\n{\n    public interface IPinnacleTemplateCatalogProvider\n    {\n        Task<IReadOnlyList<TemplateCatalogItem>> ListPinnacleAsync(\n            WhatsAppSettingEntity setting,\n            CancellationToken ct = default);\n\n        Task<TemplateCatalogItem?> GetByNamePinnacleAsync(\n            WhatsAppSettingEntity setting,\n            string templateName,\n            CancellationToken ct = default);\n    }\n}\n"
    },
    {
      "path": "xbytechat-api/WhatsAppSettings/Abstractions/ITemplateCatalogProvider.cs",
      "sha256": "c20ebfc19a7f6f0a37a9d5d1f0458ac22c9ea6c66f3a0b08d6f4132c0f90b513",
      "language": "csharp",
      "size": 670,
      "content": "using System.Collections.Generic;\nusing System.Threading;\nusing System.Threading.Tasks;\nusing xbytechat.api.WhatsAppSettings.DTOs;      // TemplateCatalogItem\nusing xbytechat_api.WhatsAppSettings.Models;    // WhatsAppSettingEntity\n\nnamespace xbytechat.api.WhatsAppSettings.Abstractions\n{\n    public interface ITemplateCatalogProvider\n    {\n        Task<IReadOnlyList<TemplateCatalogItem>> ListAsync(\n            WhatsAppSettingEntity setting,\n            CancellationToken ct = default);\n\n        Task<TemplateCatalogItem?> GetByNameAsync(\n            WhatsAppSettingEntity setting,\n            string templateName,\n            CancellationToken ct = default);\n    }\n}\n"
    },
    {
      "path": "xbytechat-api/WhatsAppSettings/Abstractions/TemplateCatalogItem.cs",
      "sha256": "66c3b015d5dea2cf216f9b23fbcb1e7074d22d7850a79401cfbae44bf9a3677c",
      "language": "csharp",
      "size": 450,
      "content": "using xbytechat.api.WhatsAppSettings.DTOs;\n\nnamespace xbytechat.api.WhatsAppSettings.Abstractions\n{\n    public record TemplateCatalogItem(\n       string Name,\n       string Language,\n       string Body,\n       int PlaceholderCount,\n       bool HasImageHeader,\n       IReadOnlyList<ButtonMetadataDto> Buttons,\n       string Status,\n       string? Category,\n       string? ExternalId,\n       string RawJson,\n        string? SubCategory = null\n   );\n}\n\n"
    },
    {
      "path": "xbytechat-api/WhatsAppSettings/Common/Providers.cs",
      "sha256": "f28418126b45e299564664005d25a4c33d566f9deeb455d10358c28c54ccc6bc",
      "language": "csharp",
      "size": 801,
      "content": "namespace xbytechat.api.WhatsAppSettings.Common\n{\n    public static class Providers\n    {\n        public const string PINNACLE = \"PINNACLE\";\n        public const string META_CLOUD = \"META_CLOUD\";\n\n        public static string NormalizeToUpper(string? raw)\n        {\n            if (string.IsNullOrWhiteSpace(raw)) return PINNACLE;\n            var s = raw.Trim().ToUpperInvariant();\n            return s switch\n            {\n                \"META\" => META_CLOUD,\n                \"META_CLOUD\" => META_CLOUD,\n                \"PINNACLE\" => PINNACLE,\n                _ => s // future providers just uppercase\n            };\n        }\n        public static bool IsValid(string? raw)\n        {\n            var s = NormalizeToUpper(raw);\n            return s == PINNACLE || s == META_CLOUD;\n        }\n    }\n}\n"
    },
    {
      "path": "xbytechat-api/WhatsAppSettings/Controllers/TemplateMetaController.cs",
      "sha256": "989605668ac2858b4f7cd8064a8c8eeeafa800c2561df9484854f7c8f6923846",
      "language": "csharp",
      "size": 1630,
      "content": "using System;\nusing System.Threading.Tasks;\nusing Microsoft.AspNetCore.Authorization;\nusing Microsoft.AspNetCore.Mvc;\nusing xbytechat_api.WhatsAppSettings.Services;\n\nnamespace xbytechat.api.WhatsAppSettings.Controllers\n{\n    [ApiController]\n    [Route(\"api/templates/meta\")]\n    [Authorize]\n    public sealed class TemplateMetaController : ControllerBase\n    {\n        private readonly IWhatsAppTemplateFetcherService _fetcher;\n\n        public TemplateMetaController(IWhatsAppTemplateFetcherService fetcher)\n        {\n            _fetcher = fetcher;\n        }\n\n        \n        [HttpGet(\"list/{businessId:guid}\")]\n        public async Task<IActionResult> List(Guid businessId, [FromQuery] string? provider = null)\n        {\n            if (businessId == Guid.Empty) return BadRequest(new { message = \"Invalid businessId\" });\n            var list = await _fetcher.GetTemplatesMetaAsync(businessId, provider);\n            return Ok(list);\n        }\n\n        // GET /api/templates/meta/{businessId}/{templateName}?language=en_US&provider=META_CLOUD\n        [HttpGet(\"{businessId:guid}/{templateName}\")]\n        public async Task<IActionResult> One(Guid businessId, string templateName, [FromQuery] string? language = null, [FromQuery] string? provider = null)\n        {\n            if (businessId == Guid.Empty || string.IsNullOrWhiteSpace(templateName))\n                return BadRequest(new { message = \"Invalid parameters\" });\n\n            var meta = await _fetcher.GetTemplateMetaAsync(businessId, templateName, language, provider);\n            if (meta is null) return NotFound();\n            return Ok(meta);\n        }\n    }\n}\n"
    },
    {
      "path": "xbytechat-api/WhatsAppSettings/Controllers/TemplatePreviewController.cs",
      "sha256": "d8b530f953ecd1e5448fa763ad12dc25bbcf061b8cb7d599d4cad9a5da7f060f",
      "language": "csharp",
      "size": 1212,
      "content": "using System;\nusing System.Threading.Tasks;\nusing Microsoft.AspNetCore.Authorization;\nusing Microsoft.AspNetCore.Mvc;\nusing xbytechat.api.WhatsAppSettings.DTOs;\nusing xbytechat_api.WhatsAppSettings.Services;\n\nnamespace xbytechat.api.Features.WhatsAppSettings.Controllers\n{\n    [ApiController]\n    [Route(\"api/templates/preview\")]\n    [Authorize]\n    public sealed class TemplatePreviewController : ControllerBase\n    {\n        private readonly ITemplatePreviewService _svc;\n\n        public TemplatePreviewController(ITemplatePreviewService svc)\n        {\n            _svc = svc;\n        }\n\n        // POST /api/templates/preview/{businessId}\n        [HttpPost(\"{businessId:guid}\")]\n        public async Task<IActionResult> TemplatePreview([FromRoute] Guid businessId, [FromBody] TemplatePreviewRequestDto request)\n        {\n            if (businessId == Guid.Empty) return BadRequest(new { message = \"Invalid businessId\" });\n            if (request == null || string.IsNullOrWhiteSpace(request.TemplateName))\n                return BadRequest(new { message = \"TemplateName is required.\" });\n\n            var result = await _svc.PreviewAsync(businessId, request);\n            return Ok(result);\n        }\n    }\n}\n"
    },
    {
      "path": "xbytechat-api/WhatsAppSettings/Controllers/TemplatesController.cs",
      "sha256": "cd8759fcc64db63cd8014f3329b58ca30deaf70f88104d874646d6612ecdbf2e",
      "language": "csharp",
      "size": 11494,
      "content": "using Microsoft.AspNetCore.Authorization;\nusing Microsoft.AspNetCore.Mvc;\nusing Microsoft.EntityFrameworkCore;\nusing Microsoft.Extensions.FileSystemGlobbing;\nusing xbytechat.api.WhatsAppSettings.Services;\nusing xbytechat_api.WhatsAppSettings.Models;\nusing xbytechat_api.WhatsAppSettings.Services;\nnamespace xbytechat.api.WhatsAppSettings.Controllers\n{\n    [ApiController]\n    [Route(\"api/templates\")]\n    public class TemplatesController : ControllerBase\n    {\n        private readonly AppDbContext _db;\n        private readonly ITemplateSyncService _sync;\n        private readonly IWhatsAppTemplateFetcherService _fetcher;\n\n        public TemplatesController(AppDbContext db, ITemplateSyncService sync, IWhatsAppTemplateFetcherService fetcher)\n        { _db = db; _sync = sync; _fetcher = fetcher; }\n\n\n        // Sync Templates\n        ////[HttpPost(\"sync/{businessId:guid}\")]\n        ////[Authorize]\n        ////public async Task<IActionResult> Sync(Guid businessId, [FromQuery] bool force = false)\n        ////{\n        ////    if (businessId == Guid.Empty) return BadRequest(new { success = false, message = \"Invalid businessId\" });\n        ////    var result = await _sync.SyncBusinessTemplatesAsync(businessId, force);\n        ////    return Ok(new { success = true, result });\n        ////}\n        [HttpPost(\"sync/{businessId:guid}\")]\n        [Authorize]\n        public async Task<IActionResult> Sync(Guid businessId)\n        {\n            if (businessId == Guid.Empty)\n                return BadRequest(new { success = false, message = \"Invalid businessId\" });\n\n            // Button = always fetch and upsert (ignore TTL; do not deactivate)\n            var result = await _sync.SyncBusinessTemplatesAsync(\n                businessId,\n                force: true,onlyUpsert: true);\n\n            return Ok(new { success = true, result });\n        }\n\n        [HttpGet(\"{businessId:guid}\")]\n        [Authorize]\n        public async Task<IActionResult> List(\n      Guid businessId,\n      [FromQuery] string? q = null,\n      [FromQuery] string? status = \"APPROVED\",\n      [FromQuery] string? language = null,\n      [FromQuery] string? provider = null)\n        {\n            var query = _db.WhatsAppTemplates\n                .AsNoTracking()\n                .Where(x => x.BusinessId == businessId && x.IsActive);\n\n            if (!string.IsNullOrWhiteSpace(status))\n            {\n                var s = status.Trim().ToUpperInvariant();     // stored uppercase\n                query = query.Where(x => x.Status == s);\n            }\n\n            if (!string.IsNullOrWhiteSpace(language))\n            {\n                var lang = language.Trim();\n                query = query.Where(x => x.LanguageCode == lang);\n            }\n\n            if (!string.IsNullOrWhiteSpace(provider))\n            {\n                var prov = provider.Trim().ToUpperInvariant(); // stored uppercase\n                query = query.Where(x => x.Provider == prov);\n            }\n\n            if (!string.IsNullOrWhiteSpace(q))\n            {\n                var term = q.Trim();\n                query = query.Where(x =>\n                    x.Name.Contains(term) ||\n                    (x.Body != null && x.Body.Contains(term)));\n            }\n\n            var items = await query\n                .OrderBy(x => x.Name)\n                .Select(x => new\n                {\n                    x.Name,\n                    x.LanguageCode,\n                    x.Status,\n                    x.Category,\n                    BodyVarCount = x.BodyVarCount, // <-- replaces PlaceholderCount\n                    x.UrlButtons\n                })\n                .ToListAsync();\n\n            return Ok(new { success = true, templates = items });\n        }\n\n\n        //[HttpGet(\"{businessId:guid}/{name}\")]\n        //[Authorize]\n\n\n        //public async Task<IActionResult> GetOne(Guid businessId, string name, [FromQuery] string? language = null)\n        //{\n        //    var tpl = await _db.WhatsAppTemplates\n        //        .AsNoTracking()\n        //        .FirstOrDefaultAsync(x =>\n        //            x.BusinessId == businessId\n        //            && x.Name == name\n        //            && (language == null || x.LanguageCode == language));\n\n        //    if (tpl == null) return NotFound();\n\n        //    // Prefer stored values; optionally refine via meta fetcher\n        //    string headerKind = (tpl.HeaderKind ?? \"none\").Trim().ToLowerInvariant();\n        //    bool requiresHeaderMediaUrl = tpl.RequiresMediaHeader\n        //                                  || headerKind is \"image\" or \"video\" or \"document\";\n\n        //    try\n        //    {\n        //        // If you still want live verification, keep this; otherwise you can remove the try/catch block\n        //        var meta = await _fetcher.GetTemplateMetaAsync(\n        //            businessId: businessId,\n        //            templateName: tpl.Name,\n        //            language: tpl.LanguageCode,\n        //            provider: null);\n\n        //        var ht = meta?.HeaderType?.Trim().ToUpperInvariant();\n        //        if (!string.IsNullOrEmpty(ht))\n        //        {\n        //            headerKind = ht switch\n        //            {\n        //                \"IMAGE\" => \"image\",\n        //                \"VIDEO\" => \"video\",\n        //                \"DOCUMENT\" => \"document\",\n        //                \"TEXT\" => \"text\",\n        //                _ => headerKind\n        //            };\n        //            requiresHeaderMediaUrl = headerKind is \"image\" or \"video\" or \"document\";\n        //        }\n        //    }\n        //    catch\n        //    {\n        //        // fall back to stored fields (already set above)\n        //    }\n\n        //    return Ok(new\n        //    {\n        //        tpl.Name,\n        //        tpl.LanguageCode,\n        //        tpl.Status,\n        //        tpl.Category,\n        //        tpl.Body,\n        //        BodyVarCount = tpl.BodyVarCount,   // <- replaces old PlaceholderCount\n        //        tpl.UrlButtons,\n        //        headerKind,\n        //        requiresHeaderMediaUrl\n        //    });\n        //}\n        [HttpGet(\"{businessId:guid}/{name}\")]\n        [Authorize]\n        public async Task<IActionResult> GetOne(Guid businessId, string name, [FromQuery] string? language = null)\n        {\n            var tpl = await _db.WhatsAppTemplates\n                .AsNoTracking()\n                .FirstOrDefaultAsync(x =>\n                    x.BusinessId == businessId &&\n                    x.Name == name &&\n                    (language == null || x.LanguageCode == language));\n\n            if (tpl == null) return NotFound();\n\n            //  header info (keep your current behavior)\n            string headerKind = (tpl.HeaderKind ?? \"none\").Trim().ToLowerInvariant();\n            bool requiresHeaderMediaUrl = tpl.RequiresMediaHeader\n                                          || headerKind is \"image\" or \"video\" or \"document\";\n            try\n            {\n                var meta = await _fetcher.GetTemplateMetaAsync(\n                    businessId: businessId,\n                    templateName: tpl.Name,\n                    language: tpl.LanguageCode,\n                    provider: null);\n\n                var ht = meta?.HeaderType?.Trim().ToUpperInvariant();\n                if (!string.IsNullOrEmpty(ht))\n                {\n                    headerKind = ht switch\n                    {\n                        \"IMAGE\" => \"image\",\n                        \"VIDEO\" => \"video\",\n                        \"DOCUMENT\" => \"document\",\n                        \"TEXT\" => \"text\",\n                        _ => headerKind\n                    };\n                    requiresHeaderMediaUrl = headerKind is \"image\" or \"video\" or \"document\";\n                }\n            }\n            catch { /* fall back to stored */ }\n\n            //  build a normalized buttons array from RawJson\n            var buttons = new List<object>();\n            try\n            {\n                // RawJson was saved during sync; shape matches provider response.\n                // We'll look for components[].type == \"BUTTONS\".\n                var root = Newtonsoft.Json.Linq.JObject.Parse(string.IsNullOrWhiteSpace(tpl.RawJson) ? \"{}\" : tpl.RawJson);\n                var components = root.SelectToken(\"components\") ?? root.SelectToken(\"data.components\") ?? root.SelectToken(\"template.components\");\n\n                if (components is Newtonsoft.Json.Linq.JArray arr)\n                {\n                    foreach (var c in arr)\n                    {\n                        var type = c?[\"type\"]?.ToString()?.ToUpperInvariant();\n                        if (type != \"BUTTONS\") continue;\n\n                        var btns = c[\"buttons\"] as Newtonsoft.Json.Linq.JArray;\n                        if (btns == null) continue;\n\n                        int idx = 0;\n                        foreach (var b in btns)\n                        {\n                            var btnType = b?[\"type\"]?.ToString()?.ToUpperInvariant() ?? \"\";\n                            var text = b?[\"text\"]?.ToString() ?? \"\";\n                            // default fields\n                            string subType = btnType switch\n                            {\n                                \"URL\" => \"url\",\n                                \"PHONE_NUMBER\" => \"voice_call\",\n                                \"QUICK_REPLY\" => \"quick_reply\",\n                                \"COPY_CODE\" => \"copy_code\",\n                                \"CATALOG\" => \"catalog\",\n                                \"FLOW\" => \"flow\",\n                                \"REMINDER\" => \"reminder\",\n                                \"ORDER_DETAILS\" => \"order_details\",\n                                _ => \"unknown\"\n                            };\n\n                            // capture param (for dynamic URL / phone / coupon / flow)\n                            string? param =\n                                b?[\"url\"]?.ToString()\n                                ?? b?[\"phone_number\"]?.ToString()\n                                ?? b?[\"coupon_code\"]?.ToString()\n                                ?? b?[\"flow_id\"]?.ToString();\n\n                            buttons.Add(new\n                            {\n                                text = text,\n                                type = btnType,        // original provider type (UPPERCASE)\n                                subType = subType,     // normalized (lowercase)\n                                index = (int?)(b?[\"index\"]?.ToObject<int?>() ?? idx),\n                                parameterValue = param // may be null for quick replies\n                            });\n\n                            idx++;\n                        }\n                    }\n                }\n            }\n            catch\n            {\n                // ignore parse errors; just return other fields\n            }\n\n            return Ok(new\n            {\n                tpl.Name,\n                LanguageCode = tpl.LanguageCode,\n                tpl.Status,\n                tpl.Category,\n                Body = tpl.Body,\n                BodyVarCount = tpl.BodyVarCount, // new field you already use in List\n                UrlButtons = tpl.UrlButtons,     // keep legacy field (indexes of URL buttons)\n                headerKind,\n                requiresHeaderMediaUrl,\n                buttons                           //  NEW: full set including quick replies\n            });\n        }\n\n    }\n}\n"
    },
    {
      "path": "xbytechat-api/WhatsAppSettings/Controllers/WhatsAppNumbersController.cs",
      "sha256": "81acd60e9331bc4c7b0fb8b3cfdaea4dc1c4932811338b70e0f2fd174b2dca1f",
      "language": "csharp",
      "size": 6041,
      "content": "using System;\nusing System.Linq;\nusing System.Security.Claims;\nusing System.Threading.Tasks;\nusing Microsoft.AspNetCore.Mvc;\nusing Microsoft.AspNetCore.Http;\nusing Microsoft.Extensions.Logging;\nusing xbytechat.api.Features.WhatsAppSettings.Services;\nusing xbytechat.api.Features.WhatsAppSettings.Models;\nusing xbytechat.api.Shared;\nusing xbytechat_api.WhatsAppSettings.Services;\n\nnamespace xbytechat.api.Features.WhatsAppSettings.Controllers\n{\n    [ApiController]\n    [Route(\"api/whatsappsettings/{provider}/numbers\")]\n    public class WhatsAppNumbersController : ControllerBase\n    {\n        private readonly IWhatsAppPhoneNumberService _svc;\n        private readonly ILogger<WhatsAppNumbersController> _logger;\n\n        public WhatsAppNumbersController(\n            IWhatsAppPhoneNumberService svc,\n            ILogger<WhatsAppNumbersController> logger)\n        {\n            _svc = svc;\n            _logger = logger;\n        }\n\n        // Helper to resolve BusinessId from claims/header/query (adjust to your auth)\n        private bool TryGetBusinessId(out Guid businessId)\n        {\n            businessId = Guid.Empty;\n\n            // 1) Claim (preferred)\n            var claim = User?.FindFirst(\"BusinessId\") ?? User?.FindFirst(\"businessId\");\n            if (claim != null && Guid.TryParse(claim.Value, out businessId))\n                return true;\n\n            // 2) Header fallback\n            if (Request.Headers.TryGetValue(\"X-Business-Id\", out var h)\n                && Guid.TryParse(h.ToString(), out businessId))\n                return true;\n\n            // 3) Query fallback\n            if (Guid.TryParse(HttpContext.Request.Query[\"businessId\"], out businessId))\n                return true;\n\n            return false;\n        }\n\n        // GET /api/whatsappsettings/{provider}/numbers\n        [HttpGet]\n        [ProducesResponseType(StatusCodes.Status200OK)]\n        [ProducesResponseType(StatusCodes.Status400BadRequest)]\n        public async Task<IActionResult> List([FromRoute] string provider)\n        {\n            if (!TryGetBusinessId(out var businessId))\n                return BadRequest(\"BusinessId is required (claim/header/query).\");\n\n            var items = await _svc.ListAsync(businessId, provider);\n            return Ok(items);\n        }\n\n        public sealed class UpsertRequest\n        {\n            public string PhoneNumberId { get; set; } = null!;\n            public string WhatsAppBusinessNumber { get; set; } = null!;\n            public string? SenderDisplayName { get; set; }\n            public bool? IsActive { get; set; }\n            public bool? IsDefault { get; set; }\n        }\n\n        // POST /api/whatsappsettings/{provider}/numbers\n        [HttpPost(\"\")]\n        [ProducesResponseType(typeof(WhatsAppPhoneNumber), StatusCodes.Status200OK)]\n        [ProducesResponseType(StatusCodes.Status400BadRequest)]\n       // [HttpPost(\"\")]\n        public async Task<IActionResult> Upsert([FromRoute] string provider, [FromBody] UpsertRequest req)\n        {\n            if (!TryGetBusinessId(out var businessId))\n                return BadRequest(\"BusinessId is required (claim/header/query).\");\n\n            if (string.IsNullOrWhiteSpace(req.PhoneNumberId))\n                return BadRequest(\"phoneNumberId is required.\");\n            if (string.IsNullOrWhiteSpace(req.WhatsAppBusinessNumber))\n                return BadRequest(\"whatsAppBusinessNumber is required.\");\n\n            try\n            {\n                var saved = await _svc.UpsertAsync(\n                    businessId,\n                    provider, // service normalizes\n                    req.PhoneNumberId,\n                    req.WhatsAppBusinessNumber,\n                    req.SenderDisplayName,\n                    req.IsActive,\n                    req.IsDefault\n                );\n                return Ok(saved);\n            }\n            catch (InvalidOperationException ex) when (ex.InnerException is Npgsql.NpgsqlException npg)\n            {\n                // Bubble up constraint codes if useful\n                // 23505 unique_violation, 23503 foreign_key_violation, 23502 not_null_violation\n                return StatusCode(StatusCodes.Status409Conflict, new\n                {\n                    statusCode = 409,\n                    code = npg.SqlState,\n                    message = ex.Message\n                });\n            }\n            catch (Exception ex)\n            {\n                return StatusCode(StatusCodes.Status500InternalServerError, new\n                {\n                    statusCode = 500,\n                    message = ex.Message\n                });\n            }\n        }\n\n        // DELETE /api/whatsappsettings/{provider}/numbers/{id}\n        [HttpDelete(\"{id:guid}\")]\n        [ProducesResponseType(StatusCodes.Status204NoContent)]\n        [ProducesResponseType(StatusCodes.Status404NotFound)]\n        [ProducesResponseType(StatusCodes.Status400BadRequest)]\n        public async Task<IActionResult> Delete([FromRoute] string provider, [FromRoute] Guid id)\n        {\n            if (!TryGetBusinessId(out var businessId))\n                return BadRequest(\"BusinessId is required (claim/header/query).\");\n\n            var ok = await _svc.DeleteAsync(businessId, provider, id);\n            if (!ok) return NotFound();\n\n            return NoContent();\n        }\n\n        // PATCH /api/whatsappsettings/{provider}/numbers/{id}/default\n        [HttpPatch(\"{id:guid}/default\")]\n        [ProducesResponseType(StatusCodes.Status204NoContent)]\n        [ProducesResponseType(StatusCodes.Status404NotFound)]\n        [ProducesResponseType(StatusCodes.Status400BadRequest)]\n        public async Task<IActionResult> SetDefault([FromRoute] string provider, [FromRoute] Guid id)\n        {\n            if (!TryGetBusinessId(out var businessId))\n                return BadRequest(\"BusinessId is required (claim/header/query).\");\n\n            var ok = await _svc.SetDefaultAsync(businessId, provider, id);\n            if (!ok) return NotFound();\n\n            return NoContent();\n        }\n\n       \n   \n\n    }\n}\n"
    },
    {
      "path": "xbytechat-api/WhatsAppSettings/Controllers/WhatsAppSettingsController.cs",
      "sha256": "6b6de192548e37ead96a0668c85cf9e3f11af021e1fefe4084442cdf359f5e49",
      "language": "csharp",
      "size": 18057,
      "content": "//  File: WhatsAppSettings/Controllers/WhatsAppSettingsController.cs\nusing Microsoft.AspNetCore.Authorization;\nusing Microsoft.AspNetCore.Mvc;\nusing Microsoft.EntityFrameworkCore;\nusing Microsoft.Extensions.Logging;\nusing System;\nusing System.Linq;\nusing System.Security.Claims;\nusing System.Threading.Tasks;\nusing xbytechat.api.Features.WhatsAppSettings.Services;\nusing xbytechat.api.Shared; // for User.GetBusinessId()\nusing xbytechat.api.WhatsAppSettings.DTOs;\nusing xbytechat.api.WhatsAppSettings.Services;\nusing xbytechat_api.WhatsAppSettings.DTOs;\nusing xbytechat_api.WhatsAppSettings.Services;\n\nnamespace xbytechat_api.WhatsAppSettings.Controllers\n{\n    [ApiController]\n    [Route(\"api/[controller]\")]\n    [Authorize]\n    public class WhatsAppSettingsController : ControllerBase\n    {\n        private readonly IWhatsAppSettingsService _svc;\n        private readonly ILogger<WhatsAppSettingsController> _logger;\n        private readonly IWhatsAppSenderService _whatsAppSenderService;\n       \n        public WhatsAppSettingsController(\n            IWhatsAppSettingsService svc,\n            ILogger<WhatsAppSettingsController> logger, IWhatsAppSenderService whatsAppSenderService)\n        {\n            _svc = svc;\n            _logger = logger;\n            _whatsAppSenderService = whatsAppSenderService;\n\n        }\n\n \n        [HttpPut(\"update\")]\n        public async Task<IActionResult> UpdateSetting([FromBody] SaveWhatsAppSettingDto dto)\n        {\n            if (!ModelState.IsValid)\n                return BadRequest(new { message = \"Invalid input.\", errors = ModelState });\n\n            Guid businessId;\n            try { businessId = User.GetBusinessId(); dto.BusinessId = businessId; }\n            catch { return Unauthorized(new { message = \"BusinessId missing or invalid in token.\" }); }\n\n            await _svc.SaveOrUpdateSettingAsync(dto);\n            return Ok(new { message = \"Settings saved/updated.\" });\n        }\n\n        // ----------------------------\n        // Get the current user's saved settings\n        // ----------------------------\n        //[HttpGet(\"me\")]\n        //public async Task<IActionResult> GetMySettings()\n        //{\n        //    var businessId = User.GetBusinessId();\n        //    var setting = await _svc.GetSettingsByBusinessIdAsync(businessId);\n        //    if (setting == null)\n        //        return NotFound(new { message = \" WhatsApp settings not found.\" });\n\n        //    return Ok(setting);\n        //}\n        [HttpGet(\"me\")]\n        public async Task<IActionResult> GetMySettings()\n        {\n            var businessId = User.GetBusinessId();\n            var setting = await _svc.GetSettingsByBusinessIdAsync(businessId);\n\n            if (setting == null)\n            {\n                // Expected: user simply hasn't configured settings yet\n                return Ok(new\n                {\n                    ok = true,\n                    hasSettings = false,\n                    data = (object?)null\n                });\n            }\n\n            return Ok(new\n            {\n                ok = true,\n                hasSettings = true,\n                data = setting\n            });\n        }\n\n        // ----------------------------\n        // Test connection using values sent in the body (not necessarily saved)\n        // Accepts Provider = \"Pinnacle\" or \"Meta_cloud\"\n        // ----------------------------\n        [HttpPost(\"test-connection\")]\n        public async Task<IActionResult> TestConnection([FromBody] SaveWhatsAppSettingDto dto)\n        {\n            if (dto is null)\n                return BadRequest(new { message = \" Missing request body.\" });\n\n            var provider = NormalizeProvider(dto.Provider);\n            if (provider is null)\n                return BadRequest(new { message = \" Provider is required (Pinnacle | Meta_cloud).\" });\n\n            dto.Provider = provider; // use canonical\n\n            // Minimal provider-specific validation (service will validate again)\n            if (provider == \"META_CLOUD\")\n            {\n                if (string.IsNullOrWhiteSpace(dto.ApiUrl) ||\n                    string.IsNullOrWhiteSpace(dto.ApiKey) ||\n                    string.IsNullOrWhiteSpace(dto.PhoneNumberId))\n                {\n                    return BadRequest(new { message = \" API URL, Token and Phone Number ID are required for Meta Cloud test.\" });\n                }\n            }\n            else if (provider == \"PINNACLE\")\n            {\n                if (string.IsNullOrWhiteSpace(dto.ApiUrl) ||\n                    string.IsNullOrWhiteSpace(dto.ApiKey) ||\n                    (string.IsNullOrWhiteSpace(dto.WabaId) && string.IsNullOrWhiteSpace(dto.PhoneNumberId)) ||\n                    string.IsNullOrWhiteSpace(dto.WhatsAppBusinessNumber))\n                {\n                    return BadRequest(new\n                    {\n                        message = \" API URL, API Key, (WABA ID or Phone Number ID), and Business Number are required for Pinnacle test.\"\n                    });\n                }\n            }\n\n            try\n            {\n                var message = await _svc.TestConnectionAsync(dto);\n\n                // Convention: service returns a human string; we 200 on success (starts with ), 400 otherwise\n                if (!string.IsNullOrEmpty(message) && message.StartsWith(\"\"))\n                    return Ok(new { message });\n\n                return BadRequest(new { message = string.IsNullOrEmpty(message) ? \" Test failed.\" : message });\n            }\n            catch (Exception ex)\n            {\n                _logger.LogError(ex, \" [TestConnection] Failed\");\n                return StatusCode(500, new { message = \" Test connection failed.\", details = ex.Message });\n            }\n        }\n\n\n        [HttpPost(\"test-connection/current\")]\n        public async Task<IActionResult> TestConnectionCurrent()\n        {\n            // ---- local helpers (scoped only to this action) ----\n            static string? NormalizeProvider(string? raw)\n            {\n                if (string.IsNullOrWhiteSpace(raw)) return null;\n                var s = raw.Trim().ToLowerInvariant().Replace(\"-\", \"_\").Replace(\" \", \"_\");\n                if (s is \"meta_cloud\" or \"meta\" or \"wa_cloud\" or \"facebook\" or \"whatsapp_cloud\")\n                    return \"META_CLOUD\";\n                if (s is \"pinnacle\" or \"pinnacle_official\" or \"pinbot\")\n                    return \"PINNACLE\";\n                return null; // unknown  keep original\n            }\n\n            static string NormalizeApiUrl(string? apiUrl, string? provider)\n            {\n                if (string.Equals(provider, \"META_CLOUD\", StringComparison.Ordinal))\n                    return string.IsNullOrWhiteSpace(apiUrl) ? \"https://graph.facebook.com/v22.0\" : apiUrl.Trim();\n                return string.IsNullOrWhiteSpace(apiUrl) ? string.Empty : apiUrl.Trim();\n            }\n\n            static string? T(string? s) => string.IsNullOrWhiteSpace(s) ? null : s.Trim();\n            // ---- /helpers ----\n\n            var businessId = User.GetBusinessId();\n\n            // Pulls merged settings + number from WhatsAppPhoneNumbers via your service\n            var saved = await _svc.GetSettingsByBusinessIdAsync(businessId); // returns WhatsAppSettingsDto\n            if (saved is null)\n                return NotFound(new { message = \" No saved WhatsApp settings found.\" });\n\n            // defensive normalization (safe even if FE already sends uppercase)\n            var provider = NormalizeProvider(saved.Provider) ?? saved.Provider?.Trim().ToUpperInvariant();\n            var apiUrl = NormalizeApiUrl(saved.ApiUrl, provider);\n            var apiKey = T(saved.ApiKey);\n            var phoneId = T(saved.PhoneNumberId);\n            var wabaId = T(saved.WabaId);\n\n            var dto = new SaveWhatsAppSettingDto\n            {\n                BusinessId = businessId,\n                Provider = provider ?? saved.Provider, // keep original if we couldn't map\n                ApiUrl = apiUrl,\n                ApiKey = apiKey,\n                PhoneNumberId = phoneId, // comes from WhatsAppPhoneNumbers via DTO\n                WabaId = wabaId,\n                WhatsAppBusinessNumber = T(saved.WhatsAppBusinessNumber), // from WhatsAppPhoneNumbers\n                SenderDisplayName = null, // not used in test; include if your DTO needs it\n                WebhookSecret = null,     // ^\n                WebhookVerifyToken = null,\n                IsActive = true           // test against the active config\n            };\n\n            // Provider-specific guardrails (fail early with clear messages)\n            if (dto.Provider == \"META_CLOUD\")\n            {\n                if (string.IsNullOrEmpty(dto.ApiKey))\n                    return BadRequest(new { message = \" Missing Meta access token (ApiKey).\" });\n                if (string.IsNullOrEmpty(dto.PhoneNumberId))\n                    return BadRequest(new { message = \" Missing Meta PhoneNumberId (required for messaging endpoint tests).\" });\n                // apiUrl defaulted above if empty\n            }\n            else if (dto.Provider == \"PINNACLE\")\n            {\n                if (string.IsNullOrEmpty(dto.ApiKey))\n                    return BadRequest(new { message = \" Missing Pinnacle API key.\" });\n                if (string.IsNullOrEmpty(dto.ApiUrl))\n                    return BadRequest(new { message = \" Missing Pinnacle API URL.\" });\n                // WABA/PhoneNumberId may be optional for some Pinnacle routes; your _svc.TestConnectionAsync knows best.\n            }\n            else\n            {\n                return BadRequest(new { message = $\" Unsupported provider: {dto.Provider}\" });\n            }\n\n            try\n            {\n                var message = await _svc.TestConnectionAsync(dto);\n\n                if (!string.IsNullOrEmpty(message) && message.StartsWith(\"\"))\n                    return Ok(new { message });\n\n                return BadRequest(new { message = string.IsNullOrEmpty(message) ? \" Test failed.\" : message });\n            }\n            catch (Exception ex)\n            {\n                _logger.LogError(ex, \" [TestConnectionCurrent] Failed\");\n                return StatusCode(500, new { message = \" Test connection failed.\", details = ex.Message });\n            }\n        }\n\n        [HttpDelete(\"delete\")]\n        public async Task<IActionResult> DeleteSetting()\n        {\n            var businessId = User.GetBusinessId();\n            var deleted = await _svc.DeleteSettingsAsync(businessId);\n            if (!deleted) return NotFound(new { message = \" No WhatsApp settings found to delete.\" });\n            return Ok(new { message = \" WhatsApp settings deleted successfully.\" });\n        }\n\n        // Optional alias for FE routes that call /delete-current\n        [HttpDelete(\"delete-current\")]\n        public Task<IActionResult> DeleteSettingAlias() => DeleteSetting();\n\n        private static string? NormalizeProvider(string? providerRaw)\n        {\n            if (string.IsNullOrWhiteSpace(providerRaw)) return null;\n\n            var p = providerRaw.Trim();\n\n            // Accept canonical values exactly and a few common variants\n            if (string.Equals(p, \"Pinnacle\", StringComparison.Ordinal)) return \"Pinnacle\";\n            if (string.Equals(p, \"Meta_cloud\", StringComparison.Ordinal)) return \"Meta_cloud\";\n\n            // tolerate some user/legacy variants from older UIs\n            var lower = p.ToLowerInvariant();\n            if (lower is \"pinbot\" or \"pinnacle (official)\" or \"pinnacle (pinnacle)\" or \"pinnacle official\")\n                return \"Pinnacle\";\n            if (lower is \"meta cloud\" or \"meta\" or \"meta-cloud\")\n                return \"Meta_cloud\";\n\n            return null;\n        }\n\n        [HttpGet(\"callback-url\")]\n        public async Task<IActionResult> GetMyCallbackUrl([FromServices] IConfiguration cfg)\n        {\n            var businessId = User.GetBusinessId();\n            var baseUrl = cfg[\"App:PublicBaseUrl\"] ?? string.Empty;\n            var url = await _svc.GetCallbackUrlAsync(businessId, baseUrl);\n            return Ok(new { callbackUrl = url });\n        }\n\n        [HttpGet(\"all\")]\n        public async Task<IActionResult> GetAllForBusinessAsync([FromServices] IWhatsAppSettingsService settingsService)\n        {\n            // Resolve BusinessId from claim/header/query (same pattern used elsewhere)\n            if (!TryResolveBusinessId(HttpContext, User, out var businessId))\n                return BadRequest(\"BusinessId is required (claim/header/query).\");\n\n            var items = await settingsService.GetAllForBusinessAsync(businessId);\n            return Ok(items);\n        }\n\n        // local helper (add once in this controller if you dont already have it)\n        private static bool TryResolveBusinessId(HttpContext ctx, ClaimsPrincipal user, out Guid businessId)\n        {\n            businessId = Guid.Empty;\n\n            var claim = user?.FindFirst(\"BusinessId\") ?? user?.FindFirst(\"businessId\");\n            if (claim != null && Guid.TryParse(claim.Value, out businessId))\n                return true;\n\n            if (ctx.Request.Headers.TryGetValue(\"X-Business-Id\", out var h)\n                && Guid.TryParse(h.ToString(), out businessId))\n                return true;\n\n            if (Guid.TryParse(ctx.Request.Query[\"businessId\"], out businessId))\n                return true;\n\n            return false;\n        }\n\n        // GET /api/whatsapp/senders/{businessId}\n        [HttpGet(\"senders/{businessId:guid}\")]     // <-- align action path\n        public async Task<IActionResult> GetSenders(Guid businessId)\n        {\n            if (businessId == Guid.Empty)\n                return BadRequest(new { message = \"Invalid businessId.\" });\n\n            var items = await _whatsAppSenderService.GetBusinessSendersAsync(businessId);\n            return Ok(items);\n        }\n\n\n       \n        [HttpPost(\"fetch-numbers\")]\n        public async Task<IActionResult> FetchNumbers([FromServices] IWhatsAppPhoneNumberService phoneSvc,\n           [FromServices] IWhatsAppSettingsService settingsSvc,\n              CancellationToken ct = default)\n        {\n            // --- helpers ---\n            static string? NormalizeProvider(string? raw)\n            {\n                if (string.IsNullOrWhiteSpace(raw)) return null;\n                var s = raw.Trim().ToLowerInvariant().Replace(\"-\", \"_\").Replace(\" \", \"_\");\n                if (s is \"meta_cloud\" or \"meta\" or \"wa_cloud\" or \"facebook\" or \"whatsapp_cloud\")\n                    return \"META_CLOUD\";\n                if (s is \"pinnacle\" or \"pinnacle_official\" or \"pinbot\")\n                    return \"PINNACLE\";\n                return null;\n            }\n            static string NormalizeApiUrl(string? apiUrl, string? provider)\n            {\n                if (string.Equals(provider, \"META_CLOUD\", StringComparison.Ordinal))\n                    return string.IsNullOrWhiteSpace(apiUrl) ? \"https://graph.facebook.com/v22.0\" : apiUrl.Trim();\n                return string.IsNullOrWhiteSpace(apiUrl) ? string.Empty : apiUrl.Trim();\n            }\n            static string? T(string? s) => string.IsNullOrWhiteSpace(s) ? null : s.Trim();\n            // ---------------\n\n            var businessId = User.GetBusinessId();\n\n            // Pull merged settings (includes PhoneNumberId/WhatsAppBusinessNumber from WhatsAppPhoneNumbers)\n            var saved = await settingsSvc.GetSettingsByBusinessIdAsync(businessId); // returns WhatsAppSettingsDto\n            if (saved is null)\n                return BadRequest(new { message = \" No saved WhatsApp settings found.\" });\n\n            // Normalize provider/apiUrl defensively\n            var provider = NormalizeProvider(saved.Provider) ?? saved.Provider?.Trim().ToUpperInvariant();\n            if (provider != \"PINNACLE\" && provider != \"META_CLOUD\")\n                return BadRequest(new { message = $\" Unsupported provider: {saved.Provider}\" });\n\n            var normalized = new WhatsAppSettingsDto\n            {\n                BusinessId = saved.BusinessId,\n                Provider = provider!,\n                ApiUrl = NormalizeApiUrl(saved.ApiUrl, provider),\n                ApiKey = T(saved.ApiKey),\n                WabaId = T(saved.WabaId),\n                PhoneNumberId = T(saved.PhoneNumberId),                 // current default (may be null)\n                WhatsAppBusinessNumber = T(saved.WhatsAppBusinessNumber)\n            };\n\n            // Guardrails (clear, early, provider-specific)\n            if (provider == \"META_CLOUD\")\n            {\n                if (string.IsNullOrWhiteSpace(normalized.ApiKey))\n                    return BadRequest(new { message = \" Missing Meta access token (ApiKey).\" });\n                if (string.IsNullOrWhiteSpace(normalized.WabaId))\n                    return BadRequest(new { message = \" WABA ID is required to fetch numbers from Meta Cloud.\" });\n            }\n            else // PINNACLE\n            {\n                if (string.IsNullOrWhiteSpace(normalized.ApiKey))\n                    return BadRequest(new { message = \" Missing Pinnacle API key.\" });\n                if (string.IsNullOrWhiteSpace(normalized.ApiUrl))\n                    return BadRequest(new { message = \" Missing Pinnacle API URL.\" });\n                if (string.IsNullOrWhiteSpace(normalized.WabaId) && string.IsNullOrWhiteSpace(normalized.PhoneNumberId))\n                    return BadRequest(new { message = \" WABA ID or PhoneNumberId required to fetch numbers from Pinnacle.\" });\n            }\n\n            // Sync/ingest numbers from the provider into WhatsAppPhoneNumbers table\n            var result = await phoneSvc.SyncFromProviderAsync(businessId, normalized, provider!, ct);\n\n            return Ok(new\n            {\n                success = true,\n                added = result.Added,\n                updated = result.Updated,\n                total = result.Total,\n                provider = provider\n            });\n        }\n\n\n\n    }\n\n}\n\n\n\n\n"
    },
    {
      "path": "xbytechat-api/WhatsAppSettings/Controllers/WhatsAppTemplateFetcherController.cs",
      "sha256": "423175eb5cd31766ee4c3fe215cb17108c3cf6bc44948fc0f52a88e8a000ad39",
      "language": "csharp",
      "size": 3072,
      "content": "using Microsoft.AspNetCore.Authorization;\nusing Microsoft.AspNetCore.Mvc;\nusing xbytechat_api.WhatsAppSettings.Services;\n\nnamespace xbytechat_api.WhatsAppSettings.Controllers\n{\n    [ApiController]\n    [Route(\"api/[controller]\")]\n    public class WhatsAppTemplateFetcherController : ControllerBase\n    {\n        private readonly IWhatsAppTemplateFetcherService _templateFetcherService;\n\n        public WhatsAppTemplateFetcherController(IWhatsAppTemplateFetcherService templateFetcherService)\n        {\n            _templateFetcherService = templateFetcherService;\n        }\n\n        [HttpGet(\"get-template/{businessId}\")]\n        [Authorize] //  Optional: Require authentication if your project uses JWT auth\n        public async Task<IActionResult> FetchTemplates(Guid businessId)\n        {\n            if (businessId == Guid.Empty)\n                return BadRequest(new { message = \" Invalid BusinessId.\" });\n\n            var templates = await _templateFetcherService.FetchTemplatesAsync(businessId); // comment this line to stop fetch template as per businessid\n            //var templates = await _templateFetcherService.FetchAllTemplatesAsync(); // comment this line to stop fetch template as per businessid\n\n            return Ok(new\n            {\n                success = true,\n                templates = templates\n            });\n        }\n\n      \n\n        [HttpGet(\"get-template-all\")]\n        public async Task<IActionResult> GetAllTemplatesAsync()\n        {\n            try\n            {\n                var templates = await _templateFetcherService.FetchAllTemplatesAsync();\n                return Ok(new { success = true, templates });\n            }\n            catch (Exception ex)\n            {\n                return StatusCode(500, new\n                {\n                    success = false,\n                    message = \"Error fetching templates\",\n                    detail = ex.Message\n                });\n            }\n        }\n\n        [HttpGet(\"get-template-by-name\")]\n        public async Task<IActionResult> GetTemplateByName([FromQuery] string name)\n        {\n            var businessId = Guid.Parse(User.FindFirst(\"businessId\")?.Value);\n            var template = await _templateFetcherService.GetTemplateByNameAsync(businessId, name, true);\n            return template == null ? NotFound() : Ok(template);\n        }\n        [HttpGet(\"get-by-name/{businessId}/{templateName}\")]\n        public async Task<IActionResult> GetByName(Guid businessId, string templateName, [FromQuery] bool includeButtons = true)\n        {\n            if (businessId == Guid.Empty || string.IsNullOrWhiteSpace(templateName))\n                return BadRequest(new { success = false, message = \" Missing or invalid parameters.\" });\n\n            var template = await _templateFetcherService.GetTemplateByNameAsync(businessId, templateName, includeButtons);\n\n            if (template == null)\n                return NotFound();\n\n            return Ok(new\n            {\n                success = true,\n                template\n            });\n        }\n    }\n}\n\n"
    },
    {
      "path": "xbytechat-api/WhatsAppSettings/DTOs/ButtonMetadataDto.cs",
      "sha256": "55b2b89dbf3f8b8f16bb134711c23334c37a60c9543a1ea34325fb89506a6dce",
      "language": "csharp",
      "size": 536,
      "content": "namespace xbytechat.api.WhatsAppSettings.DTOs\n{\n    public class ButtonMetadataDto\n    {\n        public string Type { get; set; } // Example: \"URL\" or \"PHONE_NUMBER\"\n        public string Text { get; set; } // Button Text\n        public string SubType { get; set; } // (optional) for URL, Phone Number etc\n        public int Index { get; set; } // Index like 0, 1\n                                       // Optional: dynamic parameter value for validation\n        public string? ParameterValue { get; set; } // e.g. coupon_code\n    }\n\n}\n"
    },
    {
      "path": "xbytechat-api/WhatsAppSettings/DTOs/SaveWhatsAppSettingDto.cs",
      "sha256": "9c7ba8be0ccb6695a19a15e08fa4ef3542ae0978f21c1129b75fb4975cf74a32",
      "language": "csharp",
      "size": 1324,
      "content": "//  File: WhatsAppSettings/DTOs/SaveWhatsAppSettingDto.cs\nusing System;\nusing System.ComponentModel.DataAnnotations;\n\nnamespace xbytechat_api.WhatsAppSettings.DTOs\n{\n    public class SaveWhatsAppSettingDto\n    {\n        public Guid BusinessId { get; set; }\n\n        // Which provider: \"pinnacle\" | \"meta_cloud\"\n        [Required, MaxLength(50)]\n        public string Provider { get; set; } = string.Empty;\n\n        [Required, MaxLength(500)]\n        public string ApiUrl { get; set; } = string.Empty;\n\n        [MaxLength(1000)]\n        public string? ApiKey { get; set; } // Pinnacle\n\n      \n        [MaxLength(100)]\n        public string? PhoneNumberId { get; set; } // Meta Cloud\n\n        [MaxLength(100)]\n        public string? WabaId { get; set; } // Optional (Pinnacle/Meta)\n\n        [MaxLength(50)]\n        public string? WhatsAppBusinessNumber { get; set; }\n\n        [MaxLength(100)]\n        public string? SenderDisplayName { get; set; }\n\n        [MaxLength(200)]\n        public string? WebhookSecret { get; set; }\n\n        [MaxLength(200)]\n        public string? WebhookVerifyToken { get; set; }\n\n        //  NEW: per-provider callback URL (optional, stored in DB)\n        [MaxLength(1000)]\n        public string? WebhookCallbackUrl { get; set; }\n\n        public bool IsActive { get; set; } = true;\n    }\n}\n"
    },
    {
      "path": "xbytechat-api/WhatsAppSettings/DTOs/TemplateCatalogItem.cs",
      "sha256": "54c972f09c8bcba9a6e5138aa436898303927539032d8fe46cab52a7f283f3b4",
      "language": "csharp",
      "size": 567,
      "content": "// xbytechat.api/WhatsAppSettings/DTOs/TemplateCatalogItem.cs\nnamespace xbytechat.api.WhatsAppSettings.DTOs\n{\n   \n\n \n    public sealed record TemplateButtonMetadataDto\n    {\n        public string Text { get; init; } = \"\";\n        public string Type { get; init; } = \"\";     // META raw: URL / QUICK_REPLY / PHONE_NUMBER / ...\n        public string SubType { get; init; } = \"\";  // url / quick_reply / voice_call / ...\n        public int Index { get; init; }             // position in the button list\n        public string ParameterValue { get; init; } = \"\";\n    }\n}\n"
    },
    {
      "path": "xbytechat-api/WhatsAppSettings/DTOs/TemplateForUIResponseDto.cs",
      "sha256": "954d4bddaa8450da19f714aec8f819d5affa5edcee6a6e078759e3bcb04b47be",
      "language": "csharp",
      "size": 427,
      "content": "namespace xbytechat.api.WhatsAppSettings.DTOs\n{\n    public class TemplateForUIResponseDto\n    {\n        public string Name { get; set; } = \"\";\n        public string Language { get; set; } = \"en_US\";\n        public string Body { get; set; } = \"\";\n        public int ParametersCount { get; set; }\n        public bool HasImageHeader { get; set; }\n        public List<ButtonMetadataDto> ButtonParams { get; set; } = new();\n    }\n}\n"
    },
    {
      "path": "xbytechat-api/WhatsAppSettings/DTOs/TemplateMetadataDto.cs",
      "sha256": "154918abf3d7b2efa65ebcef2084ae33404f5eab44188b98d9e05a554462a4d6",
      "language": "csharp",
      "size": 968,
      "content": "namespace xbytechat.api.WhatsAppSettings.DTOs\n{\n    /// <summary>\n    /// DTO representing a simplified view of WhatsApp template metadata.\n    /// </summary>\n    public class TemplateMetadataDto\n    {\n        /// Unique name of the template.\n        public string Name { get; set; } = string.Empty;\n\n        /// Language code used when creating the template (e.g., en_US, hi_IN).\n        public string Language { get; set; } = \"en_US\";\n\n        /// The message body content with placeholders (e.g., \"Hi {{1}}, your order is ready\").\n        public string Body { get; set; } = string.Empty;\n\n        /// Number of dynamic parameters required (e.g., 2 for {{1}} and {{2}}).\n        public int PlaceholderCount { get; set; }\n\n        public List<ButtonMetadataDto> ButtonParams { get; set; } = new List<ButtonMetadataDto>(); //  Added Buttons\n        public bool HasImageHeader { get; set; } = true;\n\n        public string HeaderKind { get; set; } = \"none\";\n\n    }\n}\n"
    },
    {
      "path": "xbytechat-api/WhatsAppSettings/DTOs/TemplateMetaDto.cs",
      "sha256": "2806aa041b83e7e1ef645c67f18f7d455aac9bdd1fcce9c4538b76786132c9ff",
      "language": "csharp",
      "size": 1516,
      "content": "using System.Collections.Generic;\n\nnamespace xbytechat.api.WhatsAppSettings.DTOs\n{\n    // Normalized snapshot of a provider template for FE + snapshots\n    public sealed class TemplateMetaDto\n    {\n        public string Provider { get; set; } = \"\";     // \"META_CLOUD\" | \"PINNACLE\"\n        public string TemplateId { get; set; } = \"\";   // providers id if you store it\n        public string TemplateName { get; set; } = \"\";\n        public string Language { get; set; } = \"\";     // e.g., \"en_US\"\n\n        public bool HasHeaderMedia { get; set; }\n        public string? HeaderType { get; set; }        // \"IMAGE\" | \"VIDEO\" | \"DOCUMENT\" (future)\n\n        // 1-based placeholder slots for BODY\n        public List<PlaceholderSlot> BodyPlaceholders { get; set; } = new();\n\n        // Up to 3 buttons in template order\n        public List<TemplateButtonMeta> Buttons { get; set; } = new();\n\n    }\n\n    public sealed class TemplateButtonMeta\n    {\n        // Provider-level type (e.g., \"URL\", \"PHONE_NUMBER\", \"QUICK_REPLY\")\n        public string Type { get; set; } = \"\";\n        public string Text { get; set; } = \"\";         // label\n        public string? Value { get; set; }             // ParameterValue from provider (may contain \"{{1}}\")\n        public int Order { get; set; }                 // 0..2\n    }\n\n    public sealed class PlaceholderSlot\n    {\n        public int Index { get; set; }                 // 1..N\n        public string? Label { get; set; }\n        public string? Example { get; set; }\n    }\n}\n"
    },
    {
      "path": "xbytechat-api/WhatsAppSettings/DTOs/TemplatePreviewDto.cs",
      "sha256": "ea9fe018139bee52670ef4b1030e185040a735c6eb91257088e675e75a40e3e1",
      "language": "csharp",
      "size": 2223,
      "content": "using System;\nusing System.Collections.Generic;\n\nnamespace xbytechat.api.WhatsAppSettings.DTOs\n{\n    public sealed class TemplatePreviewRequestDto\n    {\n        public string TemplateName { get; set; } = \"\";\n        public string? Provider { get; set; }          // \"META_CLOUD\" | \"PINNACLE\" (optional)\n        public string? Language { get; set; }          // e.g., \"en_US\" (optional)\n        public string? HeaderImageUrl { get; set; }    // for image-header previews\n        public List<string> TemplateParameters { get; set; } = new();  // BODY params in order\n        public List<PreviewButtonInputDto> Buttons { get; set; } = new(); // up to 3\n    }\n\n    public sealed class PreviewButtonInputDto\n    {\n        public int Position { get; set; }              // 1..3 aligns with template button order\n        public string? Type { get; set; }              // e.g., \"URL\"\n        public string? Title { get; set; }             // label shown to user (optional)\n        public string? Value { get; set; }             // for dynamic URL value or tel/wa deep link\n    }\n\n    public sealed class TemplatePreviewResponseDto\n    {\n        public bool FoundTemplate { get; set; }\n        public string TemplateName { get; set; } = \"\";\n        public string? Language { get; set; }\n        public bool HasHeaderMedia { get; set; }\n        public string HeaderType { get; set; } = \"\";   // \"IMAGE\", \"VIDEO\", etc.\n\n        public int RequiredPlaceholderCount { get; set; }\n        public int ProvidedPlaceholderCount { get; set; }\n        public List<int> MissingPlaceholderIndices { get; set; } = new(); // 1-based\n        public List<string> Warnings { get; set; } = new();\n        public List<string> Errors { get; set; } = new();\n\n        // A provider-shaped preview of what we'd send (Meta/Pinnacle use the same component shape)\n        // Example:\n        // [\n        //   { type:\"header\", parameters:[{ type:\"image\", image:{ link:\"...\"}}]},\n        //   { type:\"body\", parameters:[{type:\"text\",text:\"..\"}, ...] },\n        //   { type:\"button\", sub_type:\"url\", index:\"0\", parameters:[{ type:\"text\", text:\"TOKEN_OR_URL\"}] }\n        // ]\n        public List<object> ProviderComponentsPreview { get; set; } = new();\n    }\n}\n"
    },
    {
      "path": "xbytechat-api/WhatsAppSettings/DTOs/TemplateShape.cs",
      "sha256": "b09887fc7a92992bd71f628553412f5a86b5164c175bc94e37286378488ab975",
      "language": "csharp",
      "size": 93,
      "content": "namespace xbytechat.api.WhatsAppSettings.DTOs\n{\n    public class TemplateShape\n    {\n    }\n}\n"
    },
    {
      "path": "xbytechat-api/WhatsAppSettings/DTOs/TemplateSummaryDto.cs",
      "sha256": "fe362a273559fdfadca0d5c953779523b4c3312685fd4043802ac0c9453a2a8f",
      "language": "csharp",
      "size": 2996,
      "content": "using System;\nusing System.Collections.Generic;\n\nnamespace xbytechat.api.WhatsAppSettings.DTOs\n{\n    /// <summary>\n    /// Section-aware summary of a provider template.\n    /// Distinct slots are tracked per section to avoid collisions (e.g., header {{1}} vs body {{1}}).\n    /// </summary>\n    public sealed class TemplateSummaryDto\n    {\n        // --- What users see in CSV/FE ---\n        public string HeaderKind { get; init; } = \"none\";           // none | text | image | video | document\n        public string? HeaderText { get; init; }                    // original header text if TEXT\n        public string? BodyText { get; init; }                      // original body text\n        public string CombinedPreviewBody { get; init; } = \"\";      // HeaderText + \"\\n\\n\" + BodyText (for FE/CSV)\n\n        // --- Distinct slot lists per section (order of appearance) ---\n        public List<int> HeaderParamIndices { get; init; } = new(); // e.g., [1,2]\n        public List<int> BodyParamIndices { get; init; } = new();   // e.g., [1,2,3]\n\n        // Per-button parameter templates (URL/tel/etc), each with their own local indices\n        public List<ButtonParamTemplate> Buttons { get; init; } = new(); // up to 3, in template order (1..3)\n\n        // Convenience total for CSV/validation (sum across sections, not union)\n        public int PlaceholderCount { get; init; }                  // HeaderParamIndices.Count + BodyParamIndices.Count +  Buttons[i].ParamIndices.Count\n    }\n\n    public sealed class ButtonParamTemplate\n    {\n        public int Order { get; init; }                 // 1..3 (template order)\n        public string Type { get; init; } = \"\";         // URL | PHONE_NUMBER | QUICK_REPLY | FLOW | ...\n        public string Text { get; init; } = \"\";         // Button label\n        public string? ParamTemplate { get; init; }     // e.g., \"https://x.example/{{1}}\", \"tel:+911234567890\"\n        public List<int> ParamIndices { get; init; } = new(); // e.g., [1]\n    }\n\n    /// <summary>\n    /// Result of filling values across all sections in the agreed order:\n    /// [ header slots... , body slots... , (btn1 slots...), (btn2 slots...), ... ]\n    /// </summary>\n    public sealed class TemplateFillResult\n    {\n        public string ResolvedHeaderText { get; init; } = \"\";\n        public string ResolvedBodyText { get; init; } = \"\";\n        public string ResolvedCombinedPreviewBody { get; init; } = \"\";\n        public List<ResolvedButtonParam> ResolvedButtons { get; init; } = new(); // aligned with TemplateSummaryDto.Buttons\n        public List<string> Warnings { get; init; } = new();\n        public List<string> Errors { get; init; } = new();\n    }\n\n    public sealed class ResolvedButtonParam\n    {\n        public int Order { get; init; }            // 1..3\n        public string Type { get; init; } = \"\";\n        public string Text { get; init; } = \"\";\n        public string? ResolvedValue { get; init; } // filled URL/tel/... or original if no placeholders\n    }\n}\n"
    },
    {
      "path": "xbytechat-api/WhatsAppSettings/DTOs/TemplateSummaryResponseDto.cs",
      "sha256": "70bdef8be64a16b303a2543426e521b694e039e2a4f0b1a403f0e8675ff9fb63",
      "language": "csharp",
      "size": 473,
      "content": "using System.Collections.Generic;\nusing xbytechat.api.WhatsAppSettings.DTOs;\n\nnamespace xbytechat.api.Features.WhatsAppSettings.DTOs\n{\n    public sealed class TemplateSummaryResponseDto\n    {\n        public string TemplateId { get; init; } = \"\";\n        public string Provider { get; init; } = \"\";\n        public string Name { get; init; } = \"\";\n        public string Language { get; init; } = \"\";\n\n        public TemplateSummaryDto Summary { get; init; } = new();\n    }\n}\n"
    },
    {
      "path": "xbytechat-api/WhatsAppSettings/DTOs/WhatsAppSenderDto.cs",
      "sha256": "8c113389ea7e922d92ef3a6f8538003ea60f8a62298e0622300bf845f290668c",
      "language": "csharp",
      "size": 869,
      "content": "namespace xbytechat.api.WhatsAppSettings.DTOs\n{\n    public class WhatsAppSenderDto\n    {\n        public Guid Id { get; set; }                         // row id in WhatsAppPhoneNumbers\n        public Guid BusinessId { get; set; }\n        public string Provider { get; set; } = string.Empty; // \"PINNACLE\" | \"META_CLOUD\"\n        public string PhoneNumberId { get; set; } = string.Empty;\n        public string WhatsAppBusinessNumber { get; set; } = string.Empty; // E.164 printable\n        public string? SenderDisplayName { get; set; }\n        public bool IsActive { get; set; }\n        public bool IsDefault { get; set; }\n        public string DisplayLabel =>\n            string.IsNullOrWhiteSpace(SenderDisplayName)\n                ? $\"{WhatsAppBusinessNumber}  {Provider}\"\n                : $\"{SenderDisplayName} ({WhatsAppBusinessNumber})  {Provider}\";\n    }\n}\n"
    },
    {
      "path": "xbytechat-api/WhatsAppSettings/DTOs/WhatsAppSettingsDto.cs",
      "sha256": "8f45c102277a57f946fd1bf84f0bbabf4986f0035b4dbbe9cbea8d98054fc998",
      "language": "csharp",
      "size": 539,
      "content": "namespace xbytechat.api.WhatsAppSettings.DTOs\n{\n    public sealed class WhatsAppSettingsDto\n    {\n        public Guid BusinessId { get; init; }\n        public string Provider { get; init; } = string.Empty;\n        public string ApiUrl { get; init; } = string.Empty;\n        public string? ApiKey { get; init; }\n        public string? WabaId { get; init; }\n\n        public string? PhoneNumberId { get; init; }  // from WhatsAppPhoneNumbers\n        public string? WhatsAppBusinessNumber { get; init; }  // from WhatsAppPhoneNumbers\n    }\n\n}\n"
    },
    {
      "path": "xbytechat-api/WhatsAppSettings/Helpers/TemplateJsonHelper.cs",
      "sha256": "aedaa16cd4ce9f6feff139747eee0211d6fb2fc2bf7aaef8492e2edb080a4bb3",
      "language": "csharp",
      "size": 13934,
      "content": "using System;\nusing System.Collections.Generic;\nusing System.Linq;\nusing System.Text.RegularExpressions;\nusing Newtonsoft.Json.Linq;\n\nnamespace xbytechat.api.WhatsAppSettings.Helpers\n{\n    public static class TemplateJsonHelper\n    {\n        // Positional like {{1}}\n        private static readonly Regex PositionalRx = new(@\"\\{\\{\\s*(\\d+)\\s*\\}\\}\", RegexOptions.Compiled);\n        // Named like {{first_name}}  (letters, digits, _, -, starting with letter/_)\n        private static readonly Regex NamedRx = new(@\"\\{\\{\\s*([A-Za-z_][A-Za-z0-9_\\-]*)\\s*\\}\\}\", RegexOptions.Compiled);\n        // Any like {{...}}  used for total counting / empty braces\n        private static readonly Regex AnyRx = new(@\"\\{\\{[^}]*\\}\\}\", RegexOptions.Compiled);\n\n        public static (string HeaderKind, string CombinedBody, int PlaceholderCount)\n            Summarize(string rawJson, string? bodyFallback = null)\n        {\n            var d = SummarizeDetailed(rawJson, bodyFallback);\n            return (d.HeaderKind ?? \"none\", d.CombinedPreviewBody ?? string.Empty, d.PlaceholderCount);\n        }\n\n        public static TemplateSummaryDto SummarizeDetailed(string rawJson, string? bodyFallback = null)\n        {\n            var doc = JToken.Parse(string.IsNullOrWhiteSpace(rawJson) ? \"{}\" : rawJson);\n            var components = doc[\"components\"] as JArray ?? new JArray();\n\n            // Provider hint (may be null/empty)\n            var parameterFormatHint = doc[\"parameter_format\"]?.ToString()?.ToUpperInvariant(); // \"POSITIONAL\" | \"NAMED\" | null\n\n            string headerKind = \"none\";\n            string? headerText = null;\n            string? bodyText = null;\n\n            var headerPosIdx = new List<int>();\n            var bodyPosIdx = new List<int>();\n            var buttons = new List<ButtonParamTemplate>();\n            var occurrences = new List<PlaceholderOccurrence>();\n\n            int order = 0;\n\n            foreach (var comp in components)\n            {\n                var type = comp?[\"type\"]?.ToString()?.ToUpperInvariant();\n                if (string.IsNullOrEmpty(type)) continue;\n\n                if (type == \"HEADER\")\n                {\n                    var format = comp?[\"format\"]?.ToString()?.ToUpperInvariant();\n                    headerKind = format switch\n                    {\n                        \"TEXT\" => \"text\",\n                        \"IMAGE\" => \"image\",\n                        \"VIDEO\" => \"video\",\n                        \"DOCUMENT\" => \"document\",\n                        _ => \"none\"\n                    };\n\n                    if (headerKind == \"text\")\n                    {\n                        headerText = comp?[\"text\"]?.ToString() ?? \"\";\n                        headerPosIdx = ExtractPositional(headerText);\n                        occurrences.AddRange(CollectOccurrences(headerText, PlaceholderLocation.Header));\n                    }\n                }\n                else if (type == \"BODY\")\n                {\n                    bodyText = comp?[\"text\"]?.ToString() ?? \"\";\n                    bodyPosIdx = ExtractPositional(bodyText);\n                    occurrences.AddRange(CollectOccurrences(bodyText, PlaceholderLocation.Body));\n                }\n                else if (type == \"BUTTONS\")\n                {\n                    var btns = comp?[\"buttons\"] as JArray ?? new JArray();\n                    foreach (var b in btns)\n                    {\n                        order++;\n                        var btnType = b?[\"type\"]?.ToString()?.ToUpperInvariant() ?? \"\";\n                        var text = b?[\"text\"]?.ToString() ?? \"\";\n\n                        string? urlLike =\n                            b?[\"url\"]?.ToString()\n                            ?? b?[\"phone_number\"]?.ToString()\n                            ?? b?[\"coupon_code\"]?.ToString()\n                            ?? b?[\"flow_id\"]?.ToString();\n\n                        // example can be string or array\n                        if (string.IsNullOrWhiteSpace(urlLike))\n                        {\n                            var ex = b?[\"example\"];\n                            if (ex is JArray arr) urlLike = arr.FirstOrDefault()?.ToString();\n                            else if (ex is JValue val) urlLike = val.ToString();\n                        }\n\n                        var tmpl = urlLike;\n                        var posIdx = string.IsNullOrEmpty(tmpl) ? new List<int>() : ExtractPositional(tmpl);\n\n                        buttons.Add(new ButtonParamTemplate\n                        {\n                            Order = order,\n                            Type = btnType,\n                            Text = text,\n                            ParamTemplate = tmpl,\n                            ParamIndices = posIdx\n                        });\n\n                        // collect occurrences for button text & param template separately\n                        if (!string.IsNullOrEmpty(text))\n                            occurrences.AddRange(CollectOccurrences(text, PlaceholderLocation.Button, order, \"text\"));\n\n                        if (!string.IsNullOrEmpty(tmpl))\n                            occurrences.AddRange(CollectOccurrences(tmpl!, PlaceholderLocation.Button, order, \"param\"));\n                    }\n                }\n            }\n\n            // fallback if no BODY block present in JSON\n            bodyText ??= bodyFallback ?? \"\";\n\n            var combined = CombinePreview(headerText, bodyText);\n\n            // Positional counting  max index across header/body/buttons\n            var maxHeader = headerPosIdx.DefaultIfEmpty(0).Max();\n            var maxBody = bodyPosIdx.DefaultIfEmpty(0).Max();\n            var maxBtns = buttons.SelectMany(b => b.ParamIndices).DefaultIfEmpty(0).Max();\n            var maxPositional = Math.Max(maxHeader, Math.Max(maxBody, maxBtns));\n\n            int placeholderCount;\n            if (maxPositional > 0)\n            {\n                placeholderCount = maxPositional;\n            }\n            else\n            {\n                // Named/empty mode  total {{...}} across header/body/buttons\n                placeholderCount =\n                    CountAny(headerText) +\n                    CountAny(bodyText) +\n                    buttons.Sum(b => CountAny(b.ParamTemplate)) +\n                    // button text may also contain placeholders\n                    buttons.Sum(b => CountAny(b.Text));\n            }\n\n            // ----- ParameterFormat resolution (hint  inference) -----\n            string? parameterFormat = null;\n            if (parameterFormatHint == \"POSITIONAL\" || parameterFormatHint == \"NAMED\")\n            {\n                parameterFormat = parameterFormatHint;\n            }\n            else\n            {\n                // Infer from content\n                var hasPositional = maxPositional > 0;\n                var hasNamed = occurrences.Any(o => o.Type == PlaceholderType.Named);\n\n                if (hasPositional) parameterFormat = \"POSITIONAL\";\n                else if (hasNamed) parameterFormat = \"NAMED\";\n                else parameterFormat = null; // unknown / no placeholders\n            }\n\n            return new TemplateSummaryDto\n            {\n                HeaderKind = headerKind,\n                HeaderText = headerText,\n                BodyText = bodyText,\n                CombinedPreviewBody = combined,\n                HeaderParamIndices = headerPosIdx,\n                BodyParamIndices = bodyPosIdx,\n                Buttons = buttons,\n                PlaceholderCount = placeholderCount,\n                Placeholders = occurrences,\n\n                // NEW: summary flag so services don't have to re-derive this\n                ParameterFormat = parameterFormat\n            };\n        }\n\n\n        /// <summary>Render a text with positional placeholders ({{1}}, {{2}}, ).</summary>\n        public static string RenderTextPositional(string? template, IReadOnlyDictionary<int, string> args)\n        {\n            if (string.IsNullOrEmpty(template)) return string.Empty;\n            // Replace highest-first to avoid {{1}} touching characters that form {{10}}\n            // Using Regex evaluator is safer:\n            return PositionalRx.Replace(template, m =>\n            {\n                var idx = int.Parse(m.Groups[1].Value);\n                return args.TryGetValue(idx, out var val) ? val ?? string.Empty : string.Empty;\n            });\n        }\n\n        /// <summary>Render a text with named placeholders ({{name}}, {{email}}). Empty {{}} treated as next positional index (1-based).</summary>\n        public static string RenderTextNamed(string? template, IReadOnlyDictionary<string, string> namedArgs, IReadOnlyDictionary<int, string>? positionalArgs = null)\n        {\n            if (string.IsNullOrEmpty(template)) return string.Empty;\n\n            // First replace named\n            var result = NamedRx.Replace(template, m =>\n            {\n                var key = m.Groups[1].Value;\n                return namedArgs.TryGetValue(key, out var val) ? val ?? string.Empty : string.Empty;\n            });\n\n            // Then positional if provided\n            if (positionalArgs != null && positionalArgs.Count > 0)\n            {\n                result = RenderTextPositional(result, positionalArgs);\n            }\n\n            // Finally convert empty {{}}  empty string (or you could plug a policy here)\n            result = Regex.Replace(result, @\"\\{\\{\\s*\\}\\}\", string.Empty);\n\n            return result;\n        }\n\n        // ---------- internal helpers ----------\n\n        private static List<int> ExtractPositional(string text)\n            => PositionalRx.Matches(text).Select(m => int.Parse(m.Groups[1].Value)).Distinct().ToList();\n\n        private static int CountAny(string? text)\n            => string.IsNullOrEmpty(text) ? 0 : AnyRx.Matches(text).Count;\n\n        private static string CombinePreview(string? header, string? body)\n        {\n            var h = string.IsNullOrWhiteSpace(header) ? null : header!.Trim();\n            var b = string.IsNullOrWhiteSpace(body) ? null : body!.Trim();\n            if (h is null && b is null) return \"\";\n            if (h is null) return b!;\n            if (b is null) return h!;\n            return $\"{h}\\n\\n{b}\";\n        }\n\n        private static IEnumerable<PlaceholderOccurrence> CollectOccurrences(\n            string text,\n            PlaceholderLocation location,\n            int? buttonOrder = null,\n            string? buttonField = null)\n        {\n            // Positional\n            foreach (Match m in PositionalRx.Matches(text))\n            {\n                yield return new PlaceholderOccurrence\n                {\n                    Type = PlaceholderType.Positional,\n                    Index = int.Parse(m.Groups[1].Value),\n                    Raw = m.Value,\n                    Location = location,\n                    ButtonOrder = buttonOrder,\n                    ButtonField = buttonField\n                };\n            }\n            // Named\n            foreach (Match m in NamedRx.Matches(text))\n            {\n                yield return new PlaceholderOccurrence\n                {\n                    Type = PlaceholderType.Named,\n                    Name = m.Groups[1].Value,\n                    Raw = m.Value,\n                    Location = location,\n                    ButtonOrder = buttonOrder,\n                    ButtonField = buttonField\n                };\n            }\n            // Empty braces (that werent positional or named)\n            // We count them by subtracting positional+named from all-any.\n            var any = AnyRx.Matches(text).Cast<Match>().Select(mm => mm.Value).ToList();\n            var consumed = new HashSet<string>(PositionalRx.Matches(text).Cast<Match>().Select(mm => mm.Value)\n                .Concat(NamedRx.Matches(text).Cast<Match>().Select(mm => mm.Value)));\n            foreach (var token in any.Where(t => !consumed.Contains(t)))\n            {\n                yield return new PlaceholderOccurrence\n                {\n                    Type = PlaceholderType.Empty,\n                    Raw = token,\n                    Location = location,\n                    ButtonOrder = buttonOrder,\n                    ButtonField = buttonField\n                };\n            }\n        }\n    }\n\n    // ---------- DTOs ----------\n\n    public sealed class TemplateSummaryDto\n    {\n        public string HeaderKind { get; set; } = \"none\";\n        public string? HeaderText { get; set; }\n        public string? BodyText { get; set; }\n\n        public List<int> HeaderParamIndices { get; set; } = new();\n        public List<int> BodyParamIndices { get; set; } = new();\n\n        public List<ButtonParamTemplate> Buttons { get; set; } = new();\n\n        public string? CombinedPreviewBody { get; set; }\n\n        public int PlaceholderCount { get; set; }\n\n        public List<PlaceholderOccurrence> Placeholders { get; set; } = new();\n        public string ParameterFormat { get; set; } = \"UNKNOWN\"; // POSITIONAL | NAMED | MIXED | UNKNOWN\n\n    }\n\n    public sealed class ButtonParamTemplate\n    {\n        public int Order { get; set; }\n        public string Type { get; set; } = \"\";\n        public string Text { get; set; } = \"\";\n        public string? ParamTemplate { get; set; }\n        public List<int> ParamIndices { get; set; } = new();\n    }\n\n    public enum PlaceholderType { Positional, Named, Empty }\n\n    public enum PlaceholderLocation {\n\n        Header = 0, Body = 1, Button = 2\n    }\n\n    public sealed class PlaceholderOccurrence\n    {\n        public PlaceholderType Type { get; set; }\n        public int? Index { get; set; }     // for Positional\n        public string? Name { get; set; }   // for Named\n        public string Raw { get; set; } = \"{{}}\";\n        public PlaceholderLocation Location { get; set; }\n        public int? ButtonOrder { get; set; }     // when Location == Button\n        public string? ButtonField { get; set; }  // \"text\" or \"param\"\n    }\n}\n"
    },
    {
      "path": "xbytechat-api/WhatsAppSettings/Models/WhatsAppPhoneNumber.cs",
      "sha256": "fbcd435532eb4acfc7bf5ec1191078f2598e733541f44cd2a3b768e96436ce0c",
      "language": "csharp",
      "size": 827,
      "content": "using System;\n\nnamespace xbytechat.api.Features.WhatsAppSettings.Models\n{\n    public class WhatsAppPhoneNumber\n    {\n        public Guid Id { get; set; } = Guid.NewGuid();\n\n        public Guid BusinessId { get; set; }\n        public string Provider { get; set; } = null!;                 // \"Meta_cloud\" | \"Pinnacle\" | etc.\n\n        public string PhoneNumberId { get; set; } = null!;            // provider-specific id (e.g., Meta phone_number_id)\n        public string WhatsAppBusinessNumber { get; set; } = null!;   // e.g., \"+15551234567\"\n        public string? SenderDisplayName { get; set; }\n\n        public bool IsActive { get; set; } = true;\n        public bool IsDefault { get; set; } = false;\n\n        public DateTime CreatedAt { get; set; } = DateTime.UtcNow;\n        public DateTime? UpdatedAt { get; set; }\n    }\n}\n"
    },
    {
      "path": "xbytechat-api/WhatsAppSettings/Models/WhatsAppSettingEntity.cs",
      "sha256": "d4e6aff67b15f0a503cd217b7ed30bf58b63b5e508dcb5da128ac989a36c6b63",
      "language": "csharp",
      "size": 1835,
      "content": "using System;\nusing System.ComponentModel.DataAnnotations;\nusing xbytechat.api.Features.WhatsAppSettings.Models;\n\nnamespace xbytechat_api.WhatsAppSettings.Models\n{\n    public class WhatsAppSettingEntity\n    {\n        [Key]\n        public Guid Id { get; set; }\n\n        [Required]\n        public Guid BusinessId { get; set; }\n\n        // NEW: which provider this row belongs to (\"pinnacle\", \"meta_cloud\", \"twilio\", etc.)\n        [Required]\n        [MaxLength(50)]\n        public string Provider { get; set; } //= \"pinnacle\";\n\n        [Required]\n        [MaxLength(500)]\n        public string ApiUrl { get; set; }  // e.g. https://partnersv1.pinbot.ai/v3\n\n        [MaxLength(1000)]\n        public string ApiKey { get; set; }\n\n        //[Required]\n        //[MaxLength(1000)]\n        //public string ApiToken { get; set; } // store encrypted\n\n        //[MaxLength(20)]\n       // public string? WhatsAppBusinessNumber { get; set; }\n\n        //public string? PhoneNumberId { get; set; } // used by Meta Cloud; Pinbot doesn't need it\n        public string? WabaId { get; set; } = string.Empty;\n\n        [MaxLength(100)]\n        public string? SenderDisplayName { get; set; }\n\n        // Optional: for webhook signature/verification if provider supports it\n        [MaxLength(200)]\n        public string? WebhookSecret { get; set; }\n\n        [MaxLength(200)]\n\n\n        public string? WebhookVerifyToken { get; set; }\n\n        [MaxLength(1000)]\n        public string? WebhookCallbackUrl { get; set; }\n\n\n        [Required]\n        public bool IsActive { get; set; } = true;\n\n        [Required]\n        public DateTime CreatedAt { get; set; } = DateTime.UtcNow;\n\n        public DateTime? UpdatedAt { get; set; }\n\n        public ICollection<WhatsAppPhoneNumber> WhatsAppBusinessNumbers { get; set; } = new List<WhatsAppPhoneNumber>();\n\n    }\n}\n\n\n"
    },
    {
      "path": "xbytechat-api/WhatsAppSettings/Providers/IMetaTemplateCatalogProvider.cs",
      "sha256": "73c5af3f63545a523d620b39d6c064a1264ba069f156e96dfd4538eba6a15848",
      "language": "csharp",
      "size": 541,
      "content": "using xbytechat.api.WhatsAppSettings.Abstractions;\nusing xbytechat_api.WhatsAppSettings.Models;\n\nnamespace xbytechat.api.WhatsAppSettings.Providers\n{\n    public interface IMetaTemplateCatalogProvider\n    {\n        Task<IReadOnlyList<TemplateCatalogItem>> ListMetaAsync(\n           WhatsAppSettingEntity setting,\n           CancellationToken ct = default);\n\n        Task<TemplateCatalogItem?> GetByNameMetaAsync(\n            WhatsAppSettingEntity setting,\n            string templateName,\n            CancellationToken ct = default);\n    }\n}\n"
    },
    {
      "path": "xbytechat-api/WhatsAppSettings/Providers/IPinnacleTemplateCatalogProvider.cs",
      "sha256": "7cb6804a809e2848861752dcdc26f6031e20ed3584ffb9872844faecabd90b67",
      "language": "csharp",
      "size": 551,
      "content": "using xbytechat.api.WhatsAppSettings.Abstractions;\nusing xbytechat_api.WhatsAppSettings.Models;\n\nnamespace xbytechat.api.WhatsAppSettings.Providers\n{\n    public interface IPinnacleTemplateCatalogProvider\n    {\n        Task<IReadOnlyList<TemplateCatalogItem>> ListPinnacleAsync(\n          WhatsAppSettingEntity setting,\n          CancellationToken ct = default);\n\n        Task<TemplateCatalogItem?> GetByNamePinnacleAsync(\n            WhatsAppSettingEntity setting,\n            string templateName,\n            CancellationToken ct = default);\n    }\n}\n"
    },
    {
      "path": "xbytechat-api/WhatsAppSettings/Providers/MetaTemplateCatalogProvider.cs",
      "sha256": "5db788f74106c14c8aeb9a145246ce07028eec573af21091ac12806d6d35d6ad",
      "language": "csharp",
      "size": 16844,
      "content": "using System.Globalization;\nusing System.Net.Http.Headers;\nusing System.Text.RegularExpressions;\nusing Microsoft.Extensions.Logging;\nusing Newtonsoft.Json;\nusing xbytechat.api.WhatsAppSettings.Abstractions;\nusing xbytechat.api.WhatsAppSettings.DTOs;\nusing xbytechat_api.WhatsAppSettings.Models;\n\nnamespace xbytechat.api.WhatsAppSettings.Providers\n{\n    public sealed class MetaTemplateCatalogProvider : IMetaTemplateCatalogProvider\n    {\n        private readonly HttpClient _http;\n        private readonly ILogger<MetaTemplateCatalogProvider> _log;\n\n        public MetaTemplateCatalogProvider(HttpClient http, ILogger<MetaTemplateCatalogProvider> log)\n        {\n            _http = http;\n            _log = log;\n        }\n\n        public async Task<IReadOnlyList<TemplateCatalogItem>> ListMetaAsync(\n            WhatsAppSettingEntity s, CancellationToken ct = default)\n        {\n            var items = new List<TemplateCatalogItem>();\n            if (string.IsNullOrWhiteSpace(s.ApiKey) || string.IsNullOrWhiteSpace(s.WabaId))\n                return items;\n\n            var baseUrl = s.ApiUrl?.TrimEnd('/') ?? \"https://graph.facebook.com/v22.0\";\n            var next = $\"{baseUrl}/{s.WabaId}/message_templates?limit=100\";\n\n            _http.DefaultRequestHeaders.Authorization = new AuthenticationHeaderValue(\"Bearer\", s.ApiKey);\n\n            while (!string.IsNullOrWhiteSpace(next))\n            {\n                ct.ThrowIfCancellationRequested();\n\n                using var req = new HttpRequestMessage(HttpMethod.Get, next);\n                var res = await _http.SendAsync(req, ct);\n                var json = await res.Content.ReadAsStringAsync(ct);\n                if (!res.IsSuccessStatusCode) break;\n\n                dynamic parsed = JsonConvert.DeserializeObject(json);\n                foreach (var tpl in parsed.data)\n                {\n                    try\n                    {\n                        // status filter\n                        string status = (tpl.status?.ToString() ?? \"\").ToUpperInvariant();\n                        if (status != \"APPROVED\" && status != \"ACTIVE\") continue;\n\n                        string name = tpl.name?.ToString() ?? \"\";\n                        string language = tpl.language?.ToString() ?? \"en_US\";\n                        string category = tpl.category?.ToString() ?? \"\";\n                        string externalId = tpl.id?.ToString() ?? \"\";\n\n                        string body = \"\";\n                        bool hasImageHeader = false;\n                        var buttons = new List<ButtonMetadataDto>();\n\n                        foreach (var comp in tpl.components)\n                        {\n                            string type = comp.type?.ToString()?.ToUpperInvariant() ?? \"\";\n\n                            if (type == \"BODY\")\n                            {\n                                body = comp.text?.ToString() ?? \"\";\n                            }\n                            else if (type == \"HEADER\")\n                            {\n                                if (comp.format?.ToString()?.ToUpperInvariant() == \"IMAGE\")\n                                    hasImageHeader = true;\n                            }\n                            else if (type == \"BUTTONS\")\n                            {\n                                if (comp.buttons == null) continue;\n\n                                foreach (var b in comp.buttons)\n                                {\n                                    try\n                                    {\n                                        string btnTypeRaw = b.type?.ToString() ?? \"\";\n                                        string btnType = btnTypeRaw.ToUpperInvariant();\n                                        string text = b.text?.ToString() ?? \"\";\n\n                                        // ---- robust index extraction (avoid RuntimeBinderException) ----\n                                        int index;\n                                        object? idxObj = null;\n                                        try { idxObj = b.index; } catch { /* some payloads omit index */ }\n                                        if (idxObj is int ii) index = ii;\n                                        else if (idxObj is long ll && ll <= int.MaxValue) index = (int)ll;\n                                        else if (idxObj != null && int.TryParse(idxObj.ToString(), NumberStyles.Integer, CultureInfo.InvariantCulture, out var parsedIdx))\n                                            index = parsedIdx;\n                                        else\n                                            index = buttons.Count; // fallback to current count\n\n                                        // normalize subtype & parameter value\n                                        string subType = btnType switch\n                                        {\n                                            \"URL\" => \"url\",\n                                            \"PHONE_NUMBER\" => \"voice_call\",\n                                            \"QUICK_REPLY\" => \"quick_reply\",\n                                            \"COPY_CODE\" => \"copy_code\",\n                                            \"CATALOG\" => \"catalog\",\n                                            \"FLOW\" => \"flow\",\n                                            \"REMINDER\" => \"reminder\",\n                                            \"ORDER_DETAILS\" => \"order_details\",\n                                            _ => \"unknown\"\n                                        };\n\n                                        // try to capture a useful value for URL-like buttons\n                                        string? param =\n                                            b.url != null ? b.url.ToString() :\n                                            b.phone_number != null ? b.phone_number.ToString() :\n                                            b.coupon_code != null ? b.coupon_code.ToString() :\n                                            b.flow_id != null ? b.flow_id.ToString() :\n                                            null;\n\n                                        // example can be array or scalar\n                                        if (string.IsNullOrWhiteSpace(param))\n                                        {\n                                            try\n                                            {\n                                                var ex = b.example;\n                                                if (ex != null)\n                                                {\n                                                    if (ex is string exStr) param = exStr;\n                                                    else\n                                                    {\n                                                        // attempt common shapes: { \"example\": { \"url\": [\"...\"] } } or [\"...\"]\n                                                        var exStr2 = ex.ToString();\n                                                        if (!string.IsNullOrWhiteSpace(exStr2))\n                                                            param = exStr2;\n                                                    }\n                                                }\n                                            }\n                                            catch { /* ignore */ }\n                                        }\n\n                                        // some subtypes require a value; skip if not available\n                                        bool requiresParam = subType is \"url\" or \"flow\" or \"copy_code\" or \"catalog\" or \"reminder\";\n                                        if (subType == \"unknown\" || (requiresParam && string.IsNullOrWhiteSpace(param)))\n                                            continue;\n\n                                        buttons.Add(new ButtonMetadataDto\n                                        {\n                                            Text = text,\n                                            Type = btnType,\n                                            SubType = subType,\n                                            Index = index,\n                                            ParameterValue = param ?? \"\"\n                                        });\n                                    }\n                                    catch (Exception exBtn)\n                                    {\n                                        _log.LogWarning(exBtn, \"[MetaTpl] Button parse failed for template {Name}\", name);\n                                    }\n                                }\n                            }\n                        }\n\n                        int placeholders = Regex.Matches(body ?? \"\", \"{{(.*?)}}\").Count;\n                        var raw = JsonConvert.SerializeObject(tpl);\n\n                        items.Add(new TemplateCatalogItem(\n                            Name: name,\n                            Language: language,\n                            Body: body,\n                            PlaceholderCount: placeholders,\n                            HasImageHeader: hasImageHeader,\n                            Buttons: buttons,\n                            Status: status,\n                            Category: category,\n                            ExternalId: externalId,\n                            RawJson: raw\n                        ));\n                    }\n                    catch (Exception exItem)\n                    {\n                        _log.LogWarning(exItem, \"[MetaTpl] Skipped bad template item\");\n                    }\n                }\n\n                // paging\n                try { next = parsed?.paging?.next?.ToString(); }\n                catch { next = null; }\n            }\n\n            return items;\n        }\n\n        public async Task<TemplateCatalogItem?> GetByNameMetaAsync(\n            WhatsAppSettingEntity s, string templateName, CancellationToken ct = default)\n        {\n            var all = await ListMetaAsync(s, ct);\n            return all.FirstOrDefault(t => t.Name.Equals(templateName, StringComparison.OrdinalIgnoreCase));\n        }\n    }\n}\n\n//using Newtonsoft.Json;\n//using System.Net.Http.Headers;\n//using System.Text.RegularExpressions;\n//using xbytechat.api.WhatsAppSettings.Abstractions;\n//using xbytechat.api.WhatsAppSettings.DTOs;\n//using xbytechat_api.WhatsAppSettings.Models;\n\n//namespace xbytechat.api.WhatsAppSettings.Providers\n//{\n//    public sealed class MetaTemplateCatalogProvider : ITemplateCatalogProvider\n//    {\n//        private readonly HttpClient _http;\n//        private readonly ILogger<MetaTemplateCatalogProvider> _log;\n\n//        public MetaTemplateCatalogProvider(HttpClient http, ILogger<MetaTemplateCatalogProvider> log)\n//        { _http = http; _log = log; }\n\n//        public async Task<IReadOnlyList<TemplateCatalogItem>> ListAsync(WhatsAppSettingEntity s, CancellationToken ct = default)\n//        {\n//            var items = new List<TemplateCatalogItem>();\n//            if (string.IsNullOrWhiteSpace(s.ApiKey) || string.IsNullOrWhiteSpace(s.WabaId))\n//                return items;\n\n//            var baseUrl = s.ApiUrl?.TrimEnd('/') ?? \"https://graph.facebook.com/v22.0\";\n//            var next = $\"{baseUrl}/{s.WabaId}/message_templates?limit=100\";\n\n//            _http.DefaultRequestHeaders.Authorization = new AuthenticationHeaderValue(\"Bearer\", s.ApiKey);\n\n//            while (!string.IsNullOrWhiteSpace(next))\n//            {\n//                var res = await _http.GetAsync(next, ct);\n//                var json = await res.Content.ReadAsStringAsync(ct);\n//                if (!res.IsSuccessStatusCode) break;\n\n//                dynamic parsed = JsonConvert.DeserializeObject(json);\n\n//                foreach (var tpl in parsed.data)\n//                {\n//                    // Filter APPROVED/ACTIVE\n//                    string status = (tpl.status?.ToString() ?? \"\").ToUpperInvariant();\n//                    if (status != \"APPROVED\" && status != \"ACTIVE\") continue;\n\n//                    string name = tpl.name;\n//                    string language = tpl.language ?? \"en_US\";\n//                    string body = \"\";\n//                    bool hasImageHeader = false;\n//                    var buttons = new List<ButtonMetadataDto>();\n\n//                    foreach (var comp in tpl.components)\n//                    {\n//                        string type = comp.type?.ToString()?.ToUpperInvariant();\n\n//                        if (type == \"BODY\")\n//                            body = comp.text?.ToString() ?? \"\";\n\n//                        if (type == \"HEADER\" && (comp.format?.ToString()?.ToUpperInvariant() == \"IMAGE\"))\n//                            hasImageHeader = true;\n\n//                        if (type == \"BUTTONS\")\n//                        {\n//                            foreach (var b in comp.buttons)\n//                            {\n//                                try\n//                                {\n//                                    string btnType = b.type?.ToString()?.ToUpperInvariant() ?? \"\";\n//                                    string text = b.text?.ToString() ?? \"\";\n//                                    int index = buttons.Count;\n\n//                                    string subType = btnType switch\n//                                    {\n//                                        \"URL\" => \"url\",\n//                                        \"PHONE_NUMBER\" => \"voice_call\",\n//                                        \"QUICK_REPLY\" => \"quick_reply\",\n//                                        \"COPY_CODE\" => \"copy_code\",\n//                                        \"CATALOG\" => \"catalog\",\n//                                        \"FLOW\" => \"flow\",\n//                                        \"REMINDER\" => \"reminder\",\n//                                        \"ORDER_DETAILS\" => \"order_details\",\n//                                        _ => \"unknown\"\n//                                    };\n\n//                                    string? param = b.url != null ? b.url.ToString()\n//                                                 : b.phone_number != null ? b.phone_number.ToString()\n//                                                 : b.coupon_code != null ? b.coupon_code.ToString()\n//                                                 : b.flow_id != null ? b.flow_id.ToString()\n//                                                 : null;\n\n//                                    bool hasExample = b.example != null;\n//                                    bool isDynamic = hasExample && Regex.IsMatch(b.example.ToString(), @\"\\{\\{[0-9]+\\}\\}\");\n//                                    bool requiresParam = new[] { \"url\", \"flow\", \"copy_code\", \"catalog\", \"reminder\" }.Contains(subType);\n//                                    bool needsRuntimeValue = requiresParam && isDynamic;\n//                                    if (subType == \"unknown\" || (param == null && needsRuntimeValue)) continue;\n\n//                                    buttons.Add(new ButtonMetadataDto\n//                                    {\n//                                        Text = text,\n//                                        Type = btnType,\n//                                        SubType = subType,\n//                                        Index = index,\n//                                        ParameterValue = param ?? \"\"\n//                                    });\n//                                }\n//                                catch (Exception ex)\n//                                { _log.LogWarning(ex, \"Button parse failed for template {Name}\", (string)name); }\n//                            }\n//                        }\n//                    }\n\n//                    int placeholders = Regex.Matches(body ?? \"\", \"{{(.*?)}}\").Count;\n//                    var raw = JsonConvert.SerializeObject(tpl);\n\n//                    items.Add(new TemplateCatalogItem(\n//                        Name: name,\n//                        Language: language,\n//                        Body: body,\n//                        PlaceholderCount: placeholders,\n//                        HasImageHeader: hasImageHeader,\n//                        Buttons: buttons,\n//                        Status: status,\n//                        Category: tpl.category?.ToString(),\n//                        ExternalId: tpl.id?.ToString(),\n//                        RawJson: raw\n//                    ));\n//                }\n\n//                next = parsed?.paging?.next?.ToString();\n//            }\n\n//            return items;\n//        }\n\n//        public async Task<TemplateCatalogItem?> GetByNameAsync(WhatsAppSettingEntity s, string templateName, CancellationToken ct = default)\n//            => (await ListAsync(s, ct)).FirstOrDefault(t => t.Name.Equals(templateName, StringComparison.OrdinalIgnoreCase));\n//    }\n//}"
    },
    {
      "path": "xbytechat-api/WhatsAppSettings/Providers/PinnacleTemplateCatalogProvider.cs",
      "sha256": "5bde2b8ac067b986ad6c7b929b798255af1cfad1c304e3023d34792ba7c0eee6",
      "language": "csharp",
      "size": 11298,
      "content": "// xbytechat.api/WhatsAppSettings/Providers/PinnacleTemplateCatalogProvider.cs\nusing System.Collections.Generic;\nusing System.Linq;\nusing System.Net.Http;\nusing System.Text.RegularExpressions;\nusing System.Threading;\nusing System.Threading.Tasks;\nusing Microsoft.EntityFrameworkCore;\nusing Microsoft.Extensions.Logging;\nusing Newtonsoft.Json;\nusing xbytechat.api.WhatsAppSettings.Abstractions;\nusing xbytechat.api.WhatsAppSettings.DTOs;\nusing xbytechat_api.WhatsAppSettings.Models;\nusing TemplateCatalogItem = xbytechat.api.WhatsAppSettings.Abstractions.TemplateCatalogItem;\n\nnamespace xbytechat.api.WhatsAppSettings.Providers\n{\n    // Make sure your DI registers this as IPinnacleTemplateCatalogProvider *and* ITemplateCatalogProvider if needed.\n    public sealed class PinnacleTemplateCatalogProvider : IPinnacleTemplateCatalogProvider\n    {\n        private readonly HttpClient _http;\n        private readonly ILogger<PinnacleTemplateCatalogProvider> _log;\n        private readonly AppDbContext _context;\n\n        public PinnacleTemplateCatalogProvider(\n            HttpClient http,\n            ILogger<PinnacleTemplateCatalogProvider> log,\n            AppDbContext context)\n        {\n            _http = http;\n            _log = log;\n            _context = context;\n        }\n\n        // === Interface method used by TemplateSyncService ===\n        // TemplateSyncService expects _pinnacle.ListAsync(setting, ct). We delegate to the concrete method below.\n        public Task<IReadOnlyList<TemplateCatalogItem>> ListAsync(\n            WhatsAppSettingEntity setting,\n            CancellationToken ct = default)\n            => ListPinnacleAsync(setting, ct);\n\n        // === Concrete implementation ===\n        public async Task<IReadOnlyList<TemplateCatalogItem>> ListPinnacleAsync(\n            WhatsAppSettingEntity setting,\n            CancellationToken ct = default)\n        {\n            var items = new List<TemplateCatalogItem>();\n\n            if (string.IsNullOrWhiteSpace(setting.ApiKey))\n            {\n                _log.LogWarning(\"Pinnacle: missing ApiKey for BusinessId {BusinessId}\", setting.BusinessId);\n                return items;\n            }\n\n            var baseUrl = (setting.ApiUrl ?? \"https://partnersv1.pinbot.ai\").TrimEnd('/');\n            if (!baseUrl.EndsWith(\"/v3\", System.StringComparison.OrdinalIgnoreCase))\n                baseUrl += \"/v3\";\n\n            var prov = (setting.Provider ?? \"\")\n                .Trim().Replace(\"-\", \"_\").Replace(\" \", \"_\")\n                .ToUpperInvariant();\n\n            var pathId = !string.IsNullOrWhiteSpace(setting.WabaId)\n                ? setting.WabaId!.Trim()\n                : await _context.WhatsAppPhoneNumbers\n                    .AsNoTracking()\n                    .Where(p => p.BusinessId == setting.BusinessId\n                                && p.IsActive\n                                && p.Provider.ToUpper() == prov)\n                    .OrderByDescending(p => p.IsDefault)\n                    .ThenByDescending(p => p.UpdatedAt ?? p.CreatedAt)\n                    .Select(p => p.PhoneNumberId)\n                    .FirstOrDefaultAsync(ct);\n\n            if (string.IsNullOrWhiteSpace(pathId))\n            {\n                _log.LogWarning(\"Pinnacle: missing WabaId/PhoneNumberId for BusinessId {BusinessId}\", setting.BusinessId);\n                return items;\n            }\n\n            _http.DefaultRequestHeaders.Remove(\"apikey\");\n            _http.DefaultRequestHeaders.Remove(\"x-api-key\");\n            _http.DefaultRequestHeaders.TryAddWithoutValidation(\"apikey\", setting.ApiKey);\n            _http.DefaultRequestHeaders.TryAddWithoutValidation(\"x-api-key\", setting.ApiKey);\n\n            string? nextUrl = $\"{baseUrl}/{pathId}/message_templates?limit=100\";\n\n            while (!string.IsNullOrWhiteSpace(nextUrl))\n            {\n                ct.ThrowIfCancellationRequested();\n\n                HttpResponseMessage res;\n                string json;\n                try\n                {\n                    using var req = new HttpRequestMessage(HttpMethod.Get, nextUrl);\n                    res = await _http.SendAsync(req, ct);\n                    json = await res.Content.ReadAsStringAsync(ct);\n                }\n                catch (System.Exception ex)\n                {\n                    _log.LogError(ex, \" Pinnacle HTTP error for {Url}\", nextUrl);\n                    break;\n                }\n\n                if (!res.IsSuccessStatusCode)\n                {\n                    _log.LogError(\" Pinnacle list failed ({Status}): {Body}\", (int)res.StatusCode, json);\n                    break;\n                }\n\n                dynamic parsed;\n                try { parsed = JsonConvert.DeserializeObject(json)!; }\n                catch (System.Exception ex)\n                {\n                    _log.LogError(ex, \" Pinnacle JSON parse error\");\n                    break;\n                }\n\n                var collection = parsed?.data ?? parsed?.templates;\n                if (collection == null)\n                {\n                    _log.LogInformation(\"Pinnacle: no data/templates array.\");\n                    break;\n                }\n\n                foreach (var tpl in collection)\n                {\n                    try\n                    {\n                        ct.ThrowIfCancellationRequested();\n\n                        string name = tpl?.name?.ToString() ?? \"\";\n                        string language = tpl?.language?.ToString() ?? \"\";\n                        string status = (tpl?.status?.ToString() ?? \"APPROVED\").Trim().ToUpperInvariant();\n                        string category = tpl?.category?.ToString() ?? \"\";\n                        string? subCat = tpl?.sub_category?.ToString();\n                        string externalId = tpl?.id?.ToString() ?? \"\";\n\n                        if (status != \"APPROVED\" && status != \"ACTIVE\")\n                            continue;\n\n                        string body = \"\";\n                        string headerKind = \"none\"; // text/image/video/document/none\n                        var buttons = new List<ButtonMetadataDto>();\n\n                        var components = tpl?.components;\n                        if (components != null)\n                        {\n                            foreach (var c in components)\n                            {\n                                var type = c?.type?.ToString()?.ToUpperInvariant();\n\n                                if (type == \"BODY\")\n                                {\n                                    body = c?.text?.ToString() ?? \"\";\n                                }\n                                else if (type == \"HEADER\")\n                                {\n                                    var fmt = c?.format?.ToString()?.ToUpperInvariant();\n                                    headerKind = fmt switch\n                                    {\n                                        \"TEXT\" => \"text\",\n                                        \"IMAGE\" => \"image\",\n                                        \"VIDEO\" => \"video\",\n                                        \"DOCUMENT\" => \"document\",\n                                        _ => \"none\"\n                                    };\n                                }\n                                else if (type == \"BUTTONS\" && c?.buttons != null)\n                                {\n                                    foreach (var b in c.buttons)\n                                    {\n                                        string btnType = b?.type?.ToString()?.ToUpperInvariant() ?? \"\";\n                                        string text = b?.text?.ToString() ?? \"\";\n\n                                        // Prefer provider index if present; fallback to list order.\n                                        int index = 0;\n                                        if (!int.TryParse(b?.index?.ToString(), out index))\n                                            index = buttons.Count;\n\n                                        string subType = btnType switch\n                                        {\n                                            \"URL\" => \"url\",\n                                            \"PHONE_NUMBER\" => \"voice_call\",\n                                            \"QUICK_REPLY\" => \"quick_reply\",\n                                            \"COPY_CODE\" => \"copy_code\",\n                                            \"CATALOG\" => \"catalog\",\n                                            \"FLOW\" => \"flow\",\n                                            \"REMINDER\" => \"reminder\",\n                                            \"ORDER_DETAILS\" => \"order_details\",\n                                            _ => \"unknown\"\n                                        };\n                                        if (subType == \"unknown\") continue;\n\n                                        string? param =\n                                            b?.url?.ToString()\n                                            ?? b?.phone_number?.ToString()\n                                            ?? b?.coupon_code?.ToString()\n                                            ?? b?.flow_id?.ToString();\n\n                                        buttons.Add(new ButtonMetadataDto\n                                        {\n                                            Text = text,\n                                            Type = btnType,\n                                            SubType = subType,\n                                            Index = index,\n                                            ParameterValue = param ?? \"\"\n                                        });\n                                    }\n                                }\n                            }\n                        }\n\n                        // PlaceholderCount is not used by sync; it recomputes from RawJson.\n                        var raw = JsonConvert.SerializeObject(tpl);\n\n                        items.Add(new TemplateCatalogItem(\n                            Name: name,\n                            Language: language,\n                            Body: body,\n                            PlaceholderCount: 0,                 // sync derives counts from RawJson\n                            HasImageHeader: headerKind == \"image\",\n                            Buttons: buttons,\n                            Status: status,\n                            Category: category,\n                            ExternalId: externalId,\n                            RawJson: raw,\n                            SubCategory: subCat\n                        ));\n                    }\n                    catch\n                    {\n                        // swallow a bad item and continue\n                    }\n                }\n\n                // safe paging read\n                try { nextUrl = parsed?.paging?.next?.ToString(); }\n                catch { nextUrl = null; }\n                if (string.IsNullOrWhiteSpace(nextUrl)) break;\n            }\n\n            return items;\n        }\n\n        public Task<TemplateCatalogItem?> GetByNamePinnacleAsync(\n            WhatsAppSettingEntity setting,\n            string templateName,\n            CancellationToken ct = default)\n            => Task.FromResult<TemplateCatalogItem?>(null); // not used in sync path\n    }\n}\n"
    },
    {
      "path": "xbytechat-api/WhatsAppSettings/Services/ITemplatePreviewService.cs",
      "sha256": "a3a93cd8e29af752b16c49daadd82a6a419069bc5933177e663d030e47304f4e",
      "language": "csharp",
      "size": 306,
      "content": "using System;\nusing System.Threading.Tasks;\nusing xbytechat.api.WhatsAppSettings.DTOs;\n\nnamespace xbytechat_api.WhatsAppSettings.Services\n{\n    public interface ITemplatePreviewService\n    {\n        Task<TemplatePreviewResponseDto> PreviewAsync(Guid businessId, TemplatePreviewRequestDto request);\n    }\n}\n"
    },
    {
      "path": "xbytechat-api/WhatsAppSettings/Services/ITemplateSyncService.cs",
      "sha256": "4f3db9b43981973f160e937b9d1c3581dec0398d14d1fad47dd9151132b8725e",
      "language": "csharp",
      "size": 407,
      "content": "namespace xbytechat.api.WhatsAppSettings.Services\n{\n    public interface ITemplateSyncService\n    {\n        Task<TemplateSyncResult>\n            SyncBusinessTemplatesAsync(Guid businessId, \n            bool force = false,\n            bool onlyUpsert = false,\n            CancellationToken ct = default);\n    }\n    public record TemplateSyncResult(int Added, int Updated, int Skipped, DateTime SyncedAt);\n\n}\n"
    },
    {
      "path": "xbytechat-api/WhatsAppSettings/Services/IWhatsAppPhoneNumberService.cs",
      "sha256": "c9bc6548dcd7992936780ef305a214e46e641f096d252bbda87cc42ed32cbfe9",
      "language": "csharp",
      "size": 1614,
      "content": "using System;\nusing System.Collections.Generic;\nusing System.Threading.Tasks;\nusing xbytechat.api.Features.WhatsAppSettings.Models;\nusing xbytechat.api.WhatsAppSettings.DTOs;\nusing xbytechat_api.WhatsAppSettings.Models;\n\nnamespace xbytechat.api.Features.WhatsAppSettings.Services\n{\n    public interface IWhatsAppPhoneNumberService\n    {\n        Task<IReadOnlyList<WhatsAppPhoneNumber>> ListAsync(Guid businessId, string provider, CancellationToken ct = default);\n\n        Task<WhatsAppPhoneNumber> UpsertAsync(\n            Guid businessId,\n            string provider,\n            string phoneNumberId,\n            string whatsAppBusinessNumber,\n            string? senderDisplayName,\n            bool? isActive = null,\n            bool? isDefault = null);\n\n        // Delete by entity Id (GUID)\n        Task<bool> DeleteAsync(Guid businessId, string provider, Guid id);\n\n        // Set one number as default (enforces one default per (business, provider))\n        Task<bool> SetDefaultAsync(Guid businessId, string provider, Guid id);\n\n        // Find a specific number by PhoneNumberId\n        Task<WhatsAppPhoneNumber?> FindAsync(Guid businessId, string provider, string phoneNumberId);\n\n        // Get the default number for a provider (or null if not set)\n        Task<WhatsAppPhoneNumber?> GetDefaultAsync(Guid businessId, string provider);\n\n        // in IWhatsAppPhoneNumberService\n        Task<(int Added, int Updated, int Total)> SyncFromProviderAsync(\n        Guid businessId,\n        WhatsAppSettingsDto setting,   // DTO\n        string provider,\n        CancellationToken ct = default);\n    }\n}\n"
    },
    {
      "path": "xbytechat-api/WhatsAppSettings/Services/IWhatsAppSenderService.cs",
      "sha256": "b6780029b1436d346fc9f57aca94684bdc620076e88e7df8711805cc3edc3b02",
      "language": "csharp",
      "size": 425,
      "content": "using xbytechat.api.WhatsAppSettings.DTOs;\n\nnamespace xbytechat.api.WhatsAppSettings.Services\n{\n    public interface IWhatsAppSenderService\n    {\n        Task<IReadOnlyList<WhatsAppSenderDto>> GetBusinessSendersAsync(Guid businessId, CancellationToken ct = default);\n        Task<(string Provider, string PhoneNumberId)?> ResolveSenderPairAsync(Guid businessId, string phoneNumberId, CancellationToken ct = default);\n    }\n}\n"
    },
    {
      "path": "xbytechat-api/WhatsAppSettings/Services/IWhatsAppSettingsService.cs",
      "sha256": "92b4186c4b6aca80883ae90759b1ed3e8cabe2d2953a5954169221f857f6597e",
      "language": "csharp",
      "size": 913,
      "content": "using System;\nusing System.Threading.Tasks;\nusing xbytechat.api.WhatsAppSettings.DTOs;\nusing xbytechat_api.WhatsAppSettings.DTOs;\nusing xbytechat_api.WhatsAppSettings.Models;\n\nnamespace xbytechat_api.WhatsAppSettings.Services\n{\n    public interface IWhatsAppSettingsService\n    {\n        Task SaveOrUpdateSettingAsync(SaveWhatsAppSettingDto dto);\n        Task<WhatsAppSettingsDto> GetSettingsByBusinessIdAsync(Guid businessId);\n        Task<bool> DeleteSettingsAsync(Guid businessId);\n        Task<string> TestConnectionAsync(SaveWhatsAppSettingDto dto);\n        Task<string?> GetSenderNumberAsync(Guid businessId);\n        Task<string> GetCallbackUrlAsync(Guid businessId, string appBaseUrl);\n        Task<IReadOnlyList<WhatsAppSettingEntity>> GetAllForBusinessAsync(Guid businessId);\n        Task<WhatsAppSettingEntity?> GetSettingsByBusinessIdAndProviderAsync(Guid businessId, string provider);\n      \n    }\n}\n"
    },
    {
      "path": "xbytechat-api/WhatsAppSettings/Services/IWhatsAppTemplateFetcherService.cs",
      "sha256": "14a7a41486ab4e78dc848576af52394b66a21a256d1edbf8e85f605c2e31e119",
      "language": "csharp",
      "size": 762,
      "content": "using System;\nusing System.Collections.Generic;\nusing System.Threading.Tasks;\nusing xbytechat.api.WhatsAppSettings.DTOs;\n\n\nnamespace xbytechat_api.WhatsAppSettings.Services\n{\n    public interface IWhatsAppTemplateFetcherService\n    {\n        Task<List<TemplateMetadataDto>> FetchTemplatesAsync(Guid businessId);\n        Task<List<TemplateForUIResponseDto>> FetchAllTemplatesAsync();\n        Task<TemplateMetadataDto?> GetTemplateByNameAsync(Guid businessId, string templateName, bool includeButtons);\n\n        Task<IReadOnlyList<TemplateMetaDto>> GetTemplatesMetaAsync(Guid businessId, string? provider = null);\n        Task<TemplateMetaDto?> GetTemplateMetaAsync(Guid businessId, string templateName, string? language = null, string? provider = null);\n\n    }\n}\n"
    }
  ]
}
